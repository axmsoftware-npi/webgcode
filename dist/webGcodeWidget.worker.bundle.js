/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.0.14
 */

/********************************************************************************
 *                                                                              *
 * Author    :  Angus Johnson                                                   *
 * Version   :  6.1.3a                                                          *
 * Date      :  22 January 2014                                                 *
 * Website   :  http://www.angusj.com                                           *
 * Copyright :  Angus Johnson 2010-2014                                         *
 *                                                                              *
 * License:                                                                     *
 * Use, modification & distribution is subject to Boost Software License Ver 1. *
 * http://www.boost.org/LICENSE_1_0.txt                                         *
 *                                                                              *
 * Attributions:                                                                *
 * The code in this library is an extension of Bala Vatti's clipping algorithm: *
 * "A generic solution to polygon clipping"                                     *
 * Communications of the ACM, Vol 35, Issue 7 (July 1992) pp 56-63.             *
 * http://portal.acm.org/citation.cfm?id=129906                                 *
 *                                                                              *
 * Computer graphics and geometric modeling: implementation and algorithms      *
 * By Max K. Agoston                                                            *
 * Springer; 1 edition (January 4, 2005)                                        *
 * http://books.google.com/books?q=vatti+clipping+agoston                       *
 *                                                                              *
 * See also:                                                                    *
 * "Polygon Offsetting by Computing Winding Numbers"                            *
 * Paper no. DETC2005-85513 pp. 565-575                                         *
 * ASME 2005 International Design Engineering Technical Conferences             *
 * and Computers and Information in Engineering Conference (IDETC/CIE2005)      *
 * September 24-28, 2005 , Long Beach, California, USA                          *
 * http://www.me.berkeley.edu/~mcmains/pubs/DAC05OffsetPolygon.pdf              *
 *                                                                              *
 *******************************************************************************/

/*******************************************************************************
 *                                                                              *
 * Basic JavaScript BN library - subset useful for RSA encryption.              *
 * http://www-cs-students.stanford.edu/~tjw/jsbn/                               *
 * Copyright (c) 2005  Tom Wu                                                   *
 * All Rights Reserved.                                                         *
 * See "LICENSE" for details:                                                   *
 * http://www-cs-students.stanford.edu/~tjw/jsbn/LICENSE                        *
 *                                                                              *
 *******************************************************************************/

// Copyright (c) 2005  Tom Wu

// Copyright (c) 2005-2009  Tom Wu

/*
 (c) 2013, Vladimir Agafonkin
 Simplify.js, a high-performance JS polyline simplification library
 mourner.github.io/simplify-js
 */

// Parts of RaphaÃ«l 2.1.0 (MIT licence: http://raphaeljs.com/license.html)

// Copyright (C) 2007 Chris Double.
//
// Redistribution and use in source and binary forms, with or without
// modification, are permitted provided that the following conditions are met:
//
// 1. Redistributions of source code must retain the above copyright notice,
//    this list of conditions and the following disclaimer.
//
// 2. Redistributions in binary form must reproduce the above copyright notice,
//    this list of conditions and the following disclaimer in the documentation
//    and/or other materials provided with the distribution.
//
// THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
// INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
// FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
// DEVELOPERS AND CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
// OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
// WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
// OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
// ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
//

(function(){function e(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function t(e){var t=e._promiseCallbacks;return t||(t=e._promiseCallbacks={}),t}function i(e,t){if(e==="onerror"){r.on("error",t);return}if(arguments.length!==2)return r[e];r[e]=t}function s(e){return typeof e=="function"||typeof e=="object"&&e!==null}function o(e){return typeof e=="function"}function u(e){return typeof e=="object"&&e!==null}function c(){}function d(){setTimeout(function(){var e;for(var t=0;t<p.length;t++){e=p[t];var n=e.payload;n.guid=n.key+n.id,n.childGuid=n.key+n.childId,n.error&&(n.stack=n.error.stack),r.trigger(e.name,e.payload)}p.length=0},50)}function v(e,t,n){1===p.push({name:e,payload:{key:t._guidKey,id:t._id,eventName:e,detail:t._result,childId:n&&n._id,label:t._label,timeStamp:l(),error:r["instrument-with-stack"]?new Error(t._label):null}})&&d()}function g(){return new TypeError("A promises callback cannot return that same promise.")}function y(){}function x(e){try{return e.then}catch(t){return S.error=t,S}}function T(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function N(e,t,n){r.async(function(e){var r=!1,i=T(n,t,function(n){if(r)return;r=!0,t!==n?L(e,n):O(e,n)},function(t){if(r)return;r=!0,M(e,t)},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,M(e,i))},e)}function C(e,t){t._state===w?O(e,t._result):e._state===E?M(e,t._result):_(t,undefined,function(n){t!==n?L(e,n):O(e,n)},function(t){M(e,t)})}function k(e,t){if(t.constructor===e.constructor)C(e,t);else{var n=x(t);n===S?M(e,S.error):n===undefined?O(e,t):o(n)?N(e,t,n):O(e,t)}}function L(e,t){e===t?O(e,t):s(t)?k(e,t):O(e,t)}function A(e){e._onerror&&e._onerror(e._result),D(e)}function O(e,t){if(e._state!==b)return;e._result=t,e._state=w,e._subscribers.length===0?r.instrument&&m("fulfilled",e):r.async(D,e)}function M(e,t){if(e._state!==b)return;e._state=E,e._result=t,r.async(A,e)}function _(e,t,n,i){var s=e._subscribers,o=s.length;e._onerror=null,s[o]=t,s[o+w]=n,s[o+E]=i,o===0&&e._state&&r.async(D,e)}function D(e){var t=e._subscribers,n=e._state;r.instrument&&m(n===w?"fulfilled":"rejected",e);if(t.length===0)return;var i,s,o=e._result;for(var u=0;u<t.length;u+=3)i=t[u],s=t[u+n],i?j(n,i,s,o):s(o);e._subscribers.length=0}function P(){this.error=null}function B(e,t){try{return e(t)}catch(n){return H.error=n,H}}function j(e,t,n,r){var i=o(n),s,u,a,f;if(i){s=B(n,r),s===H?(f=!0,u=s.error,s=null):a=!0;if(t===s){M(t,g());return}}else s=r,a=!0;t._state===b&&(i&&a?L(t,s):f?M(t,u):e===w?O(t,s):e===E&&M(t,s))}function F(e,t){try{t(function(n){L(e,n)},function(n){M(e,n)})}catch(n){M(e,n)}}function I(e,t,n){return e===w?{state:"fulfilled",value:n}:{state:"rejected",reason:n}}function q(e,t,n,r){this._instanceConstructor=e,this.promise=new e(y,r),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),this.length===0?O(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&O(this.promise,this._result))):M(this.promise,this._validationError())}function U(e,t){return(new R(this,e,!0,t)).promise}function W(e,t){function s(e){L(r,e)}function o(e){M(r,e)}var n=this,r=new n(y,t);if(!f(e))return M(r,new TypeError("You must pass an array to race.")),r;var i=e.length;for(var u=0;r._state===b&&u<i;u++)_(n.resolve(e[u]),undefined,s,o);return r}function V(e,t){var n=this;if(e&&typeof e=="object"&&e.constructor===n)return e;var r=new n(y,t);return L(r,e),r}function J(e,t){var n=this,r=new n(y,t);return M(r,e),r}function Y(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function Z(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function et(e,t){this._id=G++,this._label=t,this._state=undefined,this._result=undefined,this._subscribers=[],r.instrument&&m("created",this),y!==e&&(o(e)||Y(),this instanceof et||Z(),F(this,e))}function nt(){this.value=undefined}function st(e){try{return e.then}catch(t){return rt.value=t,rt}}function ot(e,t,n){try{e.apply(t,n)}catch(r){return rt.value=r,rt}}function ut(e,t){var n={},r,i,s=e.length,o=new Array(s);for(var u=0;u<s;u++)o[u]=e[u];for(i=0;i<t.length;i++)r=t[i],n[r]=o[i+1];return n}function at(e){var t=e.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=e[r];return n}function ft(e,t){return{then:function(n,r){return e.call(t,n,r)}}}function lt(e,t){var n=function(){var n=this,r=arguments.length,i=new Array(r+1),s,o=!1;for(var u=0;u<r;++u){s=arguments[u];if(!o){o=dt(s);if(o===it){var a=new tt(y);return M(a,it.value),a}o&&o!==!0&&(s=ft(o,s))}i[u]=s}var l=new tt(y);return i[r]=function(e,n){e?M(l,e):t===undefined?L(l,n):t===!0?L(l,at(arguments)):f(t)?L(l,ut(arguments,t)):L(l,n)},o?pt(l,i,e,n):ht(l,i,e,n)};return n.__proto__=e,n}function ht(e,t,n,r){var i=ot(n,r,t);return i===rt&&M(e,i.value),e}function pt(e,t,n,r){return tt.all(t).then(function(t){var i=ot(n,r,t);return i===rt&&M(e,i.value),e})}function dt(e){return e&&typeof e=="object"?e.constructor===tt?!0:st(e):!1}function vt(e,t){return tt.all(e,t)}function gt(e,t,n){this._superConstructor(e,t,!1,n)}function yt(e,t){return(new gt(tt,e,t)).promise}function wt(e,t){return tt.race(e,t)}function St(e,t,n){this._superConstructor(e,t,!0,n)}function Tt(e,t){return(new xt(tt,e,t)).promise}function Ct(e,t,n){this._superConstructor(e,t,!1,n)}function kt(e,t){return(new Ct(tt,e,t)).promise}function At(e){throw setTimeout(function(){throw e}),e}function Mt(e){var t={};return t.promise=new tt(function(e,n){t.resolve=e,t.reject=n},e),t}function Dt(e,t,n){return tt.all(e,n).then(function(e){if(!o(t))throw new TypeError("You must pass a function as map's second argument.");var r=e.length,i=new Array(r);for(var s=0;s<r;s++)i[s]=t(e[s]);return tt.all(i,n)})}function Ht(e,t){return tt.resolve(e,t)}function jt(e,t){return tt.reject(e,t)}function It(e,t,n){return tt.all(e,n).then(function(e){if(!o(t))throw new TypeError("You must pass a function as filter's second argument.");var r=e.length,i=new Array(r);for(var s=0;s<r;s++)i[s]=t(e[s]);return tt.all(i,n).then(function(t){var n=new Array(r),i=0;for(var s=0;s<r;s++)t[s]&&(n[i]=e[s],i++);return n.length=i,n})})}function Ut(e,t){Zt[Rt]=e,Zt[Rt+1]=t,Rt+=2,Rt===2&&nn()}function Jt(){return function(){process.nextTick(en)}}function Kt(){return function(){vertxNext(en)}}function Qt(){var e=0,t=new Vt(en),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function Gt(){var e=new MessageChannel;return e.port1.onmessage=en,function(){e.port2.postMessage(0)}}function Yt(){return function(){setTimeout(en,1)}}function en(){for(var e=0;e<Rt;e+=2){var t=Zt[e],n=Zt[e+1];t(n),Zt[e]=undefined,Zt[e+1]=undefined}Rt=0}function tn(){try{var e=require("vertx"),t=e.runOnLoop||e.runOnContext;return Kt()}catch(n){return Yt()}}function sn(e,t){r.async(e,t)}function on(){r.on.apply(r,arguments)}function un(){r.off.apply(r,arguments)}var n={mixin:function(e){return e.on=this.on,e.off=this.off,e.trigger=this.trigger,e._promiseCallbacks=undefined,e},on:function(n,r){var i=t(this),s;s=i[n],s||(s=i[n]=[]),e(s,r)===-1&&s.push(r)},off:function(n,r){var i=t(this),s,o;if(!r){i[n]=[];return}s=i[n],o=e(s,r),o!==-1&&s.splice(o,1)},trigger:function(e,n){var r=t(this),i,s;if(i=r[e])for(var o=0;o<i.length;o++)s=i[o],s(n)}},r={instrument:!1};n.mixin(r);var a;Array.isArray?a=Array.isArray:a=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var f=a,l=Date.now||function(){return(new Date).getTime()},h=Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if(typeof e!="object")throw new TypeError("Argument must be an object");return c.prototype=e,new c},p=[],m=v,b=void 0,w=1,E=2,S=new P,H=new P,R=q;q.prototype._validateInput=function(e){return f(e)},q.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},q.prototype._init=function(){this._result=new Array(this.length)},q.prototype._enumerate=function(){var e=this.length,t=this.promise,n=this._input;for(var r=0;t._state===b&&r<e;r++)this._eachEntry(n[r],r)},q.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;u(e)?e.constructor===n&&e._state!==b?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(n.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(w,t,e))},q.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===b&&(this._remaining--,this._abortOnReject&&e===E?M(r,n):this._result[t]=this._makeResult(e,t,n)),this._remaining===0&&O(r,this._result)},q.prototype._makeResult=function(e,t,n){return n},q.prototype._willSettleAt=function(e,t){var n=this;_(e,undefined,function(e){n._settledAt(w,t,e)},function(e){n._settledAt(E,t,e)})};var z=U,X=W,$=V,K=J,Q="rsvp_"+l()+"-",G=0,tt=et;et.cast=$,et.all=z,et.race=X,et.resolve=$,et.reject=K,et.prototype={constructor:et,_guidKey:Q,_onerror:function(e){r.trigger("error",e)},then:function(e,t,n){var i=this,s=i._state;if(s===w&&!e||s===E&&!t)return r.instrument&&m("chained",this,this),this;i._onerror=null;var o=new this.constructor(y,n),u=i._result;r.instrument&&m("chained",i,o);if(s){var a=arguments[s-1];r.async(function(){j(s,o,a,u)})}else _(i,o,e,t);return o},"catch":function(e,t){return this.then(null,e,t)},"finally":function(e,t){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})},t)}};var rt=new nt,it=new nt,ct=lt,mt=vt;gt.prototype=h(R.prototype),gt.prototype._superConstructor=R,gt.prototype._makeResult=I,gt.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var bt=yt,Et=wt,xt=St;St.prototype=h(R.prototype),St.prototype._superConstructor=R,St.prototype._init=function(){this._result={}},St.prototype._validateInput=function(e){return e&&typeof e=="object"},St.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},St.prototype._enumerate=function(){var e=this.promise,t=this._input,n=[];for(var r in t)e._state===b&&t.hasOwnProperty(r)&&n.push({position:r,entry:t[r]});var i=n.length;this._remaining=i;var s;for(var o=0;e._state===b&&o<i;o++)s=n[o],this._eachEntry(s.entry,s.position)};var Nt=Tt;Ct.prototype=h(xt.prototype),Ct.prototype._superConstructor=R,Ct.prototype._makeResult=I,Ct.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var Lt=kt,Ot=At,_t=Mt,Pt=Dt,Bt=Ht,Ft=jt,qt=It,Rt=0,zt=Ut,Wt=typeof window!="undefined"?window:undefined,Xt=Wt||{},Vt=Xt.MutationObserver||Xt.WebKitMutationObserver,$t=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined",Zt=new Array(1e3),nn;typeof process!="undefined"&&{}.toString.call(process)==="[object process]"?nn=Jt():Vt?nn=Qt():$t?nn=Gt():Wt===undefined&&typeof require=="function"?nn=tn():nn=Yt(),r.async=zt;var rn=Bt;if(typeof window!="undefined"&&typeof window.__PROMISE_INSTRUMENTATION__=="object"){var an=window.__PROMISE_INSTRUMENTATION__;i("instrument",!0);for(var fn in an)an.hasOwnProperty(fn)&&on(fn,an[fn])}var ln={race:Et,Promise:tt,allSettled:bt,hash:Nt,hashSettled:Lt,denodeify:ct,on:on,off:un,map:Pt,filter:qt,resolve:Bt,reject:Ft,all:mt,rethrow:Ot,defer:_t,EventTarget:n,configure:i,async:sn};typeof define=="function"&&define.amd?define("RSVP",[],function(){return ln}):typeof module!="undefined"&&module.exports?module.exports=ln:typeof this!="undefined"&&(this.RSVP=ln)}).call(this),function(){function h(e,t,n){i.biginteger_used=1,e!=null&&("number"==typeof e&&"undefined"==typeof t?this.fromInt(e):"number"==typeof e?this.fromNumber(e,t,n):t==null&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function p(){return new h(null)}function d(e,t,n,r,i,s){while(--s>=0){var o=t*this[e++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=o&67108863}return i}function v(e,t,n,r,i,s){var o=t&32767,u=t>>15;while(--s>=0){var a=this[e]&32767,f=this[e++]>>15,l=u*a+f*o;a=o*a+((l&32767)<<15)+n[r]+(i&1073741823),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n[r++]=a&1073741823}return i}function m(e,t,n,r,i,s){var o=t&16383,u=t>>14;while(--s>=0){var a=this[e]&16383,f=this[e++]>>14,l=u*a+f*o;a=o*a+((l&16383)<<14)+n[r]+i,i=(a>>28)+(l>>14)+u*f,n[r++]=a&268435455}return i}function S(e){return y.charAt(e)}function x(e,t){var n=b[e.charCodeAt(t)];return n==null?-1:n}function T(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function N(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function C(e){var t=p();return t.fromInt(e),t}function k(e,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==256)n=8;else if(t==2)n=1;else if(t==32)n=5;else{if(t!=4){this.fromRadix(e,t);return}n=2}this.t=0,this.s=0;var r=e.length,i=!1,s=0;while(--r>=0){var o=n==8?e[r]&255:x(e,r);if(o<0){e.charAt(r)=="-"&&(i=!0);continue}i=!1,s==0?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB)}n==8&&(e[0]&128)!=0&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&h.ZERO.subTo(this,this)}function L(){var e=this.s&this.DM;while(this.t>0&&this[this.t-1]==e)--this.t}function A(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else{if(e!=4)return this.toRadix(e);t=2}var n=(1<<t)-1,r,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0){u<this.DB&&(r=this[o]>>u)>0&&(i=!0,s=S(r));while(o>=0)u<t?(r=(this[o]&(1<<u)-1)<<t-u,r|=this[--o]>>(u+=this.DB-t)):(r=this[o]>>(u-=t)&n,u<=0&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=S(r))}return i?s:"0"}function O(){var e=p();return h.ZERO.subTo(this,e),e}function M(){return this.s<0?this.negate():this}function _(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t;t=n-e.t;if(t!=0)return this.s<0?-t:t;while(--n>=0)if((t=this[n]-e[n])!=0)return t;return 0}function D(e){var t=1,n;return(n=e>>>16)!=0&&(e=n,t+=16),(n=e>>8)!=0&&(e=n,t+=8),(n=e>>4)!=0&&(e=n,t+=4),(n=e>>2)!=0&&(e=n,t+=2),(n=e>>1)!=0&&(e=n,t+=1),t}function P(){return this.t<=0?0:this.DB*(this.t-1)+D(this[this.t-1]^this.s&this.DM)}function H(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function B(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function j(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>r|o,o=(this[u]&i)<<n;for(u=s-1;u>=0;--u)t[u]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function F(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function I(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function q(e,t){var n=this.abs(),r=e.abs(),i=n.t;t.t=i+r.t;while(--i>=0)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&h.ZERO.subTo(t,t)}function R(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function U(e,t,n){var r=e.abs();if(r.t<=0)return;var i=this.abs();if(i.t<r.t){t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=p());var s=p(),o=this.s,u=e.s,a=this.DB-D(r[r.t-1]);a>0?(r.lShiftTo(a,s),i.lShiftTo(a,n)):(r.copyTo(s),i.copyTo(n));var f=s.t,l=s[f-1];if(l==0)return;var c=l*(1<<this.F1)+(f>1?s[f-2]>>this.F2:0),d=this.FV/c,v=(1<<this.F1)/c,m=1<<this.F2,g=n.t,y=g-f,b=t==null?p():t;s.dlShiftTo(y,b),n.compareTo(b)>=0&&(n[n.t++]=1,n.subTo(b,n)),h.ONE.dlShiftTo(f,b),b.subTo(s,s);while(s.t<f)s[s.t++]=0;while(--y>=0){var w=n[--g]==l?this.DM:Math.floor(n[g]*d+(n[g-1]+m)*v);if((n[g]+=s.am(0,w,n,y,0,f))<w){s.dlShiftTo(y,b),n.subTo(b,n);while(n[g]<--w)n.subTo(b,n)}}t!=null&&(n.drShiftTo(f,t),o!=u&&h.ZERO.subTo(t,t)),n.t=f,n.clamp(),a>0&&n.rShiftTo(a,n),o<0&&h.ZERO.subTo(n,n)}function z(e){var t=p();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(h.ZERO)>0&&e.subTo(t,t),t}function W(e){this.m=e}function X(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function V(e){return e}function $(e){e.divRemTo(this.m,null,e)}function J(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function K(e,t){e.squareTo(t),this.reduce(t)}function Q(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function G(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Y(e){var t=p();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(h.ZERO)>0&&this.m.subTo(t,t),t}function Z(e){var t=p();return e.copyTo(t),this.reduce(t),t}function et(e){while(e.t<=this.mt2)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e[n]>=e.DV)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function tt(e,t){e.squareTo(t),this.reduce(t)}function nt(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function rt(){return(this.t>0?this[0]&1:this.s)==0}function it(e,t){if(e>4294967295||e<1)return h.ONE;var n=p(),r=p(),i=t.convert(this),s=D(e)-1;i.copyTo(n);while(--s>=0){t.sqrTo(n,r);if((e&1<<s)>0)t.mulTo(r,i,n);else{var o=n;n=r,r=o}}return t.revert(n)}function st(e,t){var n;return e<256||t.isEven()?n=new W(t):n=new G(t),this.exp(e,n)}function ot(){var e=p();return this.copyTo(e),e}function ut(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function at(){return this.t==0?this.s:this[0]<<24>>24}function ft(){return this.t==0?this.s:this[0]<<16>>16}function lt(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function ct(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function ht(e){e==null&&(e=10);if(this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=C(n),i=p(),s=p(),o="";this.divRemTo(r,i,s);while(i.signum()>0)o=(n+s.intValue()).toString(e).substr(1)+o,i.divRemTo(r,i,s);return s.intValue().toString(e)+o}function pt(e,t){this.fromInt(0),t==null&&(t=10);var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,s=0,o=0;for(var u=0;u<e.length;++u){var a=x(e,u);if(a<0){e.charAt(u)=="-"&&this.signum()==0&&(i=!0);continue}o=t*o+a,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&h.ZERO.subTo(this,this)}function dt(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(h.ONE.shiftLeft(e-1),St,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(t))this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(h.ONE.shiftLeft(e-1),this)}else{var r=new Array,i=e&7;r.length=(e>>3)+1,t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function vt(){var e=this.t,t=new Array;t[0]=this.s;var n=this.DB-e*this.DB%8,r,i=0;if(e-->0){n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);while(e>=0){n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),(r&128)!=0&&(r|=-256),i==0&&(this.s&128)!=(r&128)&&++i;if(i>0||r!=this.s)t[i++]=r}}return t}function mt(e){return this.compareTo(e)==0}function gt(e){return this.compareTo(e)<0?this:e}function yt(e){return this.compareTo(e)>0?this:e}function bt(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;r<s;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){i=e.s&this.DM;for(r=s;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{i=this.s&this.DM;for(r=s;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function wt(e,t){return e&t}function Et(e){var t=p();return this.bitwiseTo(e,wt,t),t}function St(e,t){return e|t}function xt(e){var t=p();return this.bitwiseTo(e,St,t),t}function Tt(e,t){return e^t}function Nt(e){var t=p();return this.bitwiseTo(e,Tt,t),t}function Ct(e,t){return e&~t}function kt(e){var t=p();return this.bitwiseTo(e,Ct,t),t}function Lt(){var e=p();for(var t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function At(e){var t=p();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function Ot(e){var t=p();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function Mt(e){if(e==0)return-1;var t=0;return(e&65535)==0&&(e>>=16,t+=16),(e&255)==0&&(e>>=8,t+=8),(e&15)==0&&(e>>=4,t+=4),(e&3)==0&&(e>>=2,t+=2),(e&1)==0&&++t,t}function _t(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+Mt(this[e]);return this.s<0?this.t*this.DB:-1}function Dt(e){var t=0;while(e!=0)e&=e-1,++t;return t}function Pt(){var e=0,t=this.s&this.DM;for(var n=0;n<this.t;++n)e+=Dt(this[n]^t);return e}function Ht(e){var t=Math.floor(e/this.DB);return t>=this.t?this.s!=0:(this[t]&1<<e%this.DB)!=0}function Bt(e,t){var n=h.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function jt(e){return this.changeBit(e,St)}function Ft(e){return this.changeBit(e,Ct)}function It(e){return this.changeBit(e,Tt)}function qt(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r+=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function Rt(e){var t=p();return this.addTo(e,t),t}function Ut(e){var t=p();return this.subTo(e,t),t}function zt(e){var t=p();return this.multiplyTo(e,t),t}function Wt(){var e=p();return this.squareTo(e),e}function Xt(e){var t=p();return this.divRemTo(e,t,null),t}function Vt(e){var t=p();return this.divRemTo(e,null,t),t}function $t(e){var t=p(),n=p();return this.divRemTo(e,t,n),new Array(t,n)}function Jt(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function Kt(e,t){if(e==0)return;while(this.t<=t)this[this.t++]=0;this[t]+=e;while(this[t]>=this.DV)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}function Qt(){}function Gt(e){return e}function Yt(e,t,n){e.multiplyTo(t,n)}function Zt(e,t){e.squareTo(t)}function en(e){return this.exp(e,new Qt)}function tn(e,t,n){var r=Math.min(this.t+e.t,t);n.s=0,n.t=r;while(r>0)n[--r]=0;var i;for(i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function nn(e,t,n){--t;var r=n.t=this.t+e.t-t;n.s=0;while(--r>=0)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function rn(e){this.r2=p(),this.q3=p(),h.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function sn(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=p();return e.copyTo(t),this.reduce(t),t}function on(e){return e}function un(e){e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(e.compareTo(this.r2)<0)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);while(e.compareTo(this.m)>=0)e.subTo(this.m,e)}function an(e,t){e.squareTo(t),this.reduce(t)}function fn(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function ln(e,t){var n=e.bitLength(),r,i=C(1),s;if(n<=0)return i;n<18?r=1:n<48?r=3:n<144?r=4:n<768?r=5:r=6,n<8?s=new W(t):t.isEven()?s=new rn(t):s=new G(t);var o=new Array,u=3,a=r-1,f=(1<<r)-1;o[1]=s.convert(this);if(r>1){var l=p();s.sqrTo(o[1],l);while(u<=f)o[u]=p(),s.mulTo(l,o[u-2],o[u]),u+=2}var c=e.t-1,h,d=!0,v=p(),m;n=D(e[c])-1;while(c>=0){n>=a?h=e[c]>>n-a&f:(h=(e[c]&(1<<n+1)-1)<<a-n,c>0&&(h|=e[c-1]>>this.DB+n-a)),u=r;while((h&1)==0)h>>=1,--u;(n-=u)<0&&(n+=this.DB,--c);if(d)o[h].copyTo(i),d=!1;else{while(u>1)s.sqrTo(i,v),s.sqrTo(v,i),u-=2;u>0?s.sqrTo(i,v):(m=i,i=v,v=m),s.mulTo(v,o[h],i)}while(c>=0&&(e[c]&1<<n)==0)s.sqrTo(i,v),m=i,i=v,v=m,--n<0&&(n=this.DB-1,--c)}return s.revert(i)}function cn(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return t;i<s&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));while(t.signum()>0)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function hn(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(t==0)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function pn(e){var t=e.isEven();if(this.isEven()&&t||e.signum()==0)return h.ZERO;var n=e.clone(),r=this.clone(),i=C(1),s=C(0),o=C(0),u=C(1);while(n.signum()!=0){while(n.isEven()){n.rShiftTo(1,n);if(t){if(!i.isEven()||!s.isEven())i.addTo(this,i),s.subTo(e,s);i.rShiftTo(1,i)}else s.isEven()||s.subTo(e,s);s.rShiftTo(1,s)}while(r.isEven()){r.rShiftTo(1,r);if(t){if(!o.isEven()||!u.isEven())o.addTo(this,o),u.subTo(e,u);o.rShiftTo(1,o)}else u.isEven()||u.subTo(e,u);u.rShiftTo(1,u)}n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(o,i),s.subTo(u,s)):(r.subTo(n,r),t&&o.subTo(i,o),u.subTo(s,u))}return r.compareTo(h.ONE)!=0?h.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u}function mn(e){var t,n=this.abs();if(n.t==1&&n[0]<=dn[dn.length-1]){for(t=0;t<dn.length;++t)if(n[0]==dn[t])return!0;return!1}if(n.isEven())return!1;t=1;while(t<dn.length){var r=dn[t],i=t+1;while(i<dn.length&&r<vn)r*=dn[i++];r=n.modInt(r);while(t<i)if(r%dn[t++]==0)return!1}return n.millerRabin(e)}function gn(e){var t=this.subtract(h.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);e=e+1>>1,e>dn.length&&(e=dn.length);var i=p();for(var s=0;s<e;++s){i.fromInt(dn[Math.floor(Math.random()*dn.length)]);var o=i.modPow(r,this);if(o.compareTo(h.ONE)!=0&&o.compareTo(t)!=0){var u=1;while(u++<n&&o.compareTo(t)!=0){o=o.modPowInt(2,this);if(o.compareTo(h.ONE)==0)return!1}if(o.compareTo(t)!=0)return!1}}return!0}var e=!1,t=!1,n=!0,r=!1,i={},s=!1;typeof module!="undefined"&&module.exports?(module.exports=i,s=!0):typeof document!="undefined"?window.ClipperLib=i:self.ClipperLib=i;var o;if(!s){var u=navigator.userAgent.toString().toLowerCase();o=navigator.appName}else{var u="chrome";o="Netscape"}var a={};u.indexOf("chrome")!=-1&&u.indexOf("chromium")==-1?a.chrome=1:a.chrome=0,u.indexOf("chromium")!=-1?a.chromium=1:a.chromium=0,u.indexOf("safari")!=-1&&u.indexOf("chrome")==-1&&u.indexOf("chromium")==-1?a.safari=1:a.safari=0,u.indexOf("firefox")!=-1?a.firefox=1:a.firefox=0,u.indexOf("firefox/17")!=-1?a.firefox17=1:a.firefox17=0,u.indexOf("firefox/15")!=-1?a.firefox15=1:a.firefox15=0,u.indexOf("firefox/3")!=-1?a.firefox3=1:a.firefox3=0,u.indexOf("opera")!=-1?a.opera=1:a.opera=0,u.indexOf("msie 10")!=-1?a.msie10=1:a.msie10=0,u.indexOf("msie 9")!=-1?a.msie9=1:a.msie9=0,u.indexOf("msie 8")!=-1?a.msie8=1:a.msie8=0,u.indexOf("msie 7")!=-1?a.msie7=1:a.msie7=0,u.indexOf("msie ")!=-1?a.msie=1:a.msie=0,i.biginteger_used=null;var f,l=0xdeadbeefcafe,c=(l&16777215)==15715070;c&&o=="Microsoft Internet Explorer"?(h.prototype.am=v,f=30):c&&o!="Netscape"?(h.prototype.am=d,f=26):(h.prototype.am=m,f=28),h.prototype.DB=f,h.prototype.DM=(1<<f)-1,h.prototype.DV=1<<f;var g=52;h.prototype.FV=Math.pow(2,g),h.prototype.F1=g-f,h.prototype.F2=2*f-g;var y="0123456789abcdefghijklmnopqrstuvwxyz",b=new Array,w,E;w="0".charCodeAt(0);for(E=0;E<=9;++E)b[w++]=E;w="a".charCodeAt(0);for(E=10;E<36;++E)b[w++]=E;w="A".charCodeAt(0);for(E=10;E<36;++E)b[w++]=E;W.prototype.convert=X,W.prototype.revert=V,W.prototype.reduce=$,W.prototype.mulTo=J,W.prototype.sqrTo=K,G.prototype.convert=Y,G.prototype.revert=Z,G.prototype.reduce=et,G.prototype.mulTo=nt,G.prototype.sqrTo=tt,h.prototype.copyTo=T,h.prototype.fromInt=N,h.prototype.fromString=k,h.prototype.clamp=L,h.prototype.dlShiftTo=H,h.prototype.drShiftTo=B,h.prototype.lShiftTo=j,h.prototype.rShiftTo=F,h.prototype.subTo=I,h.prototype.multiplyTo=q,h.prototype.squareTo=R,h.prototype.divRemTo=U,h.prototype.invDigit=Q,h.prototype.isEven=rt,h.prototype.exp=it,h.prototype.toString=A,h.prototype.negate=O,h.prototype.abs=M,h.prototype.compareTo=_,h.prototype.bitLength=P,h.prototype.mod=z,h.prototype.modPowInt=st,h.ZERO=C(0),h.ONE=C(1),Qt.prototype.convert=Gt,Qt.prototype.revert=Gt,Qt.prototype.mulTo=Yt,Qt.prototype.sqrTo=Zt,rn.prototype.convert=sn,rn.prototype.revert=on,rn.prototype.reduce=un,rn.prototype.mulTo=fn,rn.prototype.sqrTo=an;var dn=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],vn=(1<<26)/dn[dn.length-1];h.prototype.chunkSize=lt,h.prototype.toRadix=ht,h.prototype.fromRadix=pt,h.prototype.fromNumber=dt,h.prototype.bitwiseTo=bt,h.prototype.changeBit=Bt,h.prototype.addTo=qt,h.prototype.dMultiply=Jt,h.prototype.dAddOffset=Kt,h.prototype.multiplyLowerTo=tn,h.prototype.multiplyUpperTo=nn,h.prototype.modInt=hn,h.prototype.millerRabin=gn,h.prototype.clone=ot,h.prototype.intValue=ut,h.prototype.byteValue=at,h.prototype.shortValue=ft,h.prototype.signum=ct,h.prototype.toByteArray=vt,h.prototype.equals=mt,h.prototype.min=gt,h.prototype.max=yt,h.prototype.and=Et,h.prototype.or=xt,h.prototype.xor=Nt,h.prototype.andNot=kt,h.prototype.not=Lt,h.prototype.shiftLeft=At,h.prototype.shiftRight=Ot,h.prototype.getLowestSetBit=_t,h.prototype.bitCount=Pt,h.prototype.testBit=Ht,h.prototype.setBit=jt,h.prototype.clearBit=Ft,h.prototype.flipBit=It,h.prototype.add=Rt,h.prototype.subtract=Ut,h.prototype.multiply=zt,h.prototype.divide=Xt,h.prototype.remainder=Vt,h.prototype.divideAndRemainder=$t,h.prototype.modPow=ln,h.prototype.modInverse=pn,h.prototype.pow=en,h.prototype.gcd=cn,h.prototype.isProbablePrime=mn,h.prototype.square=Wt;var yn=h;yn.prototype.IsNegative=function(){return this.compareTo(yn.ZERO)==-1?!0:!1},yn.op_Equality=function(e,t){return e.compareTo(t)==0?!0:!1},yn.op_Inequality=function(e,t){return e.compareTo(t)!=0?!0:!1},yn.op_GreaterThan=function(e,t){return e.compareTo(t)>0?!0:!1},yn.op_LessThan=function(e,t){return e.compareTo(t)<0?!0:!1},yn.op_Addition=function(e,t){return(new yn(e)).add(new yn(t))},yn.op_Subtraction=function(e,t){return(new yn(e)).subtract(new yn(t))},yn.Int128Mul=function(e,t){return(new yn(e)).multiply(new yn(t))},yn.op_Division=function(e,t){return e.divide(t)},yn.prototype.ToDouble=function(){return parseFloat(this.toString())};if(typeof bn=="undefined")var bn=function(e,t){var n;if(typeof Object.getOwnPropertyNames=="undefined"){for(n in t.prototype)if(typeof e.prototype[n]=="undefined"||e.prototype[n]==Object.prototype[n])e.prototype[n]=t.prototype[n];for(n in t)typeof e[n]=="undefined"&&(e[n]=t[n]);e.$baseCtor=t}else{var r=Object.getOwnPropertyNames(t.prototype);for(var i=0;i<r.length;i++)typeof Object.getOwnPropertyDescriptor(e.prototype,r[i])=="undefined"&&Object.defineProperty(e.prototype,r[i],Object.getOwnPropertyDescriptor(t.prototype,r[i]));for(n in t)typeof e[n]=="undefined"&&(e[n]=t[n]);e.$baseCtor=t}};i.Path=function(){return[]},i.Paths=function(){return[]},i.DoublePoint=function(){var e=arguments;this.X=0,this.Y=0,e.length==1?(this.X=e[0].X,this.Y=e[0].Y):e.length==2&&(this.X=e[0],this.Y=e[1])},i.DoublePoint0=function(){this.X=0,this.Y=0},i.DoublePoint1=function(e){this.X=e.X,this.Y=e.Y},i.DoublePoint2=function(e,t){this.X=e,this.Y=t},i.PolyNode=function(){this.m_Parent=null,this.m_polygon=new i.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},i.PolyNode.prototype.IsHoleNode=function(){var e=!0,t=this.m_Parent;while(t!==null)e=!e,t=t.m_Parent;return e},i.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},i.PolyNode.prototype.Contour=function(){return this.m_polygon},i.PolyNode.prototype.AddChild=function(e){var t=this.m_Childs.length;this.m_Childs.push(e),e.m_Parent=this,e.m_Index=t},i.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},i.PolyNode.prototype.GetNextSiblingUp=function(){return this.m_Parent===null?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},i.PolyNode.prototype.Childs=function(){return this.m_Childs},i.PolyNode.prototype.Parent=function(){return this.m_Parent},i.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},i.PolyTree=function(){this.m_AllPolys=[],i.PolyNode.call(this)},i.PolyTree.prototype.Clear=function(){for(var e=0,t=this.m_AllPolys.length;e<t;e++)this.m_AllPolys[e]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},i.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},i.PolyTree.prototype.Total=function(){return this.m_AllPolys.length},bn(i.PolyTree,i.PolyNode),i.Math_Abs_Int64=i.Math_Abs_Int32=i.Math_Abs_Double=function(e){return Math.abs(e)},i.Math_Max_Int32_Int32=function(e,t){return Math.max(e,t)},a.msie||a.opera||a.safari?i.Cast_Int32=function(e){return e|0}:i.Cast_Int32=function(e){return~~e},a.chrome?i.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):~~e}:a.firefox&&typeof Number.toInteger=="function"?i.Cast_Int64=function(e){return Number.toInteger(e)}:a.msie7||a.msie8?i.Cast_Int64=function(e){return parseInt(e,10)}:a.msie?i.Cast_Int64=function(e){return e<-2147483648||e>2147483647?e<0?Math.ceil(e):Math.floor(e):e|0}:i.Cast_Int64=function(e){return e<0?Math.ceil(e):Math.floor(e)},i.Clear=function(e){e.length=0},i.PI=3.141592653589793,i.PI2=6.283185307179586,i.IntPoint=function(){var e=arguments,n=e.length;this.X=0,this.Y=0;if(t){this.Z=0;if(n==3)this.X=e[0],this.Y=e[1],this.Z=e[2];else if(n==2)this.X=e[0],this.Y=e[1],this.Z=0;else if(n==1)if(e[0]instanceof i.DoublePoint){var r=e[0];this.X=i.Clipper.Round(r.X),this.Y=i.Clipper.Round(r.Y),this.Z=0}else{var s=e[0];typeof s.Z=="undefined"&&(s.Z=0),this.X=s.X,this.Y=s.Y,this.Z=s.Z}else this.X=0,this.Y=0,this.Z=0}else if(n==2)this.X=e[0],this.Y=e[1];else if(n==1)if(e[0]instanceof i.DoublePoint){var r=e[0];this.X=i.Clipper.Round(r.X),this.Y=i.Clipper.Round(r.Y)}else{var s=e[0];this.X=s.X,this.Y=s.Y}else this.X=0,this.Y=0},i.IntPoint.op_Equality=function(e,t){return e.X==t.X&&e.Y==t.Y},i.IntPoint.op_Inequality=function(e,t){return e.X!=t.X||e.Y!=t.Y},t?(i.IntPoint0=function(){this.X=0,this.Y=0,this.Z=0},i.IntPoint1=function(e){this.X=e.X,this.Y=e.Y,this.Z=e.Z},i.IntPoint1dp=function(e){this.X=i.Clipper.Round(e.X),this.Y=i.Clipper.Round(e.Y),this.Z=0},i.IntPoint2=function(e,t){this.X=e,this.Y=t,this.Z=0},i.IntPoint3=function(e,t,n){this.X=e,this.Y=t,this.Z=n}):(i.IntPoint0=function(){this.X=0,this.Y=0},i.IntPoint1=function(e){this.X=e.X,this.Y=e.Y},i.IntPoint1dp=function(e){this.X=i.Clipper.Round(e.X),this.Y=i.Clipper.Round(e.Y)},i.IntPoint2=function(e,t){this.X=e,this.Y=t}),i.IntRect=function(){var e=arguments,t=e.length;t==4?(this.left=e[0],this.top=e[1],this.right=e[2],this.bottom=e[3]):t==1?(this.left=ir.left,this.top=ir.top,this.right=ir.right,this.bottom=ir.bottom):(this.left=0,this.top=0,this.right=0,this.bottom=0)},i.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},i.IntRect1=function(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom},i.IntRect4=function(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r},i.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},i.PolyType={ptSubject:0,ptClip:1},i.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},i.JoinType={jtSquare:0,jtRound:1,jtMiter:2},i.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},r&&(i.EndType_={etSquare:0,etRound:1,etButt:2,etClosed:3}),i.EdgeSide={esLeft:0,esRight:1},i.Direction={dRightToLeft:0,dLeftToRight:1},i.TEdge=function(){this.Bot=new i.IntPoint,this.Curr=new i.IntPoint,this.Top=new i.IntPoint,this.Delta=new i.IntPoint,this.Dx=0,this.PolyTyp=i.PolyType.ptSubject,this.Side=i.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},i.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new i.IntPoint},i.MyIntersectNodeSort=function(){},i.MyIntersectNodeSort.Compare=function(e,t){return t.Pt.Y-e.Pt.Y},i.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},i.Scanbeam=function(){this.Y=0,this.Next=null},i.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},i.OutPt=function(){this.Idx=0,this.Pt=new i.IntPoint,this.Next=null,this.Prev=null},i.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new i.IntPoint},i.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_MinimaList=null,this.m_CurrentLM=null,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},i.ClipperBase.horizontal=-9007199254740992,i.ClipperBase.Skip=-2,i.ClipperBase.Unassigned=-1,i.ClipperBase.tolerance=1e-20,e?(i.ClipperBase.loRange=46340,i.ClipperBase.hiRange=46340):(i.ClipperBase.loRange=47453132,i.ClipperBase.hiRange=0xfffffffffffff),i.ClipperBase.near_zero=function(e){return e>-i.ClipperBase.tolerance&&e<i.ClipperBase.tolerance},i.ClipperBase.IsHorizontal=function(e){return e.Delta.Y===0},i.ClipperBase.prototype.PointIsVertex=function(e,t){var n=t;do{if(i.IntPoint.op_Equality(n.Pt,e))return!0;n=n.Next}while(n!=t);return!1},i.ClipperBase.prototype.PointOnLineSegment=function(e,t,n,r){return r?e.X==t.X&&e.Y==t.Y||e.X==n.X&&e.Y==n.Y||e.X>t.X==e.X<n.X&&e.Y>t.Y==e.Y<n.Y&&yn.op_Equality(yn.Int128Mul(e.X-t.X,n.Y-t.Y),yn.Int128Mul(n.X-t.X,e.Y-t.Y)):e.X==t.X&&e.Y==t.Y||e.X==n.X&&e.Y==n.Y||e.X>t.X==e.X<n.X&&e.Y>t.Y==e.Y<n.Y&&(e.X-t.X)*(n.Y-t.Y)==(n.X-t.X)*(e.Y-t.Y)},i.ClipperBase.prototype.PointOnPolygon=function(e,t,n){var r=t;for(;;){if(this.PointOnLineSegment(e,r.Pt,r.Next.Pt,n))return!0;r=r.Next;if(r==t)break}return!1},i.ClipperBase.prototype.SlopesEqual=i.ClipperBase.SlopesEqual=function(){var e=arguments,t=e.length,n,r,s,o,u,a,f;return t==3?(n=e[0],r=e[1],f=e[2],f?yn.op_Equality(yn.Int128Mul(n.Delta.Y,r.Delta.X),yn.Int128Mul(n.Delta.X,r.Delta.Y)):i.Cast_Int64(n.Delta.Y*r.Delta.X)==i.Cast_Int64(n.Delta.X*r.Delta.Y)):t==4?(s=e[0],o=e[1],u=e[2],f=e[3],f?yn.op_Equality(yn.Int128Mul(s.Y-o.Y,o.X-u.X),yn.Int128Mul(s.X-o.X,o.Y-u.Y)):i.Cast_Int64((s.Y-o.Y)*(o.X-u.X))-i.Cast_Int64((s.X-o.X)*(o.Y-u.Y))===0):(s=e[0],o=e[1],u=e[2],a=e[3],f=e[4],f?yn.op_Equality(yn.Int128Mul(s.Y-o.Y,u.X-a.X),yn.Int128Mul(s.X-o.X,u.Y-a.Y)):i.Cast_Int64((s.Y-o.Y)*(u.X-a.X))-i.Cast_Int64((s.X-o.X)*(u.Y-a.Y))===0)},i.ClipperBase.SlopesEqual3=function(e,t,n){return n?yn.op_Equality(yn.Int128Mul(e.Delta.Y,t.Delta.X),yn.Int128Mul(e.Delta.X,t.Delta.Y)):i.Cast_Int64(e.Delta.Y*t.Delta.X)==i.Cast_Int64(e.Delta.X*t.Delta.Y)},i.ClipperBase.SlopesEqual4=function(e,t,n,r){return r?yn.op_Equality(yn.Int128Mul(e.Y-t.Y,t.X-n.X),yn.Int128Mul(e.X-t.X,t.Y-n.Y)):i.Cast_Int64((e.Y-t.Y)*(t.X-n.X))-i.Cast_Int64((e.X-t.X)*(t.Y-n.Y))===0},i.ClipperBase.SlopesEqual5=function(e,t,n,r,s){return s?yn.op_Equality(yn.Int128Mul(e.Y-t.Y,n.X-r.X),yn.Int128Mul(e.X-t.X,n.Y-r.Y)):i.Cast_Int64((e.Y-t.Y)*(n.X-r.X))-i.Cast_Int64((e.X-t.X)*(n.Y-r.Y))===0},i.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var e=0,t=this.m_edges.length;e<t;++e){for(var n=0,r=this.m_edges[e].length;n<r;++n)this.m_edges[e][n]=null;i.Clear(this.m_edges[e])}i.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},i.ClipperBase.prototype.DisposeLocalMinimaList=function(){while(this.m_MinimaList!==null){var e=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=e}this.m_CurrentLM=null},i.ClipperBase.prototype.RangeTest=function(e,t){if(t.Value)(e.X>i.ClipperBase.hiRange||e.Y>i.ClipperBase.hiRange||-e.X>i.ClipperBase.hiRange||-e.Y>i.ClipperBase.hiRange)&&i.Error("Coordinate outside allowed range in RangeTest().");else if(e.X>i.ClipperBase.loRange||e.Y>i.ClipperBase.loRange||-e.X>i.ClipperBase.loRange||-e.Y>i.ClipperBase.loRange)t.Value=!0,this.RangeTest(e,t)},i.ClipperBase.prototype.InitEdge=function(e,t,n,r){e.Next=t,e.Prev=n,e.Curr.X=r.X,e.Curr.Y=r.Y,e.OutIdx=-1},i.ClipperBase.prototype.InitEdge2=function(e,t){e.Curr.Y>=e.Next.Curr.Y?(e.Bot.X=e.Curr.X,e.Bot.Y=e.Curr.Y,e.Top.X=e.Next.Curr.X,e.Top.Y=e.Next.Curr.Y):(e.Top.X=e.Curr.X,e.Top.Y=e.Curr.Y,e.Bot.X=e.Next.Curr.X,e.Bot.Y=e.Next.Curr.Y),this.SetDx(e),e.PolyTyp=t},i.ClipperBase.prototype.FindNextLocMin=function(e){var t;for(;;){while(i.IntPoint.op_Inequality(e.Bot,e.Prev.Bot)||i.IntPoint.op_Equality(e.Curr,e.Top))e=e.Next;if(e.Dx!=i.ClipperBase.horizontal&&e.Prev.Dx!=i.ClipperBase.horizontal)break;while(e.Prev.Dx==i.ClipperBase.horizontal)e=e.Prev;t=e;while(e.Dx==i.ClipperBase.horizontal)e=e.Next;if(e.Top.Y==e.Prev.Bot.Y)continue;t.Prev.Bot.X<e.Bot.X&&(e=t);break}return e},i.ClipperBase.prototype.ProcessBound=function(e,t){var n=e,r=e,s,o;e.Dx==i.ClipperBase.horizontal&&(t?o=e.Prev.Bot.X:o=e.Next.Bot.X,e.Bot.X!=o&&this.ReverseHorizontal(e));if(r.OutIdx!=i.ClipperBase.Skip)if(t){while(r.Top.Y==r.Next.Bot.Y&&r.Next.OutIdx!=i.ClipperBase.Skip)r=r.Next;if(r.Dx==i.ClipperBase.horizontal&&r.Next.OutIdx!=i.ClipperBase.Skip){s=r;while(s.Prev.Dx==i.ClipperBase.horizontal)s=s.Prev;s.Prev.Top.X==r.Next.Top.X?t||(r=s.Prev):s.Prev.Top.X>r.Next.Top.X&&(r=s.Prev)}while(e!=r)e.NextInLML=e.Next,e.Dx==i.ClipperBase.horizontal&&e!=n&&e.Bot.X!=e.Prev.Top.X&&this.ReverseHorizontal(e),e=e.Next;e.Dx==i.ClipperBase.horizontal&&e!=n&&e.Bot.X!=e.Prev.Top.X&&this.ReverseHorizontal(e),r=r.Next}else{while(r.Top.Y==r.Prev.Bot.Y&&r.Prev.OutIdx!=i.ClipperBase.Skip)r=r.Prev;if(r.Dx==i.ClipperBase.horizontal&&r.Prev.OutIdx!=i.ClipperBase.Skip){s=r;while(s.Next.Dx==i.ClipperBase.horizontal)s=s.Next;s.Next.Top.X==r.Prev.Top.X?t||(r=s.Next):s.Next.Top.X>r.Prev.Top.X&&(r=s.Next)}while(e!=r)e.NextInLML=e.Prev,e.Dx==i.ClipperBase.horizontal&&e!=n&&e.Bot.X!=e.Next.Top.X&&this.ReverseHorizontal(e),e=e.Prev;e.Dx==i.ClipperBase.horizontal&&e!=n&&e.Bot.X!=e.Next.Top.X&&this.ReverseHorizontal(e),r=r.Prev}if(r.OutIdx==i.ClipperBase.Skip){e=r;if(t){while(e.Top.Y==e.Next.Bot.Y)e=e.Next;while(e!=r&&e.Dx==i.ClipperBase.horizontal)e=e.Prev}else{while(e.Top.Y==e.Prev.Bot.Y)e=e.Prev;while(e!=r&&e.Dx==i.ClipperBase.horizontal)e=e.Next}if(e==r)t?r=e.Next:r=e.Prev;else{t?e=r.Next:e=r.Prev;var u=new i.LocalMinima;u.Next=null,u.Y=e.Bot.Y,u.LeftBound=null,u.RightBound=e,u.RightBound.WindDelta=0,r=this.ProcessBound(u.RightBound,t),this.InsertLocalMinima(u)}}return r},i.ClipperBase.prototype.AddPath=function(e,t,r){n?!r&&t==i.PolyType.ptClip&&i.Error("AddPath: Open paths must be subject."):r||i.Error("AddPath: Open paths have been disabled.");var s=e.length-1;if(r)while(s>0&&i.IntPoint.op_Equality(e[s],e[0]))--s;while(s>0&&i.IntPoint.op_Equality(e[s],e[s-1]))--s;if(r&&s<2||!r&&s<1)return!1;var o=new Array;for(var u=0;u<=s;u++)o.push(new i.TEdge);var a=!0;o[1].Curr.X=e[1].X,o[1].Curr.Y=e[1].Y;var f={Value:this.m_UseFullRange};this.RangeTest(e[0],f),this.m_UseFullRange=f.Value,f.Value=this.m_UseFullRange,this.RangeTest(e[s],f),this.m_UseFullRange=f.Value,this.InitEdge(o[0],o[1],o[s],e[0]),this.InitEdge(o[s],o[0],o[s-1],e[s]);for(var u=s-1;u>=1;--u)f.Value=this.m_UseFullRange,this.RangeTest(e[u],f),this.m_UseFullRange=f.Value,this.InitEdge(o[u],o[u+1],o[u-1],e[u]);var l=o[0],c=l,h=l;for(;;){if(i.IntPoint.op_Equality(c.Curr,c.Next.Curr)){if(c==c.Next)break;c==l&&(l=c.Next),c=this.RemoveEdge(c),h=c;continue}if(c.Prev==c.Next)break;if(r&&i.ClipperBase.SlopesEqual(c.Prev.Curr,c.Curr,c.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(c.Prev.Curr,c.Curr,c.Next.Curr))){c==l&&(l=c.Next),c=this.RemoveEdge(c),c=c.Prev,h=c;continue}c=c.Next;if(c==h)break}if(!r&&c==c.Next||r&&c.Prev==c.Next)return!1;r||(this.m_HasOpenPaths=!0,l.Prev.OutIdx=i.ClipperBase.Skip);var p=l;c=l;do this.InitEdge2(c,t),c=c.Next,a&&c.Curr.Y!=l.Curr.Y&&(a=!1);while(c!=l);if(a){if(r)return!1;c.Prev.OutIdx=i.ClipperBase.Skip,c.Prev.Bot.X<c.Prev.Top.X&&this.ReverseHorizontal(c.Prev);var d=new i.LocalMinima;d.Next=null,d.Y=c.Bot.Y,d.LeftBound=null,d.RightBound=c,d.RightBound.Side=i.EdgeSide.esRight,d.RightBound.WindDelta=0;while(c.Next.OutIdx!=i.ClipperBase.Skip)c.NextInLML=c.Next,c.Bot.X!=c.Prev.Top.X&&this.ReverseHorizontal(c),c=c.Next;return this.InsertLocalMinima(d),this.m_edges.push(o),!0}this.m_edges.push(o);var v,m=null;for(;;){c=this.FindNextLocMin(c);if(c==m)break;m==null&&(m=c);var d=new i.LocalMinima;d.Next=null,d.Y=c.Bot.Y,c.Dx<c.Prev.Dx?(d.LeftBound=c.Prev,d.RightBound=c,v=!1):(d.LeftBound=c,d.RightBound=c.Prev,v=!0),d.LeftBound.Side=i.EdgeSide.esLeft,d.RightBound.Side=i.EdgeSide.esRight,r?d.LeftBound.Next==d.RightBound?d.LeftBound.WindDelta=-1:d.LeftBound.WindDelta=1:d.LeftBound.WindDelta=0,d.RightBound.WindDelta=-d.LeftBound.WindDelta,c=this.ProcessBound(d.LeftBound,v);var g=this.ProcessBound(d.RightBound,!v);d.LeftBound.OutIdx==i.ClipperBase.Skip?d.LeftBound=null:d.RightBound.OutIdx==i.ClipperBase.Skip&&(d.RightBound=null),this.InsertLocalMinima(d),v||(c=g)}return!0},i.ClipperBase.prototype.AddPaths=function(e,t,n){var r=!1;for(var i=0,s=e.length;i<s;++i)this.AddPath(e[i],t,n)&&(r=!0);return r},i.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(e,t,n){return i.IntPoint.op_Equality(e,n)||i.IntPoint.op_Equality(e,t)||i.IntPoint.op_Equality(n,t)?!1:e.X!=n.X?t.X>e.X==t.X<n.X:t.Y>e.Y==t.Y<n.Y},i.ClipperBase.prototype.RemoveEdge=function(e){e.Prev.Next=e.Next,e.Next.Prev=e.Prev;var t=e.Next;return e.Prev=null,t},i.ClipperBase.prototype.SetDx=function(e){e.Delta.X=e.Top.X-e.Bot.X,e.Delta.Y=e.Top.Y-e.Bot.Y,e.Delta.Y===0?e.Dx=i.ClipperBase.horizontal:e.Dx=e.Delta.X/e.Delta.Y},i.ClipperBase.prototype.InsertLocalMinima=function(e){if(this.m_MinimaList===null)this.m_MinimaList=e;else if(e.Y>=this.m_MinimaList.Y)e.Next=this.m_MinimaList,this.m_MinimaList=e;else{var t=this.m_MinimaList;while(t.Next!==null&&e.Y<t.Next.Y)t=t.Next;e.Next=t.Next,t.Next=e}},i.ClipperBase.prototype.PopLocalMinima=function(){if(this.m_CurrentLM===null)return;this.m_CurrentLM=this.m_CurrentLM.Next},i.ClipperBase.prototype.ReverseHorizontal=function(e){var n=e.Top.X;e.Top.X=e.Bot.X,e.Bot.X=n,t&&(n=e.Top.Z,e.Top.Z=e.Bot.Z,e.Bot.Z=n)},i.ClipperBase.prototype.Reset=function(){this.m_CurrentLM=this.m_MinimaList;if(this.m_CurrentLM==null)return;var e=this.m_MinimaList;while(e!=null){var t=e.LeftBound;t!=null&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,t.Side=i.EdgeSide.esLeft,t.OutIdx=i.ClipperBase.Unassigned),t=e.RightBound,t!=null&&(t.Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,t.Side=i.EdgeSide.esRight,t.OutIdx=i.ClipperBase.Unassigned),e=e.Next}},i.Clipper=function(e){typeof e=="undefined"&&(e=0),this.m_PolyOuts=null,this.m_ClipType=i.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=i.PolyFillType.pftEvenOdd,this.m_SubjFillType=i.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,i.ClipperBase.call(this),this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=i.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=(1&e)!==0,this.StrictlySimple=(2&e)!==0,this.PreserveCollinear=(4&e)!==0,t&&(this.ZFillFunction=null)},i.Clipper.ioReverseSolution=1,i.Clipper.ioStrictlySimple=2,i.Clipper.ioPreserveCollinear=4,i.Clipper.prototype.Clear=function(){if(this.m_edges.length===0)return;this.DisposeAllPolyPts(),i.ClipperBase.prototype.Clear.call(this)},i.Clipper.prototype.DisposeScanbeamList=function(){while(this.m_Scanbeam!==null){var e=this.m_Scanbeam.Next;this.m_Scanbeam=null,this.m_Scanbeam=e}},i.Clipper.prototype.Reset=function(){i.ClipperBase.prototype.Reset.call(this),this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null;var e=this.m_MinimaList;while(e!==null)this.InsertScanbeam(e.Y),e=e.Next},i.Clipper.prototype.InsertScanbeam=function(e){if(this.m_Scanbeam===null)this.m_Scanbeam=new i.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=e;else if(e>this.m_Scanbeam.Y){var t=new i.Scanbeam;t.Y=e,t.Next=this.m_Scanbeam,this.m_Scanbeam=t}else{var n=this.m_Scanbeam;while(n.Next!==null&&e<=n.Next.Y)n=n.Next;if(e==n.Y)return;var t=new i.Scanbeam;t.Y=e,t.Next=n.Next,n.Next=t}},i.Clipper.prototype.Execute=function(){var e=arguments,t=e.length,n=e[1]instanceof i.PolyTree;if(t==4&&!n){var r=e[0],s=e[1],o=e[2],u=e[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&i.Error("Error: PolyTree struct is need for open path clipping."),this.m_ExecuteLocked=!0,i.Clear(s),this.m_SubjFillType=o,this.m_ClipFillType=u,this.m_ClipType=r,this.m_UsingPolyTree=!1;try{var a=this.ExecuteInternal();a&&this.BuildResult(s)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return a}if(t==4&&n){var r=e[0],f=e[1],o=e[2],u=e[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=o,this.m_ClipFillType=u,this.m_ClipType=r,this.m_UsingPolyTree=!0;try{var a=this.ExecuteInternal();a&&this.BuildResult2(f)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return a}if(t==2&&!n){var r=e[0],s=e[1];return this.Execute(r,s,i.PolyFillType.pftEvenOdd,i.PolyFillType.pftEvenOdd)}if(t==2&&n){var r=e[0],f=e[1];return this.Execute(r,f,i.PolyFillType.pftEvenOdd,i.PolyFillType.pftEvenOdd)}},i.Clipper.prototype.FixHoleLinkage=function(e){if(e.FirstLeft===null||e.IsHole!=e.FirstLeft.IsHole&&e.FirstLeft.Pts!==null)return;var t=e.FirstLeft;while(t!==null&&(t.IsHole==e.IsHole||t.Pts===null))t=t.FirstLeft;e.FirstLeft=t},i.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(this.m_CurrentLM===null)return!1;var e=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(e),i.Clear(this.m_GhostJoins),this.ProcessHorizontals(!1);if(this.m_Scanbeam===null)break;var t=this.PopScanbeam();if(!this.ProcessIntersections(e,t))return!1;this.ProcessEdgesAtTopOfScanbeam(t),e=t}while(this.m_Scanbeam!==null||this.m_CurrentLM!==null);for(var n=0,r=this.m_PolyOuts.length;n<r;n++){var s=this.m_PolyOuts[n];if(s.Pts===null||s.IsOpen)continue;(s.IsHole^this.ReverseSolution)==this.Area(s)>0&&this.ReversePolyPtLinks(s.Pts)}this.JoinCommonEdges();for(var n=0,r=this.m_PolyOuts.length;n<r;n++){var s=this.m_PolyOuts[n];s.Pts!==null&&!s.IsOpen&&this.FixupOutPolygon(s)}return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{i.Clear(this.m_Joins),i.Clear(this.m_GhostJoins)}},i.Clipper.prototype.PopScanbeam=function(){var e=this.m_Scanbeam.Y,t=this.m_Scanbeam;return this.m_Scanbeam=this.m_Scanbeam.Next,t=null,e},i.Clipper.prototype.DisposeAllPolyPts=function(){for(var e=0,t=this.m_PolyOuts.length;e<t;++e)this.DisposeOutRec(e);i.Clear(this.m_PolyOuts)},i.Clipper.prototype.DisposeOutRec=function(e){var t=this.m_PolyOuts[e];t.Pts!==null&&this.DisposeOutPts(t.Pts),t=null,this.m_PolyOuts[e]=null},i.Clipper.prototype.DisposeOutPts=function(e){if(e===null)return;var t=null;e.Prev.Next=null;while(e!==null)t=e,e=e.Next,t=null},i.Clipper.prototype.AddJoin=function(e,t,n){var r=new i.Join;r.OutPt1=e,r.OutPt2=t,r.OffPt.X=n.X,r.OffPt.Y=n.Y,this.m_Joins.push(r)},i.Clipper.prototype.AddGhostJoin=function(e,t){var n=new i.Join;n.OutPt1=e,n.OffPt.X=t.X,n.OffPt.Y=t.Y,this.m_GhostJoins.push(n)},t&&(i.Clipper.prototype.SetZ=function(e,t){e.Z=0,this.ZFillFunction!==null&&(t.OutIdx<0?this.ZFillFunction(t.Bot,t.Top,e):this.ZFillFunction(t.Top,t.Bot,e))}),i.Clipper.prototype.InsertLocalMinimaIntoAEL=function(e){while(this.m_CurrentLM!==null&&this.m_CurrentLM.Y==e){var t=this.m_CurrentLM.LeftBound,n=this.m_CurrentLM.RightBound;this.PopLocalMinima();var r=null;t===null?(this.InsertEdgeIntoAEL(n,null),this.SetWindingCount(n),this.IsContributing(n)&&(r=this.AddOutPt(n,n.Bot))):n==null?(this.InsertEdgeIntoAEL(t,null),this.SetWindingCount(t),this.IsContributing(t)&&(r=this.AddOutPt(t,t.Bot)),this.InsertScanbeam(t.Top.Y)):(this.InsertEdgeIntoAEL(t,null),this.InsertEdgeIntoAEL(n,t),this.SetWindingCount(t),n.WindCnt=t.WindCnt,n.WindCnt2=t.WindCnt2,this.IsContributing(t)&&(r=this.AddLocalMinPoly(t,n,t.Bot)),this.InsertScanbeam(t.Top.Y)),n!=null&&(i.ClipperBase.IsHorizontal(n)?this.AddEdgeToSEL(n):this.InsertScanbeam(n.Top.Y));if(t==null||n==null)continue;if(r!==null&&i.ClipperBase.IsHorizontal(n)&&this.m_GhostJoins.length>0&&n.WindDelta!==0)for(var s=0,o=this.m_GhostJoins.length;s<o;s++){var u=this.m_GhostJoins[s];this.HorzSegmentsOverlap(u.OutPt1.Pt,u.OffPt,n.Bot,n.Top)&&this.AddJoin(u.OutPt1,r,u.OffPt)}if(t.OutIdx>=0&&t.PrevInAEL!==null&&t.PrevInAEL.Curr.X==t.Bot.X&&t.PrevInAEL.OutIdx>=0&&i.ClipperBase.SlopesEqual(t.PrevInAEL,t,this.m_UseFullRange)&&t.WindDelta!==0&&t.PrevInAEL.WindDelta!==0){var a=this.AddOutPt(t.PrevInAEL,t.Bot);this.AddJoin(r,a,t.Top)}if(t.NextInAEL!=n){if(n.OutIdx>=0&&n.PrevInAEL.OutIdx>=0&&i.ClipperBase.SlopesEqual(n.PrevInAEL,n,this.m_UseFullRange)&&n.WindDelta!==0&&n.PrevInAEL.WindDelta!==0){var a=this.AddOutPt(n.PrevInAEL,n.Bot);this.AddJoin(r,a,n.Top)}var f=t.NextInAEL;if(f!==null)while(f!=n)this.IntersectEdges(n,f,t.Curr,!1),f=f.NextInAEL}}},i.Clipper.prototype.InsertEdgeIntoAEL=function(e,t){if(this.m_ActiveEdges===null)e.PrevInAEL=null,e.NextInAEL=null,this.m_ActiveEdges=e;else if(t===null&&this.E2InsertsBeforeE1(this.m_ActiveEdges,e))e.PrevInAEL=null,e.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=e,this.m_ActiveEdges=e;else{t===null&&(t=this.m_ActiveEdges);while(t.NextInAEL!==null&&!this.E2InsertsBeforeE1(t.NextInAEL,e))t=t.NextInAEL;e.NextInAEL=t.NextInAEL,t.NextInAEL!==null&&(t.NextInAEL.PrevInAEL=e),e.PrevInAEL=t,t.NextInAEL=e}},i.Clipper.prototype.E2InsertsBeforeE1=function(e,t){return t.Curr.X==e.Curr.X?t.Top.Y>e.Top.Y?t.Top.X<i.Clipper.TopX(e,t.Top.Y):e.Top.X>i.Clipper.TopX(t,e.Top.Y):t.Curr.X<e.Curr.X},i.Clipper.prototype.IsEvenOddFillType=function(e){return e.PolyTyp==i.PolyType.ptSubject?this.m_SubjFillType==i.PolyFillType.pftEvenOdd:this.m_ClipFillType==i.PolyFillType.pftEvenOdd},i.Clipper.prototype.IsEvenOddAltFillType=function(e){return e.PolyTyp==i.PolyType.ptSubject?this.m_ClipFillType==i.PolyFillType.pftEvenOdd:this.m_SubjFillType==i.PolyFillType.pftEvenOdd},i.Clipper.prototype.IsContributing=function(e){var t,n;e.PolyTyp==i.PolyType.ptSubject?(t=this.m_SubjFillType,n=this.m_ClipFillType):(t=this.m_ClipFillType,n=this.m_SubjFillType);switch(t){case i.PolyFillType.pftEvenOdd:if(e.WindDelta===0&&e.WindCnt!=1)return!1;break;case i.PolyFillType.pftNonZero:if(Math.abs(e.WindCnt)!=1)return!1;break;case i.PolyFillType.pftPositive:if(e.WindCnt!=1)return!1;break;default:if(e.WindCnt!=-1)return!1}switch(this.m_ClipType){case i.ClipType.ctIntersection:switch(n){case i.PolyFillType.pftEvenOdd:case i.PolyFillType.pftNonZero:return e.WindCnt2!==0;case i.PolyFillType.pftPositive:return e.WindCnt2>0;default:return e.WindCnt2<0};case i.ClipType.ctUnion:switch(n){case i.PolyFillType.pftEvenOdd:case i.PolyFillType.pftNonZero:return e.WindCnt2===0;case i.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0};case i.ClipType.ctDifference:if(e.PolyTyp==i.PolyType.ptSubject)switch(n){case i.PolyFillType.pftEvenOdd:case i.PolyFillType.pftNonZero:return e.WindCnt2===0;case i.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}else switch(n){case i.PolyFillType.pftEvenOdd:case i.PolyFillType.pftNonZero:return e.WindCnt2!==0;case i.PolyFillType.pftPositive:return e.WindCnt2>0;default:return e.WindCnt2<0};case i.ClipType.ctXor:if(e.WindDelta!==0)return!0;switch(n){case i.PolyFillType.pftEvenOdd:case i.PolyFillType.pftNonZero:return e.WindCnt2===0;case i.PolyFillType.pftPositive:return e.WindCnt2<=0;default:return e.WindCnt2>=0}}return!0},i.Clipper.prototype.SetWindingCount=function(e){var t=e.PrevInAEL;while(t!==null&&(t.PolyTyp!=e.PolyTyp||t.WindDelta===0))t=t.PrevInAEL;if(t===null)e.WindCnt=e.WindDelta===0?1:e.WindDelta,e.WindCnt2=0,t=this.m_ActiveEdges;else if(e.WindDelta===0&&this.m_ClipType!=i.ClipType.ctUnion)e.WindCnt=1,e.WindCnt2=t.WindCnt2,t=t.NextInAEL;else if(this.IsEvenOddFillType(e)){if(e.WindDelta===0){var n=!0,r=t.PrevInAEL;while(r!==null)r.PolyTyp==t.PolyTyp&&r.WindDelta!==0&&(n=!n),r=r.PrevInAEL;e.WindCnt=n?0:1}else e.WindCnt=e.WindDelta;e.WindCnt2=t.WindCnt2,t=t.NextInAEL}else t.WindCnt*t.WindDelta<0?Math.abs(t.WindCnt)>1?t.WindDelta*e.WindDelta<0?e.WindCnt=t.WindCnt:e.WindCnt=t.WindCnt+e.WindDelta:e.WindCnt=e.WindDelta===0?1:e.WindDelta:e.WindDelta===0?e.WindCnt=t.WindCnt<0?t.WindCnt-1:t.WindCnt+1:t.WindDelta*e.WindDelta<0?e.WindCnt=t.WindCnt:e.WindCnt=t.WindCnt+e.WindDelta,e.WindCnt2=t.WindCnt2,t=t.NextInAEL;if(this.IsEvenOddAltFillType(e))while(t!=e)t.WindDelta!==0&&(e.WindCnt2=e.WindCnt2===0?1:0),t=t.NextInAEL;else while(t!=e)e.WindCnt2+=t.WindDelta,t=t.NextInAEL},i.Clipper.prototype.AddEdgeToSEL=function(e){this.m_SortedEdges===null?(this.m_SortedEdges=e,e.PrevInSEL=null,e.NextInSEL=null):(e.NextInSEL=this.m_SortedEdges,e.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=e,this.m_SortedEdges=e)},i.Clipper.prototype.CopyAELToSEL=function(){var e=this.m_ActiveEdges;this.m_SortedEdges=e;while(e!==null)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e=e.NextInAEL},i.Clipper.prototype.SwapPositionsInAEL=function(e,t){if(e.NextInAEL==e.PrevInAEL||t.NextInAEL==t.PrevInAEL)return;if(e.NextInAEL==t){var n=t.NextInAEL;n!==null&&(n.PrevInAEL=e);var r=e.PrevInAEL;r!==null&&(r.NextInAEL=t),t.PrevInAEL=r,t.NextInAEL=e,e.PrevInAEL=t,e.NextInAEL=n}else if(t.NextInAEL==e){var n=e.NextInAEL;n!==null&&(n.PrevInAEL=t);var r=t.PrevInAEL;r!==null&&(r.NextInAEL=e),e.PrevInAEL=r,e.NextInAEL=t,t.PrevInAEL=e,t.NextInAEL=n}else{var n=e.NextInAEL,r=e.PrevInAEL;e.NextInAEL=t.NextInAEL,e.NextInAEL!==null&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=t.PrevInAEL,e.PrevInAEL!==null&&(e.PrevInAEL.NextInAEL=e),t.NextInAEL=n,t.NextInAEL!==null&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=r,t.PrevInAEL!==null&&(t.PrevInAEL.NextInAEL=t)}e.PrevInAEL===null?this.m_ActiveEdges=e:t.PrevInAEL===null&&(this.m_ActiveEdges=t)},i.Clipper.prototype.SwapPositionsInSEL=function(e,t){if(e.NextInSEL===null&&e.PrevInSEL===null)return;if(t.NextInSEL===null&&t.PrevInSEL===null)return;if(e.NextInSEL==t){var n=t.NextInSEL;n!==null&&(n.PrevInSEL=e);var r=e.PrevInSEL;r!==null&&(r.NextInSEL=t),t.PrevInSEL=r,t.NextInSEL=e,e.PrevInSEL=t,e.NextInSEL=n}else if(t.NextInSEL==e){var n=e.NextInSEL;n!==null&&(n.PrevInSEL=t);var r=t.PrevInSEL;r!==null&&(r.NextInSEL=e),e.PrevInSEL=r,e.NextInSEL=t,t.PrevInSEL=e,t.NextInSEL=n}else{var n=e.NextInSEL,r=e.PrevInSEL;e.NextInSEL=t.NextInSEL,e.NextInSEL!==null&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=t.PrevInSEL,e.PrevInSEL!==null&&(e.PrevInSEL.NextInSEL=e),t.NextInSEL=n,t.NextInSEL!==null&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=r,t.PrevInSEL!==null&&(t.PrevInSEL.NextInSEL=t)}e.PrevInSEL===null?this.m_SortedEdges=e:t.PrevInSEL===null&&(this.m_SortedEdges=t)},i.Clipper.prototype.AddLocalMaxPoly=function(e,t,n){this.AddOutPt(e,n),t.WindDelta==0&&this.AddOutPt(t,n),e.OutIdx==t.OutIdx?(e.OutIdx=-1,t.OutIdx=-1):e.OutIdx<t.OutIdx?this.AppendPolygon(e,t):this.AppendPolygon(t,e)},i.Clipper.prototype.AddLocalMinPoly=function(e,t,n){var r,s,o;i.ClipperBase.IsHorizontal(t)||e.Dx>t.Dx?(r=this.AddOutPt(e,n),t.OutIdx=e.OutIdx,e.Side=i.EdgeSide.esLeft,t.Side=i.EdgeSide.esRight,s=e,s.PrevInAEL==t?o=t.PrevInAEL:o=s.PrevInAEL):(r=this.AddOutPt(t,n),e.OutIdx=t.OutIdx,e.Side=i.EdgeSide.esRight,t.Side=i.EdgeSide.esLeft,s=t,s.PrevInAEL==e?o=e.PrevInAEL:o=s.PrevInAEL);if(o!==null&&o.OutIdx>=0&&i.Clipper.TopX(o,n.Y)==i.Clipper.TopX(s,n.Y)&&i.ClipperBase.SlopesEqual(s,o,this.m_UseFullRange)&&s.WindDelta!==0&&o.WindDelta!==0){var u=this.AddOutPt(o,n);this.AddJoin(r,u,s.Top)}return r},i.Clipper.prototype.CreateOutRec=function(){var e=new i.OutRec;return e.Idx=-1,e.IsHole=!1,e.IsOpen=!1,e.FirstLeft=null,e.Pts=null,e.BottomPt=null,e.PolyNode=null,this.m_PolyOuts.push(e),e.Idx=this.m_PolyOuts.length-1,e},i.Clipper.prototype.AddOutPt=function(e,n){var r=e.Side==i.EdgeSide.esLeft;if(e.OutIdx<0){var s=this.CreateOutRec();s.IsOpen=e.WindDelta===0;var o=new i.OutPt;return s.Pts=o,o.Idx=s.Idx,o.Pt.X=n.X,o.Pt.Y=n.Y,o.Next=o,o.Prev=o,s.IsOpen||this.SetHoleState(e,s),t&&(i.IntPoint.op_Equality(n,e.Bot)?(o.Pt.X=e.Bot.X,o.Pt.Y=e.Bot.Y,o.Pt.Z=e.Bot.Z):i.IntPoint.op_Equality(n,e.Top)?(o.Pt.X=e.Top.X,o.Pt.Y=e.Top.Y,o.Pt.Z=e.Top.Z):this.SetZ(o.Pt,e)),e.OutIdx=s.Idx,o}var s=this.m_PolyOuts[e.OutIdx],u=s.Pts;if(r&&i.IntPoint.op_Equality(n,u.Pt))return u;if(!r&&i.IntPoint.op_Equality(n,u.Prev.Pt))return u.Prev;var o=new i.OutPt;return o.Idx=s.Idx,o.Pt.X=n.X,o.Pt.Y=n.Y,o.Next=u,o.Prev=u.Prev,o.Prev.Next=o,u.Prev=o,r&&(s.Pts=o),t&&(i.IntPoint.op_Equality(n,e.Bot)?(o.Pt.X=e.Bot.X,o.Pt.Y=e.Bot.Y,o.Pt.Z=e.Bot.Z):i.IntPoint.op_Equality(n,e.Top)?(o.Pt.X=e.Top.X,o.Pt.Y=e.Top.Y,o.Pt.Z=e.Top.Z):this.SetZ(o.Pt,e)),o},i.Clipper.prototype.SwapPoints=function(e,t){var n=new i.IntPoint(e.Value);e.Value.X=t.Value.X,e.Value.Y=t.Value.Y,t.Value.X=n.X,t.Value.Y=n.Y},i.Clipper.prototype.HorzSegmentsOverlap=function(e,t,n,r){return e.X>n.X==e.X<r.X?!0:t.X>n.X==t.X<r.X?!0:n.X>e.X==n.X<t.X?!0:r.X>e.X==r.X<t.X?!0:e.X==n.X&&t.X==r.X?!0:e.X==r.X&&t.X==n.X?!0:!1},i.Clipper.prototype.InsertPolyPtBetween=function(e,t,n){var r=new i.OutPt;return r.Pt.X=n.X,r.Pt.Y=n.Y,t==e.Next?(e.Next=r,t.Prev=r,r.Next=t,r.Prev=e):(t.Next=r,e.Prev=r,r.Next=e,r.Prev=t),r},i.Clipper.prototype.SetHoleState=function(e,t){var n=!1,r=e.PrevInAEL;while(r!==null)r.OutIdx>=0&&r.WindDelta!=0&&(n=!n,t.FirstLeft===null&&(t.FirstLeft=this.m_PolyOuts[r.OutIdx])),r=r.PrevInAEL;n&&(t.IsHole=!0)},i.Clipper.prototype.GetDx=function(e,t){return e.Y==t.Y?i.ClipperBase.horizontal:(t.X-e.X)/(t.Y-e.Y)},i.Clipper.prototype.FirstIsBottomPt=function(e,t){var n=e.Prev;while(i.IntPoint.op_Equality(n.Pt,e.Pt)&&n!=e)n=n.Prev;var r=Math.abs(this.GetDx(e.Pt,n.Pt));n=e.Next;while(i.IntPoint.op_Equality(n.Pt,e.Pt)&&n!=e)n=n.Next;var s=Math.abs(this.GetDx(e.Pt,n.Pt));n=t.Prev;while(i.IntPoint.op_Equality(n.Pt,t.Pt)&&n!=t)n=n.Prev;var o=Math.abs(this.GetDx(t.Pt,n.Pt));n=t.Next;while(i.IntPoint.op_Equality(n.Pt,t.Pt)&&n!=t)n=n.Next;var u=Math.abs(this.GetDx(t.Pt,n.Pt));return r>=o&&r>=u||s>=o&&s>=u},i.Clipper.prototype.GetBottomPt=function(e){var t=null,n=e.Next;while(n!=e)n.Pt.Y>e.Pt.Y?(e=n,t=null):n.Pt.Y==e.Pt.Y&&n.Pt.X<=e.Pt.X&&(n.Pt.X<e.Pt.X?(t=null,e=n):n.Next!=e&&n.Prev!=e&&(t=n)),n=n.Next;if(t!==null)while(t!=n){this.FirstIsBottomPt(n,t)||(e=t),t=t.Next;while(i.IntPoint.op_Inequality(t.Pt,e.Pt))t=t.Next}return e},i.Clipper.prototype.GetLowermostRec=function(e,t){e.BottomPt===null&&(e.BottomPt=this.GetBottomPt(e.Pts)),t.BottomPt===null&&(t.BottomPt=this.GetBottomPt(t.Pts));var n=e.BottomPt,r=t.BottomPt;return n.Pt.Y>r.Pt.Y?e:n.Pt.Y<r.Pt.Y?t:n.Pt.X<r.Pt.X?e:n.Pt.X>r.Pt.X?t:n.Next==n?t:r.Next==r?e:this.FirstIsBottomPt(n,r)?e:t},i.Clipper.prototype.Param1RightOfParam2=function(e,t){do{e=e.FirstLeft;if(e==t)return!0}while(e!==null);return!1},i.Clipper.prototype.GetOutRec=function(e){var t=this.m_PolyOuts[e];while(t!=this.m_PolyOuts[t.Idx])t=this.m_PolyOuts[t.Idx];return t},i.Clipper.prototype.AppendPolygon=function(e,t){var n=this.m_PolyOuts[e.OutIdx],r=this.m_PolyOuts[t.OutIdx],s;this.Param1RightOfParam2(n,r)?s=r:this.Param1RightOfParam2(r,n)?s=n:s=this.GetLowermostRec(n,r);var o=n.Pts,u=o.Prev,a=r.Pts,f=a.Prev,l;e.Side==i.EdgeSide.esLeft?(t.Side==i.EdgeSide.esLeft?(this.ReversePolyPtLinks(a),a.Next=o,o.Prev=a,u.Next=f,f.Prev=u,n.Pts=f):(f.Next=o,o.Prev=f,a.Prev=u,u.Next=a,n.Pts=a),l=i.EdgeSide.esLeft):(t.Side==i.EdgeSide.esRight?(this.ReversePolyPtLinks(a),u.Next=f,f.Prev=u,a.Next=o,o.Prev=a):(u.Next=a,a.Prev=u,o.Prev=f,f.Next=o),l=i.EdgeSide.esRight),n.BottomPt=null,s==r&&(r.FirstLeft!=n&&(n.FirstLeft=r.FirstLeft),n.IsHole=r.IsHole),r.Pts=null,r.BottomPt=null,r.FirstLeft=n;var c=e.OutIdx,h=t.OutIdx;e.OutIdx=-1,t.OutIdx=-1;var p=this.m_ActiveEdges;while(p!==null){if(p.OutIdx==h){p.OutIdx=c,p.Side=l;break}p=p.NextInAEL}r.Idx=n.Idx},i.Clipper.prototype.ReversePolyPtLinks=function(e){if(e===null)return;var t,n;t=e;do n=t.Next,t.Next=t.Prev,t.Prev=n,t=n;while(t!=e)},i.Clipper.SwapSides=function(e,t){var n=e.Side;e.Side=t.Side,t.Side=n},i.Clipper.SwapPolyIndexes=function(e,t){var n=e.OutIdx;e.OutIdx=t.OutIdx,t.OutIdx=n},i.Clipper.prototype.IntersectEdges=function(e,t,r,s){var o=!s&&e.NextInLML===null&&e.Top.X==r.X&&e.Top.Y==r.Y,u=!s&&t.NextInLML===null&&t.Top.X==r.X&&t.Top.Y==r.Y,a=e.OutIdx>=0,f=t.OutIdx>=0;if(n)if(e.WindDelta===0||t.WindDelta===0){e.WindDelta===0&&t.WindDelta===0?(o||u)&&a&&f&&this.AddLocalMaxPoly(e,t,r):e.PolyTyp==t.PolyTyp&&e.WindDelta!=t.WindDelta&&this.m_ClipType==i.ClipType.ctUnion?e.WindDelta===0?f&&(this.AddOutPt(e,r),a&&(e.OutIdx=-1)):a&&(this.AddOutPt(t,r),f&&(t.OutIdx=-1)):e.PolyTyp!=t.PolyTyp&&(e.WindDelta!==0||Math.abs(t.WindCnt)!=1||this.m_ClipType==i.ClipType.ctUnion&&t.WindCnt2!==0?t.WindDelta===0&&Math.abs(e.WindCnt)==1&&(this.m_ClipType!=i.ClipType.ctUnion||e.WindCnt2===0)&&(this.AddOutPt(t,r),f&&(t.OutIdx=-1)):(this.AddOutPt(e,r),a&&(e.OutIdx=-1))),o&&(e.OutIdx<0?this.DeleteFromAEL(e):i.Error("Error intersecting polylines")),u&&(t.OutIdx<0?this.DeleteFromAEL(t):i.Error("Error intersecting polylines"));return}if(e.PolyTyp==t.PolyTyp)if(this.IsEvenOddFillType(e)){var l=e.WindCnt;e.WindCnt=t.WindCnt,t.WindCnt=l}else e.WindCnt+t.WindDelta===0?e.WindCnt=-e.WindCnt:e.WindCnt+=t.WindDelta,t.WindCnt-e.WindDelta===0?t.WindCnt=-t.WindCnt:t.WindCnt-=e.WindDelta;else this.IsEvenOddFillType(t)?e.WindCnt2=e.WindCnt2===0?1:0:e.WindCnt2+=t.WindDelta,this.IsEvenOddFillType(e)?t.WindCnt2=t.WindCnt2===0?1:0:t.WindCnt2-=e.WindDelta;var c,h,p,d;e.PolyTyp==i.PolyType.ptSubject?(c=this.m_SubjFillType,p=this.m_ClipFillType):(c=this.m_ClipFillType,p=this.m_SubjFillType),t.PolyTyp==i.PolyType.ptSubject?(h=this.m_SubjFillType,d=this.m_ClipFillType):(h=this.m_ClipFillType,d=this.m_SubjFillType);var v,m;switch(c){case i.PolyFillType.pftPositive:v=e.WindCnt;break;case i.PolyFillType.pftNegative:v=-e.WindCnt;break;default:v=Math.abs(e.WindCnt)}switch(h){case i.PolyFillType.pftPositive:m=t.WindCnt;break;case i.PolyFillType.pftNegative:m=-t.WindCnt;break;default:m=Math.abs(t.WindCnt)}if(a&&f)o||u||v!==0&&v!=1||m!==0&&m!=1||e.PolyTyp!=t.PolyTyp&&this.m_ClipType!=i.ClipType.ctXor?this.AddLocalMaxPoly(e,t,r):(this.AddOutPt(e,r),this.AddOutPt(t,r),i.Clipper.SwapSides(e,t),i.Clipper.SwapPolyIndexes(e,t));else if(a){if(m===0||m==1)this.AddOutPt(e,r),i.Clipper.SwapSides(e,t),i.Clipper.SwapPolyIndexes(e,t)}else if(f){if(v===0||v==1)this.AddOutPt(t,r),i.Clipper.SwapSides(e,t),i.Clipper.SwapPolyIndexes(e,t)}else if((v===0||v==1)&&(m===0||m==1)&&!o&&!u){var g,y;switch(p){case i.PolyFillType.pftPositive:g=e.WindCnt2;break;case i.PolyFillType.pftNegative:g=-e.WindCnt2;break;default:g=Math.abs(e.WindCnt2)}switch(d){case i.PolyFillType.pftPositive:y=t.WindCnt2;break;case i.PolyFillType.pftNegative:y=-t.WindCnt2;break;default:y=Math.abs(t.WindCnt2)}if(e.PolyTyp!=t.PolyTyp)this.AddLocalMinPoly(e,t,r);else if(v==1&&m==1)switch(this.m_ClipType){case i.ClipType.ctIntersection:g>0&&y>0&&this.AddLocalMinPoly(e,t,r);break;case i.ClipType.ctUnion:g<=0&&y<=0&&this.AddLocalMinPoly(e,t,r);break;case i.ClipType.ctDifference:(e.PolyTyp==i.PolyType.ptClip&&g>0&&y>0||e.PolyTyp==i.PolyType.ptSubject&&g<=0&&y<=0)&&this.AddLocalMinPoly(e,t,r);break;case i.ClipType.ctXor:this.AddLocalMinPoly(e,t,r)}else i.Clipper.SwapSides(e,t)}o!=u&&(o&&e.OutIdx>=0||u&&t.OutIdx>=0)&&(i.Clipper.SwapSides(e,t),i.Clipper.SwapPolyIndexes(e,t)),o&&this.DeleteFromAEL(e),u&&this.DeleteFromAEL(t)},i.Clipper.prototype.DeleteFromAEL=function(e){var t=e.PrevInAEL,n=e.NextInAEL;if(t===null&&n===null&&e!=this.m_ActiveEdges)return;t!==null?t.NextInAEL=n:this.m_ActiveEdges=n,n!==null&&(n.PrevInAEL=t),e.NextInAEL=null,e.PrevInAEL=null},i.Clipper.prototype.DeleteFromSEL=function(e){var t=e.PrevInSEL,n=e.NextInSEL;if(t===null&&n===null&&e!=this.m_SortedEdges)return;t!==null?t.NextInSEL=n:this.m_SortedEdges=n,n!==null&&(n.PrevInSEL=t),e.NextInSEL=null,e.PrevInSEL=null},i.Clipper.prototype.UpdateEdgeIntoAEL=function(e){e.NextInLML===null&&i.Error("UpdateEdgeIntoAEL: invalid call");var t=e.PrevInAEL,n=e.NextInAEL;return e.NextInLML.OutIdx=e.OutIdx,t!==null?t.NextInAEL=e.NextInLML:this.m_ActiveEdges=e.NextInLML,n!==null&&(n.PrevInAEL=e.NextInLML),e.NextInLML.Side=e.Side,e.NextInLML.WindDelta=e.WindDelta,e.NextInLML.WindCnt=e.WindCnt,e.NextInLML.WindCnt2=e.WindCnt2,e=e.NextInLML,e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,e.PrevInAEL=t,e.NextInAEL=n,i.ClipperBase.IsHorizontal(e)||this.InsertScanbeam(e.Top.Y),e},i.Clipper.prototype.ProcessHorizontals=function(e){var t=this.m_SortedEdges;while(t!==null)this.DeleteFromSEL(t),this.ProcessHorizontal(t,e),t=this.m_SortedEdges},i.Clipper.prototype.GetHorzDirection=function(e,t){e.Bot.X<e.Top.X?(t.Left=e.Bot.X,t.Right=e.Top.X,t.Dir=i.Direction.dLeftToRight):(t.Left=e.Top.X,t.Right=e.Bot.X,t.Dir=i.Direction.dRightToLeft)},i.Clipper.prototype.PrepareHorzJoins=function(e,t){var n=this.m_PolyOuts[e.OutIdx].Pts;e.Side!=i.EdgeSide.esLeft&&(n=n.Prev),t&&(i.IntPoint.op_Equality(n.Pt,e.Top)?this.AddGhostJoin(n,e.Bot):this.AddGhostJoin(n,e.Top))},i.Clipper.prototype.ProcessHorizontal=function(e,t){var n={Dir:null,Left:null,Right:null};this.GetHorzDirection(e,n);var r=n.Dir,s=n.Left,o=n.Right,u=e,a=null;while(u.NextInLML!==null&&i.ClipperBase.IsHorizontal(u.NextInLML))u=u.NextInLML;u.NextInLML===null&&(a=this.GetMaximaPair(u));for(;;){var f=e==u,l=this.GetNextInAEL(e,r);while(l!==null){if(l.Curr.X==e.Top.X&&e.NextInLML!==null&&l.Dx<e.NextInLML.Dx)break;var c=this.GetNextInAEL(l,r);if(r==i.Direction.dLeftToRight&&l.Curr.X<=o||r==i.Direction.dRightToLeft&&l.Curr.X>=s){e.OutIdx>=0&&e.WindDelta!=0&&this.PrepareHorzJoins(e,t);if(l==a&&f){r==i.Direction.dLeftToRight?this.IntersectEdges(e,l,l.Top,!1):this.IntersectEdges(l,e,l.Top,!1),a.OutIdx>=0&&i.Error("ProcessHorizontal error");return}if(r==i.Direction.dLeftToRight){var h=new i.IntPoint(l.Curr.X,e.Curr.Y);this.IntersectEdges(e,l,h,!0)}else{var h=new i.IntPoint(l.Curr.X,e.Curr.Y);this.IntersectEdges(l,e,h,!0)}this.SwapPositionsInAEL(e,l)}else if(r==i.Direction.dLeftToRight&&l.Curr.X>=o||r==i.Direction.dRightToLeft&&l.Curr.X<=s)break;l=c}e.OutIdx>=0&&e.WindDelta!==0&&this.PrepareHorzJoins(e,t);if(e.NextInLML===null||!i.ClipperBase.IsHorizontal(e.NextInLML))break;e=this.UpdateEdgeIntoAEL(e),e.OutIdx>=0&&this.AddOutPt(e,e.Bot);var n={Dir:r,Left:s,Right:o};this.GetHorzDirection(e,n),r=n.Dir,s=n.Left,o=n.Right}if(e.NextInLML!==null)if(e.OutIdx>=0){var p=this.AddOutPt(e,e.Top);e=this.UpdateEdgeIntoAEL(e);if(e.WindDelta===0)return;var d=e.PrevInAEL,c=e.NextInAEL;if(d!==null&&d.Curr.X==e.Bot.X&&d.Curr.Y==e.Bot.Y&&d.WindDelta!==0&&d.OutIdx>=0&&d.Curr.Y>d.Top.Y&&i.ClipperBase.SlopesEqual(e,d,this.m_UseFullRange)){var v=this.AddOutPt(d,e.Bot);this.AddJoin(p,v,e.Top)}else if(c!==null&&c.Curr.X==e.Bot.X&&c.Curr.Y==e.Bot.Y&&c.WindDelta!==0&&c.OutIdx>=0&&c.Curr.Y>c.Top.Y&&i.ClipperBase.SlopesEqual(e,c,this.m_UseFullRange)){var v=this.AddOutPt(c,e.Bot);this.AddJoin(p,v,e.Top)}}else e=this.UpdateEdgeIntoAEL(e);else a!==null?a.OutIdx>=0?(r==i.Direction.dLeftToRight?this.IntersectEdges(e,a,e.Top,!1):this.IntersectEdges(a,e,e.Top,!1),a.OutIdx>=0&&i.Error("ProcessHorizontal error")):(this.DeleteFromAEL(e),this.DeleteFromAEL(a)):(e.OutIdx>=0&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e))},i.Clipper.prototype.GetNextInAEL=function(e,t){return t==i.Direction.dLeftToRight?e.NextInAEL:e.PrevInAEL},i.Clipper.prototype.IsMinima=function(e){return e!==null&&e.Prev.NextInLML!=e&&e.Next.NextInLML!=e},i.Clipper.prototype.IsMaxima=function(e,t){return e!==null&&e.Top.Y==t&&e.NextInLML===null},i.Clipper.prototype.IsIntermediate=function(e,t){return e.Top.Y==t&&e.NextInLML!==null},i.Clipper.prototype.GetMaximaPair=function(e){var t=null;return i.IntPoint.op_Equality(e.Next.Top,e.Top)&&e.Next.NextInLML===null?t=e.Next:i.IntPoint.op_Equality(e.Prev.Top,e.Top)&&e.Prev.NextInLML===null&&(t=e.Prev),t!==null&&(t.OutIdx==-2||t.NextInAEL==t.PrevInAEL&&!i.ClipperBase.IsHorizontal(t))?null:t},i.Clipper.prototype.ProcessIntersections=function(e,t){if(this.m_ActiveEdges==null)return!0;try{this.BuildIntersectList(e,t);if(this.m_IntersectList.length==0)return!0;if(this.m_IntersectList.length!=1&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(n){this.m_SortedEdges=null,this.m_IntersectList.length=0,i.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},i.Clipper.prototype.BuildIntersectList=function(e,t){if(this.m_ActiveEdges===null)return;var n=this.m_ActiveEdges;this.m_SortedEdges=n;while(n!==null)n.PrevInSEL=n.PrevInAEL,n.NextInSEL=n.NextInAEL,n.Curr.X=i.Clipper.TopX(n,t),n=n.NextInAEL;var r=!0;while(r&&this.m_SortedEdges!==null){r=!1,n=this.m_SortedEdges;while(n.NextInSEL!==null){var s=n.NextInSEL,o=new i.IntPoint;if(n.Curr.X>s.Curr.X){!this.IntersectPoint(n,s,o)&&n.Curr.X>s.Curr.X+1&&i.Error("Intersection error"),o.Y>e&&(o.Y=e,Math.abs(n.Dx)>Math.abs(s.Dx)?o.X=i.Clipper.TopX(s,e):o.X=i.Clipper.TopX(n,e));var u=new i.IntersectNode;u.Edge1=n,u.Edge2=s,u.Pt.X=o.X,u.Pt.Y=o.Y,this.m_IntersectList.push(u),this.SwapPositionsInSEL(n,s),r=!0}else n=s}if(n.PrevInSEL===null)break;n.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null},i.Clipper.prototype.EdgesAdjacent=function(e){return e.Edge1.NextInSEL==e.Edge2||e.Edge1.PrevInSEL==e.Edge2},i.Clipper.IntersectNodeSort=function(e,t){return t.Pt.Y-e.Pt.Y},i.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();var e=this.m_IntersectList.length;for(var t=0;t<e;t++){if(!this.EdgesAdjacent(this.m_IntersectList[t])){var n=t+1;while(n<e&&!this.EdgesAdjacent(this.m_IntersectList[n]))n++;if(n==e)return!1;var r=this.m_IntersectList[t];this.m_IntersectList[t]=this.m_IntersectList[n],this.m_IntersectList[n]=r}this.SwapPositionsInSEL(this.m_IntersectList[t].Edge1,this.m_IntersectList[t].Edge2)}return!0},i.Clipper.prototype.ProcessIntersectList=function(){for(var e=0,t=this.m_IntersectList.length;e<t;e++){var n=this.m_IntersectList[e];this.IntersectEdges(n.Edge1,n.Edge2,n.Pt,!0),this.SwapPositionsInAEL(n.Edge1,n.Edge2)}this.m_IntersectList.length=0};var wn=function(e){return e<0?Math.ceil(e-.5):Math.round(e)},En=function(e){return e<0?Math.ceil(e-.5):Math.floor(e+.5)},Sn=function(e){return e<0?-Math.round(Math.abs(e)):Math.round(e)},xn=function(e){return e<0?(e-=.5,e<-2147483648?Math.ceil(e):e|0):(e+=.5,e>2147483647?Math.floor(e):e|0)};a.msie?i.Clipper.Round=wn:a.chromium?i.Clipper.Round=Sn:a.safari?i.Clipper.Round=xn:i.Clipper.Round=En,i.Clipper.TopX=function(e,t){return t==e.Top.Y?e.Top.X:e.Bot.X+i.Clipper.Round(e.Dx*(t-e.Bot.Y))},i.Clipper.prototype.IntersectPoint=function(e,t,n){n.X=0,n.Y=0;var r,s;if(i.ClipperBase.SlopesEqual(e,t,this.m_UseFullRange)||e.Dx==t.Dx)return t.Bot.Y>e.Bot.Y?(n.X=t.Bot.X,n.Y=t.Bot.Y):(n.X=e.Bot.X,n.Y=e.Bot.Y),!1;if(e.Delta.X===0)n.X=e.Bot.X,i.ClipperBase.IsHorizontal(t)?n.Y=t.Bot.Y:(s=t.Bot.Y-t.Bot.X/t.Dx,n.Y=i.Clipper.Round(n.X/t.Dx+s));else if(t.Delta.X===0)n.X=t.Bot.X,i.ClipperBase.IsHorizontal(e)?n.Y=e.Bot.Y:(r=e.Bot.Y-e.Bot.X/e.Dx,n.Y=i.Clipper.Round(n.X/e.Dx+r));else{r=e.Bot.X-e.Bot.Y*e.Dx,s=t.Bot.X-t.Bot.Y*t.Dx;var o=(s-r)/(e.Dx-t.Dx);n.Y=i.Clipper.Round(o),Math.abs(e.Dx)<Math.abs(t.Dx)?n.X=i.Clipper.Round(e.Dx*o+r):n.X=i.Clipper.Round(t.Dx*o+s)}if(n.Y<e.Top.Y||n.Y<t.Top.Y){if(e.Top.Y>t.Top.Y)return n.Y=e.Top.Y,n.X=i.Clipper.TopX(t,e.Top.Y),n.X<e.Top.X;n.Y=t.Top.Y,Math.abs(e.Dx)<Math.abs(t.Dx)?n.X=i.Clipper.TopX(e,n.Y):n.X=i.Clipper.TopX(t,n.Y)}return!0},i.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(e){var t=this.m_ActiveEdges;while(t!==null){var n=this.IsMaxima(t,e);if(n){var r=this.GetMaximaPair(t);n=r===null||!i.ClipperBase.IsHorizontal(r)}if(n){var s=t.PrevInAEL;this.DoMaxima(t),s===null?t=this.m_ActiveEdges:t=s.NextInAEL}else{this.IsIntermediate(t,e)&&i.ClipperBase.IsHorizontal(t.NextInLML)?(t=this.UpdateEdgeIntoAEL(t),t.OutIdx>=0&&this.AddOutPt(t,t.Bot),this.AddEdgeToSEL(t)):(t.Curr.X=i.Clipper.TopX(t,e),t.Curr.Y=e);if(this.StrictlySimple){var s=t.PrevInAEL;if(t.OutIdx>=0&&t.WindDelta!==0&&s!==null&&s.OutIdx>=0&&s.Curr.X==t.Curr.X&&s.WindDelta!==0){var o=this.AddOutPt(s,t.Curr),u=this.AddOutPt(t,t.Curr);this.AddJoin(o,u,t.Curr)}}t=t.NextInAEL}}this.ProcessHorizontals(!0),t=this.m_ActiveEdges;while(t!==null){if(this.IsIntermediate(t,e)){var o=null;t.OutIdx>=0&&(o=this.AddOutPt(t,t.Top)),t=this.UpdateEdgeIntoAEL(t);var s=t.PrevInAEL,a=t.NextInAEL;if(s!==null&&s.Curr.X==t.Bot.X&&s.Curr.Y==t.Bot.Y&&o!==null&&s.OutIdx>=0&&s.Curr.Y>s.Top.Y&&i.ClipperBase.SlopesEqual(t,s,this.m_UseFullRange)&&t.WindDelta!==0&&s.WindDelta!==0){var u=this.AddOutPt(s,t.Bot);this.AddJoin(o,u,t.Top)}else if(a!==null&&a.Curr.X==t.Bot.X&&a.Curr.Y==t.Bot.Y&&o!==null&&a.OutIdx>=0&&a.Curr.Y>a.Top.Y&&i.ClipperBase.SlopesEqual(t,a,this.m_UseFullRange)&&t.WindDelta!==0&&a.WindDelta!==0){var u=this.AddOutPt(a,t.Bot);this.AddJoin(o,u,t.Top)}}t=t.NextInAEL}},i.Clipper.prototype.DoMaxima=function(e){var t=this.GetMaximaPair(e);if(t===null){e.OutIdx>=0&&this.AddOutPt(e,e.Top),this.DeleteFromAEL(e);return}var n=e.NextInAEL,r=!0;while(n!==null&&n!=t)this.IntersectEdges(e,n,e.Top,!0),this.SwapPositionsInAEL(e,n),n=e.NextInAEL;e.OutIdx==-1&&t.OutIdx==-1?(this.DeleteFromAEL(e),this.DeleteFromAEL(t)):e.OutIdx>=0&&t.OutIdx>=0?this.IntersectEdges(e,t,e.Top,!1):r&&e.WindDelta===0?(e.OutIdx>=0&&(this.AddOutPt(e,e.Top),e.OutIdx=-1),this.DeleteFromAEL(e),t.OutIdx>=0&&(this.AddOutPt(t,e.Top),t.OutIdx=-1),this.DeleteFromAEL(t)):i.Error("DoMaxima error")},i.Clipper.ReversePaths=function(e){for(var t=0,n=e.length;t<n;t++)e[t].reverse()},i.Clipper.Orientation=function(e){return i.Clipper.Area(e)>=0},i.Clipper.prototype.PointCount=function(e){if(e===null)return 0;var t=0,n=e;do t++,n=n.Next;while(n!=e);return t},i.Clipper.prototype.BuildResult=function(e){i.Clear(e);for(var t=0,n=this.m_PolyOuts.length;t<n;t++){var r=this.m_PolyOuts[t];if(r.Pts===null)continue;var s=r.Pts.Prev,o=this.PointCount(s);if(o<2)continue;var u=new Array(o);for(var a=0;a<o;a++)u[a]=s.Pt,s=s.Prev;e.push(u)}},i.Clipper.prototype.BuildResult2=function(e){e.Clear();for(var t=0,n=this.m_PolyOuts.length;t<n;t++){var r=this.m_PolyOuts[t],s=this.PointCount(r.Pts);if(r.IsOpen&&s<2||!r.IsOpen&&s<3)continue;this.FixHoleLinkage(r);var o=new i.PolyNode;e.m_AllPolys.push(o),r.PolyNode=o,o.m_polygon.length=s;var u=r.Pts.Prev;for(var a=0;a<s;a++)o.m_polygon[a]=u.Pt,u=u.Prev}for(var t=0,n=this.m_PolyOuts.length;t<n;t++){var r=this.m_PolyOuts[t];if(r.PolyNode===null)continue;r.IsOpen?(r.PolyNode.IsOpen=!0,e.AddChild(r.PolyNode)):r.FirstLeft!==null&&r.FirstLeft.PolyNode!=null?r.FirstLeft.PolyNode.AddChild(r.PolyNode):e.AddChild(r.PolyNode)}},i.Clipper.prototype.FixupOutPolygon=function(e){var t=null;e.BottomPt=null;var n=e.Pts;for(;;){if(n.Prev==n||n.Prev==n.Next){this.DisposeOutPts(n),e.Pts=null;return}if(i.IntPoint.op_Equality(n.Pt,n.Next.Pt)||i.IntPoint.op_Equality(n.Pt,n.Prev.Pt)||i.ClipperBase.SlopesEqual(n.Prev.Pt,n.Pt,n.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(n.Prev.Pt,n.Pt,n.Next.Pt))){t=null;var r=n;n.Prev.Next=n.Next,n.Next.Prev=n.Prev,n=n.Prev,r=null}else{if(n==t)break;t===null&&(t=n),n=n.Next}}e.Pts=n},i.Clipper.prototype.DupOutPt=function(e,t){var n=new i.OutPt;return n.Pt.X=e.Pt.X,n.Pt.Y=e.Pt.Y,n.Idx=e.Idx,t?(n.Next=e.Next,n.Prev=e,e.Next.Prev=n,e.Next=n):(n.Prev=e.Prev,n.Next=e,e.Prev.Next=n,e.Prev=n),n},i.Clipper.prototype.GetOverlap=function(e,t,n,r,i){return e<t?n<r?(i.Left=Math.max(e,n),i.Right=Math.min(t,r)):(i.Left=Math.max(e,r),i.Right=Math.min(t,n)):n<r?(i.Left=Math.max(t,n),i.Right=Math.min(e,r)):(i.Left=Math.max(t,r),i.Right=Math.min(e,n)),i.Left<i.Right},i.Clipper.prototype.JoinHorz=function(e,t,n,r,s,o){var u=e.Pt.X>t.Pt.X?i.Direction.dRightToLeft:i.Direction.dLeftToRight,a=n.Pt.X>r.Pt.X?i.Direction.dRightToLeft:i.Direction.dLeftToRight;if(u==a)return!1;if(u==i.Direction.dLeftToRight){while(e.Next.Pt.X<=s.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==s.Y)e=e.Next;o&&e.Pt.X!=s.X&&(e=e.Next),t=this.DupOutPt(e,!o),i.IntPoint.op_Inequality(t.Pt,s)&&(e=t,e.Pt.X=s.X,e.Pt.Y=s.Y,t=this.DupOutPt(e,!o))}else{while(e.Next.Pt.X>=s.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==s.Y)e=e.Next;!o&&e.Pt.X!=s.X&&(e=e.Next),t=this.DupOutPt(e,o),i.IntPoint.op_Inequality(t.Pt,s)&&(e=t,e.Pt.X=s.X,e.Pt.Y=s.Y,t=this.DupOutPt(e,o))}if(a==i.Direction.dLeftToRight){while(n.Next.Pt.X<=s.X&&n.Next.Pt.X>=n.Pt.X&&n.Next.Pt.Y==s.Y)n=n.Next;o&&n.Pt.X!=s.X&&(n=n.Next),r=this.DupOutPt(n,!o),i.IntPoint.op_Inequality(r.Pt,s)&&(n=r,n.Pt.X=s.X,n.Pt.Y=s.Y,r=this.DupOutPt(n,!o))}else{while(n.Next.Pt.X>=s.X&&n.Next.Pt.X<=n.Pt.X&&n.Next.Pt.Y==s.Y)n=n.Next;!o&&n.Pt.X!=s.X&&(n=n.Next),r=this.DupOutPt(n,o),i.IntPoint.op_Inequality(r.Pt,s)&&(n=r,n.Pt.X=s.X,n.Pt.Y=s.Y,r=this.DupOutPt(n,o))}return u==i.Direction.dLeftToRight==o?(e.Prev=n,n.Next=e,t.Next=r,r.Prev=t):(e.Next=n,n.Prev=e,t.Prev=r,r.Next=t),!0},i.Clipper.prototype.JoinPoints=function(e,t,n){var r=e.OutPt1,s=new i.OutPt,o=e.OutPt2,u=new i.OutPt,a=e.OutPt1.Pt.Y==e.OffPt.Y;if(a&&i.IntPoint.op_Equality(e.OffPt,e.OutPt1.Pt)&&i.IntPoint.op_Equality(e.OffPt,e.OutPt2.Pt)){s=e.OutPt1.Next;while(s!=r&&i.IntPoint.op_Equality(s.Pt,e.OffPt))s=s.Next;var f=s.Pt.Y>e.OffPt.Y;u=e.OutPt2.Next;while(u!=o&&i.IntPoint.op_Equality(u.Pt,e.OffPt))u=u.Next;var l=u.Pt.Y>e.OffPt.Y;return f==l?!1:f?(s=this.DupOutPt(r,!1),u=this.DupOutPt(o,!0),r.Prev=o,o.Next=r,s.Next=u,u.Prev=s,e.OutPt1=r,e.OutPt2=s,!0):(s=this.DupOutPt(r,!0),u=this.DupOutPt(o,!1),r.Next=o,o.Prev=r,s.Prev=u,u.Next=s,e.OutPt1=r,e.OutPt2=s,!0)}if(a){s=r;while(r.Prev.Pt.Y==r.Pt.Y&&r.Prev!=s&&r.Prev!=o)r=r.Prev;while(s.Next.Pt.Y==s.Pt.Y&&s.Next!=r&&s.Next!=o)s=s.Next;if(s.Next==r||s.Next==o)return!1;u=o;while(o.Prev.Pt.Y==o.Pt.Y&&o.Prev!=u&&o.Prev!=s)o=o.Prev;while(u.Next.Pt.Y==u.Pt.Y&&u.Next!=o&&u.Next!=r)u=u.Next;if(u.Next==o||u.Next==r)return!1;var c={Left:null,Right:null};if(!this.GetOverlap(r.Pt.X,s.Pt.X,o.Pt.X,u.Pt.X,c))return!1;var h=c.Left,p=c.Right,d=new i.IntPoint,v;return r.Pt.X>=h&&r.Pt.X<=p?(d.X=r.Pt.X,d.Y=r.Pt.Y,v=r.Pt.X>s.Pt.X):o.Pt.X>=h&&o.Pt.X<=p?(d.X=o.Pt.X,d.Y=o.Pt.Y,v=o.Pt.X>u.Pt.X):s.Pt.X>=h&&s.Pt.X<=p?(d.X=s.Pt.X,d.Y=s.Pt.Y,v=s.Pt.X>r.Pt.X):(d.X=u.Pt.X,d.Y=u.Pt.Y,v=u.Pt.X>o.Pt.X),e.OutPt1=r,e.OutPt2=o,this.JoinHorz(r,s,o,u,d,v)}s=r.Next;while(i.IntPoint.op_Equality(s.Pt,r.Pt)&&s!=r)s=s.Next;var m=s.Pt.Y>r.Pt.Y||!i.ClipperBase.SlopesEqual(r.Pt,s.Pt,e.OffPt,this.m_UseFullRange);if(m){s=r.Prev;while(i.IntPoint.op_Equality(s.Pt,r.Pt)&&s!=r)s=s.Prev;if(s.Pt.Y>r.Pt.Y||!i.ClipperBase.SlopesEqual(r.Pt,s.Pt,e.OffPt,this.m_UseFullRange))return!1}u=o.Next;while(i.IntPoint.op_Equality(u.Pt,o.Pt)&&u!=o)u=u.Next;var g=u.Pt.Y>o.Pt.Y||!i.ClipperBase.SlopesEqual(o.Pt,u.Pt,e.OffPt,this.m_UseFullRange);if(g){u=o.Prev;while(i.IntPoint.op_Equality(u.Pt,o.Pt)&&u!=o)u=u.Prev;if(u.Pt.Y>o.Pt.Y||!i.ClipperBase.SlopesEqual(o.Pt,u.Pt,e.OffPt,this.m_UseFullRange))return!1}return s==r||u==o||s==u||t==n&&m==g?!1:m?(s=this.DupOutPt(r,!1),u=this.DupOutPt(o,!0),r.Prev=o,o.Next=r,s.Next=u,u.Prev=s,e.OutPt1=r,e.OutPt2=s,!0):(s=this.DupOutPt(r,!0),u=this.DupOutPt(o,!1),r.Next=o,o.Prev=r,s.Prev=u,u.Next=s,e.OutPt1=r,e.OutPt2=s,!0)},i.Clipper.GetBounds=function(e){var t=0,n=e.length;while(t<n&&e[t].length==0)t++;if(t==n)return new i.IntRect(0,0,0,0);var r=new i.IntRect;r.left=e[t][0].X,r.right=r.left,r.top=e[t][0].Y,r.bottom=r.top;for(;t<n;t++)for(var s=0,o=e[t].length;s<o;s++)e[t][s].X<r.left?r.left=e[t][s].X:e[t][s].X>r.right&&(r.right=e[t][s].X),e[t][s].Y<r.top?r.top=e[t][s].Y:e[t][s].Y>r.bottom&&(r.bottom=e[t][s].Y);return r},i.Clipper.prototype.GetBounds2=function(e){var t=e,n=new i.IntRect;n.left=e.Pt.X,n.right=e.Pt.X,n.top=e.Pt.Y,n.bottom=e.Pt.Y,e=e.Next;while(e!=t)e.Pt.X<n.left&&(n.left=e.Pt.X),e.Pt.X>n.right&&(n.right=e.Pt.X),e.Pt.Y<n.top&&(n.top=e.Pt.Y),e.Pt.Y>n.bottom&&(n.bottom=e.Pt.Y),e=e.Next;return n},i.Clipper.PointInPolygon=function(e,t){var n=0,r=t.length;if(r<3)return 0;var i=t[0];for(var s=1;s<=r;++s){var o=s==r?t[0]:t[s];if(o.Y==e.Y)if(o.X==e.X||i.Y==e.Y&&o.X>e.X==i.X<e.X)return-1;if(i.Y<e.Y!=o.Y<e.Y)if(i.X>=e.X)if(o.X>e.X)n=1-n;else{var u=(i.X-e.X)*(o.Y-e.Y)-(o.X-e.X)*(i.Y-e.Y);if(u==0)return-1;u>0==o.Y>i.Y&&(n=1-n)}else if(o.X>e.X){var u=(i.X-e.X)*(o.Y-e.Y)-(o.X-e.X)*(i.Y-e.Y);if(u==0)return-1;u>0==o.Y>i.Y&&(n=1-n)}i=o}return n},i.Clipper.prototype.PointInPolygon=function(e,t){var n=0,r=t;for(;;){var i=t.Pt.X,s=t.Pt.Y,o=t.Next.Pt.X,u=t.Next.Pt.Y;if(u==e.Y)if(o==e.X||s==e.Y&&o>e.X==i<e.X)return-1;if(s<e.Y!=u<e.Y)if(i>=e.X)if(o>e.X)n=1-n;else{var a=(i-e.X)*(u-e.Y)-(o-e.X)*(s-e.Y);if(a==0)return-1;a>0==u>s&&(n=1-n)}else if(o>e.X){var a=(i-e.X)*(u-e.Y)-(o-e.X)*(s-e.Y);if(a==0)return-1;a>0==u>s&&(n=1-n)}t=t.Next;if(r==t)break}return n},i.Clipper.prototype.Poly2ContainsPoly1=function(e,t){var n=e;do{var r=this.PointInPolygon(n.Pt,t);if(r>=0)return r!=0;n=n.Next}while(n!=e);return!0},i.Clipper.prototype.FixupFirstLefts1=function(e,t){for(var n=0,r=this.m_PolyOuts.length;n<r;n++){var i=this.m_PolyOuts[n];i.Pts!==null&&i.FirstLeft==e&&this.Poly2ContainsPoly1(i.Pts,t.Pts)&&(i.FirstLeft=t)}},i.Clipper.prototype.FixupFirstLefts2=function(e,t){for(var n=0,r=this.m_PolyOuts,i=r.length,s=r[n];n<i;n++,s=r[n])s.FirstLeft==e&&(s.FirstLeft=t)},i.Clipper.ParseFirstLeft=function(e){while(e!=null&&e.Pts==null)e=e.FirstLeft;return e},i.Clipper.prototype.JoinCommonEdges=function(){for(var e=0,t=this.m_Joins.length;e<t;e++){var n=this.m_Joins[e],r=this.GetOutRec(n.OutPt1.Idx),s=this.GetOutRec(n.OutPt2.Idx);if(r.Pts==null||s.Pts==null)continue;var o;r==s?o=r:this.Param1RightOfParam2(r,s)?o=s:this.Param1RightOfParam2(s,r)?o=r:o=this.GetLowermostRec(r,s);if(!this.JoinPoints(n,r,s))continue;if(r==s){r.Pts=n.OutPt1,r.BottomPt=null,s=this.CreateOutRec(),s.Pts=n.OutPt2,this.UpdateOutPtIdxs(s);if(this.m_UsingPolyTree)for(var u=0,a=this.m_PolyOuts.length;u<a-1;u++){var f=this.m_PolyOuts[u];if(f.Pts==null||i.Clipper.ParseFirstLeft(f.FirstLeft)!=r||f.IsHole==r.IsHole)continue;this.Poly2ContainsPoly1(f.Pts,n.OutPt2)&&(f.FirstLeft=s)}this.Poly2ContainsPoly1(s.Pts,r.Pts)?(s.IsHole=!r.IsHole,s.FirstLeft=r,this.m_UsingPolyTree&&this.FixupFirstLefts2(s,r),(s.IsHole^this.ReverseSolution)==this.Area(s)>0&&this.ReversePolyPtLinks(s.Pts)):this.Poly2ContainsPoly1(r.Pts,s.Pts)?(s.IsHole=r.IsHole,r.IsHole=!s.IsHole,s.FirstLeft=r.FirstLeft,r.FirstLeft=s,this.m_UsingPolyTree&&this.FixupFirstLefts2(r,s),(r.IsHole^this.ReverseSolution)==this.Area(r)>0&&this.ReversePolyPtLinks(r.Pts)):(s.IsHole=r.IsHole,s.FirstLeft=r.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(r,s))}else s.Pts=null,s.BottomPt=null,s.Idx=r.Idx,r.IsHole=o.IsHole,o==s&&(r.FirstLeft=s.FirstLeft),s.FirstLeft=r,this.m_UsingPolyTree&&this.FixupFirstLefts2(s,r)}},i.Clipper.prototype.UpdateOutPtIdxs=function(e){var t=e.Pts;do t.Idx=e.Idx,t=t.Prev;while(t!=e.Pts)},i.Clipper.prototype.DoSimplePolygons=function(){var e=0;while(e<this.m_PolyOuts.length){var t=this.m_PolyOuts[e++],n=t.Pts;if(n===null)continue;do{var r=n.Next;while(r!=t.Pts){if(i.IntPoint.op_Equality(n.Pt,r.Pt)&&r.Next!=n&&r.Prev!=n){var s=n.Prev,o=r.Prev;n.Prev=o,o.Next=n,r.Prev=s,s.Next=r,t.Pts=n;var u=this.CreateOutRec();u.Pts=r,this.UpdateOutPtIdxs(u),this.Poly2ContainsPoly1(u.Pts,t.Pts)?(u.IsHole=!t.IsHole,u.FirstLeft=t):this.Poly2ContainsPoly1(t.Pts,u.Pts)?(u.IsHole=t.IsHole,t.IsHole=!u.IsHole,u.FirstLeft=t.FirstLeft,t.FirstLeft=u):(u.IsHole=t.IsHole,u.FirstLeft=t.FirstLeft),r=n}r=r.Next}n=n.Next}while(n!=t.Pts)}},i.Clipper.Area=function(e){var t=e.length;if(t<3)return 0;var n=0;for(var r=0,i=t-1;r<t;++r)n+=(e[i].X+e[r].X)*(e[i].Y-e[r].Y),i=r;return-n*.5},i.Clipper.prototype.Area=function(e){var t=e.Pts;if(t==null)return 0;var n=0;do n+=(t.Prev.Pt.X+t.Pt.X)*(t.Prev.Pt.Y-t.Pt.Y),t=t.Next;while(t!=e.Pts);return n*.5},r&&(i.Clipper.OffsetPaths=function(e,t,n,r,s){var o=new i.Paths,u=new i.ClipperOffset(s,s);return u.AddPaths(e,n,r),u.Execute(o,t),o}),i.Clipper.SimplifyPolygon=function(e,t){var n=new Array,r=new i.Clipper(0);return r.StrictlySimple=!0,r.AddPath(e,i.PolyType.ptSubject,!0),r.Execute(i.ClipType.ctUnion,n,t,t),n},i.Clipper.SimplifyPolygons=function(e,t){typeof t=="undefined"&&(t=i.PolyFillType.pftEvenOdd);var n=new Array,r=new i.Clipper(0);return r.StrictlySimple=!0,r.AddPaths(e,i.PolyType.ptSubject,!0),r.Execute(i.ClipType.ctUnion,n,t,t),n},i.Clipper.DistanceSqrd=function(e,t){var n=e.X-t.X,r=e.Y-t.Y;return n*n+r*r},i.Clipper.DistanceFromLineSqrd=function(e,t,n){var r=t.Y-n.Y,i=n.X-t.X,s=r*t.X+i*t.Y;return s=r*e.X+i*e.Y-s,s*s/(r*r+i*i)},i.Clipper.SlopesNearCollinear=function(e,t,n,r){return i.Clipper.DistanceFromLineSqrd(t,e,n)<r},i.Clipper.PointsAreClose=function(e,t,n){var r=e.X-t.X,i=e.Y-t.Y;return r*r+i*i<=n},i.Clipper.ExcludeOp=function(e){var t=e.Prev;return t.Next=e.Next,e.Next.Prev=t,t.Idx=0,t},i.Clipper.CleanPolygon=function(e,t){typeof t=="undefined"&&(t=1.415);var n=e.length;if(n==0)return new Array;var r=new Array(n);for(var s=0;s<n;++s)r[s]=new i.OutPt;for(var s=0;s<n;++s)r[s].Pt=e[s],r[s].Next=r[(s+1)%n],r[s].Next.Prev=r[s],r[s].Idx=0;var o=t*t,u=r[0];while(u.Idx==0&&u.Next!=u.Prev)i.Clipper.PointsAreClose(u.Pt,u.Prev.Pt,o)?(u=i.Clipper.ExcludeOp(u),n--):i.Clipper.PointsAreClose(u.Prev.Pt,u.Next.Pt,o)?(i.Clipper.ExcludeOp(u.Next),u=i.Clipper.ExcludeOp(u),n-=2):i.Clipper.SlopesNearCollinear(u.Prev.Pt,u.Pt,u.Next.Pt,o)?(u=i.Clipper.ExcludeOp(u),n--):(u.Idx=1,u=u.Next);n<3&&(n=0);var a=new Array(n);for(var s=0;s<n;++s)a[s]=new i.IntPoint(u.Pt),u=u.Next;return r=null,a},i.Clipper.CleanPolygons=function(e,t){var n=new Array(e.length);for(var r=0,s=e.length;r<s;r++)n[r]=i.Clipper.CleanPolygon(e[r],t);return n},i.Clipper.Minkowski=function(e,t,n,r){var s=r?1:0,o=e.length,u=t.length,a=new Array;if(n)for(var f=0;f<u;f++){var l=new Array(o);for(var c=0,h=e.length,p=e[c];c<h;c++,p=e[c])l[c]=new i.IntPoint(t[f].X+p.X,t[f].Y+p.Y);a.push(l)}else for(var f=0;f<u;f++){var l=new Array(o);for(var c=0,h=e.length,p=e[c];c<h;c++,p=e[c])l[c]=new i.IntPoint(t[f].X-p.X,t[f].Y-p.Y);a.push(l)}var d=new Array;for(var f=0;f<u-1+s;f++)for(var c=0;c<o;c++){var v=new Array;v.push(a[f%u][c%o]),v.push(a[(f+1)%u][c%o]),v.push(a[(f+1)%u][(c+1)%o]),v.push(a[f%u][(c+1)%o]),i.Clipper.Orientation(v)||v.reverse(),d.push(v)}var m=new i.Clipper(0);return m.AddPaths(d,i.PolyType.ptSubject,!0),m.Execute(i.ClipType.ctUnion,a,i.PolyFillType.pftNonZero,i.PolyFillType.pftNonZero),a},i.Clipper.MinkowskiSum=function(){var e=arguments,t=e.length;if(t==3){var n=e[0],r=e[1],s=e[2];return i.Clipper.Minkowski(n,r,!0,s)}if(t==4){var n=e[0],o=e[1],u=e[2],s=e[3],a=new i.Clipper,f;for(var l=0,c=o.length;l<c;++l){var f=i.Clipper.Minkowski(n,o[l],!0,s);a.AddPaths(f,i.PolyType.ptSubject,!0)}s&&a.AddPaths(o,i.PolyType.ptClip,!0);var h=new i.Paths;return a.Execute(i.ClipType.ctUnion,h,u,u),h}},i.Clipper.MinkowskiDiff=function(e,t,n){return i.Clipper.Minkowski(e,t,!1,n)},i.Clipper.PolyTreeToPaths=function(e){var t=new Array;return i.Clipper.AddPolyNodeToPaths(e,i.Clipper.NodeType.ntAny,t),t},i.Clipper.AddPolyNodeToPaths=function(e,t,n){var r=!0;switch(t){case i.Clipper.NodeType.ntOpen:return;case i.Clipper.NodeType.ntClosed:r=!e.IsOpen;break;default:}e.m_polygon.length>0&&r&&n.push(e.m_polygon);for(var s=0,o=e.Childs(),u=o.length,a=o[s];s<u;s++,a=o[s])i.Clipper.AddPolyNodeToPaths(a,t,n)},i.Clipper.OpenPathsFromPolyTree=function(e){var t=new i.Paths;for(var n=0,r=e.ChildCount();n<r;n++)e.Childs()[n].IsOpen&&t.push(e.Childs()[n].m_polygon);return t},i.Clipper.ClosedPathsFromPolyTree=function(e){var t=new i.Paths;return i.Clipper.AddPolyNodeToPaths(e,i.Clipper.NodeType.ntClosed,t),t},bn(i.Clipper,i.ClipperBase),i.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},i.ClipperOffset=function(e,t){typeof e=="undefined"&&(e=2),typeof t=="undefined"&&(t=i.ClipperOffset.def_arc_tolerance),this.m_destPolys=new i.Paths,this.m_srcPoly=new i.Path,this.m_destPoly=new i.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new i.IntPoint,this.m_polyNodes=new i.PolyNode,this.MiterLimit=e,this.ArcTolerance=t,this.m_lowest.X=-1},i.ClipperOffset.two_pi=6.28318530717959,i.ClipperOffset.def_arc_tolerance=.25,i.ClipperOffset.prototype.Clear=function(){i.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},i.ClipperOffset.Round=i.Clipper.Round,i.ClipperOffset.prototype.AddPath=function(e,t,n){var r=e.length-1;if(r<0)return;var s=new i.PolyNode;s.m_jointype=t,s.m_endtype=n;if(n==i.EndType.etClosedLine||n==i.EndType.etClosedPolygon)while(r>0&&i.IntPoint.op_Equality(e[0],e[r]))r--;s.m_polygon.push(e[0]);var o=0,u=0;for(var a=1;a<=r;a++)if(i.IntPoint.op_Inequality(s.m_polygon[o],e[a])){o++,s.m_polygon.push(e[a]);if(e[a].Y>s.m_polygon[u].Y||e[a].Y==s.m_polygon[u].Y&&e[a].X<s.m_polygon[u].X)u=o}if(n==i.EndType.etClosedPolygon&&o<2||n!=i.EndType.etClosedPolygon&&o<0)return;this.m_polyNodes.AddChild(s);if(n!=i.EndType.etClosedPolygon)return;if(this.m_lowest.X<0)this.m_lowest=new i.IntPoint(0,u);else{var f=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];if(s.m_polygon[u].Y>f.Y||s.m_polygon[u].Y==f.Y&&s.m_polygon[u].X<f.X)this.m_lowest=new i.IntPoint(this.m_polyNodes.ChildCount()-1,u)}},i.ClipperOffset.prototype.AddPaths=function(e,t,n){for(var r=0,i=e.length;r<i;r++)this.AddPath(e[r],t,n)},i.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!i.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var e=0;e<this.m_polyNodes.ChildCount();e++){var t=this.m_polyNodes.Childs()[e];(t.m_endtype==i.EndType.etClosedPolygon||t.m_endtype==i.EndType.etClosedLine&&i.Clipper.Orientation(t.m_polygon))&&t.m_polygon.reverse()}else for(var e=0;e<this.m_polyNodes.ChildCount();e++){var t=this.m_polyNodes.Childs()[e];t.m_endtype==i.EndType.etClosedLine&&!i.Clipper.Orientation(t.m_polygon)&&t.m_polygon.reverse()}},i.ClipperOffset.GetUnitNormal=function(e,t){var n=t.X-e.X,r=t.Y-e.Y;if(n==0&&r==0)return new i.DoublePoint(0,0);var s=1/Math.sqrt(n*n+r*r);return n*=s,r*=s,new i.DoublePoint(r,-n)},i.ClipperOffset.prototype.DoOffset=function(e){this.m_destPolys=new Array,this.m_delta=e;if(i.ClipperBase.near_zero(e)){for(var t=0;t<this.m_polyNodes.ChildCount();t++){var n=this.m_polyNodes.Childs()[t];n.m_endtype==i.EndType.etClosedPolygon&&this.m_destPolys.push(n.m_polygon)}return}this.MiterLimit>2?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5;var r;this.ArcTolerance<=0?r=i.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(e)*i.ClipperOffset.def_arc_tolerance?r=Math.abs(e)*i.ClipperOffset.def_arc_tolerance:r=this.ArcTolerance;var s=3.14159265358979/Math.acos(1-r/Math.abs(e));this.m_sin=Math.sin(i.ClipperOffset.two_pi/s),this.m_cos=Math.cos(i.ClipperOffset.two_pi/s),this.m_StepsPerRad=s/i.ClipperOffset.two_pi,e<0&&(this.m_sin=-this.m_sin);for(var t=0;t<this.m_polyNodes.ChildCount();t++){var n=this.m_polyNodes.Childs()[t];this.m_srcPoly=n.m_polygon;var o=this.m_srcPoly.length;if(o==0||e<=0&&(o<3||n.m_endtype!=i.EndType.etClosedPolygon))continue;this.m_destPoly=new Array;if(o==1){if(n.m_jointype==i.JoinType.jtRound){var u=1,a=0;for(var f=1;f<=s;f++){this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[0].X+u*e),i.ClipperOffset.Round(this.m_srcPoly[0].Y+a*e)));var l=u;u=u*this.m_cos-this.m_sin*a,a=l*this.m_sin+a*this.m_cos}}else{var u=-1,a=-1;for(var f=0;f<4;++f)this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[0].X+u*e),i.ClipperOffset.Round(this.m_srcPoly[0].Y+a*e))),u<0?u=1:a<0?a=1:u=-1}this.m_destPolys.push(this.m_destPoly);continue}this.m_normals.length=0;for(var f=0;f<o-1;f++)this.m_normals.push(i.ClipperOffset.GetUnitNormal(this.m_srcPoly[f],this.m_srcPoly[f+1]));n.m_endtype==i.EndType.etClosedLine||n.m_endtype==i.EndType.etClosedPolygon?this.m_normals.push(i.ClipperOffset.GetUnitNormal(this.m_srcPoly[o-1],this.m_srcPoly[0])):this.m_normals.push(new i.DoublePoint(this.m_normals[o-2]));if(n.m_endtype==i.EndType.etClosedPolygon){var c=o-1;for(var f=0;f<o;f++)c=this.OffsetPoint(f,c,n.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(n.m_endtype==i.EndType.etClosedLine){var c=o-1;for(var f=0;f<o;f++)c=this.OffsetPoint(f,c,n.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;var h=this.m_normals[o-1];for(var f=o-1;f>0;f--)this.m_normals[f]=new i.DoublePoint(-this.m_normals[f-1].X,-this.m_normals[f-1].Y);this.m_normals[0]=new i.DoublePoint(-h.X,-h.Y),c=0;for(var f=o-1;f>=0;f--)c=this.OffsetPoint(f,c,n.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{var c=0;for(var f=1;f<o-1;++f)c=this.OffsetPoint(f,c,n.m_jointype);var p;if(n.m_endtype==i.EndType.etOpenButt){var f=o-1;p=new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[f].X+this.m_normals[f].X*e),i.ClipperOffset.Round(this.m_srcPoly[f].Y+this.m_normals[f].Y*e)),this.m_destPoly.push(p),p=new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[f].X-this.m_normals[f].X*e),i.ClipperOffset.Round(this.m_srcPoly[f].Y-this.m_normals[f].Y*e)),this.m_destPoly.push(p)}else{var f=o-1;c=o-2,this.m_sinA=0,this.m_normals[f]=new i.DoublePoint(-this.m_normals[f].X,-this.m_normals[f].Y),n.m_endtype==i.EndType.etOpenSquare?this.DoSquare(f,c):this.DoRound(f,c)}for(var f=o-1;f>0;f--)this.m_normals[f]=new i.DoublePoint(-this.m_normals[f-1].X,-this.m_normals[f-1].Y);this.m_normals[0]=new i.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y),c=o-1;for(var f=c-1;f>0;--f)c=this.OffsetPoint(f,c,n.m_jointype);n.m_endtype==i.EndType.etOpenButt?(p=new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*e),i.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*e)),this.m_destPoly.push(p),p=new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*e),i.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*e)),this.m_destPoly.push(p)):(c=1,this.m_sinA=0,n.m_endtype==i.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}},i.ClipperOffset.prototype.Execute=function(){var e=arguments,t=e[0]instanceof i.PolyTree;if(!t){var n=e[0],r=e[1];i.Clear(n),this.FixOrientations(),this.DoOffset(r);var s=new i.Clipper(0);s.AddPaths(this.m_destPolys,i.PolyType.ptSubject,!0);if(r>0)s.Execute(i.ClipType.ctUnion,n,i.PolyFillType.pftPositive,i.PolyFillType.pftPositive);else{var o=i.Clipper.GetBounds(this.m_destPolys),u=new i.Path;u.push(new i.IntPoint(o.left-10,o.bottom+10)),u.push(new i.IntPoint(o.right+10,o.bottom+10)),u.push(new i.IntPoint(o.right+10,o.top-10)),u.push(new i.IntPoint(o.left-10,o.top-10)),s.AddPath(u,i.PolyType.ptSubject,!0),s.ReverseSolution=!0,s.Execute(i.ClipType.ctUnion,n,i.PolyFillType.pftNegative,i.PolyFillType.pftNegative),n.length>0&&n.splice(0,1)}}else{var n=e[0],r=e[1];n.Clear(),this.FixOrientations(),this.DoOffset(r);var s=new i.Clipper(0);s.AddPaths(this.m_destPolys,i.PolyType.ptSubject,!0);if(r>0)s.Execute(i.ClipType.ctUnion,n,i.PolyFillType.pftPositive,i.PolyFillType.pftPositive);else{var o=i.Clipper.GetBounds(this.m_destPolys),u=new i.Path;u.push(new i.IntPoint(o.left-10,o.bottom+10)),u.push(new i.IntPoint(o.right+10,o.bottom+10)),u.push(new i.IntPoint(o.right+10,o.top-10)),u.push(new i.IntPoint(o.left-10,o.top-10)),s.AddPath(u,i.PolyType.ptSubject,!0),s.ReverseSolution=!0,s.Execute(i.ClipType.ctUnion,n,i.PolyFillType.pftNegative,i.PolyFillType.pftNegative);if(n.ChildCount()==1&&n.Childs()[0].ChildCount()>0){var a=n.Childs()[0];n.Childs()[0]=a.Childs()[0];for(var f=1;f<a.ChildCount();f++)n.AddChild(a.Childs()[f])}else n.Clear()}}},i.ClipperOffset.prototype.OffsetPoint=function(e,t,n){this.m_sinA=this.m_normals[t].X*this.m_normals[e].Y-this.m_normals[e].X*this.m_normals[t].Y;if(this.m_sinA<5e-5&&this.m_sinA>-0.00005)return t;this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1);if(this.m_sinA*this.m_delta<0)this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[t].X*this.m_delta),i.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[t].Y*this.m_delta))),this.m_destPoly.push(new i.IntPoint(this.m_srcPoly[e])),this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),i.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)));else switch(n){case i.JoinType.jtMiter:var r=1+(this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y);r>=this.m_miterLim?this.DoMiter(e,t,r):this.DoSquare(e,t);break;case i.JoinType.jtSquare:this.DoSquare(e,t);break;case i.JoinType.jtRound:this.DoRound(e,t)}return t=e,t},i.ClipperOffset.prototype.DoSquare=function(e,t){var n=Math.tan(Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y)/4);this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[t].X-this.m_normals[t].Y*n)),i.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[t].Y+this.m_normals[t].X*n)))),this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_delta*(this.m_normals[e].X+this.m_normals[e].Y*n)),i.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_delta*(this.m_normals[e].Y-this.m_normals[e].X*n))))},i.ClipperOffset.prototype.DoMiter=function(e,t,n){var r=this.m_delta/n;this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[e].X+(this.m_normals[t].X+this.m_normals[e].X)*r),i.ClipperOffset.Round(this.m_srcPoly[e].Y+(this.m_normals[t].Y+this.m_normals[e].Y)*r)))},i.ClipperOffset.prototype.DoRound=function(e,t){var n=Math.atan2(this.m_sinA,this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y),r=i.Cast_Int32(i.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(n))),s=this.m_normals[t].X,o=this.m_normals[t].Y,u;for(var a=0;a<r;++a)this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[e].X+s*this.m_delta),i.ClipperOffset.Round(this.m_srcPoly[e].Y+o*this.m_delta))),u=s,s=s*this.m_cos-this.m_sin*o,o=u*this.m_sin+o*this.m_cos;this.m_destPoly.push(new i.IntPoint(i.ClipperOffset.Round(this.m_srcPoly[e].X+this.m_normals[e].X*this.m_delta),i.ClipperOffset.Round(this.m_srcPoly[e].Y+this.m_normals[e].Y*this.m_delta)))},i.Error=function(e){try{throw new Error(e)}catch(t){alert(t.message)}},i.JS={},i.JS.AreaOfPolygon=function(e,t){return t||(t=1),i.Clipper.Area(e)/(t*t)},i.JS.AreaOfPolygons=function(e,t){t||(t=1);var n=0;for(var r=0;r<e.length;r++)n+=i.Clipper.Area(e[r]);return n/(t*t)},i.JS.BoundsOfPath=function(e,t){return i.JS.BoundsOfPaths([e],t)},i.JS.BoundsOfPaths=function(e,t){t||(t=1);var n=i.Clipper.GetBounds(e);return n.left/=t,n.bottom/=t,n.right/=t,n.top/=t,n},i.JS.Clean=function(e,t){if(e instanceof Array){var n=e[0]instanceof Array,e=i.JS.Clone(e);if(typeof t!="number"||t===null)return i.Error("Delta is not a number in Clean()."),e;if(e.length===0||e.length==1&&e[0].length===0||t<0)return e;n||(e=[e]);var r=e.length,s,o,u,a,f,l,c,h=[];for(var p=0;p<r;p++){o=e[p],s=o.length;if(s===0)continue;if(s<3){u=o,h.push(u);continue}u=o,a=t*t,f=o[0],l=1;for(c=1;c<s;c++){if((o[c].X-f.X)*(o[c].X-f.X)+(o[c].Y-f.Y)*(o[c].Y-f.Y)<=a)continue;u[l]=o[c],f=o[c],l++}f=o[l-1],(o[0].X-f.X)*(o[0].X-f.X)+(o[0].Y-f.Y)*(o[0].Y-f.Y)<=a&&l--,l<s&&u.splice(l,s-l),u.length&&h.push(u)}return!n&&h.length?h=h[0]:!n&&h.length===0?h=[]:n&&h.length===0&&(h=[[]]),h}return[]},i.JS.Clone=function(e){if(e instanceof Array){if(e.length===0)return[];if(e.length==1&&e[0].length===0)return[[]];var t=e[0]instanceof Array;t||(e=[e]);var n=e.length,r,i,s,o,u=new Array(n);for(i=0;i<n;i++){r=e[i].length,o=new Array(r);for(s=0;s<r;s++)o[s]={X:e[i][s].X,Y:e[i][s].Y};u[i]=o}return t||(u=u[0]),u}return[]},i.JS.Lighten=function(e,t){if(e instanceof Array){if(typeof t!="number"||t===null)return i.Error("Tolerance is not a number in Lighten()."),i.JS.Clone(e);if(e.length===0||e.length==1&&e[0].length===0||t<0)return i.JS.Clone(e);e[0]instanceof Array||(e=[e]);var n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=e.length,E=t*t,S=[];for(n=0;n<w;n++){s=e[n],a=s.length;if(a==0)continue;for(o=0;o<1e6;o++){u=[],a=s.length,s[a-1].X!=s[0].X||s[a-1].Y!=s[0].Y?(d=1,s.push({X:s[0].X,Y:s[0].Y}),a=s.length):d=0,p=[];for(r=0;r<a-2;r++){f=s[r],c=s[r+1],l=s[r+2],y=f.X,b=f.Y,v=l.X-y,m=l.Y-b;if(v!==0||m!==0)g=((c.X-y)*v+(c.Y-b)*m)/(v*v+m*m),g>1?(y=l.X,b=l.Y):g>0&&(y+=v*g,b+=m*g);v=c.X-y,m=c.Y-b,h=v*v+m*m,h<=E&&(p[r+1]=1,r++)}u.push({X:s[0].X,Y:s[0].Y});for(r=1;r<a-1;r++)p[r]||u.push({X:s[r].X,Y:s[r].Y});u.push({X:s[a-1].X,Y:s[a-1].Y}),d&&s.pop();if(!p.length)break;s=u}a=u.length,u[a-1].X==u[0].X&&u[a-1].Y==u[0].Y&&u.pop(),u.length>2&&S.push(u)}return!e[0]instanceof Array&&(S=S[0]),typeof S=="undefined"&&(S=[[]]),S}return[]},i.JS.PerimeterOfPath=function(e,t,n){if(typeof e=="undefined")return 0;var r=Math.sqrt,i=0,s,o,u=0,a=0,f=0,l=0,c=e.length;if(c<2)return 0;t&&(e[c]=e[0],c++);while(--c)s=e[c],u=s.X,a=s.Y,o=e[c-1],f=o.X,l=o.Y,i+=r((u-f)*(u-f)+(a-l)*(a-l));return t&&e.pop(),i/n},i.JS.PerimeterOfPaths=function(e,t,n){n||(n=1);var r=0;for(var s=0;s<e.length;s++)r+=i.JS.PerimeterOfPath(e[s],t,n);return r},i.JS.ScaleDownPath=function(e,t){var n,r;t||(t=1),n=e.length;while(n--)r=e[n],r.X=r.X/t,r.Y=r.Y/t},i.JS.ScaleDownPaths=function(e,t){var n,r,i,s=Math.round;t||(t=1),n=e.length;while(n--){r=e[n].length;while(r--)i=e[n][r],i.X=i.X/t,i.Y=i.Y/t}},i.JS.ScaleUpPath=function(e,t){var n,r,i=Math.round;t||(t=1),n=e.length;while(n--)r=e[n],r.X=i(r.X*t),r.Y=i(r.Y*t)},i.JS.ScaleUpPaths=function(e,t){var n,r,i,s=Math.round;t||(t=1),n=e.length;while(n--){r=e[n].length;while(r--)i=e[n][r],i.X=s(i.X*t),i.Y=s(i.Y*t)}},i.ExPolygons=function(){return[]},i.ExPolygon=function(){this.outer=null,this.holes=null},i.JS.AddOuterPolyNodeToExPolygons=function(e,t){var n=new i.ExPolygon;n.outer=e.Contour();var r=e.Childs(),s=r.length;n.holes=new Array(s);var o,u,a,f,l,c;for(a=0;a<s;a++){o=r[a],n.holes[a]=o.Contour();for(f=0,l=o.Childs(),c=l.length;f<c;f++)u=l[f],i.JS.AddOuterPolyNodeToExPolygons(u,t)}t.push(n)},i.JS.ExPolygonsToPaths=function(e){var t,n,r,s,o=new i.Paths;for(t=0,r=e.length;t<r;t++){o.push(e[t].outer);for(n=0,s=e[t].holes.length;n<s;n++)o.push(e[t].holes[n])}return o},i.JS.PolyTreeToExPolygons=function(e){var t=new i.ExPolygons,n,r,s,o;for(r=0,s=e.Childs(),o=s.length;r<o;r++)n=s[r],i.JS.AddOuterPolyNodeToExPolygons(n,t);return t}}(),define("clipper",function(e){return function(){var t,n;return t||e.ClipperLib}}(this)),define("cnc/util",[],function(){function e(e,t,n){this.x=e,this.y=t,this.z=n===undefined?0:n}function t(e,t,n){var r=e.attr("class");r==null&&(r="");var i=r.split(" "),s=i.indexOf(t);n?s==-1&&e.attr("class",r+" "+t):s!=-1&&(i.splice(s,1),e.attr("class",i.join(" ")))}function n(e){function i(){if(r.length>3){var i={vertices:(new Float32Array(r)).buffer,speedTag:t};n.push(i),r=r.slice(-3),e(i)}}function s(e,n){if(t!=n||r.length>=1e4)i(),t=n;r.push(e.x,e.y,e.z)}function o(){return n.length==0&&r.length==0}var t=null,n=[],r=[];return{accumulatePoint:s,closeFragment:i,isEmpty:o}}function r(e){var t=[],n=[{type:"y",time:31536e3},{type:"mo",time:2592e3},{type:"d",time:86400},{type:"h",time:3600},{type:"m",time:60},{type:"s",time:1}];return n.forEach(function(n){var r=Math.floor(e/n.time);r&&(t.push(r+n.type),e-=r*n.time)}),t.slice(0,2).join("")}function i(){this.min=+Infinity,this.max=-Infinity}function s(){this.x=new i,this.y=new i,this.z=new i}function c(e,t){return(u[t&255]|o[e&255])+(u[t>>8&255]|o[e>>8&255])*65536+(u[t>>16&255]|o[e>>16&255])*4294967296}function h(e,t){return c(e.X,e.Y)-c(t.X,t.Y)}e.prototype={svg:function(){return" "+this.x+", "+this.y},sub:function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},add:function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)},scale:function(t){return new e(this.x*t,this.y*t,this.z*t)},round:function(){return new e(Math.round(this.x),Math.round(this.y),Math.round(this.z))},sqDistance:function(e){var t=e==null?this:this.sub(e);return t.x*t.x+t.y*t.y+t.z*t.z},distance:function(e){return Math.sqrt(this.sqDistance(e))},lerp:function(e,t){return this.add(e.sub(this).scale(t))},normalized:function(){return this.scale(1/this.distance())},atan2:function(){return Math.atan2(this.y,this.x)},angle:function(e,t){var n=this.sub(e),r=t.sub(this),i=n.x*r.x+n.y*r.y,s=n.x*r.y-n.y*r.x,o=Math.atan2(s,i),u=2*Math.PI;return o<-u?o+u:o>u?o-u:o}},[["X","x"],["Y","y"],["Z","z"],["0","x"],["1","y"],["2","z"]].forEach(function(t){Object.defineProperty(e.prototype,t[0],{get:function(){return this[t[1]]},set:function(e){this[t[1]]=e}})}),i.prototype={push:function(e){this.min=Math.min(this.min,e),this.max=Math.max(this.max,e)},get range(){return this.max-this.min}},s.prototype={pushPolylines:function(e){var t=this;e.forEach(function(e){e.forEach(function(e){t.pushPoint(e)})})},pushPoint:function(e){this.pushCoordinates(e.x,e.y,e.z)},pushCoordinates:function(e,t,n){this.x.push(e),this.y.push(t),this.z.push(n)},minPoint:function(){return new e(this.x.min,this.y.min,this.z.min)},maxPoint:function(){return new e(this.x.max,this.y.max,this.z.max)}};var o=[0,1],u=[0,2];for(var a=4;a<65535;a<<=2)for(var f=0,l=o.length;f<l;f++)o.push(o[f]|a),u.push((o[f]|a)<<1);return{Point:e,polarPoint:function(t,n){return new e(t*Math.cos(n),t*Math.sin(n))},toggleClass:t,length:function(){var e=0;for(var t=0;t<arguments.length;t++)e+=arguments[t]*arguments[t];return Math.sqrt(e)},AXES:["x","y","z"],formatCoord:function(e){if(e==null)return"";if(e==0)return"0";if(e%1===0)return e.toString();var t=e.toFixed(4);for(var n=t.length-1;n>=0;n--){if(t[n]!="0"&&t[n]!=".")return t.substring(0,n+1);if(t[n]==".")return t.substring(0,n)}return t},createSimulationAccumulator:n,humanizeDuration:r,BoundingBox:s,morton:c,mortonClipper:h}}),define("cnc/maths/bezier",["cnc/util"],function(e){function t(e,t){function n(e,n){return e+(n-e)*t}var r=n(e[0],e[2]),i=n(e[1],e[3]),s=n(e[2],e[4]),o=n(e[3],e[5]),u=n(e[4],e[6]),a=n(e[5],e[7]),f=n(r,s),l=n(i,o),c=n(s,u),h=n(o,a),p=n(f,c),d=n(l,h);return[[e[0],e[1],r,i,f,l,p,d],[p,d,c,h,u,a,e[6],e[7]]]}function n(e,n,r){function i(e,s,o){function u(e){function t(e){return e*e}var r=t(3*e[2]-2*e[0]-e[6]),i=t(3*e[3]-2*e[1]-e[7]),s=t(3*e[4]-2*e[6]-e[0]),o=t(3*e[5]-2*e[7]-e[1]),u=Math.max(r,s)+Math.max(i,o);if(isNaN(u))throw new Error("flatness is NaN");return u<=n}if(u(e)||Math.abs(s-o)<1e-200){r(e[0],e[1]);return}var a=t(e,.5),f=(o+s)/2;i(a[0],s,f),i(a[1],f,o)}i(e,0,1),r(e[6],e[7])}function r(e,t){var n=[];for(var r=0;r+1<e.length;r+=2){var i=e[r],s=e[r+1];n.push(t.a*i+t.c*s+t.e),n.push(t.b*i+t.d*s+t.f)}return n}function i(t,i,s){function o(t){return function(n,r){if(t.length){var i=t[t.length-1];if(i.x==n&&i.y==r)return}t.push(new e.Point(n,r))}}function l(){a.length&&u.push(a),a=[],f=o(a)}var u=[],a=[],f=o(a),c=[0,0];for(var h=0;h<t.length;h++){var p=t[h];if(p[0]=="M")l(),c=r(p.slice(1,3),i),f(c[0],c[1]);else if(p[0]=="C"){var d=c.concat(r(p.slice(1,7),i));n(d,s,f),c=d.slice(6,8)}else p[0]=="L"&&(c=r(p.slice(1,3),i),f(c[0],c[1]))}return l(),u}return{cubicToPoints:n,pathToPolygons:i}}),define("cnc/gcode/geometry",[],function(){function e(e){var t=null;return function(n,r){if(t){var i=n.x-t.x,s=n.y-t.y,o=n.z-t.z;(i!=0||s!=0||o!=0)&&e(i,s,o,r)}t=n}}function t(t,n,r){var i=t.from.scale(1/n).round(),s=t.to.scale(1/n).round(),o=s.sub(i);t.dv=o;var u=Math.max(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z)),a=e(r);for(var f=0;f<=u;f++){var l=f/u;a(i.lerp(s,l).round(),l)}}function n(t,n,r,i){var s=Math.ceil(t.radius*Math.abs(t.angularDistance)/n),o=i(0),u=i(1),a=Math.ceil(Math.abs(u[t.plane.lastCoord]-o[t.plane.lastCoord])/n),f=Math.max(s,a),l=e(r);for(var c=0;c<=f;c++){var h=c/f;l(i(h).scale(1/n).round(),h)}}return{rasterizeLine:t,rasterizeArc:n}}),define("cnc/gcode/simulation",["cnc/util","cnc/gcode/geometry"],function(e,t){function n(e,t,n){return t.from[e]+n*(t.to[e]-t.from[e])}function i(e,t,n){var r=Math.pow(t,2)/e,i=.8;r>n*i&&(t=Math.sqrt(n*i*e),r=Math.pow(t,2)/e);var s=Math.sqrt(Math.pow(n,2)-Math.pow(r,2));return{speed:t,acceleration:s}}function s(e,t){var n=1.95;return e.add(t).sqDistance()>=n*n}function o(t,n){var r=t.plane,i=Math.cos(t.fromAngle+n),s=Math.sin(t.fromAngle+n),o=(t.to[r.lastCoord]-t.from[r.lastCoord])/Math.abs(t.angularDistance)/t.radius,u=e.length(i,s,o),a=t.angularDistance>=0?1:-1;return new e.Point(-a*s/u,a*i/u,o/u)}function u(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=r.maxAcceleration,s=0;n>0&&(s=e[n-1].squaredSpeed);var o=s/(2*i),u=2*i*(o+r.length);r.squaredSpeed=Math.min(r.squaredSpeed,u),r[t]={length:s/(2*i)}}}function a(e){u(e,"acceleration"),e.reverse(),u(e,"deceleration"),e.reverse();for(var t=0;t<e.length;t++){var n=t<e.length-1?e[t+1].squaredSpeed:0,r=t>=1?e[t-1].squaredSpeed:0,i=e[t];i.fragments=[];var s=i.maxAcceleration,o=i.acceleration.length,a=i.deceleration.length,f=(a+i.length-o)/2,l=2*s*(o+f),c=(i.squaredSpeed-2*s*o)/(2*s),h=(2*s*(a+i.length)-i.squaredSpeed)/(2*s),p=i.squaredSpeed;f>=0&&f<=i.length&&l<=i.squaredSpeed&&(p=l,c=f,h=f,i.squaredSpeed=l);var d=c>0&&c<=i.length,v=h>=0&&h<i.length;d&&i.fragments.push({type:"acceleration",segment:i,fromSqSpeed:r,toSqSpeed:p,startX:0,stopX:c});var m=d?c:0,g=v?h:i.length;m!=g&&i.fragments.push({type:"constant",segment:i,squaredSpeed:p,startX:m,stopX:g}),v&&i.fragments.push({type:"deceleration",segment:i,fromSqSpeed:p,toSqSpeed:n,startX:h,stopX:i.length}),i.duration=0,$.each(i.fragments,function(e,t){t.length=t.stopX-t.startX,t.duration=t.type=="constant"?t.length/Math.sqrt(t.squaredSpeed):Math.abs(Math.sqrt(t.fromSqSpeed)-Math.sqrt(t.toSqSpeed))/s,i.duration+=t.duration})}}function l(e,t){var n=e.maxAcceleration,r=e.length*t,i=0,s=0,o=0,u=e.fragments[o];while(u.stopX<r)i+=u.duration,s+=u.length,o++,u=e.fragments[o];var a=f[u.type](u,Math.min(1,(r-s)/u.length),n);return{speed:a.speed,time:i+a.time}}function c(t,n){var i=[],o=null,u=new e.Point(0,0,0);for(var a=0;a<t.length;a++){var f=t[a],l=r[f.type];s(u,l.entryDirection(f))?o.push(f):(o=[f],i.push(o)),u=l.exitDirection(f),f.length=l.length(f);var c=l.speed(f,n);f.squaredSpeed=Math.pow(c.speed,2),f.maxAcceleration=c.acceleration}return i}function h(e,t){function u(e){var t=r[e.type],n=t.simulationSteps(e),i=s;for(var o=1;o<=n;o++){var u=o/n,a=l(e,u);s=i+a.time,f(t.pointAtRatio(e,u),e)}}function f(e,n){o=e,t(e[0],e[1],e[2],s,n)}var n=200,i=c(e,n),s=0,o;f([0,0,0],i[0][0]),$.each(i,function(e,t){a(t),$.each(t,function(e,t){u(t)});for(var n=0;n<10;n++)s+=.001,f(o,t[t.length-1])})}function p(e,t,n,i,s){var o=[0,1,Math.SQRT2,Math.sqrt(3)],u=c(e,t);$.each(u,function(e,t){a(t),$.each(t,function(e,t){function u(e,r,u,a){var f=o[!!e+!!r+!!u],c=l(t,a).speed,h=t.feedRate/60/20;c=Math.max(c,h);var p=Math.ceil(i*f*n/c);s(e,r,u,p,t)}r[t.type].rasterize(t,n,u)})})}function d(t){function i(e,t,i,s){n=Math.max(s,n),r.pushCoordinates(e,t,i)}var n=0,r=new e.BoundingBox;return t.length&&h(t,i),{totalTime:n,min:r.minPoint(),max:r.maxPoint()}}var r={line:{length:function(t){function n(e){return t.to[e]-t.from[e]}return e.length(n("x"),n("y"),n("z"))},speed:function(e,t){return{speed:e.feedRate/60,acceleration:t}},entryDirection:function(e){var t=e.to.sub(e.from);return t.normalized()},exitDirection:function(e){return r.line.entryDirection(e)},pointAtRatio:function(e,t){return e.from.lerp(e.to,t)},simulationSteps:function(){return 40},rasterize:t.rasterizeLine},arc:{length:function(t){var n=t.plane.lastCoord,r=t.angularDistance*t.radius;return e.length(r,t.to[n]-t.from[n])},speed:function(e,t){return i(e.radius,e.feedRate/60,t)},entryDirection:function(e){return o(e,0)},exitDirection:function(e){return o(e,e.angularDistance)},pointAtRatio:function(t,n){var r=t.centerInPlane.add(e.polarPoint(t.radius,t.fromAngle+t.angularDistance*n)),i=new e.Point;return i[t.plane.firstCoord]=r.x,i[t.plane.secondCoord]=r.y,i[t.plane.lastCoord]=t.from[t.plane.lastCoord]*(1-n)+t.to[t.plane.lastCoord]*n,i},simulationSteps:function(e){return Math.round(Math.abs(e.angularDistance)/(2*Math.PI)*50)},rasterize:function(e,n,i){t.rasterizeArc(e,n,i,function(t){return r.arc.pointAtRatio(e,t)})}}},f=function(){function e(e,t,n){var r=2*(e.segment.acceleration.length+e.length*t);return{speed:Math.sqrt(n*r),time:Math.sqrt(r/n)-Math.sqrt(e.fromSqSpeed)/n}}function t(e,t,n){var r=2*(e.segment.deceleration.length+e.length*(1-t));return{speed:Math.sqrt(n*r),time:Math.sqrt(e.toSqSpeed)/n+e.duration-Math.sqrt(r/n)}}function n(e,t){return{speed:Math.sqrt(e.squaredSpeed),time:e.duration*t}}return{acceleration:e,deceleration:t,constant:n}}();return{planSpeed:a,simulate2:h,collectToolpathInfo:d,planProgram:p,COMPONENT_TYPES:r}}),define("cnc/cam/toolpath",["cnc/util","cnc/gcode/simulation"],function(e,t){function n(){this.path=[]}function r(e){e==null&&(e=[]),this.path=e,this.className="general-toolpath"}function i(t){var i={"general-toolpath":r,"constant-z-toolpath":n},s=new i[t.className],o=t.path;for(var u=0;u<o.length;u++)s.pushPointXYZ(o[u].x,o[u].y,o[u].z);for(var a in t)a!="path"&&t.hasOwnProperty(a)&&(s[a]=a=="initialPoint"?new e.Point(t[a].x,t[a].y,t[a].z):t[a]);return s}function s(e,t,n){var i=new r;return i.speedTag="rapid",e&&(i.initialPoint=e,i.pushPointXYZ(e.x,e.y,n),t&&i.pushPointXYZ(t.x,t.y,n)),i}function o(e,t,n){this.completePath=t,this.travelBits=n,this.isEmpty=t.length==0,this.path=t,this.stopPoint=e&&e.length?e[e.length-1].getStopPoint():null,this.startPoint=e&&e.length?e[0].getStartPoint():null}function u(e,t,n,r){function i(e,t,n){var r=t[e].getStopPoint(),i=e+1<t.length?t[e+1].getStartPoint():null;return s(r,i,n)}var u=[],a=[];if(n!=null)for(var f=0;f<n.length;f++){n[f].feedrate===undefined&&Object.defineProperty(n[f],"feedrate",{enumerable:!0,get:e}),n[f].operation=r,u.push(n[f]);var l=i(f,n,t);l.operation=r,a.push(l),u.push(l)}return new o(n,u,a)}function a(e,t){this.completePath=e,this.travelBits=t,this.path=e}function f(e,t,n,r){var i=[],o=[];if(r.length){o.push(e),i.push(e);for(var u=0;u<r.length;u++){var f=r[u];if(f.isEmpty)continue;o.pushObjects(f.path),i.pushObjects(f.getTravelBits());var l=f.getStopPoint();if(l&&u+1<r.length&&!r[u+1].isEmpty){var c=s(l,r[u+1].getStartPoint(),n);i.push(c),o.push(c)}}o.push(t),i.push(t)}return new a(o,i)}return n.prototype={getTypeName:function(){return"constant-z-toolpath"},pushPoint:function(e){this.path.push(e)},pushPointXYZ:function(t,n){this.path.push(new e.Point(t,n))},getStartPoint:function(t){var n=this.path[0];return new e.Point(n[0],n[1],t)},getStopPoint:function(t){var n=this.path[this.path.length-1];return new e.Point(n[0],n[1],t)},forEachPoint:function(e,t){$.each(this.path,function(n,r){e(r[0],r[1],t,n)})},asPathDef:function(){var e=this.path,t="";if(e.length){var n=e[0];t+=" M "+n[0]+","+n[1];for(var r=1;r<e.length;r++)t+=" L "+e[r][0]+","+e[r][1]}return t},translate:function(e,t){$.each(this.path,function(n,r){r[0]+=e,r[1]+=t})},asGeneralToolpath:function(e){var t=new r;return this.forEachPoint(t.pushPointXYZ.bind(t),e),t}},r.prototype={getTypeName:function(){return"general-toolpath"},pushPoint:function(e){this.path.push(e)},pushPointXYZ:function(t,n,r){this.path.push(new e.Point(t,n,r))},pushPointInFront:function(t,n,r){this.path.unshift(new e.Point(t,n,r))},getStartPoint:function(){var t=this.path[0];return new e.Point(t[0],t[1],t[2])},getStopPoint:function(){var t=this.path[this.path.length-1];return new e.Point(t[0],t[1],t[2])},forEachPoint:function(e,t){$.each(this.path,function(t,n){e(n[0],n[1],n[2],t)});var n=this.getStopPoint(t);e(n.x,n.y,n.z)},asPathDef:function(){var e=this.path,t="";if(e.length){var n=e[0];t+=" M "+n[0]+","+n[1];for(var r=1;r<e.length;r++)t+=" L "+e[r][0]+","+e[r][1]}return t},translated:function(e,t,n){var i=new r;return $.each(this.path,function(r,s){i.pushPointXYZ(s[0]+e,s[1]+t,s[2]+n)}),i},asGeneralToolpath:function(e){return this},toJSON:function(){return{className:"general-toolpath",path:this.path}},asCompactToolpath:function(){var e=new Float32Array(this.path.length*3);for(var t=0;t<this.path.length;t++)e[t*3]=this.path[t].x,e[t*3+1]=this.path[t].y,e[t*3+2]=this.path[t].z;return e},asSimulablePolyline:function(e,t,n){if(!this.path||this.path.length==0)return 0;var r=[],i=this.initialPoint!=null?this.initialPoint:this.getStartPoint();return e=e?e:this.feedRate,this.path.forEach(function(s){s.sqDistance(i)&&r.push({type:"line",from:i,to:s,speedTag:n,feedRate:n=="rapid"?t:e}),i=s}),r},length:function(){var e=0,t=null;return this.path.forEach(function(n){t&&(e+=t.distance(n)),t=n}),e}},o.prototype={getStartPoint:function(){return this.startPoint},getStopPoint:function(){return this.stopPoint},getTravelBits:function(){return this.travelBits},getDuration:function(){var e=0;return this.completePath.forEach(function(n){var r=t.collectToolpathInfo(n.asSimulablePolyline(n.feedrate,3e3,n.speedTag));e+=r.totalTime}),e}},a.prototype={getTravelBits:function(){return this.travelBits},computeCompactToolPath:function(){},getDuration:function(){var e=0;return this.completePath.forEach(function(n){e+=t.collectToolpathInfo(n.asSimulablePolyline(n.feedrate,3e3,n.speedTag)).totalTime}),e}},{decodeToolPath:i,GeneralPolylineToolpath:r,ConstantZPolygonToolpath:n,travelFromTo:s,assembleToolPathFromOperation:u,assembleWholeProgram:f,OperationToolpathAssembly:o}}),function(){function e(e){return e.X}function t(e){return e.Y}function n(n,r){var i=e(n)-e(r),s=t(n)-t(r);return i*i+s*s}function r(n,r,i){var s=e(r),o=t(r),u=e(i)-s,a=t(i)-o;if(u!==0||a!==0){var f=((e(n)-s)*u+(t(n)-o)*a)/(u*u+a*a);f>1?(s=e(i),o=t(i)):f>0&&(s+=u*f,o+=a*f)}return u=e(n)-s,a=t(n)-o,u*u+a*a}function i(e,t){var r=e[0],i=[r],s;for(var o=1,u=e.length;o<u;o++)s=e[o],n(s,r)>t&&(i.push(s),r=s);return r!==s&&i.push(s),i}function s(e,t){var n=e.length,i=typeof Uint8Array!="undefined"?Uint8Array:Array,s=new i(n),o=0,u=n-1,a=[],f=[],l,c,h,p;s[o]=s[u]=1;while(u){c=0;for(l=o+1;l<u;l++)h=r(e[l],e[o],e[u]),h>c&&(p=l,c=h);c>t&&(s[p]=1,a.push(o,p,p,u)),u=a.pop(),o=a.pop()}for(l=0;l<n;l++)s[l]&&f.push(e[l]);return f}function o(e,t,n){var r=t!==undefined?t*t:1;return e=n?e:i(e,r),e=s(e,r),e}typeof define=="function"&&define.amd?define("libs/simplify",[],function(){return o}):typeof module!="undefined"?module.exports=o:window.simplify=o}(),R=function(){function d(e){if(Object(e)!==e||typeof e=="function")return e;var n=new e.constructor;for(var r in e)e[t](r)&&(n[r]=d(e[r]));return n}function v(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return e.push(e.splice(n,1)[0])}function y(e,t){var n=[];for(var r=0,i=e.length;i-2*!t>r;r+=2){var s=[{x:+e[r-2],y:+e[r-1]},{x:+e[r],y:+e[r+1]},{x:+e[r+2],y:+e[r+3]},{x:+e[r+4],y:+e[r+5]}];t?r?i-4==r?s[3]={x:+e[0],y:+e[1]}:i-2==r&&(s[2]={x:+e[0],y:+e[1]},s[3]={x:+e[2],y:+e[3]}):s[0]={x:+e[i-2],y:+e[i-1]}:i-4==r?s[3]=s[2]:r||(s[0]={x:+e[r],y:+e[r+1]}),n.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return n}function w(e,n,r){function i(){var s=Array.prototype.slice.call(arguments,0),o=s.join("â"),u=i.cache=i.cache||{},a=i.count=i.count||[];return u[t](o)?(v(a,o),r?r(u[o]):u[o]):(a.length>=1e3&&delete u[a.shift()],a.push(o),u[o]=e[l](n,s),r?r(u[o]):u[o])}return i}var e={},t="hasOwnProperty",n=String,r="array",i={NaN:1,Infinity:1,"-Infinity":1},s=n.prototype.toLowerCase,o=n.prototype.toUpperCase,u=Object.prototype.toString,a="concat",f="split",l="apply",c=/,?([achlmqrstvxz]),?/gi,h=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,p=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig;e.is=function(e,n){return n=s.call(n),n=="finite"?!i[t](+e):n=="array"?e instanceof Array:n=="null"&&e===null||n==typeof e&&e!==null||n=="object"&&e===Object(e)||n=="array"&&Array.isArray&&Array.isArray(e)||u.call(e).slice(8,-1).toLowerCase()==n},e._path2string=function(){return this.join(",").replace(c,"$1")};var m=function(t){var n=d(t);return n.toString=e._path2string,n},g=function(e){var n=g.ps=g.ps||{};return n[e]?n[e].sleep=100:n[e]={sleep:100},setTimeout(function(){for(var r in n)n[t](r)&&r!=e&&(n[r].sleep--,!n[r].sleep&&delete n[r])}),n[e]};e.parsePathString=function(t){if(!t)return null;var i=g(t);if(i.arr)return m(i.arr);var s={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},o=[];return e.is(t,r)&&e.is(t[0],r)&&(o=m(t)),o.length||n(t).replace(h,function(e,t,n){var r=[],i=t.toLowerCase();n.replace(p,function(e,t){t&&r.push(+t)}),i=="m"&&r.length>2&&(o.push([t][a](r.splice(0,2))),i="l",t=t=="m"?"l":"L");if(i=="r")o.push([t][a](r));else while(r.length>=s[i]){o.push([t][a](r.splice(0,s[i])));if(!s[i])break}}),o.toString=e._path2string,i.arr=m(o),o};var b=e.pathToAbsolute=e._pathToAbsolute=function(t){var n=g(t);if(n.abs)return m(n.abs);if(!e.is(t,r)||!e.is(t&&t[0],r))t=e.parsePathString(t);if(!t||!t.length)return[["M",0,0]];var i=[],s=0,u=0,f=0,l=0,c=0;t[0][0]=="M"&&(s=+t[0][1],u=+t[0][2],f=s,l=u,c++,i[0]=["M",s,u]);var h=t.length==3&&t[0][0]=="M"&&t[1][0].toUpperCase()=="R"&&t[2][0].toUpperCase()=="Z";for(var p,d,v=c,b=t.length;v<b;v++){i.push(p=[]),d=t[v];if(d[0]!=o.call(d[0])){p[0]=o.call(d[0]);switch(p[0]){case"A":p[1]=d[1],p[2]=d[2],p[3]=d[3],p[4]=d[4],p[5]=d[5],p[6]=+(d[6]+s),p[7]=+(d[7]+u);break;case"V":p[1]=+d[1]+u;break;case"H":p[1]=+d[1]+s;break;case"R":var w=[s,u][a](d.slice(1));for(var E=2,S=w.length;E<S;E++)w[E]=+w[E]+s,w[++E]=+w[E]+u;i.pop(),i=i[a](y(w,h));break;case"M":f=+d[1]+s,l=+d[2]+u;break;default:for(E=1,S=d.length;E<S;E++)p[E]=+d[E]+(E%2?s:u)}}else if(d[0]=="R")w=[s,u][a](d.slice(1)),i.pop(),i=i[a](y(w,h)),p=["R"][a](d.slice(-2));else for(var x=0,T=d.length;x<T;x++)p[x]=d[x];switch(p[0]){case"Z":s=f,u=l;break;case"H":s=p[1];break;case"V":u=p[1];break;case"M":f=p[p.length-2],l=p[p.length-1];break;default:s=p[p.length-2],u=p[p.length-1]}}return i.toString=e._path2string,n.abs=m(i),i},E=function(e,t,n,r){return[(3*e+n)/4,(3*t+r)/4,(e+3*n)/4,(t+3*r)/4,n,r]},S=function(e,t,n,r,i,s){var o=1/3,u=2/3;return[o*e+u*n,o*t+u*r,o*i+u*n,o*s+u*r,i,s]},x=function(e,t,n,r,i,s,o,u,l,c){var h=Math.PI*120/180,p=Math.PI/180*(+i||0),d=[],v,m=w(function(e,t,n){var r=e*Math.cos(n)-t*Math.sin(n),i=e*Math.sin(n)+t*Math.cos(n);return{x:r,y:i}});if(!c){v=m(e,t,-p),e=v.x,t=v.y,v=m(u,l,-p),u=v.x,l=v.y;var g=(e-u)/2,y=(t-l)/2,b=g*g/(n*n)+y*y/(r*r);b>1&&(b=Math.sqrt(b),n=b*n,r=b*r);var E=n*n,S=r*r,T=(s==o?-1:1)*Math.sqrt(Math.abs((E*S-E*y*y-S*g*g)/(E*y*y+S*g*g))),N=T*n*y/r+(e+u)/2,C=T*-r*g/n+(t+l)/2,k=(t-C)/r,L=(l-C)/r,A=k>=0?1:-1,O=L>=0?1:-1,M=Math.abs(k)>1?A*Math.PI/2:Math.asin(k),_=Math.abs(L)>1?O*Math.PI/2:Math.asin(L);M=e<N?Math.PI-M:M,_=u<N?Math.PI-_:_,M<0&&(M=Math.PI*2+M),_<0&&(_=Math.PI*2+_),o&&M>_&&(M-=Math.PI*2),!o&&_>M&&(_-=Math.PI*2)}else M=c[0],_=c[1],N=c[2],C=c[3];var D=_-M;if(Math.abs(D)>h){var P=_,H=u,B=l;_=M+h*(o&&_>M?1:-1),u=N+n*Math.cos(_),l=C+r*Math.sin(_),d=x(u,l,n,r,i,0,o,H,B,[_,P,N,C])}D=_-M;var j=Math.cos(M),F=Math.sin(M),I=Math.cos(_),q=Math.sin(_),R=Math.tan(D/4),U=4/3*n*R,z=4/3*r*R,W=[e,t],X=[e+U*F,t-z*j],V=[u+U*q,l-z*I],$=[u,l];X[0]=2*W[0]-X[0],X[1]=2*W[1]-X[1];if(c)return[X,V,$][a](d);d=[X,V,$][a](d).join()[f](",");var J=[];for(var K=0,Q=d.length;K<Q;K++)J[K]=K%2?m(d[K-1],d[K],p).y:m(d[K],d[K+1],p).x;return J};return e.path2curve=e._path2curve=w(function(e,t){var n=!t&&g(e);if(!t&&n.curve)return m(n.curve);var r=b(e),i=t&&b(t),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},u=function(e,t,n){var r,i;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null);switch(e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][a](x[l](0,[t.x,t.y][a](e.slice(1))));break;case"S":n=="C"||n=="S"?(r=t.x*2-t.bx,i=t.y*2-t.by):(r=t.x,i=t.y),e=["C",r,i][a](e.slice(1));break;case"T":n=="Q"||n=="T"?(t.qx=t.x*2-t.qx,t.qy=t.y*2-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"][a](S(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][a](S(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"H":e=["C"][a](E(t.x,t.y,e[1],t.y));break;case"V":e=["C"][a](E(t.x,t.y,t.x,e[1]));break;case"Z":if(t.x!=t.X||t.y!=t.Y)e=["L"][a]([t.X,t.Y])}return e},f=function(e,t){if(e[t].length>7){e[t].shift();var n=e[t];while(n.length)h[t]="A",i&&(p[t]="A"),e.splice(t++,0,["C"][a](n.splice(0,6)));e.splice(t,1),w=Math.max(r.length,i&&i.length||0)}},c=function(e,t,n,s,o){e&&t&&e[o][0]=="M"&&t[o][0]!="M"&&(t.splice(o,0,["M",s.x,s.y]),n.bx=0,n.by=0,n.x=e[o][1],n.y=e[o][2],w=Math.max(r.length,i&&i.length||0))},h=[],p=[],d="",v="";for(var y=0,w=Math.max(r.length,i&&i.length||0);y<w;y++){r[y]&&(d=r[y][0]),d!="C"&&(h[y]=d,y&&(v=h[y-1])),r[y]=u(r[y],s,v),h[y]!="A"&&d=="C"&&(h[y]="C"),f(r,y),i&&(i[y]&&(d=i[y][0]),d!="C"&&(p[y]=d,y&&(v=p[y-1])),i[y]=u(i[y],o,v),p[y]!="A"&&d=="C"&&(p[y]="C"),f(i,y)),c(r,i,s,o,y),c(i,r,o,s,y);var T=r[y],N=i&&i[y],C=T.length,k=i&&N.length;s.x=T[C-2],s.y=T[C-1],s.bx=parseFloat(T[C-4])||s.x,s.by=parseFloat(T[C-3])||s.y,o.bx=i&&(parseFloat(N[k-4])||o.x),o.by=i&&(parseFloat(N[k-3])||o.y),o.x=i&&N[k-2],o.y=i&&N[k-1]}return i||(n.curve=m(r)),i?[r,i]:r},null,m),e}(),define("libs/extractedRaphael",function(){}),define("cnc/cam/cam",["cnc/maths/bezier","clipper","cnc/cam/toolpath","libs/simplify","cnc/util","libs/extractedRaphael"],function(e,t,n,r,i,s){function u(e,r,i,s){var o=[];return $.each(e,function(e,u){if(i){var a=t.Clipper.Area(u)/(r*r);(a>=0&&!s||a<0&&s)&&u.reverse()}var f=new n.ConstantZPolygonToolpath;$.each(u,function(e,t){f.pushPointXYZ(t.X/r,t.Y/r)}),o.push(f)}),o}function f(){this.clipperScale=o}function l(t){return e.pathToPolygons(R.path2curve(t),{a:1,b:0,c:0,d:1,e:0,f:0},1e-4)}function c(e){return e.map(function(e){return e.map(function(e){return new i.Point(Math.round(o*e.x),Math.round(o*e.y))})})}function h(e){return c(l(e))}function p(e){var t=[];for(var n=0;n<e.length;n++)if(e[n].length){for(var r=0;r<e[n].length;r++)t.push((r==0?"M":"L")+(new i.Point(e[n][r].X,e[n][r].Y)).scale(1/o).svg());t.push("Z")}return t.join(" ")}function d(e){var t=[],n=e.Childs().slice();while(n.length){var r=n.pop(),i=[r.Contour()],s=r.Childs();for(var o=0;o<s.length;o++){i.push(s[o].Contour());var u=s[o].Childs();for(var a=0;a<u.length;a++)n.push(u[a])}t.push(i)}return t}function v(e,n,r,i,s){s==null&&(s=t.PolyFillType.pftNonZero);var o=new t.Clipper,u=i?new t.PolyTree:[];return o.AddPaths(e,t.PolyType.ptSubject,!0),o.AddPaths(n,t.PolyType.ptClip,!0),o.Execute(r,u,s,s),u}function m(e,t){return e.map(function(e){return r(e,t,!0)})}function g(e,t){function n(e){var t="";return e["x"]!=null&&(t+=" X"+i.formatCoord(e.x)),e["y"]!=null&&(t+=" Y"+i.formatCoord(e.y)),e["z"]!=null&&(t+=" Z"+i.formatCoord(e.z)),t}var r=["F"+e];return t({goToTravelSpeed:function(e){r.push("G0 "+n(e))},goToWorkSpeed:function(e){r.push("G1 "+n(e))},changeWorkSpeed:function(e){r.push("F"+e)}}),r.join("\n")}function y(e,t,n,r){e=m(e,n*t);var i="";return e.forEach(function(e){if(e.length){var n=e[0];i+=" M "+n.X/t+","+n.Y/t;for(var s=1;s<e.length;s++)i+=" L "+e[s].X/t+","+e[s].Y/t;r&&(i+="Z")}}),i}var o=Math.pow(2,20),a=function(){function e(e,t,n){return e+t+","+n}function t(e,t,n){function r(e,t){return e+", "+t}function i(i,s){return"A"+r(n,n)+" 0 0 0 "+r(e+i*n,t+s*n)}var s=[i(1,0),i(0,-1),i(-1,0),i(0,1)];return"M"+r(e,t+n)+" "+s.join(" ")+"Z"}function n(e,t){function n(e,t){return"l"+e+","+t}return n(e,0)+n(0,t)+n(-e,0)+"Z"}function r(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.length!=0){var r=n[n.length-1];(r.X!=n[0].X||r.Y!=n[0].Y)&&n.push(n[0])}}return e}return{createCircle:t,createRelativeRectangle:n,op:e,closePolygons:r}}();return f.prototype={contourToolpath:function(e,n){function r(e){return e.Childs().slice().sort(function(t,n){return i.mortonClipper(t.Contour()[0],n.Contour()[0])})}function s(e){var t=[],n=r(e);for(var i=0;i<n.length;i++){var o=n[i],u=r(o);for(var a=0;a<u.length;a++)t=t.concat(s(u[a])),t.push(u[a].Contour());t.push(o.Contour())}return t}function o(e){return s(v(e,[],t.ClipType.ctUnion,!0))}e=this.polyOp(e,[],t.ClipType.ctUnion);var u=this.offsetPolygon(e,n);return{toolpath:o(u),rawToolpath:u}},rampToolPath:function(e,t,r,s){var o=[0],u=0;for(var a=0;a<e.path.length;a++){var f=e.path[a],l=e.path[(a+1)%e.path.length];u+=(new i.Point(f[0],f[1])).distance(new i.Point(l[0],l[1])),o.push(u)}var c=new n.GeneralPolylineToolpath;for(a=0;a<s;a++)e.forEachPoint(function(e,n,i,f){var l=o[f];i=t+(r-t)*((a+l/u)/s),c.pushPointXYZ(e,n,i)},null);e.forEachPoint(function(e,t){c.pushPointXYZ(e,t,r)},null);var h=e.getStartPoint(r);return c.pushPointXYZ(h.x,h.y,h.z),c},rampToolPathArray:function(e,t,n,r){var i=this;return e.map(function(e){return i.rampToolPath(e,t,n,r)})},offsetPolygon:function(e,n){var r=[],i=new t.ClipperOffset(2,1e-4*this.clipperScale);return i.AddPaths(v(e,[],t.ClipType.ctUnion),t.JoinType.jtRound,t.EndType.etClosedPolygon),i.Execute(r,n*this.clipperScale),r},fromClipper:function(e,t,r){if(e[0]instanceof n.ConstantZPolygonToolpath)throw"oops";return u(e,this.clipperScale,t,r)},polyOp:function(e,t,n,r){return v(e,t,n,!1,r)},contourAreaPositive:function(e,t){return!!t^!e},addCornerActions:function(e,t,n){if(t==0||e.length==0)return e;var r=[];r.push(e[0]);var s=e[0];for(var o=1;o<e.length-1;o++){s=e[o-1];var u=e[o];if(s.sqDistance(u)==0)continue;var a=u.sub(s),f=e[o+1],l=u.angle(s,f),c=u.add(a.normalized().scale(t));r.push(c);if(Math.abs(l)>n){var h=100/(2*Math.PI)*Math.abs(l),p=a.atan2();for(var d=0;d<=h;d++){var v=p+l/h*d,m=u.add(i.polarPoint(t,v));r.push(m)}}s=u}return e.length>1&&r.push(e[e.length-1]),r}},{CLIPPER_SCALE:o,geom:a,Machine:f,decomposePolytreeInTopLevelPolygons:d,polyOp:v,simplifyPolygons:m,polygonsToClipper:c,pathDefToPolygons:l,pathDefToClipper:h,clipperToPathDef:p,dumpGCode:g,simplifyScaleAndCreatePathDef:y}}),define("cnc/cam/pocket",["RSVP","clipper","cnc/cam/cam","require","cnc/util"],function(e,t,n,r,i){function s(e){return e[e.length-1]}function u(e,n,r){var i=r?new t.PolyTree:[];return o.Clear(),o.AddPaths(e,t.JoinType.jtRound,t.EndType.etClosedPolygon),o.Execute(i,n),i}function a(e,t){var n=e.X-t.X,r=e.Y-t.Y;return n*n+r*r}function f(e,t){var n=Infinity,r=0;for(var i=0;i<t.length;i++){var s=a(e,t[i]);s<n&&(r=i,n=s)}return t.push.apply(t,t.splice(0,r)),t}function l(e,t,n){var r=e.contour[0],i=n.slice();return i[0]=r,{shell:i,path:t.concat(r)}}function c(e){var t=s(e.children);if(t){var r=s(s(t.contour));for(var i=0;i<e.contour.length;i++)f(r,e.contour[i])}n.geom.closePolygons(e.contour)}function h(e){if(e.children.length==1&&e.contour.length==1){var t=e.children[0];if(t.contour.length==1||t.spiraledToolPath){var n,r;if(t.spiraledToolPath){var i=t.spiraledToolPath;n=t.entryPath,r=l(e,i.path,i.shell)}else{var s=t.contour[0];n=s;var o=[s];t.children.length&&o.push(s),r=l(e,s.concat([s[0]]),o)}e.children=t.children,e.spiraledToolPath=r,e.entryPath=n}}}function p(e,t){var n=e.X,r=e.Y,i=!1;for(var s=0,o=t.length-1;s<t.length;o=s++){var u=t[s].X,a=t[s].Y,f=t[o].X,l=t[o].Y,c=a>r!=l>r&&n<(f-u)*(r-a)/(l-a)+u;c&&(i=!i)}return i}function d(e,t){if(e.length==1)return 0;for(var n=0;n<e.length;n++){var r=e[n];if(p(t,r.contour[0]))return n}throw new Error("no parent found for point")}function v(e,t){e[d(e,t.contour[0][0])].children.push(t)}function m(e){e.children.sort(function(e,t){return i.mortonClipper(e.contour[0][0],t.contour[0][0])})}function g(e){return{contour:e,children:[]}}function y(e,r,i,s){var o=new t.ClipperOffset(2,e);o.AddPaths(r,t.JoinType.jtRound,t.EndType.etClosedPolygon);var u=i,a=[],f=1;do a.push(n.decomposePolytreeInTopLevelPolygons(u).map(g)),u=new t.PolyTree,o.Execute(u,-s*f),f++;while(u.ChildCount());return a}function b(e,r,i){var o=r*i,a=o/1e3,f=u(e,-r,!0),l=t.Clipper.ClosedPathsFromPolyTree(f),p=n.simplifyPolygons(l,a),d=y(a,p,f,o);do{var g=d.pop();for(var b=0;b<g.length;b++){var w=g[b];m(w),c(w),h(w),d.length&&v(s(d),w)}}while(d.length>0);return g}function w(e){var t=e.data;self.postMessage({finished:!0,result:b(t.poly,t.scaledToolRadius,t.radialEngagementRatio)})}function E(e,t,n){function o(e){return function(n){if(e.abort){console.log("got message from an aborted worker"),e.worker.terminate(),e.worker=null;return}var r=e.work.messageHandler(n.data);r&&(e.work=null,s<t.length?(e.work=t[s],e.worker.postMessage(e.work.message),s++):(e.worker.terminate(),e.worker=null))}}var r=Math.min(n,t.length),i=[],s=0;for(s=0;s<r;s++){var u=new Worker(e);i[s]={worker:u,work:t[s]},u.onmessage=o(i[s]),u.postMessage(t[s].message)}return{workers:i,abort:function(){for(var e=0;e<i.length;e++){var t=i[e];t.abort=!0,t.worker!==null&&(t.worker.terminate(),t.worker=null)}}}}function S(t,n,r){var i=e.defer();return{message:{operation:"createPocket",poly:t,scaledToolRadius:n,radialEngagementRatio:r},messageHandler:function(e){return e.finished?(i.resolve(e.result),!0):!1},promise:i.promise,polygon:t}}function x(e,t){return i.mortonClipper(e[0][0],t[0][0])}function T(e){e.sort(x)}function N(e,t,n){var i=e.map(function(e){return S(e,t,n)});return self.workerPool=E(r.toUrl("worker.js")+"#pocket",i,6),{workArray:i,abort:self.workerPool.abort}}function C(t,n,r){return{workArray:t.map(function(t){var i=e.defer();return i.resolve(b(t,n,r)),{promise:i.promise,polygon:t}}),abort:function(){}}}function k(e,r,i,s){var o=n.decomposePolytreeInTopLevelPolygons(n.polyOp(e,[],t.ClipType.ctUnion,!0));T(o);var u=s?C:N;return u(o,r,i)}var o=new t.ClipperOffset;return{doCreatePocket:b,createPocket:k,createPocketWorkerSide:w}}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("libs/earcut.min",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.earcut=e()}}(function(){return function e(t,n,r){function i(o,a){if(!n[o]){if(!t[o]){var f="function"==typeof require&&require;if(!a&&f)return f(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){function r(e,t,n){n=n||2;var r=t&&t.length,u=r?t[0]*n:e.length,a=s(e,i(e,0,u,n,!0)),f=[];if(!a)return f;var c,h,p,d,v,m,g;if(r&&(a=l(e,t,a,n)),e.length>80*n){c=p=e[0],h=d=e[1];for(var y=n;u>y;y+=n)v=e[y],m=e[y+1],c>v&&(c=v),h>m&&(h=m),v>p&&(p=v),m>d&&(d=m);g=Math.max(p-c,d-h)}return o(e,a,f,n,c,h,g),f}function i(e,t,n,r,i){var s,o,u,a=0;for(s=t,o=n-r;n>s;s+=r)a+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;if(i===a>0)for(s=t;n>s;s+=r)u=N(s,u);else for(s=n-r;s>=t;s-=r)u=N(s,u);return u}function s(e,t,n){n||(n=t);var r,i=t;do if(r=!1,i.steiner||!b(e,i.i,i.next.i)&&0!==y(e,i.prev.i,i.i,i.next.i))i=i.next;else{if(i.prev.next=i.next,i.next.prev=i.prev,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ),i=n=i.prev,i===i.next)return null;r=!0}while(r||i!==n);return n}function o(e,t,n,r,i,l,c,h){if(t){h||void 0===i||p(e,t,i,l,c);for(var d,v,m=t;t.prev!==t.next;)if(d=t.prev,v=t.next,u(e,t,i,l,c))n.push(d.i/r),n.push(t.i/r),n.push(v.i/r),v.prev=d,d.next=v,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ),t=v.next,m=v.next;else if(t=v,t===m){h?1===h?(t=a(e,t,n,r),o(e,t,n,r,i,l,c,2)):2===h&&f(e,t,n,r,i,l,c):o(e,s(e,t),n,r,i,l,c,1);break}}}function u(e,t,n,r,i){var s=t.prev.i,o=t.i,u=t.next.i,a=e[s],f=e[s+1],l=e[o],c=e[o+1],h=e[u],p=e[u+1],d=a*c-f*l,m=a*p-f*h,g=h*c-p*l,y=d-m-g;if(0>=y)return!1;var b,w,E,S,x,T,N,C=p-f,k=a-h,L=f-c,A=l-a;if(void 0!==n){var O=l>a?h>a?a:h:h>l?l:h,M=c>f?p>f?f:p:p>c?c:p,_=a>l?a>h?a:h:l>h?l:h,D=f>c?f>p?f:p:c>p?c:p,P=v(O,M,n,r,i),H=v(_,D,n,r,i);for(N=t.nextZ;N&&N.z<=H;)if(b=N.i,N=N.nextZ,b!==s&&b!==u&&(w=e[b],E=e[b+1],S=C*w+k*E-m,S>=0&&(x=L*w+A*E+d,x>=0&&(T=y-S-x,T>=0&&(S&&x||S&&T||x&&T)))))return!1;for(N=t.prevZ;N&&N.z>=P;)if(b=N.i,N=N.prevZ,b!==s&&b!==u&&(w=e[b],E=e[b+1],S=C*w+k*E-m,S>=0&&(x=L*w+A*E+d,x>=0&&(T=y-S-x,T>=0&&(S&&x||S&&T||x&&T)))))return!1}else for(N=t.next.next;N!==t.prev;)if(b=N.i,N=N.next,w=e[b],E=e[b+1],S=C*w+k*E-m,S>=0&&(x=L*w+A*E+d,x>=0&&(T=y-S-x,T>=0&&(S&&x||S&&T||x&&T))))return!1;return!0}function a(e,t,n,r){var i=t;do{var s=i.prev,o=i.next.next;if(s.i!==o.i&&w(e,s.i,i.i,i.next.i,o.i)&&S(e,s,o)&&S(e,o,s)){n.push(s.i/r),n.push(i.i/r),n.push(o.i/r),s.next=o,o.prev=s;var u=i.prevZ,a=i.nextZ&&i.nextZ.nextZ;u&&(u.nextZ=a),a&&(a.prevZ=u),i=t=o}i=i.next}while(i!==t);return i}function f(e,t,n,r,i,u,a){var f=t;do{for(var l=f.next.next;l!==f.prev;){if(f.i!==l.i&&g(e,f,l)){var c=T(f,l);return f=s(e,f,f.next),c=s(e,c,c.next),o(e,f,n,r,i,u,a),void o(e,c,n,r,i,u,a)}l=l.next}f=f.next}while(f!==t)}function l(e,t,n,r){var o,u,a,f,l,h=[];for(o=0,u=t.length;u>o;o++)a=t[o]*r,f=u-1>o?t[o+1]*r:e.length,l=i(e,a,f,r,!1),l===l.next&&(l.steiner=!0),l=s(e,l),l&&h.push(m(e,l));for(h.sort(function(t,n){return e[t.i]-e[n.i]}),o=0;o<h.length;o++)c(e,h[o],n),n=s(e,n,n.next);return n}function c(e,t,n){if(n=h(e,t,n)){var r=T(n,t);s(e,r,r.next)}}function h(e,t,n){var r,i,s,o=n,u=t.i,a=e[u],f=e[u+1],l=-1/0;do{if(i=o.i,s=o.next.i,f<=e[i+1]&&f>=e[s+1]){var c=e[i]+(f-e[i+1])*(e[s]-e[i])/(e[s+1]-e[i+1]);a>=c&&c>l&&(l=c,r=e[i]<e[s]?o:o.next)}o=o.next}while(o!==n);if(!r)return null;var h,p,d,v,m,g,y=e[r.i],b=e[r.i+1],w=a*b-f*y,E=a*f-f*l,x=f-f,T=a-l,N=f-b,C=y-a,k=w-E-(l*b-f*y),L=0>=k?-1:1,A=r,O=1/0;for(o=r.next;o!==A;)h=e[o.i],p=e[o.i+1],d=a-h,d>=0&&h>=y&&(v=(x*h+T*p-E)*L,v>=0&&(m=(N*h+C*p+w)*L,m>=0&&k*L-v-m>=0&&(g=Math.abs(f-p)/d,O>g&&S(e,o,t)&&(r=o,O=g)))),o=o.next;return r}function p(e,t,n,r,i){var s=t;do null===s.z&&(s.z=v(e[s.i],e[s.i+1],n,r,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,d(s)}function d(e){var t,n,r,i,s,o,u,a,f=1;do{for(n=e,e=null,s=null,o=0;n;){for(o++,r=n,u=0,t=0;f>t&&(u++,r=r.nextZ,r);t++);for(a=f;u>0||a>0&&r;)0===u?(i=r,r=r.nextZ,a--):0!==a&&r?n.z<=r.z?(i=n,n=n.nextZ,u--):(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,u--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;n=r}s.nextZ=null,f*=2}while(o>1);return e}function v(e,t,n,r,i){return e=1e3*(e-n)/i,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=1e3*(t-r)/i,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function m(e,t){var n=t,r=t;do e[n.i]<e[r.i]&&(r=n),n=n.next;while(n!==t);return r}function g(e,t,n){return!E(e,t,t.i,n.i)&&S(e,t,n)&&S(e,n,t)&&x(e,t,t.i,n.i)}function y(e,t,n,r){var i=(e[n+1]-e[t+1])*(e[r]-e[n])-(e[n]-e[t])*(e[r+1]-e[n+1]);return i>0?1:0>i?-1:0}function b(e,t,n){return e[t]===e[n]&&e[t+1]===e[n+1]}function w(e,t,n,r,i){return y(e,t,n,r)!==y(e,t,n,i)&&y(e,r,i,t)!==y(e,r,i,n)}function E(e,t,n,r){var i=t;do{var s=i.i,o=i.next.i;if(s!==n&&o!==n&&s!==r&&o!==r&&w(e,s,o,n,r))return!0;i=i.next}while(i!==t);return!1}function S(e,t,n){return-1===y(e,t.prev.i,t.i,t.next.i)?-1!==y(e,t.i,n.i,t.next.i)&&-1!==y(e,t.i,t.prev.i,n.i):-1===y(e,t.i,n.i,t.prev.i)||-1===y(e,t.i,t.next.i,n.i)}function x(e,t,n,r){var i=t,s=!1,o=(e[n]+e[r])/2,u=(e[n+1]+e[r+1])/2;do{var a=i.i,f=i.next.i;e[a+1]>u!=e[f+1]>u&&o<(e[f]-e[a])*(u-e[a+1])/(e[f+1]-e[a+1])+e[a]&&(s=!s),i=i.next}while(i!==t);return s}function T(e,t){var n=new C(e.i),r=new C(t.i),i=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function N(e,t){var n=new C(e);return t?(n.next=t.next,n.prev=t,t.next.prev=n,t.next=n):(n.prev=n,n.next=n),n}function C(e){this.i=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}t.exports=r},{}]},{},[1])(1)}),define("cnc/cam/operations",["RSVP","cnc/cam/cam","cnc/cam/toolpath","cnc/cam/pocket","cnc/util","clipper","libs/earcut.min"],function(e,t,n,r,i,s,o){function u(e,t){return{type:e,options:t}}function a(e,t){return i.morton(e.x,e.y)-i.morton(t.x,t.y)}function f(e,t,n){n==null&&(n=(e.contour_inside?-1:1)*(e.leaveStock+e.job.toolRadius));var r=t.contourToolpath(e.outline.clipperPolyline,n);return{contours:t.fromClipper(r.toolpath,!0,t.contourAreaPositive(e.contour_inside,e.contour_climbMilling)),rawClipperToolPath:r.rawToolpath}}function l(e,t,n,r,i){if(!r&&!i)return;var o=e.contour_inside?-1:1,u=e.job.toolRadius,a=t.offsetPolygon(e.outline.clipperPolyline,o*parseFloat(e.leaveStock));if(r){var f=[a,t.offsetPolygon(n,-o*u)];e.contour_inside||f.reverse();var l=t.polyOp(f[0],f[1],s.ClipType.ctDifference);r(h(l,t.clipperScale))}if(i){var c=e.contour_inside?t.polyOp(e.outline.clipperPolyline,a,s.ClipType.ctDifference):t.polyOp(a,e.outline.clipperPolyline,s.ClipType.ctDifference);i(h(c,t.clipperScale))}}function c(e,t){t==null&&(t=[]);var n=e.Childs();for(var r=0;r<n.length;r++){var i=n[r],s=i.Childs(),o=[];for(var u=0;u<s.length;u++)c(s[u],t),o.push(s[u].Contour());t.push({contour:i.Contour(),holes:o})}return t}function h(e,n){function p(){var e=new Float32Array(h),t=new Uint16Array(l);a.push(e.buffer,t.buffer),u.push({positions:e,indices:t}),f=0,l=[],h=[]}var r=t.polyOp(e,[],s.ClipType.ctUnion,!0),i=c(r),u=[],a=[],f=0,l=[],h=[];for(var d=0;d<i.length;d++){f>32e3&&p();var v=i[d],m=[],g=[];for(var y=0;y<v.contour.length;y++)m.push(v.contour[y].X/n,v.contour[y].Y/n,0);for(y=0;y<v.holes.length;y++){g.push(m.length/3);for(var b=0;b<v.holes[y].length;b++)m.push(v.holes[y][b].X/n,v.holes[y][b].Y/n,0)}h=h.concat(m);var w=o(m,g,3);for(y=0;y<w.length;y++)w[y]+=f;l=l.concat(w),f=h.length/3}return p(),{result:u,transferable:a}}function p(e,t){e([]),t([])}return{SimpleEngravingOperation:{label:"Simple Engraving",specialTemplate:"operationSimpleEngraving",properties:{bottom_Z:u("number",{defaultValue:-5}),dragknife_corner_action:u("boolean",{defaultValue:!1}),dragknife_swivel_radius:u("number",{defaultValue:.25}),dragknife_min_angle:u("number",{defaultValue:20})},computeToolpath:function(r,i,s){return p(i,s),new e.Promise(function(e,i){var s=r.bottom_Z,o=r.job.safetyZ,u=[],f=new t.Machine(null),l=r.outline.clipperPolyline;r.dragknife_corner_action&&(l=l.map(function(e){return f.addCornerActions(e,f.clipperScale*r.dragknife_swivel_radius,r.dragknife_min_angle/180*Math.PI)}));for(var c=0;c<l.length;c++)if(l[c].length){var h=new n.GeneralPolylineToolpath;u.push(h),h.pushPointXYZ(l[c][0].x/f.clipperScale,l[c][0].y/f.clipperScale,o);for(var p=0;p<l[c].length;p++)h.pushPointXYZ(l[c][p].x/f.clipperScale,l[c][p].y/f.clipperScale,s)}u.sort(function(e,t){return a(e.getStartPoint(),t.getStartPoint())}),e({toolpath:u})})}},SimpleContourOperation:{label:"Simple Contour",specialTemplate:"operationSimpleContour",properties:{bottom_Z:u("number",{defaultValue:-5}),contour_inside:u("boolean",{defaultValue:!0}),leaveStock:u("number",{defaultValue:0}),contour_climbMilling:u("boolean",{defaultValue:!1}),contour_multipass:u("boolean",{defaultValue:!1}),pocket_engagement:u("number",{defaultValue:50}),contour_upTo:u("number",{defaultValue:1}),contour_towardsFinal:u("boolean",{defaultValue:!0})},computeToolpath:function(n,r,i){return new e.Promise(function(e,s){var o=new t.Machine(null),u=[n.leaveStock+n.job.toolRadius];if(n.contour_multipass){var a=n.pocket_engagement/100*n.job.toolRadius;while(u[u.length-1]<n.contour_upTo)u.push(u[u.length-1]+a);n.contour_towardsFinal&&u.reverse()}var c=[],h=[];for(var p=0;p<u.length;p++){var d=f(n,o,(n.contour_inside?-1:1)*u[p]);Array.prototype.push.apply(c,d.contours),Array.prototype.push.apply(h,d.rawClipperToolPath)}e({toolpath:c.map(function(e){var t=e.getStartPoint(),r=e.asGeneralToolpath(n.bottom_Z);return r.pushPointInFront(t.x,t.y,n.job.safetyZ),r.pushPointXYZ(t.x,t.y,n.bottom_Z),r})});var v=o.offsetPolygon(n.outline.clipperPolyline,-(n.leaveStock+n.job.toolRadius));l(n,o,v,r,i)})}},RampingContourOperation:{label:"Ramping Contour",specialTemplate:"operationRampingContour",properties:{top_Z:u("number",{defaultValue:0}),bottom_Z:u("number",{defaultValue:-5}),ramping_turns:u("number",{defaultValue:5}),contour_inside:u("boolean",{defaultValue:!0}),leaveStock:u("number",{defaultValue:0}),contour_climbMilling:u("boolean",{defaultValue:!1})},computeToolpath:function(n,r,i){return new e.Promise(function(e,s){var o=new t.Machine(null),u=f(n,o),a=o.rampToolPathArray(u.contours,n.top_Z,n.bottom_Z,n.ramping_turns);a.forEach(function(e){var t=e.getStartPoint();e.pushPointInFront(t.x,t.y,n.job.safetyZ)}),e({missedArea:u.missedArea,toolpath:a}),l(n,o,u.rawClipperToolPath,r,i)})}},PocketOperation:{label:"Pocket",specialTemplate:"operationPocket",properties:{bottom_Z:u("number",{defaultValue:-5}),pocket_engagement:u("number",{defaultValue:50}),leaveStock:u("number",{defaultValue:.1}),pocket_ramping_entry:u("boolean",{defaultValue:!0}),ramping_turns:u("number",{defaultValue:2}),top_Z:u("number",{defaultValue:0})},computeToolpath:function(i,s,o){return new e.Promise(function(u,a){var f=i.outline.clipperPolyline,c=new t.Machine(null),h=i.leaveStock;h&&(f=c.offsetPolygon(f,-h));var p=i.job.toolRadius*t.CLIPPER_SCALE,d=r.createPocket(f,p,i.pocket_engagement/100,self["Worker"]==undefined),v=[],m=d.workArray.map(function(t){return e.hash({result:t.promise})});u(e.all(m).then(function(e){return e.forEach(function(e){e.result.forEach(function(e,t){function u(e){for(var t=0;t<e.children.length;t++)u(e.children[t]);e.entryPath&&s.push(c.fromClipper([e.entryPath])[0]);if(e.spiraledToolPath)r=r.concat(c.fromClipper([e.spiraledToolPath.path]));else{if(e.children.length==0){s.push(c.fromClipper(e.contour)[0]);return}var n=c.fromClipper(e.contour);for(var i=0;i<n.length;i++)o[i]||(o[i]=[]),o[i].push(n[i])}}var r=[],s=[],o=[];u(e);var a=i.pocket_ramping_entry?c.rampToolPathArray(s,i.top_Z,i.bottom_Z,i.ramping_turns):s;r=a.concat(r);for(var f=0;f<o.length;f++){var l=new n.ConstantZPolygonToolpath;for(var h=0;h<o[f].length;h++)l.path=l.path.concat(o[f][h].path);r.push(l)}r.forEach(function(e){var n=e.getStartPoint(),r=e.asGeneralToolpath(i.bottom_Z);t==0&&r.pushPointInFront(n.x,n.y,i.job.safetyZ),v.push(r)})})}),{toolpath:v}})),i.contour_inside=!0;var g=c.offsetPolygon(i.outline.clipperPolyline,-(h+i.job.toolRadius));l(i,c,g,s,o)})}},"3DlinearOperation":{label:"3D linear milling",specialTemplate:"operation3DMilling",properties:{"3d_leaveStock":u("number",{defaultValue:.5}),top_Z:u("number",{defaultValue:0}),bottom_Z:u("number",{defaultValue:-1e3}),"3d_toolType":u("string",{defaultValue:"cylinder"}),"3d_vToolAngle":u("number",{defaultValue:10}),"3d_vToolTipDiameter":u("number",{defaultValue:.1}),"3d_diametralEngagement":u("number",{defaultValue:40}),"3d_pathOrientation":u("string",{defaultValue:0}),"3d_startPercent":u("number",{defaultValue:0}),"3d_stopPercent":u("number",{defaultValue:100}),"3d_slice_Z":u("number",{defaultValue:5})},computeToolpath:function(e,t,n){return p(t,n),null}},DrillOperation:{label:"Drilling",specialTemplate:"operationDrilling",properties:{top_Z:u("number",{defaultValue:0}),bottom_Z:u("number",{defaultValue:-5})},computeToolpath:function(t,r,s){return p(r,s),new e.Promise(function(e,r){function l(e){var r=new n.GeneralPolylineToolpath;return r.pushPointXYZ(e.x-t.job.offsetX,e.y-t.job.offsetY,f),r.pushPointXYZ(e.x-t.job.offsetX,e.y-t.job.offsetY,s),r.pushPointXYZ(e.x-t.job.offsetX,e.y-t.job.offsetY,o),r}var s=t.top_Z,o=t.bottom_Z,u=t.outline.point,f=t.job.safetyZ;if(t.outline.drillData){var c=[],h=t.outline.flipped?-1:1,p=JSON.parse(t.outline.drillData),d=Object.keys(p.holes);for(var v=0;v<d.length;v++){var m=p.holes[d[v]];for(var g=0;g<m.length;g++)c.push(new i.Point(m[g].x*h,m[g].y))}c.sort(a),e({toolpath:c.map(function(e){return l(e)})})}else e({toolpath:[l(u)]})})}}}}),function(){var e;try{e=exports}catch(t){e={}}e.foldl=function(t,n,r){for(var i=0;i<r.length;++i)n=t(n,r[i]);return n},e.memoize=!0,e.ParseState=function(){function t(e,t){return this.input=e,this.index=t||0,this.length=e.length-this.index,this.cache={},this}return t.prototype.from=function(e){var n=new t(this.input,this.index+e);return n.cache=this.cache,n.length=this.length-e,n},t.prototype.substring=function(e,t){return this.input.substring(e+this.index,(t||this.length)+this.index)},t.prototype.trimLeft=function(){var e=this.substring(0),t=e.match(/^\s+/);return t?this.from(t[0].length):this},t.prototype.at=function(e){return this.input.charAt(this.index+e)},t.prototype.toString=function(){return'PS"'+this.substring(0)+'"'},t.prototype.getCached=function(t){if(!e.memoize)return!1;var n=this.cache[t];return n?n[this.index]:!1},t.prototype.putCached=function(t,n){if(!e.memoize)return!1;var r=this.cache[t];r?r[this.index]=n:(r=this.cache[t]={},r[this.index]=n)},t}(),e.ps=function(n){return new e.ParseState(n)},e.make_result=function(t,n,r){return{remaining:t,matched:n,ast:r}},e.parser_id=0,e.token=function(n){var r=e.parser_id++;return function(e){var t=e.getCached(r);if(t)return t;var i=e.length>=n.length&&e.substring(0,n.length)==n;return i?t={remaining:e.from(n.length),matched:n,ast:n}:t=!1,e.putCached(r,t),t}},e.ch=function(n){var r=e.parser_id++;return function(e){var t=e.getCached(r);if(t)return t;var i=e.length>=1&&e.at(0)==n;return i?t={remaining:e.from(1),matched:n,ast:n}:t=!1,e.putCached(r,t),t}},e.range=function(n,r){var i=e.parser_id++;return function(e){var t=e.getCached(i);if(t)return t;if(e.length<1)t=!1;else{var s=e.at(0);s>=n&&s<=r?t={remaining:e.from(1),matched:s,ast:s}:t=!1}return e.putCached(i,t),t}},e.toParser=function(n){return typeof n=="string"?e.token(n):n},e.whitespace=function(n){n=e.toParser(n);var r=e.parser_id++;return function(e){var t=e.getCached(r);return t?t:(t=n(e.trimLeft()),e.putCached(r,t),t)}},e.action=function(n,r){n=e.toParser(n);var i=e.parser_id++;return function(e){var t=e.getCached(i);if(t)return t;var s=n(e);return s?(s.ast=r(s.ast),t=s):t=!1,e.putCached(i,t),t}},e.join_action=function(n,r){return e.action(n,function(e){return e.join(r)})},e.left_factor=function(n){return e.foldl(function(e,t){return[e,t]},n[0],n[1])},e.left_factor_action=function(n){return e.action(n,e.left_factor)},e.negate=function(n){n=e.toParser(n);var r=e.parser_id++;return function(t){var i=t.getCached(r);if(i)return i;if(t.length>=1){var s=n(t);s?i=!1:i=e.make_result(t.from(1),t.at(0),t.at(0))}else i=!1;return t.putCached(r,i),i}},e.end=function(n){return n.length==0?e.make_result(n,undefined,undefined):!1},e.end_p=e.end,e.nothing=function(){return!1},e.nothing_p=e.nothing,e.sequence=function(){var n=[];for(var r=0;r<arguments.length;++r)n.push(e.toParser(arguments[r]));var i=e.parser_id++;return function(t){var r=t,s=r.getCached(i);if(s)return s;var o=[],u="",a;for(a=0;a<n.length;++a){var f=n[a],l=f(t);if(!l)break;t=l.remaining,l.ast!=undefined&&(o.push(l.ast),u+=l.matched)}return a==n.length?s=e.make_result(t,u,o):s=!1,r.putCached(i,s),s}},e.wsequence=function(){var n=[];for(var r=0;r<arguments.length;++r)n.push(e.whitespace(e.toParser(arguments[r])));return e.sequence.apply(null,n)},e.choice=function(){var n=[];for(var r=0;r<arguments.length;++r)n.push(e.toParser(arguments[r]));var i=e.parser_id++;return function(e){var t=e.getCached(i);if(t)return t;var r;for(r=0;r<n.length;++r){var s=n[r],o=s(e);if(o)break}return r==n.length?t=!1:t=o,e.putCached(i,t),t}},e.butnot=function(n,r){n=e.toParser(n),r=e.toParser(r);var i=e.parser_id++;return function(e){var t=e.getCached(i);if(t)return t;var s=r(e);if(!s)t=n(e);else{var o=n(e);o?o.matched.length>s.matched.length?t=o:t=!1:t=!1}return e.putCached(i,t),t}},e.difference=function(n,r){n=e.toParser(n),r=e.toParser(r);var i=e.parser_id++;return function(e){var t=e.getCached(i);if(t)return t;var s=r(e);if(!s)t=n(e);else{var o=n(e);o.matched.length>=s.matched.length?t=s:t=o}return e.putCached(i,t),t}},e.xor=function(n,r){n=e.toParser(n),r=e.toParser(r);var i=e.parser_id++;return function(e){var t=e.getCached(i);if(t)return t;var s=n(e),o=r(e);return s&&o?t=!1:t=s||o,e.putCached(i,t),t}},e.repeat0=function(n){n=e.toParser(n);var r=e.parser_id++;return function(t){var i=t,s=i.getCached(r);if(s)return s;var o=[],u="",a;while(a=n(t)){o.push(a.ast),u+=a.matched;if(a.remaining.index==t.index)break;t=a.remaining}return s=e.make_result(t,u,o),i.putCached(r,s),s}},e.repeat1=function(n){n=e.toParser(n);var r=e.parser_id++;return function(t){var i=t,s=i.getCached(r);if(s)return s;var o=[],u="",a=n(t);if(!a)s=!1;else{while(a){o.push(a.ast),u+=a.matched;if(a.remaining.index==t.index)break;t=a.remaining,a=n(t)}s=e.make_result(t,u,o)}return i.putCached(r,s),s}},e.optional=function(n){n=e.toParser(n);var r=e.parser_id++;return function(t){var i=t.getCached(r);if(i)return i;var s=n(t);return i=s||e.make_result(t,"",!1),t.putCached(r,i),i}},e.expect=function(n){return e.action(n,function(){return undefined})},e.chain=function(n,r,i){return n=e.toParser(n),e.action(e.sequence(n,e.repeat0(e.action(e.sequence(r,n),i))),function(e){return[e[0]].concat(e[1])})},e.chainl=function(n,r){return n=e.toParser(n),e.action(e.sequence(n,e.repeat0(e.sequence(r,n))),function(t){return e.foldl(function(e,t){return t[0](e,t[1])},t[0],t[1])})},e.list=function(n,r){return e.chain(n,r,function(e){return e[1]})},e.wlist=function(){var n=[];for(var r=0;r<arguments.length;++r)n.push(e.whitespace(arguments[r]));return e.list.apply(null,n)},e.epsilon_p=function(n){return e.make_result(n,"",undefined)},e.semantic=function(n){var r=e.parser_id++;return function(t){var i=t.getCached(r);return i?i:(i=n()?e.make_result(t,"",undefined):!1,t.putCached(r,i),i)}},e.and=function(n){n=e.toParser(n);var r=e.parser_id++;return function(t){var i=t.getCached(r);if(i)return i;var s=n(t);return i=s?e.make_result(t,"",undefined):!1,t.putCached(r,i),i}},e.not=function(n){n=e.toParser(n);var r=e.parser_id++;return function(t){var i=t.getCached(r);return i?i:(i=n(t)?!1:e.make_result(t,"",undefined),t.putCached(r,i),i)}},e.inject_into=function(n){for(var r in e)e.hasOwnProperty(r)&&typeof e[r]=="function"&&(n[r]=e[r])};if(typeof module=="object"&&typeof module.exports=="object")module.exports=e;else if(typeof define=="function"&&define.amd)define("libs/jsparse",[],function(){return e});else if(typeof window=="object"&&typeof window.document=="object")window.jsparse=e;else{if(typeof self!="object")throw"could not find valid method to export jsparse";self.jsparse=e}}(),define("cnc/gcode/parser",["libs/jsparse","cnc/util"],function(e,t){function i(e){if(n.test(e)){var t={},i;while((i=r.exec(e))!==null){var s=i[1].toLowerCase(),o=parseFloat(i[2]);t[s]==null?t[s]=[o]:t[s].push(o)}return t}return null}function l(e,t){return $.extend(S(e),t)}function c(e,t){var n=S(e);return $.each(["x","y","z","e"],function(e,r){t[r]!=null&&(n[r]+=t[r])}),n}function h(e){return e}function p(e){return e*25.4}function d(e,t){console.log(JSON.stringify(e));if(e["l"]!=2)throw{name:"unsupported G10",message:"only G10 L2 is supported"};var n=e.p;if(n==null)throw{name:"unsupported G10",message:"you did not define P"};if(n<1||n>9)throw{name:"unsupported G10",message:"should be in [0-9], was "+n};if(e.r)throw{name:"unsupported G10",message:"axis rotation is not supported"};var r=E(e,t.unitMode);$.extend(t.origins[n],r)}function v(e,t){C(e,!0,t)}function m(e,t){C(e,!1,t)}function g(e,t){b(e,t,t.feedRate,"normal")}function y(e,t){b(e,t,t.travelFeedRate,"rapid")}function b(e,t,n,r){var i=E(e,t.unitMode);i&&T(t.absolutePoint(i),t,n,r)}function w(e,t){}function E(e,t){var n={};return $.each(["x","y","z","e"],function(r,i){var s=e[i];s!==undefined&&s.length&&(n[i]=t(s[s.length-1]))}),Object.keys(n).length?n:null}function S(e){return $.extend({},e)}function x(e){return new t.Point(e.x,e.y,e.z)}function T(e,t,n,r){var i=!1;$.each(["x","y","z","e"],function(n,r){i=i||Math.abs(e[r]-t.position[r])>1e-5}),i&&(t.addPathFragment({type:"line",from:x(t.position),to:x(e),feedRate:n,lineNo:t.lineNo,speedTag:r}),t.position=e)}function N(e,n,r,i,s,o){var u,a,f,l=e.r;if(l!=undefined&&l.length){u=n(l[l.length-1]);var c=r[i.firstCoord]-s[i.firstCoord],h=r[i.secondCoord]-s[i.secondCoord],p=4*u*u-c*c-h*h;p=-Math.sqrt(p)/t.length(c,h),o||(p=-p),u<0&&(p=-p,u=-u),a=.5*(c-h*p),f=.5*(h+c*p)}else{var d=e[i.firstCenterCoord],v=e[i.secondCenterCoord];if(d===undefined&&v===undefined)throw{name:"no center",message:"circle has neither radius nor in plane center ("+i.firstCenterCoord.toUpperCase()+", "+i.secondCenterCoord.toUpperCase()+")"};a=d?n(d[d.length-1]):0,f=v?n(v[v.length-1]):0,u=t.length(a,f)}return{radius:u,toCenterX:a,toCenterY:f}}function C(e,n,r){var i=E(e,r.unitMode);if(!i)return;var s=r.position,o=r.unitMode,u=r.absolutePoint(i),a=r.planeMode,f=a.firstCoord,l=a.secondCoord,c=N(e,o,u,a,s,n),h=c.radius,p=c.toCenterX,d=c.toCenterY,v=s[f]+p,m=s[l]+d,g=u[f]-v,y=u[l]-m,b=Math.atan2(-p*y+d*g,-p*g-d*y);n&&b>=0&&(b-=2*Math.PI),!n&&b<=0&&(b+=2*Math.PI);var w=Math.atan2(-d,-p);r.addPathFragment({type:"arc",from:x(s),to:x(u),plane:a,center:{first:v,second:m},centerInPlane:new t.Point(v,m),fromAngle:w,angularDistance:b,radius:h,feedRate:r.feedRate,lineNo:r.lineNo,speedTag:"normal"}),r.position=u}function k(e,n,r,i){i==null&&(i=function(){}),r==null&&(r=new t.Point(0,0,0));var o=[];for(var u=0;u<10;u++)o.push(new t.Point(0,0,0));var a=[],f={position:new t.Point(0,0,0),distanceMode:l,motionMode:y,unitMode:h,planeMode:s,feedRate:Math.min(200,n),travelFeedRate:Math.min(e,n),pathControl:61,path:a,parser:L(),origins:o,currentOrigin:1,addPathFragment:function(e){a.push(e),i(e)},absolutePoint:function(e){var t=f.origins[f.currentOrigin];return $.each(["x","y","z","e"],function(n,r){e[r]!=null&&(e[r]+=t[r])}),f.distanceMode(f.position,e)}};return $.each(["x","y","z","e"],function(e,t){f.position[t]=r[t]}),f}function L(){function y(t){return e.action(e.whitespace(t),function(){return g[t]})}var t={},n=e.join_action(e.repeat1(e.range("0","9")),""),r=e.join_action(e.sequence(".",e.optional(n)),""),s=e.action(e.sequence(n,e.optional(r)),function(e){return e[1]!==!1?e[0]+e[1]:e[0]}),o=e.choice(s,r),u=e.action(e.sequence(e.optional(e.choice("+","-")),o),function(e){return parseFloat(e[0]!==!1?e[0]+e[1]:e[1])}),a=e.join_action(e.repeat1(e.choice("_",e.range("0","9"),e.range("a","z"),e.range("A","Z"))),""),f=e.action(e.wsequence(e.expect("<"),a,e.expect(">")),function(e){return e[0].toLowerCase()}),l=e.sequence(e.expect("#"),e.choice(n,f)),c=e.action(l,function(e){var n=t[e];return n===undefined?0:n}),h=function(e){return h(e)},p={ABS:Math.abs,ACOS:Math.acos,ASIN:Math.asin,COS:Math.cos,EXP:Math.exp,FIX:Math.floor,FUP:Math.ceil,ROUND:Math.round,LN:Math.log,SIN:Math.sin,SQRT:Math.sqrt,TAN:Math.tan,EXISTS:function(){return console.log("EXISTS TBD"),1}},d=e.wsequence(e.expect("ATAN["),h,e.expect("]"),e.expect("/"),e.expect("["),h,e.expect("]"));d=e.action(d,function(e){return Math.atan2(e[0],e[1])});var v=[d];$.each(p,function(t,n){v.push(e.action(e.wsequence(e.expect(t+"["),h,e.expect("]")),n))});var m=e.choice.apply(null,v),g={"**":Math.pow,"*":function(e,t){return e*t},"/":function(e,t){return e/t},MOD:function(e,t){return e%t},"+":function(e,t){return e+t},"-":function(e,t){return e-t},EQ:function(e,t){return e===t?1:0},NE:function(e,t){return e!==t?1:0},GT:function(e,t){return e>t?1:0},GE:function(e,t){return e>=t?1:0},LT:function(e,t){return e<t?1:0},LE:function(e,t){return e<=t?1:0},AND:function(e,t){return e&&t?1:0},OR:function(e,t){return e||t?1:0},XOR:function(e,t){return(e?!t:t)?1:0}},b=[["**"],["*","/","MOD"],["+","-"],["EQ","NE","GT","GE","LT","LE"],["AND","OR","XOR"]],w=e.action(e.wsequence(e.expect("["),h,e.expect("]")),function(e){return e[0]});h=e.whitespace(e.choice(m,w,c,u,h)),$.each(b,function(t,n){var r=[];$.each(n,function(e,t){r.push(y(t))}),h=e.chainl(h,e.choice.apply(null,r))});var E=e.choice(w,u,c),S=e.action(e.wsequence(l,e.expect("="),E),function(e){return{variable:e[0],value:e[1]}}),x=e.wsequence(e.choice.apply(null,"EFGIJKLMNPRSTXYZ".split("")),E),T=e.action(e.wsequence(e.repeat0(e.choice(S,x)),e.end),function(e){function i(e,t){n[e]===undefined?n[e]=[t]:n[e].push(t)}var n={},r=[];return $.each(e[0],function(e,t){Array.isArray(t)?i(t[0].toLowerCase(),t[1]):r.push(t)}),$.each(r,function(e,n){t[n.variable]=n.value}),n}),N=e.action(e.wsequence(T,e.expect(e.end)),function(e){return e[0]});return{decimal:u,expression:h,affectation:S,line:T,memory:t,clearMemory:function(){for(var e in t)t.hasOwnProperty(e)&&delete t[e]},parseLine:function(t){var n=i(t);return n?n:N(e.ps(t.toUpperCase())).ast}}}function A(e){var t=e.replace(/[\t ]+/g,"");return t=t.replace(/[(][^)]*[)]/g,""),t=t.replace(/;.*$/,""),t}function O(e,t,n,r,i,s){var o=e.f;o!=undefined&&o.length&&(t.feedRate=Math.min(t.unitMode(o[0]),n));var u=e.g,l=null;for(var c=0;u!==undefined&&c<u.length;c++){var h=u[c],p=f[h];if(p!=null)p==="unsupported"?s.push({lineNo:i,message:"G"+h+" is not supported, skipping",line:r}):$.extend(t,p);else{var d=a[h];d?l==null?(l=d,l(e,t)):s.push({lineNo:i,message:"More than one non-modal on same line G"+u+", skipping",line:r}):s.push({lineNo:i,message:"Did not understand G"+h+", skipping",line:r})}}l==null&&t.motionMode(e,t)}function M(e,t,n,r,i,s){i==null&&(i=[]),t==null&&(t=n),n==null&&(n=t),n==null&&t==null&&(n=3e3,t=3e3);var o=k(t,n,r,s),u=e.split(/\r?\n/);for(var a=0;a<u.length;a++){var f=u[a];if(f.match(/[\t ]*%[\t ]*/))continue;var l=A(f),c=o.parser.parseLine(l);o.lineNo=a;if(c==undefined)i.push({lineNo:a,message:"did not understand line",line:f});else try{O(c,o,n,f,a,i)}catch(h){i.push({lineNo:a,message:h.name+": "+h.message,line:f})}}return o.path}var n=/^([FGHIJKLMNPRSTXYZ][-+]?[0-9]*\.?[0-9]+)+$/i,r=/([FGHIJKLMNPRSTXYZ])([-+]?[0-9]*\.?[0-9]+)/ig;e.memoize=!1;var s={firstCoord:"x",secondCoord:"y",lastCoord:"z",firstCenterCoord:"i",secondCenterCoord:"j"},o={firstCoord:"y",secondCoord:"z",lastCoord:"x",firstCenterCoord:"j",secondCenterCoord:"k"},u={firstCoord:"z",secondCoord:"x",lastCoord:"y",firstCenterCoord:"k",secondCenterCoord:"i"},a={10:d},f={0:{motionMode:y},1:{motionMode:g},2:{motionMode:v},3:{motionMode:m},4:{},17:{planeMode:s},18:{planeMode:u},19:{planeMode:o},20:{unitMode:p},21:{unitMode:h},40:"unsupported",41:"unsupported",42:"unsupported",49:{},54:{currentOrigin:1},55:{currentOrigin:2},56:{currentOrigin:3},57:{currentOrigin:4},58:{currentOrigin:5},59:{currentOrigin:6},59.1:{currentOrigin:7},59.2:{currentOrigin:8},59.3:{currentOrigin:9},61:{pathControl:61},61.1:{pathControl:61.1},64:{pathControl:64},80:{motionMode:w},90:{distanceMode:l},91:{distanceMode:c},94:{}};return{evaluate:M,createParser:L}}),define("cnc/gcode/gcodeSimulation",["cnc/gcode/simulation","cnc/gcode/parser","cnc/util","require"],function(e,t,n,r){function i(r,i,s){function f(t){o.isEmpty()&&o.accumulatePoint(t.from,t.speedTag);if(t.type=="line"){var n=[t.from,t.to];n.speedTag=t.speedTag,a[t.lineNo]=n,o.accumulatePoint(t.to,t.speedTag)}else{var r=.001,i=Math.ceil(Math.PI/Math.acos(1-r/t.radius)*Math.abs(t.angularDistance)/(Math.PI*2)),s=[];for(var u=0;u<=i;u++){var f=e.COMPONENT_TYPES.arc.pointAtRatio(t,u/i,!0);s.push(f),o.accumulatePoint(f,t.speedTag)}a[t.lineNo]=s}}var o=n.createSimulationAccumulator(s),u=[],a=[],l=t.evaluate(r,null,null,i,u,f);o.closeFragment();var c=e.collectToolpathInfo(l);return{totalTime:c.totalTime,min:c.min,max:c.max,errors:u,lineSegmentMap:a}}function s(e){try{self.postMessage(i(e.data.code,e.data.initialPosition,function(e){self.postMessage({type:"fragment",fragment:e},[e.vertices])}))}catch(t){console.log("error "+t.message)}finally{self.close()}}function o(e,t,n,i){var s=new Worker(r.toUrl("worker.js"));s.onerror=function(r){console.log("worker error",r),console.log("trying again without worker"),u(e,t,n)},window.myWorker=s,s.onmessage=function(e){s.onerror=function(e){console.log("worker error",e)},e.data.type=="fragment"?i(e.data.fragment):(n(e.data),window.myWorker=null)},s.postMessage({operation:"simulateGCode",code:e,initialPosition:t})}function u(e,t,n,r){n(i(e,t,r))}return{simulateGCode:i,parseImmediately:u,parseInWorker:o,simulateWorkerSide:s}}),define("cnc/ui/asyncUI",["libs/earcut.min"],function(e){function t(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n].length;return t}function n(e){var n=t(e),r=new Uint32Array(n*2),i=new Float32Array(n*3),s=[i.buffer,r.buffer],o=0;for(var u=0;u<e.length;u++){var a=e[u];for(var f=0;f<a.length;f++)i[o*3+0]=a[f].x,i[o*3+1]=a[f].y,i[o*3+2]=a[f].z,f!=0&&(r[(o-1)*2]=o-1,r[(o-1)*2+1]=o),o++}return{result:[{count:n,position:i,index:r}],transferable:s}}function r(t){var n=[],r=0;for(var i=0;i<t.length;i++)for(var s=0;s<t[i].length;s++){var o=t[i][s],u=[];for(var a=0;a<o.length;a++)u[a*3+0]=o[a].x,u[a*3+1]=o[a].y,u[a*3+2]=o[a].z;var f=e(u,[],3);n.push({count:f.length/3,position:u,index:f}),r+=f.length/3}var l=[],c=[],h=0;for(s=0;s<n.length;s++){for(a=0;a<n[s].position.length;a++)c.push(n[s].position[a]);for(a=0;a<n[s].index.length;a++)l.push(n[s].index[a]+h);h+=n[s].position.length/3}return l=new Uint16Array(l),c=new Float32Array(c),{result:[{count:l.length/3,position:c,index:l}],transferable:[l.buffer,c.buffer]}}return{preparePolylines:n,preparePolygons:r}});var THREE={REVISION:"73dev"};typeof define=="function"&&define.amd?define("three",THREE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=THREE),(self.requestAnimationFrame===undefined||self.cancelAnimationFrame===undefined)&&function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!self.requestAnimationFrame;++n)self.requestAnimationFrame=self[t[n]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[n]+"CancelAnimationFrame"]||self[t[n]+"CancelRequestAnimationFrame"];self.requestAnimationFrame===undefined&&self.setTimeout!==undefined&&(self.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=self.setTimeout(function(){t(n+r)},r);return e=n+r,i}),self.cancelAnimationFrame===undefined&&self.clearTimeout!==undefined&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),Math.sign===undefined&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),Function.prototype.name===undefined&&Object.defineProperty!==undefined&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.MinEquation=103,THREE.MaxEquation=104,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.NeverDepth=0,THREE.AlwaysDepth=1,THREE.LessDepth=2,THREE.LessEqualDepth=3,THREE.EqualDepth=4,THREE.GreaterEqualDepth=5,THREE.GreaterDepth=6,THREE.NotEqualDepth=7,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=300,THREE.CubeReflectionMapping=301,THREE.CubeRefractionMapping=302,THREE.EquirectangularReflectionMapping=303,THREE.EquirectangularRefractionMapping=304,THREE.SphericalReflectionMapping=305,THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.HalfFloatType=1025,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGBEFormat=THREE.RGBAFormat,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.RGB_PVRTC_4BPPV1_Format=2100,THREE.RGB_PVRTC_2BPPV1_Format=2101,THREE.RGBA_PVRTC_4BPPV1_Format=2102,THREE.RGBA_PVRTC_2BPPV1_Format=2103,THREE.LoopOnce=2200,THREE.LoopRepeat=2201,THREE.LoopPingPong=2202,THREE.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},THREE.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},THREE.Color=function(e){return arguments.length===3?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(){function e(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*6*(2/3-n):e}return function(t,n,r){t=THREE.Math.euclideanModulo(t,1),n=THREE.Math.clamp(n,0,1),r=THREE.Math.clamp(r,0,1);if(n===0)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+n):r+n-r*n,s=2*r-i;this.r=e(s,i,t+1/3),this.g=e(s,i,t),this.b=e(s,i,t-1/3)}return this}}(),setStyle:function(e){var t=function(t){var n=parseFloat(t);return n<1&&console.warn("THREE.Color: Alpha component of color "+e+" will be ignored."),n},n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],s=n[2];switch(i){case"rgb":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*$/.exec(s))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*$/.exec(s))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,this;break;case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(s))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(s))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*$/.exec(s)){var o=parseFloat(r[1]),u=parseInt(r[2],10)/100,a=parseInt(r[3],10)/100;return this.setHSL(o,u,a)}break;case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*([0-9]*\.?[0-9]+)\s*$/.exec(s)){var o=parseFloat(r[1]),u=parseInt(r[2],10)/100,a=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(o,u,a)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var f=n[1],l=f.length;if(l===3)return this.r=parseInt(f.charAt(0)+f.charAt(0),16)/255,this.g=parseInt(f.charAt(1)+f.charAt(1),16)/255,this.b=parseInt(f.charAt(2)+f.charAt(2),16)/255,this;if(l===6)return this.r=parseInt(f.charAt(0)+f.charAt(1),16)/255,this.g=parseInt(f.charAt(2)+f.charAt(3),16)/255,this.b=parseInt(f.charAt(4)+f.charAt(5),16)/255,this}if(e&&e.length>0){var f=THREE.ColorKeywords[e];f!==undefined?this.setHex(f):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===undefined&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===undefined&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t=e||{h:0,s:0,l:0},n=this.r,r=this.g,i=this.b,s=Math.max(n,r,i),o=Math.min(n,r,i),u,a,f=(o+s)/2;if(o===s)u=0,a=0;else{var l=s-o;a=f<=.5?l/(s+o):l/(2-s-o);switch(s){case n:u=(r-i)/l+(r<i?6:0);break;case r:u=(i-n)/l+2;break;case i:u=(n-r)/l+4}u/=6}return t.h=u,t.s=a,t.l=f,t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(e,t){return e===undefined&&(e=[]),t===undefined&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=r!==undefined?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(e instanceof THREE.Euler==0)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(e._x/2),r=Math.cos(e._y/2),i=Math.cos(e._z/2),s=Math.sin(e._x/2),o=Math.sin(e._y/2),u=Math.sin(e._z/2),a=e.order;return a==="XYZ"?(this._x=s*r*i+n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i-s*o*u):a==="YXZ"?(this._x=s*r*i+n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i+s*o*u):a==="ZXY"?(this._x=s*r*i-n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i-s*o*u):a==="ZYX"?(this._x=s*r*i-n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i+s*o*u):a==="YZX"?(this._x=s*r*i+n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i-s*o*u):a==="XZY"&&(this._x=s*r*i-n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i+s*o*u),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],o=t[5],u=t[9],a=t[2],f=t[6],l=t[10],c=n+o+l,h;return c>0?(h=.5/Math.sqrt(c+1),this._w=.25/h,this._x=(f-u)*h,this._y=(i-a)*h,this._z=(s-r)*h):n>o&&n>l?(h=2*Math.sqrt(1+n-o-l),this._w=(f-u)/h,this._x=.25*h,this._y=(r+s)/h,this._z=(i+a)/h):o>l?(h=2*Math.sqrt(1+o-n-l),this._w=(i-a)/h,this._x=(r+s)/h,this._y=.25*h,this._z=(u+f)/h):(h=2*Math.sqrt(1+l-n-o),this._w=(s-r)/h,this._x=(i+a)/h,this._y=(u+f)/h,this._z=.25*h),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t,n=1e-6;return function(i,s){return e===undefined&&(e=new THREE.Vector3),t=i.dot(s)+1,t<n?(t=0,Math.abs(i.x)>Math.abs(i.z)?e.set(-i.y,i.x,0):e.set(0,-i.z,i.y)):e.crossVectors(i,s),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return t!==undefined?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w,o=t._x,u=t._y,a=t._z,f=t._w;return this._x=n*f+s*o+r*a-i*u,this._y=r*f+s*u+i*o-n*a,this._z=i*f+s*a+n*u-r*o,this._w=s*f-n*o-r*u-i*a,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var n=this._x,r=this._y,i=this._z,s=this._w,o=s*e._w+n*e._x+r*e._y+i*e._z;o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e);if(o>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);if(Math.abs(a)<.001)return this._w=.5*(s+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var f=Math.sin((1-t)*u)/a,l=Math.sin(t*u)/a;return this._w=s*f+this._w*l,this._x=n*f+this._x*l,this._y=r*f+this._y*l,this._z=i*f+this._z*l,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===undefined&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return e===undefined&&(e=[]),t===undefined&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},THREE.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==undefined?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==undefined?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(r,i){return e===undefined&&(e=new THREE.Vector2,t=new THREE.Vector2),e.set(r,r),t.set(i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===undefined&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===undefined&&(e=[]),t===undefined&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromAttribute:function(e,t,n){return n===undefined&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==undefined?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==undefined?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==undefined?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(n){return n instanceof THREE.Euler==0&&console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),e===undefined&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(n)),this}}(),applyAxisAngle:function(){var e;return function(n,r){return e===undefined&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(n,r)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12],this.y=i[1]*t+i[5]*n+i[9]*r+i[13],this.z=i[2]*t+i[6]*n+i[10]*r+i[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z,u=e.w,a=u*t+s*r-o*n,f=u*n+o*t-i*r,l=u*r+i*n-s*t,c=-i*t-s*n-o*r;return this.x=a*u+c*-i+f*-o-l*-s,this.y=f*u+c*-s+l*-i-a*-o,this.z=l*u+c*-o+a*-s-f*-i,this},project:function(){var e;return function(n){return e===undefined&&(e=new THREE.Matrix4),e.multiplyMatrices(n.projectionMatrix,e.getInverse(n.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(n){return e===undefined&&(e=new THREE.Matrix4),e.multiplyMatrices(n.matrixWorld,e.getInverse(n.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(r,i){return e===undefined&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(r,r,r),t.set(i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},cross:function(e,t){if(t!==undefined)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,u=t.z;return this.x=r*u-i*o,this.y=i*s-n*u,this.z=n*o-r*s,this},projectOnVector:function(){var e,t;return function(r){return e===undefined&&(e=new THREE.Vector3),e.copy(r).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(n){return e===undefined&&(e=new THREE.Vector3),e.copy(this).projectOnVector(n),this.sub(e)}}(),reflect:function(){var e;return function(n){return e===undefined&&(e=new THREE.Vector3),this.sub(e.copy(n).multiplyScalar(2*this.dot(n)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},setEulerFromRotationMatrix:function(e,t){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,t){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),r=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){var n=e*4,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===undefined&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===undefined&&(e=[]),t===undefined&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromAttribute:function(e,t,n){return n===undefined&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this}},THREE.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r!==undefined?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==undefined?e.w:1,this},add:function(e,t){return t!==undefined?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==undefined?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i,this},divideScalar:function(e){if(e!==0){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,s=.01,o=.1,u=e.elements,a=u[0],f=u[4],l=u[8],c=u[1],h=u[5],p=u[9],d=u[2],v=u[6],m=u[10];if(Math.abs(f-c)<s&&Math.abs(l-d)<s&&Math.abs(p-v)<s){if(Math.abs(f+c)<o&&Math.abs(l+d)<o&&Math.abs(p+v)<o&&Math.abs(a+h+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(a+1)/2,y=(h+1)/2,b=(m+1)/2,w=(f+c)/4,E=(l+d)/4,S=(p+v)/4;return g>y&&g>b?g<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(g),r=w/n,i=E/n):y>b?y<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(y),n=w/r,i=S/r):b<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(b),n=E/i,r=S/i),this.set(n,r,i,t),this}var x=Math.sqrt((v-p)*(v-p)+(l-d)*(l-d)+(c-f)*(c-f));return Math.abs(x)<.001&&(x=1),this.x=(v-p)/x,this.y=(l-d)/x,this.z=(c-f)/x,this.w=Math.acos((a+h+m-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(r,i){return e===undefined&&(e=new THREE.Vector4,t=new THREE.Vector4),e.set(r,r,r,r),t.set(i,i,i,i),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return t!==0&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e),this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===undefined&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===undefined&&(e=[]),t===undefined&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromAttribute:function(e,t,n){return n===undefined&&(n=0),t=t*e.itemSize+n,this.x=e.array[t],this.y=e.array[t+1],this.z=e.array[t+2],this.w=e.array[t+3],this}},THREE.Euler=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=THREE.Math.clamp,i=e.elements,s=i[0],o=i[4],u=i[8],a=i[1],f=i[5],l=i[9],c=i[2],h=i[6],p=i[10];return t=t||this._order,t==="XYZ"?(this._y=Math.asin(r(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(h,f),this._z=0)):t==="YXZ"?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(u,p),this._z=Math.atan2(a,f)):(this._y=Math.atan2(-c,s),this._z=0)):t==="ZXY"?(this._x=Math.asin(r(h,-1,1)),Math.abs(h)<.99999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-o,f)):(this._y=0,this._z=Math.atan2(a,s))):t==="ZYX"?(this._y=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(h,p),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-o,f))):t==="YZX"?(this._z=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-l,f),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(u,p))):t==="XZY"?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(h,f),this._y=Math.atan2(u,s)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,n!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e;return function(t,n,r){return e===undefined&&(e=new THREE.Matrix4),e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,r),this}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==undefined&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return e===undefined&&(e=[]),t===undefined&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new THREE.Vector3(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}},THREE.Line3=function(e,t){this.start=e!==undefined?e:new THREE.Vector3,this.end=t!==undefined?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new THREE.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),s=t.dot(e),o=s/i;return r&&(o=THREE.Math.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t),i=n||new THREE.Vector3;return this.delta(i).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},THREE.Box2=function(e,t){this.min=e!==undefined?e:new THREE.Vector2(Infinity,Infinity),this.max=t!==undefined?t:new THREE.Vector2(-Infinity,-Infinity)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var n=t||new THREE.Vector2;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var n=t||new THREE.Vector2;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},THREE.Box3=function(e,t){this.min=e!==undefined?e:new THREE.Vector3(Infinity,Infinity,Infinity),this.max=t!==undefined?t:new THREE.Vector3(-Infinity,-Infinity,-Infinity)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var n=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){var r=t.geometry;if(r!==undefined)if(r instanceof THREE.Geometry){var i=r.vertices;for(var s=0,o=i.length;s<o;s++)e.copy(i[s]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}else if(r instanceof THREE.BufferGeometry&&r.attributes.position!==undefined){var u=r.attributes.position.array;for(var s=0,o=u.length;s<o;s+=3)e.set(u[s],u[s+1],u[s+2]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var n=t||new THREE.Vector3;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var n=t||new THREE.Vector3;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var n=t||new THREE.Sphere;return n.center=this.center(),n.radius=this.size(e).length()*.5,n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,n,r){e===undefined&&(e=new THREE.Vector3),n===undefined&&(n=0),r===undefined&&(r=t.length);for(var i=0,s=n;i<r;i+=3,s+=3)e.fromArray(t,s),e.applyMatrix3(this),e.toArray(t,s);return t}}(),applyToBuffer:function(){var e;return function(n,r,i){e===undefined&&(e=new THREE.Vector3),r===undefined&&(r=0),i===undefined&&(i=n.length/n.itemSize);for(var s=0,o=r;s<i;s++,o++)e.x=n.getX(o),e.y=n.getY(o),e.z=n.getZ(o),e.applyMatrix3(this),n.setXYZ(e.x,e.y,e.z);return n}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8];return t*s*f-t*o*a-n*i*f+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4];var i=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(i===0){var s="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(s);return console.warn(s),this.identity(),this}return this.multiplyScalar(1/i),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}},THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){var r=this.elements;return e.set(r[0],r[1],r[2]),t.set(r[4],r[5],r[6]),n.set(r[8],r[9],r[10]),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e;return function(t){e===undefined&&(e=new THREE.Vector3);var n=this.elements,r=t.elements,i=1/e.set(r[0],r[1],r[2]).length(),s=1/e.set(r[4],r[5],r[6]).length(),o=1/e.set(r[8],r[9],r[10]).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[4]=r[4]*s,n[5]=r[5]*s,n[6]=r[6]*s,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,this}}(),makeRotationFromEuler:function(e){e instanceof THREE.Euler==0&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,s=Math.cos(n),o=Math.sin(n),u=Math.cos(r),a=Math.sin(r),f=Math.cos(i),l=Math.sin(i);if(e.order==="XYZ"){var c=s*f,h=s*l,p=o*f,d=o*l;t[0]=u*f,t[4]=-u*l,t[8]=a,t[1]=h+p*a,t[5]=c-d*a,t[9]=-o*u,t[2]=d-c*a,t[6]=p+h*a,t[10]=s*u}else if(e.order==="YXZ"){var v=u*f,m=u*l,g=a*f,y=a*l;t[0]=v+y*o,t[4]=g*o-m,t[8]=s*a,t[1]=s*l,t[5]=s*f,t[9]=-o,t[2]=m*o-g,t[6]=y+v*o,t[10]=s*u}else if(e.order==="ZXY"){var v=u*f,m=u*l,g=a*f,y=a*l;t[0]=v-y*o,t[4]=-s*l,t[8]=g+m*o,t[1]=m+g*o,t[5]=s*f,t[9]=y-v*o,t[2]=-s*a,t[6]=o,t[10]=s*u}else if(e.order==="ZYX"){var c=s*f,h=s*l,p=o*f,d=o*l;t[0]=u*f,t[4]=p*a-h,t[8]=c*a+d,t[1]=u*l,t[5]=d*a+c,t[9]=h*a-p,t[2]=-a,t[6]=o*u,t[10]=s*u}else if(e.order==="YZX"){var b=s*u,w=s*a,E=o*u,S=o*a;t[0]=u*f,t[4]=S-b*l,t[8]=E*l+w,t[1]=l,t[5]=s*f,t[9]=-o*f,t[2]=-a*f,t[6]=w*l+E,t[10]=b-S*l}else if(e.order==="XZY"){var b=s*u,w=s*a,E=o*u,S=o*a;t[0]=u*f,t[4]=-l,t[8]=a*f,t[1]=b*l+S,t[5]=s*f,t[9]=w*l-E,t[2]=E*l-w,t[6]=o*f,t[10]=S*l+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i,f=n*o,l=n*u,c=n*a,h=r*u,p=r*a,d=i*a,v=s*o,m=s*u,g=s*a;return t[0]=1-(h+d),t[4]=l-g,t[8]=c+m,t[1]=l+g,t[5]=1-(f+d),t[9]=p-v,t[2]=c-m,t[6]=p+v,t[10]=1-(f+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e,t,n;return function(r,i,s){e===undefined&&(e=new THREE.Vector3),t===undefined&&(t=new THREE.Vector3),n===undefined&&(n=new THREE.Vector3);var o=this.elements;return n.subVectors(r,i).normalize(),n.length()===0&&(n.z=1),e.crossVectors(s,n).normalize(),e.length()===0&&(n.x+=1e-4,e.crossVectors(s,n).normalize()),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return t!==undefined?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],w=n[15],E=r[0],S=r[4],x=r[8],T=r[12],N=r[1],C=r[5],k=r[9],L=r[13],A=r[2],O=r[6],M=r[10],_=r[14],D=r[3],P=r[7],H=r[11],B=r[15];return i[0]=s*E+o*N+u*A+a*D,i[4]=s*S+o*C+u*O+a*P,i[8]=s*x+o*k+u*M+a*H,i[12]=s*T+o*L+u*_+a*B,i[1]=f*E+l*N+c*A+h*D,i[5]=f*S+l*C+c*O+h*P,i[9]=f*x+l*k+c*M+h*H,i[13]=f*T+l*L+c*_+h*B,i[2]=p*E+d*N+v*A+m*D,i[6]=p*S+d*C+v*O+m*P,i[10]=p*x+d*k+v*M+m*H,i[14]=p*T+d*L+v*_+m*B,i[3]=g*E+y*N+b*A+w*D,i[7]=g*S+y*C+b*O+w*P,i[11]=g*x+y*k+b*M+w*H,i[15]=g*T+y*L+b*_+w*B,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e;return function(t,n,r){e===undefined&&(e=new THREE.Vector3),n===undefined&&(n=0),r===undefined&&(r=t.length);for(var i=0,s=n;i<r;i+=3,s+=3)e.fromArray(t,s),e.applyMatrix4(this),e.toArray(t,s);return t}}(),applyToBuffer:function(){var e;return function(n,r,i){e===undefined&&(e=new THREE.Vector3),r===undefined&&(r=0),i===undefined&&(i=n.length/n.itemSize);for(var s=0,o=r;s<i;s++,o++)e.x=n.getX(o),e.y=n.getY(o),e.z=n.getZ(o),e.applyMatrix4(this),n.setXYZ(e.x,e.y,e.z);return n}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14],p=e[3],d=e[7],v=e[11],m=e[15];return p*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+d*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+v*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+m*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e;return function(){e===undefined&&(e=new THREE.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],b=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*b+f*d*b,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*b-s*d*b,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*b+s*l*b,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*b-a*d*b,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*b+i*d*b,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*b-i*l*b,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*b+a*p*b,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*b-i*p*b,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*b+i*f*b,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d;var w=i*n[0]+a*n[4]+h*n[8]+m*n[12];if(w===0){var E="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t||!1)throw new Error(E);return console.warn(E),this.identity(),this}return this.multiplyScalar(1/w),this},translate:function(e){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(n,r)))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e,t;return function(n,r,i){e===undefined&&(e=new THREE.Vector3),t===undefined&&(t=new THREE.Matrix4);var s=this.elements,o=e.set(s[0],s[1],s[2]).length(),u=e.set(s[4],s[5],s[6]).length(),a=e.set(s[8],s[9],s[10]).length(),f=this.determinant();f<0&&(o=-o),n.x=s[12],n.y=s[13],n.z=s[14],t.elements.set(this.elements);var l=1/o,c=1/u,h=1/a;return t.elements[0]*=l,t.elements[1]*=l,t.elements[2]*=l,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=h,t.elements[9]*=h,t.elements[10]*=h,r.setFromRotationMatrix(t),i.x=o,i.y=u,i.z=a,this}}(),makeFrustum:function(e,t,n,r,i,s){var o=this.elements,u=2*i/(t-e),a=2*i/(r-n),f=(t+e)/(t-e),l=(r+n)/(r-n),c=-(s+i)/(s-i),h=-2*s*i/(s-i);return o[0]=u,o[4]=0,o[8]=f,o[12]=0,o[1]=0,o[5]=a,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,n,r){var i=n*Math.tan(THREE.Math.degToRad(e*.5)),s=-i,o=s*t,u=i*t;return this.makeFrustum(o,u,s,i,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i,l=(t+e)/u,c=(n+r)/a,h=(s+i)/f;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2/a,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){var t=this.elements,n=e.elements;for(var r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}},THREE.Ray=function(e,t){this.origin=e!==undefined?e:new THREE.Vector3,this.direction=t!==undefined?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var n=t||new THREE.Vector3;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new THREE.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new THREE.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,s,o){e.copy(r).add(i).multiplyScalar(.5),t.copy(i).sub(r).normalize(),n.copy(this.origin).sub(e);var u=r.distanceTo(i)*.5,a=-this.direction.dot(t),f=n.dot(this.direction),l=-n.dot(t),c=n.lengthSq(),h=Math.abs(1-a*a),p,d,v,m;if(h>0){p=a*l-f,d=a*f-l,m=u*h;if(p>=0)if(d>=-m)if(d<=m){var g=1/h;p*=g,d*=g,v=p*(p+a*d+2*f)+d*(a*p+d+2*l)+c}else d=u,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;else d=-u,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;else d<=-m?(p=Math.max(0,-(-a*u+f)),d=p>0?-u:Math.min(Math.max(-u,-l),u),v=-p*p+d*(d+2*l)+c):d<=m?(p=0,d=Math.min(Math.max(-u,-l),u),v=d*(d+2*l)+c):(p=Math.max(0,-(a*u+f)),d=p>0?u:Math.min(Math.max(-u,-l),u),v=-p*p+d*(d+2*l)+c)}else d=a>0?-u:u,p=Math.max(0,-(a*d+f)),v=-p*p+d*(d+2*l)+c;return s&&s.copy(this.direction).multiplyScalar(p).add(this.origin),o&&o.copy(t).multiplyScalar(d).add(e),v}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new THREE.Vector3;return function(t,n){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),i=e.dot(e)-r*r,s=t.radius*t.radius;if(i>s)return null;var o=Math.sqrt(s-i),u=r-o,a=r+o;return u<0&&a<0?null:u<0?this.at(a,n):this.at(u,n)}}(),isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0)return!0;var n=e.normal.dot(this.direction);return n*t<0?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return n===null?null:this.at(n,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return this.intersectBox(t,e)!==null}}(),intersectBox:function(e,t){var n,r,i,s,o,u,a=1/this.direction.x,f=1/this.direction.y,l=1/this.direction.z,c=this.origin;a>=0?(n=(e.min.x-c.x)*a,r=(e.max.x-c.x)*a):(n=(e.max.x-c.x)*a,r=(e.min.x-c.x)*a),f>=0?(i=(e.min.y-c.y)*f,s=(e.max.y-c.y)*f):(i=(e.max.y-c.y)*f,s=(e.min.y-c.y)*f);if(n>s||i>r)return null;if(i>n||n!==n)n=i;if(s<r||r!==r)r=s;l>=0?(o=(e.min.z-c.z)*l,u=(e.max.z-c.z)*l):(o=(e.max.z-c.z)*l,u=(e.min.z-c.z)*l);if(n>u||o>r)return null;if(o>n||n!==n)n=o;if(u<r||r!==r)r=u;return r<0?null:this.at(n>=0?n:r,t)},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3;return function(i,s,o,u,a){t.subVectors(s,i),n.subVectors(o,i),r.crossVectors(t,n);var f=this.direction.dot(r),l;if(f>0){if(u)return null;l=1}else{if(!(f<0))return null;l=-1,f=-f}e.subVectors(this.origin,i);var c=l*this.direction.dot(n.crossVectors(e,n));if(c<0)return null;var h=l*this.direction.dot(t.cross(e));if(h<0)return null;if(c+h>f)return null;var p=-l*e.dot(r);return p<0?null:this.at(p/f,a)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},THREE.Sphere=function(e,t){this.center=e!==undefined?e:new THREE.Vector3,this.radius=t!==undefined?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,n){var r=this.center;n!==undefined?r.copy(n):e.setFromPoints(t).center(r);var i=0;for(var s=0,o=t.length;s<o;s++)i=Math.max(i,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),r=t||new THREE.Vector3;return r.copy(e),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},THREE.Frustum=function(e,t,n,r,i,s){this.planes=[e!==undefined?e:new THREE.Plane,t!==undefined?t:new THREE.Plane,n!==undefined?n:new THREE.Plane,r!==undefined?r:new THREE.Plane,i!==undefined?i:new THREE.Plane,s!==undefined?s:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=this.planes;for(var n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],a=n[5],f=n[6],l=n[7],c=n[8],h=n[9],p=n[10],d=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,l-u,d-c,y-v).normalize(),t[1].setComponents(o+r,l+u,d+c,y+v).normalize(),t[2].setComponents(o+i,l+a,d+h,y+m).normalize(),t[3].setComponents(o-i,l-a,d-h,y-m).normalize(),t[4].setComponents(o-s,l-f,d-p,y-g).normalize(),t[5].setComponents(o+s,l+f,d+p,y+g).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var n=t.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),e.copy(n.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,n=e.center,r=-e.radius;for(var i=0;i<6;i++){var s=t[i].distanceToPoint(n);if(s<r)return!1}return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){var r=this.planes;for(var i=0;i<6;i++){var s=r[i];e.x=s.normal.x>0?n.min.x:n.max.x,t.x=s.normal.x>0?n.max.x:n.min.x,e.y=s.normal.y>0?n.min.y:n.max.y,t.y=s.normal.y>0?n.max.y:n.min.y,e.z=s.normal.z>0?n.min.z:n.max.z,t.z=s.normal.z>0?n.max.z:n.min.z;var o=s.distanceToPoint(e),u=s.distanceToPoint(t);if(o<0&&u<0)return!1}return!0}}(),containsPoint:function(e){var t=this.planes;for(var n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},THREE.Plane=function(e,t){this.normal=e!==undefined?e:new THREE.Vector3(1,0,0),this.constant=t!==undefined?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r,i){var s=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(s,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e),r=t||new THREE.Vector3;return r.copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,n){var r=n||new THREE.Vector3,i=t.delta(e),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(t.start)===0?r.copy(t.start):undefined;var o=-(t.start.dot(this.normal)+this.constant)/s;return o<0||o>1?undefined:r.copy(i).multiplyScalar(o).add(t.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Matrix3;return function(r,i){var s=i||n.getNormalMatrix(r),o=e.copy(this.normal).applyMatrix3(s),u=this.coplanarPoint(t);return u.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(o,u),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},THREE.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=new Array(36),n=0,r;return function(){for(var i=0;i<36;i++)i===8||i===13||i===18||i===23?t[i]="-":i===14?t[i]="4":(n<=2&&(n=33554432+Math.random()*16777216|0),r=n&15,n>>=4,t[i]=e[i===19?r&3|8:r]);return t.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(e*6-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}},THREE.Spline=function(e){function h(e,t,n,r,i,s,o){var u=(n-e)*.5,a=(r-t)*.5;return(2*(t-n)+u+a)*o+(-3*(t-n)-2*u-a)*s+u*i+t}this.points=e;var t=[],n={x:0,y:0,z:0},r,i,s,o,u,a,f,l,c;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,i=Math.floor(r),s=r-i,t[0]=i===0?i:i-1,t[1]=i,t[2]=i>this.points.length-2?this.points.length-1:i+1,t[3]=i>this.points.length-3?this.points.length-1:i+2,a=this.points[t[0]],f=this.points[t[1]],l=this.points[t[2]],c=this.points[t[3]],o=s*s,u=s*o,n.x=h(a.x,f.x,l.x,c.x,s,o,u),n.y=h(a.y,f.y,l.y,c.y,s,o,u),n.z=h(a.z,f.z,l.z,c.z,s,o,u),n},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i,s=0,o=0,u=0,a=new THREE.Vector3,f=new THREE.Vector3,l=[],c=0;l[0]=0,e||(e=100),r=this.points.length*e,a.copy(this.points[0]);for(t=1;t<r;t++)n=t/r,i=this.getPoint(n),f.copy(i),c+=f.distanceTo(a),a.copy(i),s=(this.points.length-1)*n,o=Math.floor(s),o!==u&&(l[o]=c,u=o);return l[l.length]=c,{chunks:l,total:c}},this.reparametrizeByArcLength=function(e){var t,n,r,i,s,o,u,a,f=[],l=new THREE.Vector3,c=this.getLength();f.push(l.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){o=c.chunks[t]-c.chunks[t-1],u=Math.ceil(e*o/c.total),i=(t-1)/(this.points.length-1),s=t/(this.points.length-1);for(n=1;n<u-1;n++)r=i+n*(1/u)*(s-i),a=this.getPoint(r),f.push(l.copy(a).clone());f.push(l.copy(this.points[t]).clone())}this.points=f}},THREE.Triangle=function(e,t,n){this.a=e!==undefined?e:new THREE.Vector3,this.b=t!==undefined?t:new THREE.Vector3,this.c=n!==undefined?n:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,n,r,i){var s=i||new THREE.Vector3;s.subVectors(r,n),e.subVectors(t,n),s.cross(e);var o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,s,o,u){e.subVectors(o,i),t.subVectors(s,i),n.subVectors(r,i);var a=e.dot(e),f=e.dot(t),l=e.dot(n),c=t.dot(t),h=t.dot(n),p=a*c-f*f,d=u||new THREE.Vector3;if(p===0)return d.set(-2,-1,-1);var v=1/p,m=(c*l-f*h)*v,g=(a*h-f*l)*v;return d.set(1-m-g,g,m)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,n,r,i){var s=THREE.Triangle.barycoordFromPoint(t,n,r,i,e);return s.x>=0&&s.y>=0&&s.x+s.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),e.cross(t).length()*.5}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},THREE.Clock=function(e){this.autoStart=e!==undefined?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,_now:function(){return self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now()},start:function(){this.startTime=this._now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=this._now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){this._listeners===undefined&&(this._listeners={});var n=this._listeners;n[e]===undefined&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(this._listeners===undefined)return!1;var n=this._listeners;return n[e]!==undefined&&n[e].indexOf(t)!==-1?!0:!1},removeEventListener:function(e,t){if(this._listeners===undefined)return;var n=this._listeners,r=n[e];if(r!==undefined){var i=r.indexOf(t);i!==-1&&r.splice(i,1)}},dispatchEvent:function(e){if(this._listeners===undefined)return;var t=this._listeners,n=t[e.type];if(n!==undefined){e.target=this;var r=[],i=n.length;for(var s=0;s<i;s++)r[s]=n[s];for(var s=0;s<i;s++)r[s].call(this,e)}}},function(e){function t(e,t){return e.distance-t.distance}e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),this.near=r||0,this.far=i||Infinity,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})};var n=function(e,t,r,i){if(e.visible===!1)return;e.raycast(t,r);if(i===!0){var s=e.children;for(var o=0,u=s.length;o<u;o++)n(s[o],t,r,!0)}};e.Raycaster.prototype={constructor:e.Raycaster,linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(t,n){n instanceof e.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(n.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(n).sub(this.ray.origin).normalize()):n instanceof e.OrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(n),this.ray.direction.set(0,0,-1).transformDirection(n.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,r){var i=[];return n(e,this,i,r),i.sort(t),i},intersectObjects:function(e,r){var i=[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var s=0,o=e.length;s<o;s++)n(e[s],this,i,r);return i.sort(t),i}}}(THREE),THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=THREE.Object3D.DefaultUp.clone();var e=new THREE.Vector3,t=new THREE.Euler,n=new THREE.Quaternion,r=new THREE.Vector3(1,1,1),i=function(){n.setFromEuler(t,!1)},s=function(){t.setFromQuaternion(n,undefined,!1)};t.onChange(i),n.onChange(s),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new THREE.Matrix4},normalMatrix:{value:new THREE.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=THREE.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0),THREE.Object3D.DefaultMatrixAutoUpdate=!0,THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set renderDepth(e){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e instanceof THREE.Object3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1)for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);var n=this.children.indexOf(e);n!==-1&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n],s=i.getObjectByProperty(e,t);if(s!==undefined)return s}return undefined},getWorldPosition:function(e){var t=e||new THREE.Vector3;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){var r=n||new THREE.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,t),r}}(),getWorldRotation:function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Euler;return this.getWorldQuaternion(e),n.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new THREE.Vector3,t=new THREE.Quaternion;return function(n){var r=n||new THREE.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Vector3;return this.getWorldQuaternion(e),n.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);var t=this.children;for(var n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(this.visible===!1)return;e(this);var t=this.children;for(var n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)},traverseAncestors:function(e){var t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix();if(this.matrixWorldNeedsUpdate===!0||e===!0)this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},toJSON:function(e){function f(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}var t=e===undefined,n={},r={object:n};t&&(e={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"}),n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),this.visible!==!0&&(n.visible=this.visible),n.matrix=this.matrix.toArray();if(this.children.length>0){n.children=[];for(var i=0;i<this.children.length;i++)n.children.push(this.children[i].toJSON(e).object)}if(t){var s=f(e.geometries),o=f(e.materials),u=f(e.textures),a=f(e.images);s.length>0&&(r.geometries=s),o.length>0&&(r.materials=o),u.length>0&&(r.textures=u),a.length>0&&(r.images=a)}return r},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){t===undefined&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.rotationAutoUpdate=e.rotationAutoUpdate,this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData));if(t===!0)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Face3=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=Array.isArray(r)?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=s!==undefined?s:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}},THREE.Face4=function(e,t,n,r,i,s,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,n,i,s,o)},THREE.BufferAttribute=function(e,t){this.uuid=THREE.Math.generateUUID(),this.array=e,this.itemSize=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.array.length/this.itemSize},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){var t=this.array,n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];s===undefined&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new THREE.Color),t[n++]=s.r,t[n++]=s.g,t[n++]=s.b}return this},copyIndicesArray:function(e){var t=this.array,n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];t[n++]=s.a,t[n++]=s.b,t[n++]=s.c}return this},copyVector2sArray:function(e){var t=this.array,n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];s===undefined&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new THREE.Vector2),t[n++]=s.x,t[n++]=s.y}return this},copyVector3sArray:function(e){var t=this.array,n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];s===undefined&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new THREE.Vector3),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z}return this},copyVector4sArray:function(e){var t=this.array,n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];s===undefined&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new THREE.Vector4),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z,t[n++]=s.w}return this},set:function(e,t){return t===undefined&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},clone:function(){return(new this.constructor).copy(this)}},THREE.Int8Attribute=function(e,t){return new THREE.BufferAttribute(new Int8Array(e),t)},THREE.Uint8Attribute=function(e,t){return new THREE.BufferAttribute(new Uint8Array(e),t)},THREE.Uint8ClampedAttribute=function(e,t){return new THREE.BufferAttribute(new Uint8ClampedArray(e),t)},THREE.Int16Attribute=function(e,t){return new THREE.BufferAttribute(new Int16Array(e),t)},THREE.Uint16Attribute=function(e,t){return new THREE.BufferAttribute(new Uint16Array(e),t)},THREE.Int32Attribute=function(e,t){return new THREE.BufferAttribute(new Int32Array(e),t)},THREE.Uint32Attribute=function(e,t){return new THREE.BufferAttribute(new Uint32Array(e),t)},THREE.Float32Attribute=function(e,t){return new THREE.BufferAttribute(new Float32Array(e),t)},THREE.Float64Attribute=function(e,t){return new THREE.BufferAttribute(new Float64Array(e),t)},THREE.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),(new THREE.BufferAttribute(e,t)).setDynamic(!0)},THREE.InstancedBufferAttribute=function(e,t,n){THREE.BufferAttribute.call(this,e,t),this.meshPerAttribute=n||1},THREE.InstancedBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.InstancedBufferAttribute.prototype.constructor=THREE.InstancedBufferAttribute,THREE.InstancedBufferAttribute.prototype.copy=function(e){return THREE.BufferAttribute.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},THREE.InterleavedBuffer=function(e,t){this.uuid=THREE.Math.generateUUID(),this.array=e,this.stride=t,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},THREE.InterleavedBuffer.prototype={constructor:THREE.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(e){e===!0&&this.version++},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){this.array=new e.array.constructor(e.array),this.stride=e.stride,this.dynamic=e.dynamic},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return t===undefined&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)}},THREE.InstancedInterleavedBuffer=function(e,t,n){THREE.InterleavedBuffer.call(this,e,t),this.meshPerAttribute=n||1},THREE.InstancedInterleavedBuffer.prototype=Object.create(THREE.InterleavedBuffer.prototype),THREE.InstancedInterleavedBuffer.prototype.constructor=THREE.InstancedInterleavedBuffer,THREE.InstancedInterleavedBuffer.prototype.copy=function(e){return THREE.InterleavedBuffer.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},THREE.InterleavedBufferAttribute=function(e,t,n){this.uuid=THREE.Math.generateUUID(),this.data=e,this.itemSize=t,this.offset=n},THREE.InterleavedBufferAttribute.prototype={constructor:THREE.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.array.length/this.data.stride},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}},THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=(new THREE.Matrix3).getNormalMatrix(e);for(var n=0,r=this.vertices.length;n<r;n++){var i=this.vertices[n];i.applyMatrix4(e)}for(var n=0,r=this.faces.length;n<r;n++){var s=this.faces[n];s.normal.applyMatrix3(t).normalize();for(var o=0,u=s.vertexNormals.length;o<u;o++)s.vertexNormals[o].applyMatrix3(t).normalize()}this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0},rotateX:function(){var e;return function(n){return e===undefined&&(e=new THREE.Matrix4),e.makeRotationX(n),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(n){return e===undefined&&(e=new THREE.Matrix4),e.makeRotationY(n),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(n){return e===undefined&&(e=new THREE.Matrix4),e.makeRotationZ(n),this.applyMatrix(e),this}}(),translate:function(){var e;return function(n,r,i){return e===undefined&&(e=new THREE.Matrix4),e.makeTranslation(n,r,i),this.applyMatrix(e),this}}(),scale:function(){var e;return function(n,r,i){return e===undefined&&(e=new THREE.Matrix4),e.makeScale(n,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(n){e===undefined&&(e=new THREE.Object3D),e.lookAt(n),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function v(e,n,r){var i=s!==undefined?[f[e].clone(),f[n].clone(),f[r].clone()]:[],h=o!==undefined?[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()]:[],p=new THREE.Face3(e,n,r,i,h);t.faces.push(p),u!==undefined&&t.faceVertexUvs[0].push([l[e].clone(),l[n].clone(),l[r].clone()]),a!==undefined&&t.faceVertexUvs[1].push([c[e].clone(),c[n].clone(),c[r].clone()])}var t=this,n=e.index!==null?e.index.array:undefined,r=e.attributes,i=r.position.array,s=r.normal!==undefined?r.normal.array:undefined,o=r.color!==undefined?r.color.array:undefined,u=r.uv!==undefined?r.uv.array:undefined,a=r.uv2!==undefined?r.uv2.array:undefined;a!==undefined&&(this.faceVertexUvs[1]=[]);var f=[],l=[],c=[];for(var h=0,p=0,d=0;h<i.length;h+=3,p+=2,d+=4)t.vertices.push(new THREE.Vector3(i[h],i[h+1],i[h+2])),s!==undefined&&f.push(new THREE.Vector3(s[h],s[h+1],s[h+2])),o!==undefined&&t.colors.push(new THREE.Color(o[h],o[h+1],o[h+2])),u!==undefined&&l.push(new THREE.Vector2(u[p],u[p+1])),a!==undefined&&c.push(new THREE.Vector2(a[p],a[p+1]));if(n!==undefined){var m=e.groups;if(m.length>0)for(var h=0;h<m.length;h++){var g=m[h],y=g.start,b=g.count;for(var p=y,w=y+b;p<w;p+=3)v(n[p],n[p+1],n[p+2])}else for(var h=0;h<n.length;h+=3)v(n[h],n[h+1],n[h+2])}else for(var h=0;h<i.length/3;h+=3)v(h,h+1,h+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=t===0?1:1/t,r=new THREE.Matrix4;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){var e=new THREE.Vector3,t=new THREE.Vector3;for(var n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],s=this.vertices[i.a],o=this.vertices[i.b],u=this.vertices[i.c];e.subVectors(u,o),t.subVectors(s,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,s,o;o=new Array(this.vertices.length);for(t=0,n=this.vertices.length;t<n;t++)o[t]=new THREE.Vector3;if(e){var u,a,f,l=new THREE.Vector3,c=new THREE.Vector3;for(r=0,i=this.faces.length;r<i;r++)s=this.faces[r],u=this.vertices[s.a],a=this.vertices[s.b],f=this.vertices[s.c],l.subVectors(f,a),c.subVectors(u,a),l.cross(c),o[s.a].add(l),o[s.b].add(l),o[s.c].add(l)}else for(r=0,i=this.faces.length;r<i;r++)s=this.faces[r],o[s.a].add(s.normal),o[s.b].add(s.normal),o[s.c].add(s.normal);for(t=0,n=this.vertices.length;t<n;t++)o[t].normalize();for(r=0,i=this.faces.length;r<i;r++){s=this.faces[r];var h=s.vertexNormals;h.length===3?(h[0].copy(o[s.a]),h[1].copy(o[s.b]),h[2].copy(o[s.c])):(h[0]=o[s.a].clone(),h[1]=o[s.b].clone(),h[2]=o[s.c].clone())}},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++){i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]);for(e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone()}var s=new THREE.Geometry;s.faces=this.faces;for(e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,u=this.morphNormals[e].vertexNormals,a,f;for(n=0,r=this.faces.length;n<r;n++)a=new THREE.Vector3,f={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},o.push(a),u.push(f)}var l=this.morphNormals[e];s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals();var a,f;for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],a=l.faceNormals[n],f=l.vertexNormals[n],a.copy(i.normal),f.a.copy(i.vertexNormals[0]),f.b.copy(i.vertexNormals[1]),f.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){var e=0,t=this.vertices;for(var n=0,r=t.length;n<r;n++)n>0&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e instanceof THREE.Geometry==0){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var r,i=this.vertices.length,s=this.vertices,o=e.vertices,u=this.faces,a=e.faces,f=this.faceVertexUvs[0],l=e.faceVertexUvs[0];n===undefined&&(n=0),t!==undefined&&(r=(new THREE.Matrix3).getNormalMatrix(t));for(var c=0,h=o.length;c<h;c++){var p=o[c],d=p.clone();t!==undefined&&d.applyMatrix4(t),s.push(d)}for(c=0,h=a.length;c<h;c++){var v=a[c],m,g,y,b=v.vertexNormals,w=v.vertexColors;m=new THREE.Face3(v.a+i,v.b+i,v.c+i),m.normal.copy(v.normal),r!==undefined&&m.normal.applyMatrix3(r).normalize();for(var E=0,S=b.length;E<S;E++)g=b[E].clone(),r!==undefined&&g.applyMatrix3(r).normalize(),m.vertexNormals.push(g);m.color.copy(v.color);for(var E=0,S=w.length;E<S;E++)y=w[E],m.vertexColors.push(y.clone());m.materialIndex=v.materialIndex+n,u.push(m)}for(c=0,h=l.length;c<h;c++){var x=l[c],T=[];if(x===undefined)continue;for(var E=0,S=x.length;E<S;E++)T.push(x[E].clone());f.push(T)}},mergeMesh:function(e){if(e instanceof THREE.Mesh==0){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={},t=[],n=[],r,i,s=4,o=Math.pow(10,s),u,a,f,l,c,h;for(u=0,a=this.vertices.length;u<a;u++)r=this.vertices[u],i=Math.round(r.x*o)+"_"+Math.round(r.y*o)+"_"+Math.round(r.z*o),e[i]===undefined?(e[i]=u,t.push(this.vertices[u]),n[u]=t.length-1):n[u]=n[e[i]];var p=[];for(u=0,a=this.faces.length;u<a;u++){f=this.faces[u],f.a=n[f.a],f.b=n[f.b],f.c=n[f.c],l=[f.a,f.b,f.c];var d=-1;for(var v=0;v<3;v++)if(l[v]===l[(v+1)%3]){d=v,p.push(u);break}}for(u=p.length-1;u>=0;u--){var m=p[u];this.faces.splice(m,1);for(c=0,h=this.faceVertexUvs.length;c<h;c++)this.faceVertexUvs[c].splice(m,1)}var g=this.vertices.length-t.length;return this.vertices=t,g},sortFacesByMaterialIndex:function(){function e(e,t){return e.materialIndex-t.materialIndex}this.faces.sort(e)},toJSON:function(){function N(e,t,n){return n?e|1<<t:e&~(1<<t)}function C(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return a[t]!==undefined?a[t]:(a[t]=u.length/3,u.push(e.x,e.y,e.z),a[t])}function k(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return l[t]!==undefined?l[t]:(l[t]=f.length,f.push(e.getHex()),l[t])}function L(e){var t=e.x.toString()+e.y.toString();return h[t]!==undefined?h[t]:(h[t]=c.length/2,c.push(e.x,e.y),h[t])}var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name);if(this.parameters!==undefined){var t=this.parameters;for(var n in t)t[n]!==undefined&&(e[n]=t[n]);return e}var r=[];for(var i=0;i<this.vertices.length;i++){var s=this.vertices[i];r.push(s.x,s.y,s.z)}var o=[],u=[],a={},f=[],l={},c=[],h={};for(var i=0;i<this.faces.length;i++){var p=this.faces[i],d=!1,v=!1,m=this.faceVertexUvs[0][i]!==undefined,g=p.normal.length()>0,y=p.vertexNormals.length>0,b=p.color.r!==1||p.color.g!==1||p.color.b!==1,w=p.vertexColors.length>0,E=0;E=N(E,0,0),E=N(E,1,d),E=N(E,2,v),E=N(E,3,m),E=N(E,4,g),E=N(E,5,y),E=N(E,6,b),E=N(E,7,w),o.push(E),o.push(p.a,p.b,p.c);if(m){var S=this.faceVertexUvs[0][i];o.push(L(S[0]),L(S[1]),L(S[2]))}g&&o.push(C(p.normal));if(y){var x=p.vertexNormals;o.push(C(x[0]),C(x[1]),C(x[2]))}b&&o.push(k(p.color));if(w){var T=p.vertexColors;o.push(k(T[0]),k(T[1]),k(T[2]))}}return e.data={},e.data.vertices=r,e.data.normals=u,f.length>0&&(e.data.colors=f),c.length>0&&(e.data.uvs=[c]),e.data.faces=o,e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];var t=e.vertices;for(var n=0,r=t.length;n<r;n++)this.vertices.push(t[n].clone());var i=e.faces;for(var n=0,r=i.length;n<r;n++)this.faces.push(i[n].clone());for(var n=0,r=e.faceVertexUvs.length;n<r;n++){var s=e.faceVertexUvs[n];this.faceVertexUvs[n]===undefined&&(this.faceVertexUvs[n]=[]);for(var o=0,u=s.length;o<u;o++){var a=s[o],f=[];for(var l=0,c=a.length;l<c;l++){var h=a[l];f.push(h.clone())}this.faceVertexUvs[n].push(f)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.DirectGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},THREE.DirectGeometry.prototype={constructor:THREE.DirectGeometry,computeBoundingBox:THREE.Geometry.prototype.computeBoundingBox,computeBoundingSphere:THREE.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(e){var t,n=[],r,i=e.faces;for(var s=0;s<i.length;s++){var o=i[s];o.materialIndex!==r&&(r=o.materialIndex,t!==undefined&&(t.count=s*3-t.start,n.push(t)),t={start:s*3,materialIndex:r})}t!==undefined&&(t.count=s*3-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t=e.faces,n=e.vertices,r=e.faceVertexUvs,i=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,o=e.morphTargets,u=o.length;if(u>0){var a=[];for(var f=0;f<u;f++)a[f]=[];this.morphTargets.position=a}var l=e.morphNormals,c=l.length;if(c>0){var h=[];for(var f=0;f<c;f++)h[f]=[];this.morphTargets.normal=h}var p=e.skinIndices,d=e.skinWeights,v=p.length===n.length,m=d.length===n.length;for(var f=0;f<t.length;f++){var g=t[f];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(y.length===3)this.normals.push(y[0],y[1],y[2]);else{var b=g.normal;this.normals.push(b,b,b)}var w=g.vertexColors;if(w.length===3)this.colors.push(w[0],w[1],w[2]);else{var E=g.color;this.colors.push(E,E,E)}if(i===!0){var S=r[0][f];S!==undefined?this.uvs.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",f),this.uvs.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}if(s===!0){var S=r[1][f];S!==undefined?this.uvs2.push(S[0],S[1],S[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",f),this.uvs2.push(new THREE.Vector2,new THREE.Vector2,new THREE.Vector2))}for(var x=0;x<u;x++){var T=o[x].vertices;a[x].push(T[g.a],T[g.b],T[g.c])}for(var x=0;x<c;x++){var N=l[x].vertexNormals[f];h[x].push(N.a,N.b,N.c)}v&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),m&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.DirectGeometry.prototype),THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:Infinity}},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},getIndex:function(){return this.index},setIndex:function(e){this.index=e},addAttribute:function(e,t){if(t instanceof THREE.BufferAttribute==0&&t instanceof THREE.InterleavedBufferAttribute==0){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new THREE.BufferAttribute(arguments[1],arguments[2]));return}if(e==="index"){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t);return}this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){delete this.attributes[e]},get drawcalls(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups},get offsets(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups},addDrawCall:function(e,t,n){n!==undefined&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:n!==undefined?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;t!==undefined&&(e.applyToVector3Array(t.array),t.needsUpdate=!0);var n=this.attributes.normal;if(n!==undefined){var r=(new THREE.Matrix3).getNormalMatrix(e);r.applyToVector3Array(n.array),n.needsUpdate=!0}this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere()},rotateX:function(){var e;return function(n){return e===undefined&&(e=new THREE.Matrix4),e.makeRotationX(n),this.applyMatrix(e),this}}(),rotateY:function(){var e;return function(n){return e===undefined&&(e=new THREE.Matrix4),e.makeRotationY(n),this.applyMatrix(e),this}}(),rotateZ:function(){var e;return function(n){return e===undefined&&(e=new THREE.Matrix4),e.makeRotationZ(n),this.applyMatrix(e),this}}(),translate:function(){var e;return function(n,r,i){return e===undefined&&(e=new THREE.Matrix4),e.makeTranslation(n,r,i),this.applyMatrix(e),this}}(),scale:function(){var e;return function(n,r,i){return e===undefined&&(e=new THREE.Matrix4),e.makeScale(n,r,i),this.applyMatrix(e),this}}(),lookAt:function(){var e;return function(n){e===undefined&&(e=new THREE.Object3D),e.lookAt(n),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.center().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e instanceof THREE.Points||e instanceof THREE.Line){var n=new THREE.Float32Attribute(t.vertices.length*3,3),r=new THREE.Float32Attribute(t.colors.length*3,3);this.addAttribute("position",n.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors));if(t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new THREE.Float32Attribute(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e instanceof THREE.Mesh&&t instanceof THREE.Geometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e instanceof THREE.Mesh){var n=t.__directGeometry;if(n===undefined)return this.fromGeometry(t);n.verticesNeedUpdate=t.verticesNeedUpdate,n.normalsNeedUpdate=t.normalsNeedUpdate,n.colorsNeedUpdate=t.colorsNeedUpdate,n.uvsNeedUpdate=t.uvsNeedUpdate,n.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=n}if(t.verticesNeedUpdate===!0){var r=this.attributes.position;r!==undefined&&(r.copyVector3sArray(t.vertices),r.needsUpdate=!0),t.verticesNeedUpdate=!1}if(t.normalsNeedUpdate===!0){var r=this.attributes.normal;r!==undefined&&(r.copyVector3sArray(t.normals),r.needsUpdate=!0),t.normalsNeedUpdate=!1}if(t.colorsNeedUpdate===!0){var r=this.attributes.color;r!==undefined&&(r.copyColorsArray(t.colors),r.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){var r=this.attributes.lineDistance;r!==undefined&&(r.copyArray(t.lineDistances),r.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new THREE.DirectGeometry).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(e.vertices.length*3);this.addAttribute("position",(new THREE.BufferAttribute(t,3)).copyVector3sArray(e.vertices));if(e.normals.length>0){var n=new Float32Array(e.normals.length*3);this.addAttribute("normal",(new THREE.BufferAttribute(n,3)).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(e.colors.length*3);this.addAttribute("color",(new THREE.BufferAttribute(r,3)).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(e.uvs.length*2);this.addAttribute("uv",(new THREE.BufferAttribute(i,2)).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var s=new Float32Array(e.uvs2.length*2);this.addAttribute("uv2",(new THREE.BufferAttribute(s,2)).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var o=e.vertices.length>65535?Uint32Array:Uint16Array,u=new o(e.indices.length*3);this.setIndex((new THREE.BufferAttribute(u,1)).copyIndicesArray(e.indices))}this.groups=e.groups;for(var a in e.morphTargets){var f=[],l=e.morphTargets[a];for(var c=0,h=l.length;c<h;c++){var p=l[c],d=new THREE.Float32Attribute(p.length*3,3);f.push(d.copyVector3sArray(p))}this.morphAttributes[a]=f}if(e.skinIndices.length>0){var v=new THREE.Float32Attribute(e.skinIndices.length*4,4);this.addAttribute("skinIndex",v.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var m=new THREE.Float32Attribute(e.skinWeights.length*4,4);this.addAttribute("skinWeight",m.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){var e=new THREE.Vector3;return function(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);var t=this.attributes.position.array;if(t){var n=this.boundingBox;n.makeEmpty();for(var r=0,i=t.length;r<i;r+=3)e.fromArray(t,r),n.expandByPoint(e)}if(t===undefined||t.length===0)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0);(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();var r=this.boundingSphere.center;for(var i=0,s=n.length;i<s;i+=3)t.fromArray(n,i),e.expandByPoint(t);e.center(r);var o=0;for(var i=0,s=n.length;i<s;i+=3)t.fromArray(n,i),o=Math.max(o,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,n=this.groups;if(t.position){var r=t.position.array;if(t.normal===undefined)this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(r.length),3));else{var i=t.normal.array;for(var s=0,o=i.length;s<o;s++)i[s]=0}var i=t.normal.array,u,a,f,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3;if(e){var v=e.array;n.length===0&&this.addGroup(0,v.length);for(var m=0,g=n.length;m<g;++m){var y=n[m],b=y.start,w=y.count;for(var s=b,o=b+w;s<o;s+=3)u=v[s+0]*3,a=v[s+1]*3,f=v[s+2]*3,l.fromArray(r,u),c.fromArray(r,a),h.fromArray(r,f),p.subVectors(h,c),d.subVectors(l,c),p.cross(d),i[u]+=p.x,i[u+1]+=p.y,i[u+2]+=p.z,i[a]+=p.x,i[a+1]+=p.y,i[a+2]+=p.z,i[f]+=p.x,i[f+1]+=p.y,i[f+2]+=p.z}}else for(var s=0,o=r.length;s<o;s+=9)l.fromArray(r,s),c.fromArray(r,s+3),h.fromArray(r,s+6),p.subVectors(h,c),d.subVectors(l,c),p.cross(d),i[s]=p.x,i[s+1]=p.y,i[s+2]=p.z,i[s+3]=p.x,i[s+4]=p.y,i[s+5]=p.z,i[s+6]=p.x,i[s+7]=p.y,i[s+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(e){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},merge:function(e,t){if(e instanceof THREE.BufferGeometry==0){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===undefined&&(t=0);var n=this.attributes;for(var r in n){if(e.attributes[r]===undefined)continue;var i=n[r],s=i.array,o=e.attributes[r],u=o.array,a=o.itemSize;for(var f=0,l=a*t;f<u.length;f++,l++)s[l]=u[f]}return this},normalizeNormals:function(){var e=this.attributes.normal.array,t,n,r,i;for(var s=0,o=e.length;s<o;s+=3)t=e[s],n=e[s+1],r=e[s+2],i=1/Math.sqrt(t*t+n*n+r*r),e[s]*=i,e[s+1]*=i,e[s+2]*=i},toJSON:function(){var e={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name);if(this.parameters!==undefined){var t=this.parameters;for(var n in t)t[n]!==undefined&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;if(r!==null){var i=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:i}}var s=this.attributes;for(var n in s){var o=s[n],i=Array.prototype.slice.call(o.array);e.data.attributes[n]={itemSize:o.itemSize,type:o.array.constructor.name,array:i}}var u=this.groups;u.length>0&&(e.data.groups=JSON.parse(JSON.stringify(u)));var a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e},clone:function(){return(new this.constructor).copy(this)},copy:function(e){var t=e.index;t!==null&&this.setIndex(t.clone());var n=e.attributes;for(var r in n){var i=n[r];this.addAttribute(r,i.clone())}var s=e.groups;for(var o=0,u=s.length;o<u;o++){var a=s[o];this.addGroup(a.start,a.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.BufferGeometry.MaxIndex=65535,THREE.InstancedBufferGeometry=function(){THREE.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=undefined},THREE.InstancedBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.InstancedBufferGeometry.prototype.constructor=THREE.InstancedBufferGeometry,THREE.InstancedBufferGeometry.prototype.addGroup=function(e,t,n){this.groups.push({start:e,count:t,instances:n})},THREE.InstancedBufferGeometry.prototype.copy=function(e){var t=e.index;t!==null&&this.setIndex(t.clone());var n=e.attributes;for(var r in n){var i=n[r];this.addAttribute(r,i.clone())}var s=e.groups;for(var o=0,u=s.length;o<u;o++){var a=s[o];this.addGroup(a.start,a.count,a.instances)}return this},THREE.EventDispatcher.prototype.apply(THREE.InstancedBufferGeometry.prototype),THREE.AnimationAction=function(e,t,n,r,i){if(e===undefined)throw new Error("clip is null");this.clip=e,this.localRoot=null,this.startTime=t||0,this.timeScale=n||1,this.weight=r||1,this.loop=i||THREE.LoopRepeat,this.loopCount=0,this.enabled=!0,this.actionTime=-this.startTime,this.clipTime=0,this.propertyBindings=[]},THREE.AnimationAction.prototype={constructor:THREE.AnimationAction,setLocalRoot:function(e){return this.localRoot=e,this},updateTime:function(e){var t=this.clipTime,n=this.loopCount,r=this.actionTime,i=this.clip.duration;this.actionTime=this.actionTime+e;if(this.loop===THREE.LoopOnce)return this.loopCount=0,this.clipTime=Math.min(Math.max(this.actionTime,0),i),this.clipTime!==t&&(this.clipTime===i?this.mixer.dispatchEvent({type:"finished",action:this,direction:1}):this.clipTime===0&&this.mixer.dispatchEvent({type:"finished",action:this,direction:-1})),this.clipTime;this.loopCount=Math.floor(this.actionTime/i);var s=this.actionTime-this.loopCount*i;return s%=i,this.loop==THREE.LoopPingPong&&Math.abs(this.loopCount%2)===1&&(s=i-s),this.clipTime=s,this.loopCount!==n&&this.mixer.dispatchEvent({type:"loop",action:this,loopDelta:this.loopCount-this.loopCount}),this.clipTime},syncWith:function(e){return this.actionTime=e.actionTime,this.timeScale=e.timeScale,this},warpToDuration:function(e){return this.timeScale=this.clip.duration/e,this},init:function(e){return this.clipTime=e-this.startTime,this},update:function(e){this.updateTime(e);var t=this.clip.getAt(this.clipTime);return t},getTimeScaleAt:function(e){return this.timeScale.getAt?this.timeScale.getAt(e):this.timeScale},getWeightAt:function(e){return this.weight.getAt?this.weight.getAt(e):this.weight}},THREE.AnimationClip=function(e,t,n){this.name=e,this.tracks=n,this.duration=t!==undefined?t:-1;if(this.duration<0)for(var r=0;r<this.tracks.length;r++){var i=this.tracks[r];this.duration=Math.max(i.keys[i.keys.length-1].time)}this.trim(),this.optimize(),this.results=[]},THREE.AnimationClip.prototype={constructor:THREE.AnimationClip,getAt:function(e){e=Math.max(0,Math.min(e,this.duration));for(var t=0;t<this.tracks.length;t++){var n=this.tracks[t];this.results[t]=n.getAt(e)}return this.results},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},THREE.AnimationClip.CreateFromMorphTargetSequence=function(e,t,n){var r=t.length,i=[];for(var s=0;s<r;s++){var o=[];o.push({time:(s+r-1)%r,value:0}),o.push({time:s,value:1}),o.push({time:(s+1)%r,value:0}),o.sort(THREE.KeyframeTrack.keyComparer),o[0].time===0&&o.push({time:r,value:o[0].value}),i.push((new THREE.NumberKeyframeTrack(".morphTargetInfluences["+t[s].name+"]",o)).scale(1/n))}return new THREE.AnimationClip(e,-1,i)},THREE.AnimationClip.findByName=function(e,t){for(var n=0;n<e.length;n++)if(e[n].name===t)return e[n];return null},THREE.AnimationClip.CreateClipsFromMorphTargetSequences=function(e,t){var n={},r=/^([\w-]*?)([\d]+)$/;for(var i=0,s=e.length;i<s;i++){var o=e[i],u=o.name.match(r);if(u&&u.length>1){var a=u[1],f=n[a];f||(n[a]=f=[]),f.push(o)}}var l=[];for(var a in n)l.push(THREE.AnimationClip.CreateFromMorphTargetSequence(a,n[a],t));return l},THREE.AnimationClip.parse=function(e){var t=[];for(var n=0;n<e.tracks.length;n++)t.push(THREE.KeyframeTrack.parse(e.tracks[n]).scale(1/e.fps));return new THREE.AnimationClip(e.name,e.duration,t)},THREE.AnimationClip.parseAnimation=function(e,t,n){if(!e)return console.error("  no animation in JSONLoader data"),null;var r=function(e,t,n,r,i){var s=[];for(var o=0;o<t.length;o++){var u=t[o];u[n]!==undefined&&s.push({time:u.time,value:i(u)})}return s.length>0?new r(e,s):null},i=[],s=e.name||"default",o=e.length||-1,u=e.fps||30,a=e.hierarchy||[];for(var f=0;f<a.length;f++){var l=a[f].keys;if(!l||l.length==0)continue;if(l[0].morphTargets){var c={};for(var h=0;h<l.length;h++)if(l[h].morphTargets)for(var p=0;p<l[h].morphTargets.length;p++)c[l[h].morphTargets[p]]=-1;for(var d in c){var v=[];for(var p=0;p<l[h].morphTargets.length;p++){var m=l[h];v.push({time:m.time,value:m.morphTarget===d?1:0})}i.push(new THREE.NumberKeyframeTrack(n+".morphTargetInfluence["+d+"]",v))}o=c.length*(u||1)}else{var g=n+".bones["+t[f].name+"]",y=r(g+".position",l,"pos",THREE.VectorKeyframeTrack,function(e){return(new THREE.Vector3).fromArray(e.pos)});y&&i.push(y);var b=r(g+".quaternion",l,"rot",THREE.QuaternionKeyframeTrack,function(e){return e.rot.slerp?e.rot.clone():(new THREE.Quaternion).fromArray(e.rot)});b&&i.push(b);var w=r(g+".scale",l,"scl",THREE.VectorKeyframeTrack,function(e){return(new THREE.Vector3).fromArray(e.scl)});w&&i.push(w)}}if(i.length===0)return null;var E=new THREE.AnimationClip(s,o,i);return E},THREE.AnimationMixer=function(e){this.root=e,this.time=0,this.timeScale=1,this.actions=[],this.propertyBindingMap={}},THREE.AnimationMixer.prototype={constructor:THREE.AnimationMixer,addAction:function(e){this.actions.push(e),e.init(this.time),e.mixer=this;var t=e.clip.tracks,n=e.localRoot||this.root;for(var r=0;r<t.length;r++){var i=t[r],s=n.uuid+"-"+i.name,o=this.propertyBindingMap[s];o===undefined&&(o=new THREE.PropertyBinding(n,i.name),this.propertyBindingMap[s]=o),e.propertyBindings.push(o),o.referenceCount+=1}},removeAllActions:function(){for(var e=0;e<this.actions.length;e++)this.actions[e].mixer=null;for(var t in this.propertyBindingMap)this.propertyBindingMap[t].unbind();return this.actions=[],this.propertyBindingMap={},this},removeAction:function(e){var t=this.actions.indexOf(e);t!==-1&&(this.actions.splice(t,1),e.mixer=null);var n=e.localRoot||this.root,r=e.clip.tracks;for(var i=0;i<r.length;i++){var s=r[i],o=n.uuid+"-"+s.name,u=this.propertyBindingMap[o];u.referenceCount-=1,u.referenceCount<=0&&(u.unbind(),delete this.propertyBindingMap[o])}return this},findActionByName:function(e){for(var t=0;t<this.actions.length;t++)if(this.actions[t].name===e)return this.actions[t];return null},play:function(e,t){return e.startTime=this.time,this.addAction(e),this},fadeOut:function(e,t){var n=[];return n.push({time:this.time,value:1}),n.push({time:this.time+t,value:0}),e.weight=new THREE.NumberKeyframeTrack("weight",n),this},fadeIn:function(e,t){var n=[];return n.push({time:this.time,value:0}),n.push({time:this.time+t,value:1}),e.weight=new THREE.NumberKeyframeTrack("weight",n),this},warp:function(e,t,n,r){var i=[];return i.push({time:this.time,value:t}),i.push({time:this.time+r,value:n}),e.timeScale=new THREE.NumberKeyframeTrack("timeScale",i),this},crossFade:function(e,t,n,r){this.fadeOut(e,n),this.fadeIn(t,n);if(r){var i=e.clip.duration/t.clip.duration,s=1/i;this.warp(e,1,i,n),this.warp(t,s,1,n)}return this},update:function(e){var t=e*this.timeScale;this.time+=t;for(var n=0;n<this.actions.length;n++){var r=this.actions[n],i=r.getWeightAt(this.time),s=r.getTimeScaleAt(this.time),o=t*s,u=r.update(o);if(r.weight<=0||!r.enabled)continue;for(var a=0;a<u.length;a++){var f=r.clip.tracks[a].name;r.propertyBindings[a].accumulate(u[a],i)}}for(var l in this.propertyBindingMap)this.propertyBindingMap[l].apply();return this}},THREE.EventDispatcher.prototype.apply(THREE.AnimationMixer.prototype),THREE.AnimationUtils={getEqualsFunc:function(e){return e.equals?function(t,n){return t.equals(n)}:function(t,n){return t===n}},clone:function(e){var t=typeof e;if(t==="object"){if(e.clone)return e.clone();console.error("can not figure out how to copy exemplarValue",e)}return e},lerp:function(e,t,n,r){var i=THREE.AnimationUtils.getLerpFunc(e,r);return i(e,t,n)},lerp_object:function(e,t,n){return e.lerp(t,n)},slerp_object:function(e,t,n){return e.slerp(t,n)},lerp_number:function(e,t,n){return e*(1-n)+t*n},lerp_boolean:function(e,t,n){return n<.5?e:t},lerp_boolean_immediate:function(e,t,n){return e},lerp_string:function(e,t,n){return n<.5?e:t},lerp_string_immediate:function(e,t,n){return e},getLerpFunc:function(e,t){if(e===undefined||e===null)throw new Error("examplarValue is null");var n=typeof e;switch(n){case"object":if(e.lerp)return THREE.AnimationUtils.lerp_object;if(e.slerp)return THREE.AnimationUtils.slerp_object;break;case"number":return THREE.AnimationUtils.lerp_number;case"boolean":return t?THREE.AnimationUtils.lerp_boolean:THREE.AnimationUtils.lerp_boolean_immediate;case"string":return t?THREE.AnimationUtils.lerp_string:THREE.AnimationUtils.lerp_string_immediate}}},THREE.KeyframeTrack=function(e,t){if(e===undefined)throw new Error("track name is undefined");if(t===undefined||t.length===0)throw new Error("no keys in track named "+e);this.name=e,this.keys=t,this.lastIndex=0,this.validate(),this.optimize()},THREE.KeyframeTrack.prototype={constructor:THREE.KeyframeTrack,getAt:function(e){while(this.lastIndex<this.keys.length&&e>=this.keys[this.lastIndex].time)this.lastIndex++;while(this.lastIndex>0&&e<this.keys[this.lastIndex-1].time)this.lastIndex--;if(this.lastIndex>=this.keys.length)return this.setResult(this.keys[this.keys.length-1].value),this.result;if(this.lastIndex===0)return this.setResult(this.keys[0].value),this.result;var t=this.keys[this.lastIndex-1];this.setResult(t.value);if(t.constantToNext)return this.result;var n=this.keys[this.lastIndex],r=(e-t.time)/(n.time-t.time);return this.result=this.lerpValues(this.result,n.value,r),this.result},shift:function(e){if(e!==0)for(var t=0;t<this.keys.length;t++)this.keys[t].time+=e;return this},scale:function(e){if(e!==1)for(var t=0;t<this.keys.length;t++)this.keys[t].time*=e;return this},trim:function(e,t){var n=0;for(var r=1;r<this.keys.length;r++)this.keys[r]<=e&&n++;var i=0;for(var r=this.keys.length-2;r>0;r++){if(!(this.keys[r]>=t))break;i++}return n+i>0&&(this.keys=this.keys.splice(n,this.keys.length-i-n)),this},validate:function(){var e=null;if(this.keys.length===0){console.error("  track is empty, no keys",this);return}for(var t=0;t<this.keys.length;t++){var n=this.keys[t];if(!n){console.error("  key is null in track",this,t);return}if(typeof n.time!="number"||Number.isNaN(n.time)){console.error("  key.time is not a valid number",this,t,n);return}if(n.value===undefined||n.value===null){console.error("  key.value is null in track",this,t,n);return}if(e&&e.time>n.time){console.error("  key.time is less than previous key time, out of order keys",this,t,n,e);return}e=n}return this},optimize:function(){var e=[],t=this.keys[0];e.push(t);var n=THREE.AnimationUtils.getEqualsFunc(t.value);for(var r=1;r<this.keys.length-1;r++){var i=this.keys[r],s=this.keys[r+1];if(t.time===i.time)continue;if(this.compareValues(t.value,i.value)&&this.compareValues(i.value,s.value))continue;t.constantToNext=this.compareValues(t.value,i.value),e.push(i),t=i}return e.push(this.keys[this.keys.length-1]),this.keys=e,this}},THREE.KeyframeTrack.keyComparer=function(t,n){return t.time-n.time},THREE.KeyframeTrack.parse=function(e){if(e.type===undefined)throw new Error("track type undefined, can not parse");var t=THREE.KeyframeTrack.GetTrackTypeForTypeName(e.type);return t.parse(e)},THREE.KeyframeTrack.GetTrackTypeForTypeName=function(e){switch(e.toLowerCase()){case"vector":case"vector2":case"vector3":case"vector4":return THREE.VectorKeyframeTrack;case"quaternion":return THREE.QuaternionKeyframeTrack;case"integer":case"scalar":case"double":case"float":case"number":return THREE.NumberKeyframeTrack;case"bool":case"boolean":return THREE.BooleanKeyframeTrack;case"string":return THREE.StringKeyframeTrack}throw new Error("Unsupported typeName: "+e)},THREE.PropertyBinding=function(e,t){this.rootNode=e,this.trackName=t,this.referenceCount=0,this.originalValue=null;var n=THREE.PropertyBinding.parseTrackName(t);this.directoryName=n.directoryName,this.nodeName=n.nodeName,this.objectName=n.objectName,this.objectIndex=n.objectIndex,this.propertyName=n.propertyName,this.propertyIndex=n.propertyIndex,this.node=THREE.PropertyBinding.findNode(e,this.nodeName)||e,this.cumulativeValue=null,this.cumulativeWeight=0},THREE.PropertyBinding.prototype={constructor:THREE.PropertyBinding,reset:function(){this.cumulativeValue=null,this.cumulativeWeight=0},accumulate:function(e,t){this.isBound||this.bind();if(this.cumulativeWeight===0)t>0&&(this.cumulativeValue===null&&(this.cumulativeValue=THREE.AnimationUtils.clone(e)),this.cumulativeWeight=t);else{var n=t/(this.cumulativeWeight+t);this.cumulativeValue=this.lerpValue(this.cumulativeValue,e,n),this.cumulativeWeight+=t}},unbind:function(){if(!this.isBound)return;this.setValue(this.originalValue),this.setValue=null,this.getValue=null,this.lerpValue=null,this.equalsValue=null,this.triggerDirty=null,this.isBound=!1},bind:function(){if(this.isBound)return;var e=this.node;if(!e){console.error("  trying to update node for track: "+this.trackName+" but it wasn't found.");return}if(this.objectName){if(this.objectName==="materials"){if(!e.material){console.error("  can not bind to material as node does not have a material",this);return}if(!e.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}e=e.material.materials}else if(this.objectName==="bones"){if(!e.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}e=e.skeleton.bones;for(var t=0;t<e.length;t++)if(e[t].name===this.objectIndex){this.objectIndex=t;break}}else{if(e[this.objectName]===undefined){console.error("  can not bind to objectName of node, undefined",this);return}e=e[this.objectName]}if(this.objectIndex!==undefined){if(e[this.objectIndex]===undefined){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,e);return}e=e[this.objectIndex]}}var n=e[this.propertyName];if(!n){console.error("  trying to update property for track: "+this.nodeName+"."+this.propertyName+" but it wasn't found.",e);return}if(this.propertyIndex!==undefined){if(this.propertyName==="morphTargetInfluences"){e.geometry||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this),e.geometry.morphTargets||console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(var t=0;t<this.node.geometry.morphTargets.length;t++)if(e.geometry.morphTargets[t].name===this.propertyIndex){this.propertyIndex=t;break}}this.setValue=function(t){return this.equalsValue(n[this.propertyIndex],t)?!1:(n[this.propertyIndex]=t,!0)},this.getValue=function(){return n[this.propertyIndex]}}else n.copy?(this.setValue=function(t){return this.equalsValue(n,t)?!1:(n.copy(t),!0)},this.getValue=function(){return n}):(this.setValue=function(n){return this.equalsValue(e[this.propertyName],n)?!1:(e[this.propertyName]=n,!0)},this.getValue=function(){return e[this.propertyName]});e.needsUpdate!==undefined?this.triggerDirty=function(){this.node.needsUpdate=!0}:e.matrixWorldNeedsUpdate!==undefined&&(this.triggerDirty=function(){e.matrixWorldNeedsUpdate=!0}),this.originalValue=this.getValue(),this.equalsValue=THREE.AnimationUtils.getEqualsFunc(this.originalValue),this.lerpValue=THREE.AnimationUtils.getLerpFunc(this.originalValue,!0),this.isBound=!0},apply:function(){this.isBound||this.bind();if(this.cumulativeWeight>0){if(this.cumulativeWeight<1){var e=1-this.cumulativeWeight,t=e/(this.cumulativeWeight+e);this.cumulativeValue=this.lerpValue(this.cumulativeValue,this.originalValue,t)}var n=this.setValue(this.cumulativeValue);n&&this.triggerDirty&&this.triggerDirty(),this.cumulativeValue=null,this.cumulativeWeight=0}}},THREE.PropertyBinding.parseTrackName=function(e){var t=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_. ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,n=t.exec(e);if(!n)throw new Error("cannot parse trackName at all: "+e);n.index===t.lastIndex&&t.lastIndex++;var r={directoryName:n[1],nodeName:n[3],objectName:n[5],objectIndex:n[7],propertyName:n[9],propertyIndex:n[11]};if(r.propertyName===null||r.propertyName.length===0)throw new Error("can not parse propertyName from trackName: "+e);return r},THREE.PropertyBinding.findNode=function(e,t){if(!t||t===""||t==="root"||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=function(e){for(var n=0;n<e.bones.length;n++){var r=e.bones[n];if(r.name===t)return r}return null},r=n(e.skeleton);if(r)return r}if(e.children){var i=function(e){for(var n=0;n<e.length;n++){var r=e[n];if(r.name===t||r.uuid===t)return r;var s=i(r.children);if(s)return s}return null},s=i(e.children);if(s)return s}return null},THREE.VectorKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},THREE.VectorKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.VectorKeyframeTrack.prototype.constructor=THREE.VectorKeyframeTrack,THREE.VectorKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},THREE.VectorKeyframeTrack.prototype.lerpValues=function(e,t,n){return e.lerp(t,n)},THREE.VectorKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},THREE.VectorKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var n=this.keys[t];e.push({time:n.time,value:n.value.clone()})}return new THREE.VectorKeyframeTrack(this.name,e)},THREE.VectorKeyframeTrack.parse=function(e){var t=e.keys[0].value.length,n=THREE["Vector"+t],r=[];for(var i=0;i<e.keys.length;i++){var s=e.keys[i];r.push({value:(new n).fromArray(s.value),time:s.time})}return new THREE.VectorKeyframeTrack(e.name,r)},THREE.QuaternionKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value.clone()},THREE.QuaternionKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.QuaternionKeyframeTrack.prototype.constructor=THREE.QuaternionKeyframeTrack,THREE.QuaternionKeyframeTrack.prototype.setResult=function(e){this.result.copy(e)},THREE.QuaternionKeyframeTrack.prototype.lerpValues=function(e,t,n){return e.slerp(t,n)},THREE.QuaternionKeyframeTrack.prototype.compareValues=function(e,t){return e.equals(t)},THREE.QuaternionKeyframeTrack.prototype.multiply=function(e){for(var t=0;t<this.keys.length;t++)this.keys[t].value.multiply(e);return this},THREE.QuaternionKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var n=this.keys[t];e.push({time:n.time,value:n.value.clone()})}return new THREE.QuaternionKeyframeTrack(this.name,e)},THREE.QuaternionKeyframeTrack.parse=function(e){var t=[];for(var n=0;n<e.keys.length;n++){var r=e.keys[n];t.push({value:(new THREE.Quaternion).fromArray(r.value),time:r.time})}return new THREE.QuaternionKeyframeTrack(e.name,t)},THREE.StringKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},THREE.StringKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.StringKeyframeTrack.prototype.constructor=THREE.StringKeyframeTrack,THREE.StringKeyframeTrack.prototype.setResult=function(e){this.result=e},THREE.StringKeyframeTrack.prototype.lerpValues=function(e,t,n){return n<1?e:t},THREE.StringKeyframeTrack.prototype.compareValues=function(e,t){return e===t},THREE.StringKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var n=this.keys[t];e.push({time:n.time,value:n.value})}return new THREE.StringKeyframeTrack(this.name,e)},THREE.StringKeyframeTrack.parse=function(e){return new THREE.StringKeyframeTrack(e.name,e.keys)},THREE.BooleanKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},THREE.BooleanKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.BooleanKeyframeTrack.prototype.constructor=THREE.BooleanKeyframeTrack,THREE.BooleanKeyframeTrack.prototype.setResult=function(e){this.result=e},THREE.BooleanKeyframeTrack.prototype.lerpValues=function(e,t,n){return n<1?e:t},THREE.BooleanKeyframeTrack.prototype.compareValues=function(e,t){return e===t},THREE.BooleanKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var n=this.keys[t];e.push({time:n.time,value:n.value})}return new THREE.BooleanKeyframeTrack(this.name,e)},THREE.BooleanKeyframeTrack.parse=function(e){return new THREE.BooleanKeyframeTrack(e.name,e.keys)},THREE.NumberKeyframeTrack=function(e,t){THREE.KeyframeTrack.call(this,e,t),this.result=this.keys[0].value},THREE.NumberKeyframeTrack.prototype=Object.create(THREE.KeyframeTrack.prototype),THREE.NumberKeyframeTrack.prototype.constructor=THREE.NumberKeyframeTrack,THREE.NumberKeyframeTrack.prototype.setResult=function(e){this.result=e},THREE.NumberKeyframeTrack.prototype.lerpValues=function(e,t,n){return e*(1-n)+t*n},THREE.NumberKeyframeTrack.prototype.compareValues=function(e,t){return e===t},THREE.NumberKeyframeTrack.prototype.clone=function(){var e=[];for(var t=0;t<this.keys.length;t++){var n=this.keys[t];e.push({time:n.time,value:n.value})}return new THREE.NumberKeyframeTrack(this.name,e)},THREE.NumberKeyframeTrack.parse=function(e){return new THREE.NumberKeyframeTrack(e.name,e.keys)},THREE.Camera=function(){THREE.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.constructor=THREE.Camera,THREE.Camera.prototype.getWorldDirection=function(){var e=new THREE.Quaternion;return function(t){var n=t||new THREE.Vector3;return this.getWorldQuaternion(e),n.set(0,0,-1).applyQuaternion(e)}}(),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},THREE.Camera.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this),this.type="CubeCamera";var r=90,i=1,s=new THREE.PerspectiveCamera(r,i,e,t);s.up.set(0,-1,0),s.lookAt(new THREE.Vector3(1,0,0)),this.add(s);var o=new THREE.PerspectiveCamera(r,i,e,t);o.up.set(0,-1,0),o.lookAt(new THREE.Vector3(-1,0,0)),this.add(o);var u=new THREE.PerspectiveCamera(r,i,e,t);u.up.set(0,0,1),u.lookAt(new THREE.Vector3(0,1,0)),this.add(u);var a=new THREE.PerspectiveCamera(r,i,e,t);a.up.set(0,0,-1),a.lookAt(new THREE.Vector3(0,-1,0)),this.add(a);var f=new THREE.PerspectiveCamera(r,i,e,t);f.up.set(0,-1,0),f.lookAt(new THREE.Vector3(0,0,1)),this.add(f);var l=new THREE.PerspectiveCamera(r,i,e,t);l.up.set(0,-1,0),l.lookAt(new THREE.Vector3(0,0,-1)),this.add(l),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){this.parent===null&&this.updateMatrixWorld();var n=this.renderTarget,r=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,s,n),n.activeCubeFace=1,e.render(t,o,n),n.activeCubeFace=2,e.render(t,u,n),n.activeCubeFace=3,e.render(t,a,n),n.activeCubeFace=4,e.render(t,f,n),n.generateMipmaps=r,n.activeCubeFace=5,e.render(t,l,n),e.setRenderTarget(null)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CubeCamera.prototype.constructor=THREE.CubeCamera,THREE.OrthographicCamera=function(e,t,n,r,i,s){THREE.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i!==undefined?i:.1,this.far=s!==undefined?s:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera,THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(n-e,n+e,r+t,r-t,this.near,this.far)},THREE.OrthographicCamera.prototype.copy=function(e){return THREE.Camera.prototype.copy.call(this,e),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},THREE.OrthographicCamera.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,t},THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=e!==undefined?e:50,this.aspect=t!==undefined?t:1,this.near=n!==undefined?n:.1,this.far=r!==undefined?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera,THREE.PerspectiveCamera.prototype.setLens=function(e,t){t===undefined&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(e*2))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=THREE.Math.radToDeg(2*Math.atan(Math.tan(THREE.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var t=this.fullWidth/this.fullHeight,n=Math.tan(THREE.Math.degToRad(e*.5))*this.near,r=-n,i=t*r,s=t*n,o=Math.abs(s-i),u=Math.abs(n-r);this.projectionMatrix.makeFrustum(i+this.x*o/this.fullWidth,i+(this.x+this.width)*o/this.fullWidth,n-(this.y+this.height)*u/this.fullHeight,n-this.y*u/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.copy=function(e){return THREE.Camera.prototype.copy.call(this,e),this.fov=e.fov,this.aspect=e.aspect,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this},THREE.PerspectiveCamera.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.fov=this.fov,t.object.aspect=this.aspect,t.object.near=this.near,t.object.far=this.far,t},THREE.Light=function(e){THREE.Object3D.call(this),this.type="Light",this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.constructor=THREE.Light,THREE.Light.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.color.copy(e.color),this},THREE.AmbientLight=function(e){THREE.Light.call(this,e),this.type="AmbientLight"},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.constructor=THREE.AmbientLight,THREE.AmbientLight.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t},THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new THREE.Object3D,this.intensity=t!==undefined?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight,THREE.DirectionalLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.target=e.target.clone(),this.castShadow=e.castShadow,this.onlyShadow=e.onlyShadow,this.shadowCameraNear=e.shadowCameraNear,this.shadowCameraFar=e.shadowCameraFar,this.shadowCameraLeft=e.shadowCameraLeft,this.shadowCameraRight=e.shadowCameraRight,this.shadowCameraTop=e.shadowCameraTop,this.shadowCameraBottom=e.shadowCameraBottom,this.shadowCameraVisible=e.shadowCameraVisible,this.shadowBias=e.shadowBias,this.shadowDarkness=e.shadowDarkness,this.shadowMapWidth=e.shadowMapWidth,this.shadowMapHeight=e.shadowMapHeight,this},THREE.DirectionalLight.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t},THREE.HemisphereLight=function(e,t,n){THREE.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new THREE.Color(t),this.intensity=n!==undefined?n:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight,THREE.HemisphereLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this.intensity=e.intensity,this},THREE.HemisphereLight.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.groundColor=this.groundColor.getHex(),t.object.intensity=this.intensity,t},THREE.PointLight=function(e,t,n,r){THREE.Light.call(this,e),this.type="PointLight",this.intensity=t!==undefined?t:1,this.distance=n!==undefined?n:0,this.decay=r!==undefined?r:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=1,this.shadowCameraFar=500,this.shadowCameraFov=90,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.constructor=THREE.PointLight,THREE.PointLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.decay=e.decay,this.castShadow=e.castShadow,this.onlyShadow=e.onlyShadow,this.shadowCameraNear=e.shadowCameraNear,this.shadowCameraFar=e.shadowCameraFar,this.shadowCameraFov=e.shadowCameraFov,this.shadowCameraVisible=e.shadowCameraVisible,this.shadowBias=e.shadowBias,this.shadowDarkness=e.shadowDarkness,this.shadowMapWidth=e.shadowMapWidth,this.shadowMapHeight=e.shadowMapHeight,this},THREE.PointLight.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t.object.distance=this.distance,t.object.decay=this.decay,t},THREE.SpotLight=function(e,t,n,r,i,s){THREE.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new THREE.Object3D,this.intensity=t!==undefined?t:1,this.distance=n!==undefined?n:0,this.angle=r!==undefined?r:Math.PI/3,this.exponent=i!==undefined?i:10,this.decay=s!==undefined?s:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.constructor=THREE.SpotLight,THREE.SpotLight.prototype.copy=function(e){return THREE.Light.prototype.copy.call(this,e),this.intensity=e.intensity,this.distance=e.distance,this.angle=e.angle,this.exponent=e.exponent,this.decay=e.decay,this.target=e.target.clone(),this.castShadow=e.castShadow,this.onlyShadow=e.onlyShadow,this.shadowCameraNear=e.shadowCameraNear,this.shadowCameraFar=e.shadowCameraFar,this.shadowCameraFov=e.shadowCameraFov,this.shadowCameraVisible=e.shadowCameraVisible,this.shadowBias=e.shadowBias,this.shadowDarkness=e.shadowDarkness,this.shadowMapWidth=e.shadowMapWidth,this.shadowMapHeight=e.shadowMapHeight,this},THREE.SpotLight.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t.object.distance=this.distance,t.object.angle=this.angle,t.object.exponent=this.exponent,t.object.decay=this.decay,t},THREE.Cache={enabled:!1,files:{},add:function(e,t){if(this.enabled===!1)return;this.files[e]=t},get:function(e){if(this.enabled===!1)return;return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},THREE.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:undefined,extractUrlBase:function(e){var t=e.split("/");return t.length===1?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,n){var r=[];for(var i=0;i<e.length;++i)r[i]=this.createMaterial(e[i],t,n);return r},createMaterial:function(){var e;return function(n,r,i){function o(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function u(t,n,s,u,a,f,l){var c=r+s,h,p=THREE.Loader.Handlers.get(c);p!==null?h=p.load(c):(h=new THREE.Texture,p=e,p.setCrossOrigin(i),p.load(c,function(e){if(THREE.Math.isPowerOfTwo(e.width)===!1||THREE.Math.isPowerOfTwo(e.height)===!1){var t=o(e.width),n=o(e.height),r=document.createElement("canvas");r.width=t,r.height=n;var i=r.getContext("2d");i.drawImage(e,0,0,t,n),h.image=r}else h.image=e;h.needsUpdate=!0})),h.sourceFile=s,u&&(h.repeat.set(u[0],u[1]),u[0]!==1&&(h.wrapS=THREE.RepeatWrapping),u[1]!==1&&(h.wrapT=THREE.RepeatWrapping)),a&&h.offset.set(a[0],a[1]);if(f){var d={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};d[f[0]]!==undefined&&(h.wrapS=d[f[0]]),d[f[1]]!==undefined&&(h.wrapT=d[f[1]])}l&&(h.anisotropy=l),t[n]=h}function a(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var s=this;i===undefined&&s.crossOrigin!==undefined&&(i=s.crossOrigin),e===undefined&&(e=new THREE.ImageLoader);var f="MeshLambertMaterial",l={};if(n.shading){var c=n.shading.toLowerCase();c==="phong"?f="MeshPhongMaterial":c==="basic"&&(f="MeshBasicMaterial")}n.blending!==undefined&&THREE[n.blending]!==undefined&&(l.blending=THREE[n.blending]),n.transparent!==undefined&&(l.transparent=n.transparent),n.opacity!==undefined&&n.opacity<1&&(l.transparent=!0),n.depthTest!==undefined&&(l.depthTest=n.depthTest),n.depthWrite!==undefined&&(l.depthWrite=n.depthWrite),n.visible!==undefined&&(l.visible=n.visible),n.flipSided!==undefined&&(l.side=THREE.BackSide),n.doubleSided!==undefined&&(l.side=THREE.DoubleSide),n.wireframe!==undefined&&(l.wireframe=n.wireframe),n.vertexColors!==undefined&&(n.vertexColors==="face"?l.vertexColors=THREE.FaceColors:n.vertexColors&&(l.vertexColors=THREE.VertexColors)),n.colorDiffuse?l.color=a(n.colorDiffuse):n.DbgColor&&(l.color=n.DbgColor),n.colorEmissive&&(l.emissive=a(n.colorEmissive)),f==="MeshPhongMaterial"&&(n.colorSpecular&&(l.specular=a(n.colorSpecular)),n.specularCoef&&(l.shininess=n.specularCoef)),n.transparency!==undefined&&(console.warn("THREE.Loader: transparency has been renamed to opacity"),n.opacity=n.transparency),n.opacity!==undefined&&(l.opacity=n.opacity),r&&(n.mapDiffuse&&u(l,"map",n.mapDiffuse,n.mapDiffuseRepeat,n.mapDiffuseOffset,n.mapDiffuseWrap,n.mapDiffuseAnisotropy),n.mapLight&&u(l,"lightMap",n.mapLight,n.mapLightRepeat,n.mapLightOffset,n.mapLightWrap,n.mapLightAnisotropy),n.mapAO&&u(l,"aoMap",n.mapAO,n.mapAORepeat,n.mapAOOffset,n.mapAOWrap,n.mapAOAnisotropy),n.mapBump&&u(l,"bumpMap",n.mapBump,n.mapBumpRepeat,n.mapBumpOffset,n.mapBumpWrap,n.mapBumpAnisotropy),n.mapNormal&&u(l,"normalMap",n.mapNormal,n.mapNormalRepeat,n.mapNormalOffset,n.mapNormalWrap,n.mapNormalAnisotropy),n.mapSpecular&&u(l,"specularMap",n.mapSpecular,n.mapSpecularRepeat,n.mapSpecularOffset,n.mapSpecularWrap,n.mapSpecularAnisotropy),n.mapAlpha&&u(l,"alphaMap",n.mapAlpha,n.mapAlphaRepeat,n.mapAlphaOffset,n.mapAlphaWrap,n.mapAlphaAnisotropy)),n.mapBumpScale&&(l.bumpScale=n.mapBumpScale),n.mapNormalFactor&&(l.normalScale=new THREE.Vector2(n.mapNormalFactor,n.mapNormalFactor));var h=new THREE[f](l);return n.DbgName!==undefined&&(h.name=n.DbgName),h}}()},THREE.Loader.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=0,n=this.handlers.length;t<n;t+=2){var r=this.handlers[t],i=this.handlers[t+1];if(r.test(e))return i}return null}},THREE.XHRLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,n,r){var i=this,s=THREE.Cache.get(e);if(s!==undefined)return t&&setTimeout(function(){t(s)},0),s;var o=new XMLHttpRequest;return o.open("GET",e,!0),o.addEventListener("load",function(n){THREE.Cache.add(e,this.response),t&&t(this.response),i.manager.itemEnd(e)},!1),n!==undefined&&o.addEventListener("progress",function(e){n(e)},!1),o.addEventListener("error",function(t){r&&r(t),i.manager.itemError(e)},!1),this.crossOrigin!==undefined&&(o.crossOrigin=this.crossOrigin),this.responseType!==undefined&&(o.responseType=this.responseType),this.withCredentials!==undefined&&(o.withCredentials=this.withCredentials),o.send(null),i.manager.itemStart(e),o},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e},setWithCredentials:function(e){this.withCredentials=e}},THREE.ImageLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,n,r){var i=this,s=THREE.Cache.get(e);if(s!==undefined)return t&&setTimeout(function(){t(s)},0),s;var o=document.createElement("img");return o.addEventListener("load",function(n){THREE.Cache.add(e,this),t&&t(this),i.manager.itemEnd(e)},!1),n!==undefined&&o.addEventListener("progress",function(e){n(e)},!1),o.addEventListener("error",function(t){r&&r(t),i.manager.itemError(e)},!1),this.crossOrigin!==undefined&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){typeof e=="boolean"&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=undefined),this.manager=e!==undefined?e:THREE.DefaultLoadingManager,this.withCredentials=!1},THREE.JSONLoader.prototype={constructor:THREE.JSONLoader,get statusDomElement(){return this._statusDomElement===undefined&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(e,t,n,r){var i=this,s=this.texturePath&&typeof this.texturePath=="string"?this.texturePath:THREE.Loader.prototype.extractUrlBase(e),o=new THREE.XHRLoader(this.manager);o.setCrossOrigin(this.crossOrigin),o.setWithCredentials(this.withCredentials),o.load(e,function(n){var r=JSON.parse(n),o=r.metadata;if(o!==undefined){if(o.type==="object"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");return}if(o.type==="scene"){console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.");return}}var u=i.parse(r,s);t(u.geometry,u.materials)})},setCrossOrigin:function(e){this.crossOrigin=e},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){function i(t){function r(e,t){return e&1<<t}var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M=e.faces,_=e.vertices,D=e.normals,P=e.colors,H=0;if(e.uvs!==undefined){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&H++;for(i=0;i<H;i++)n.faceVertexUvs[i]=[]}u=0,a=_.length;while(u<a)E=new THREE.Vector3,E.x=_[u++]*t,E.y=_[u++]*t,E.z=_[u++]*t,n.vertices.push(E);u=0,a=M.length;while(u<a){p=M[u++],d=r(p,0),v=r(p,1),m=r(p,3),g=r(p,4),y=r(p,5),b=r(p,6),w=r(p,7);if(d){x=new THREE.Face3,x.a=M[u],x.b=M[u+1],x.c=M[u+3],T=new THREE.Face3,T.a=M[u+1],T.b=M[u+2],T.c=M[u+3],u+=4,v&&(h=M[u++],x.materialIndex=h,T.materialIndex=h),o=n.faces.length;if(m)for(i=0;i<H;i++){k=e.uvs[i],n.faceVertexUvs[i][o]=[],n.faceVertexUvs[i][o+1]=[];for(s=0;s<4;s++)c=M[u++],A=k[c*2],O=k[c*2+1],L=new THREE.Vector2(A,O),s!==2&&n.faceVertexUvs[i][o].push(L),s!==0&&n.faceVertexUvs[i][o+1].push(L)}g&&(l=M[u++]*3,x.normal.set(D[l++],D[l++],D[l]),T.normal.copy(x.normal));if(y)for(i=0;i<4;i++)l=M[u++]*3,C=new THREE.Vector3(D[l++],D[l++],D[l]),i!==2&&x.vertexNormals.push(C),i!==0&&T.vertexNormals.push(C);b&&(f=M[u++],N=P[f],x.color.setHex(N),T.color.setHex(N));if(w)for(i=0;i<4;i++)f=M[u++],N=P[f],i!==2&&x.vertexColors.push(new THREE.Color(N)),i!==0&&T.vertexColors.push(new THREE.Color(N));n.faces.push(x),n.faces.push(T)}else{S=new THREE.Face3,S.a=M[u++],S.b=M[u++],S.c=M[u++],v&&(h=M[u++],S.materialIndex=h),o=n.faces.length;if(m)for(i=0;i<H;i++){k=e.uvs[i],n.faceVertexUvs[i][o]=[];for(s=0;s<3;s++)c=M[u++],A=k[c*2],O=k[c*2+1],L=new THREE.Vector2(A,O),n.faceVertexUvs[i][o].push(L)}g&&(l=M[u++]*3,S.normal.set(D[l++],D[l++],D[l]));if(y)for(i=0;i<3;i++)l=M[u++]*3,C=new THREE.Vector3(D[l++],D[l++],D[l]),S.vertexNormals.push(C);b&&(f=M[u++],S.color.setHex(P[f]));if(w)for(i=0;i<3;i++)f=M[u++],S.vertexColors.push(new THREE.Color(P[f]));n.faces.push(S)}}}function s(){var t=e.influencesPerVertex!==undefined?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,i=e.skinWeights.length;r<i;r+=t){var s=e.skinWeights[r],o=t>1?e.skinWeights[r+1]:0,u=t>2?e.skinWeights[r+2]:0,a=t>3?e.skinWeights[r+3]:0;n.skinWeights.push(new THREE.Vector4(s,o,u,a))}if(e.skinIndices)for(var r=0,i=e.skinIndices.length;r<i;r+=t){var f=e.skinIndices[r],l=t>1?e.skinIndices[r+1]:0,c=t>2?e.skinIndices[r+2]:0,h=t>3?e.skinIndices[r+3]:0;n.skinIndices.push(new THREE.Vector4(f,l,c,h))}n.bones=e.bones,n.bones&&n.bones.length>0&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&console.warn("When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match.")}function o(t){if(e.morphTargets!==undefined){var r,i,s,o,u,a;for(r=0,i=e.morphTargets.length;r<i;r++){n.morphTargets[r]={},n.morphTargets[r].name=e.morphTargets[r].name,n.morphTargets[r].vertices=[],u=n.morphTargets[r].vertices,a=e.morphTargets[r].vertices;for(s=0,o=a.length;s<o;s+=3){var f=new THREE.Vector3;f.x=a[s]*t,f.y=a[s+1]*t,f.z=a[s+2]*t,u.push(f)}}}if(e.morphColors!==undefined){var r,i,l,c,h,p,d;for(r=0,i=e.morphColors.length;r<i;r++){n.morphColors[r]={},n.morphColors[r].name=e.morphColors[r].name,n.morphColors[r].colors=[],h=n.morphColors[r].colors,p=e.morphColors[r].colors;for(l=0,c=p.length;l<c;l+=3)d=new THREE.Color(16755200),d.setRGB(p[l],p[l+1],p[l+2]),h.push(d)}}}function u(){var t=[],r=[];e.animation!==undefined&&r.push(e.animation),e.animations!==undefined&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var i=0;i<r.length;i++){var s=THREE.AnimationClip.parseAnimation(r[i],n.bones);s&&t.push(s)}if(n.morphTargets){var o=THREE.AnimationClip.CreateClipsFromMorphTargetSequences(n.morphTargets,10);t=t.concat(o)}t.length>0&&(n.animations=t)}var n=new THREE.Geometry,r=e.scale!==undefined?1/e.scale:1;i(r),s(),o(r),u(),n.computeFaceNormals(),n.computeBoundingSphere();if(e.materials===undefined||e.materials.length===0)return{geometry:n};var a=THREE.Loader.prototype.initMaterials(e.materials,t,this.crossOrigin);return{geometry:n,materials:a}}},THREE.LoadingManager=function(e,t,n){var r=this,i=!1,s=0,o=0;this.onStart=undefined,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,i===!1&&r.onStart!==undefined&&r.onStart(e,s,o),i=!0},this.itemEnd=function(e){s++,r.onProgress!==undefined&&r.onProgress(e,s,o),s===o&&(i=!1,r.onLoad!==undefined&&r.onLoad())},this.itemError=function(e){r.onError!==undefined&&r.onError(e)}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,n,r){var i=this,s=new THREE.XHRLoader(i.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry,n=e.data.index;if(n!==undefined){var r=new self[n.type](n.array);t.setIndex(new THREE.BufferAttribute(r,1))}var i=e.data.attributes;for(var s in i){var o=i[s],r=new self[o.type](o.array);t.addAttribute(s,new THREE.BufferAttribute(r,o.itemSize))}var u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==undefined)for(var a=0,f=u.length;a!==f;++a){var l=u[a];t.addGroup(l.start,l.count)}var c=e.data.boundingSphere;if(c!==undefined){var h=new THREE.Vector3;c.center!==undefined&&h.fromArray(c.center),t.boundingSphere=new THREE.Sphere(h,c.radius)}return t}},THREE.MaterialLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager,this.textures={}},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,n,r){var i=this,s=new THREE.XHRLoader(i.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){t(i.parse(JSON.parse(e)))},n,r)},setCrossOrigin:function(e){this.crossOrigin=e},setTextures:function(e){this.textures=e},getTexture:function(e){var t=this.textures;return t[e]===undefined&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]},parse:function(e){var t=new THREE[e.type];t.uuid=e.uuid,e.name!==undefined&&(t.name=e.name),e.color!==undefined&&t.color.setHex(e.color),e.emissive!==undefined&&t.emissive.setHex(e.emissive),e.specular!==undefined&&t.specular.setHex(e.specular),e.shininess!==undefined&&(t.shininess=e.shininess),e.uniforms!==undefined&&(t.uniforms=e.uniforms),e.vertexShader!==undefined&&(t.vertexShader=e.vertexShader),e.fragmentShader!==undefined&&(t.fragmentShader=e.fragmentShader),e.vertexColors!==undefined&&(t.vertexColors=e.vertexColors),e.shading!==undefined&&(t.shading=e.shading),e.blending!==undefined&&(t.blending=e.blending),e.side!==undefined&&(t.side=e.side),e.opacity!==undefined&&(t.opacity=e.opacity),e.transparent!==undefined&&(t.transparent=e.transparent),e.alphaTest!==undefined&&(t.alphaTest=e.alphaTest),e.depthTest!==undefined&&(t.depthTest=e.depthTest),e.depthWrite!==undefined&&(t.depthWrite=e.depthWrite),e.wireframe!==undefined&&(t.wireframe=e.wireframe),e.wireframeLinewidth!==undefined&&(t.wireframeLinewidth=e.wireframeLinewidth),e.size!==undefined&&(t.size=e.size),e.sizeAttenuation!==undefined&&(t.sizeAttenuation=e.sizeAttenuation),e.map!==undefined&&(t.map=this.getTexture(e.map)),e.alphaMap!==undefined&&(t.alphaMap=this.getTexture(e.alphaMap),t.transparent=!0),e.bumpMap!==undefined&&(t.bumpMap=this.getTexture(e.bumpMap)),e.bumpScale!==undefined&&(t.bumpScale=e.bumpScale),e.normalMap!==undefined&&(t.normalMap=this.getTexture(e.normalMap)),e.normalScale&&(t.normalScale=new THREE.Vector2(e.normalScale,e.normalScale)),e.displacementMap!==undefined&&(t.displacementMap=this.getTexture(e.displacementMap)),e.displacementScale!==undefined&&(t.displacementScale=e.displacementScale),e.displacementBias!==undefined&&(t.displacementBias=e.displacementBias),e.specularMap!==undefined&&(t.specularMap=this.getTexture(e.specularMap)),e.envMap!==undefined&&(t.envMap=this.getTexture(e.envMap),t.combine=THREE.MultiplyOperation),e.reflectivity&&(t.reflectivity=e.reflectivity),e.lightMap!==undefined&&(t.lightMap=this.getTexture(e.lightMap)),e.lightMapIntensity!==undefined&&(t.lightMapIntensity=e.lightMapIntensity),e.aoMap!==undefined&&(t.aoMap=this.getTexture(e.aoMap)),e.aoMapIntensity!==undefined&&(t.aoMapIntensity=e.aoMapIntensity);if(e.materials!==undefined)for(var n=0,r=e.materials.length;n<r;n++)t.materials.push(this.parse(e.materials[n]));return t}},THREE.ObjectLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager,this.texturePath=""},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,n,r){this.texturePath===""&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var i=this,s=new THREE.XHRLoader(i.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){i.parse(JSON.parse(e),t)},n,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var n=this.parseGeometries(e.geometries),r=this.parseImages(e.images,function(){t!==undefined&&t(o)}),i=this.parseTextures(e.textures,r),s=this.parseMaterials(e.materials,i),o=this.parseObject(e.object,n,s);return e.animations&&(o.animations=this.parseAnimations(e.animations)),(e.images===undefined||e.images.length===0)&&t!==undefined&&t(o),o},parseGeometries:function(e){var t={};if(e!==undefined){var n=new THREE.JSONLoader,r=new THREE.BufferGeometryLoader;for(var i=0,s=e.length;i<s;i++){var o,u=e[i];switch(u.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new THREE[u.type](u.width,u.height,u.widthSegments,u.heightSegments);break;case"BoxGeometry":case"CubeGeometry":o=new THREE.BoxGeometry(u.width,u.height,u.depth,u.widthSegments,u.heightSegments,u.depthSegments);break;case"CircleBufferGeometry":o=new THREE.CircleBufferGeometry(u.radius,u.segments,u.thetaStart,u.thetaLength);break;case"CircleGeometry":o=new THREE.CircleGeometry(u.radius,u.segments,u.thetaStart,u.thetaLength);break;case"CylinderGeometry":o=new THREE.CylinderGeometry(u.radiusTop,u.radiusBottom,u.height,u.radialSegments,u.heightSegments,u.openEnded,u.thetaStart,u.thetaLength);break;case"SphereGeometry":o=new THREE.SphereGeometry(u.radius,u.widthSegments,u.heightSegments,u.phiStart,u.phiLength,u.thetaStart,u.thetaLength);break;case"SphereBufferGeometry":o=new THREE.SphereBufferGeometry(u.radius,u.widthSegments,u.heightSegments,u.phiStart,u.phiLength,u.thetaStart,u.thetaLength);break;case"DodecahedronGeometry":o=new THREE.DodecahedronGeometry(u.radius,u.detail);break;case"IcosahedronGeometry":o=new THREE.IcosahedronGeometry(u.radius,u.detail);break;case"OctahedronGeometry":o=new THREE.OctahedronGeometry(u.radius,u.detail);break;case"TetrahedronGeometry":o=new THREE.TetrahedronGeometry(u.radius,u.detail);break;case"RingGeometry":o=new THREE.RingGeometry(u.innerRadius,u.outerRadius,u.thetaSegments,u.phiSegments,u.thetaStart,u.thetaLength);break;case"TorusGeometry":o=new THREE.TorusGeometry(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.arc);break;case"TorusKnotGeometry":o=new THREE.TorusKnotGeometry(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.p,u.q,u.heightScale);break;case"TextGeometry":o=new THREE.TextGeometry(u.text,u.data);break;case"BufferGeometry":o=r.parse(u);break;case"Geometry":o=n.parse(u.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+u.type+'"');continue}o.uuid=u.uuid,u.name!==undefined&&(o.name=u.name),t[u.uuid]=o}}return t},parseMaterials:function(e,t){var n={};if(e!==undefined){var r=new THREE.MaterialLoader;r.setTextures(t);for(var i=0,s=e.length;i<s;i++){var o=r.parse(e[i]);n[o.uuid]=o}}return n},parseAnimations:function(e){var t=[];for(var n=0;n<e.length;n++){var r=THREE.AnimationClip.parse(e[n]);t.push(r)}return t},parseImages:function(e,t){function i(e){return n.manager.itemStart(e),o.load(e,function(){n.manager.itemEnd(e)})}var n=this,r={};if(e!==undefined&&e.length>0){var s=new THREE.LoadingManager(t),o=new THREE.ImageLoader(s);o.setCrossOrigin(this.crossOrigin);for(var u=0,a=e.length;u<a;u++){var f=e[u],l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(f.url)?f.url:n.texturePath+f.url;r[f.uuid]=i(l)}}return r},parseTextures:function(e,t){function n(e){return typeof e=="number"?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),THREE[e])}var r={};if(e!==undefined)for(var i=0,s=e.length;i<s;i++){var o=e[i];o.image===undefined&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),t[o.image]===undefined&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var u=new THREE.Texture(t[o.image]);u.needsUpdate=!0,u.uuid=o.uuid,o.name!==undefined&&(u.name=o.name),o.mapping!==undefined&&(u.mapping=n(o.mapping)),o.offset!==undefined&&(u.offset=new THREE.Vector2(o.offset[0],o.offset[1])),o.repeat!==undefined&&(u.repeat=new THREE.Vector2(o.repeat[0],o.repeat[1])),o.minFilter!==undefined&&(u.minFilter=n(o.minFilter)),o.magFilter!==undefined&&(u.magFilter=n(o.magFilter)),o.anisotropy!==undefined&&(u.anisotropy=o.anisotropy),Array.isArray(o.wrap)&&(u.wrapS=n(o.wrap[0]),u.wrapT=n(o.wrap[1])),r[o.uuid]=u}return r},parseObject:function(){var e=new THREE.Matrix4;return function(t,n,r){var i,s=function(e){return n[e]===undefined&&console.warn("THREE.ObjectLoader: Undefined geometry",e),n[e]},o=function(e){return r[e]===undefined&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]};switch(t.type){case"Scene":i=new THREE.Scene;break;case"PerspectiveCamera":i=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":i=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":i=new THREE.AmbientLight(t.color);break;case"DirectionalLight":i=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":i=new THREE.PointLight(t.color,t.intensity,t.distance,t.decay);break;case"SpotLight":i=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent,t.decay);break;case"HemisphereLight":i=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":i=new THREE.Mesh(s(t.geometry),o(t.material));break;case"LOD":i=new THREE.LOD;break;case"Line":i=new THREE.Line(s(t.geometry),o(t.material),t.mode);break;case"PointCloud":case"Points":i=new THREE.Points(s(t.geometry),o(t.material));break;case"Sprite":i=new THREE.Sprite(o(t.material));break;case"Group":i=new THREE.Group;break;default:i=new THREE.Object3D}i.uuid=t.uuid,t.name!==undefined&&(i.name=t.name),t.matrix!==undefined?(e.fromArray(t.matrix),e.decompose(i.position,i.quaternion,i.scale)):(t.position!==undefined&&i.position.fromArray(t.position),t.rotation!==undefined&&i.rotation.fromArray(t.rotation),t.scale!==undefined&&i.scale.fromArray(t.scale)),t.castShadow!==undefined&&(i.castShadow=t.castShadow),t.receiveShadow!==undefined&&(i.receiveShadow=t.receiveShadow),t.visible!==undefined&&(i.visible=t.visible),t.userData!==undefined&&(i.userData=t.userData);if(t.children!==undefined)for(var u in t.children)i.add(this.parseObject(t.children[u],n,r));if(t.type==="LOD"){var a=t.levels;for(var f=0;f<a.length;f++){var l=a[f],u=i.getObjectByProperty("uuid",l.object);u!==undefined&&i.addLevel(u,l.distance)}}return i}}()},THREE.TextureLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,n,r){var i=this,s=new THREE.ImageLoader(i.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(e){var n=new THREE.Texture(e);n.needsUpdate=!0,t!==undefined&&t(n)},n,r)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager,this._parser=null},THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(e,t,n,r){var i=this,s=new THREE.DataTexture,o=new THREE.XHRLoader(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setResponseType("arraybuffer"),o.load(e,function(e){var n=i._parser(e);if(!n)return;undefined!==n.image?s.image=n.image:undefined!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=undefined!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,s.wrapT=undefined!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,s.magFilter=undefined!==n.magFilter?n.magFilter:THREE.LinearFilter,s.minFilter=undefined!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,s.anisotropy=undefined!==n.anisotropy?n.anisotropy:1,undefined!==n.format&&(s.format=n.format),undefined!==n.type&&(s.type=n.type),undefined!==n.mipmaps&&(s.mipmaps=n.mipmaps),1===n.mipmapCount&&(s.minFilter=THREE.LinearFilter),s.needsUpdate=!0,t&&t(s,n)},n,r),s},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.CompressedTextureLoader=function(e){this.manager=e!==undefined?e:THREE.DefaultLoadingManager,this._parser=null},THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(e,t,n,r){var i=this,s=[],o=new THREE.CompressedTexture;o.image=s;var u=new THREE.XHRLoader(this.manager);u.setCrossOrigin(this.crossOrigin),u.setResponseType("arraybuffer");if(Array.isArray(e)){var a=0,f=function(f){u.load(e[f],function(e){var n=i._parser(e,!0);s[f]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},a+=1,a===6&&(n.mipmapCount===1&&(o.minFilter=THREE.LinearFilter),o.format=n.format,o.needsUpdate=!0,t&&t(o))},n,r)};for(var l=0,c=e.length;l<c;++l)f(l)}else u.load(e,function(e){var n=i._parser(e,!0);if(n.isCubemap){var r=n.mipmaps.length/n.mipmapCount;for(var u=0;u<r;u++){s[u]={mipmaps:[]};for(var a=0;a<n.mipmapCount;a++)s[u].mipmaps.push(n.mipmaps[u*n.mipmapCount+a]),s[u].format=n.format,s[u].width=n.width,s[u].height=n.height}}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;n.mipmapCount===1&&(o.minFilter=THREE.LinearFilter),o.format=n.format,o.needsUpdate=!0,t&&t(o)},n,r);return o},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.type="Material",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=THREE.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},setValues:function(e){if(e===undefined)return;for(var t in e){var n=e[t];if(n===undefined){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}var r=this[t];if(r===undefined){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}r instanceof THREE.Color?r.set(n):r instanceof THREE.Vector3&&n instanceof THREE.Vector3?r.copy(n):t==="overdraw"?this[t]=Number(n):this[t]=n}},toJSON:function(e){var t={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};return t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.color instanceof THREE.Color&&(t.color=this.color.getHex()),this.emissive instanceof THREE.Color&&(t.emissive=this.emissive.getHex()),this.specular instanceof THREE.Color&&(t.specular=this.specular.getHex()),this.shininess!==undefined&&(t.shininess=this.shininess),this.map instanceof THREE.Texture&&(t.map=this.map.toJSON(e).uuid),this.alphaMap instanceof THREE.Texture&&(t.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap instanceof THREE.Texture&&(t.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap instanceof THREE.Texture&&(t.bumpMap=this.bumpMap.toJSON(e).uuid,t.bumpScale=this.bumpScale),this.normalMap instanceof THREE.Texture&&(t.normalMap=this.normalMap.toJSON(e).uuid,t.normalScale=this.normalScale),this.displacementMap instanceof THREE.Texture&&(t.displacementMap=this.displacementMap.toJSON(e).uuid,t.displacementScale=this.displacementScale,t.displacementBias=this.displacementBias),this.specularMap instanceof THREE.Texture&&(t.specularMap=this.specularMap.toJSON(e).uuid),this.envMap instanceof THREE.Texture&&(t.envMap=this.envMap.toJSON(e).uuid,t.reflectivity=this.reflectivity),this.size!==undefined&&(t.size=this.size),this.sizeAttenuation!==undefined&&(t.sizeAttenuation=this.sizeAttenuation),this.vertexColors!==undefined&&this.vertexColors!==THREE.NoColors&&(t.vertexColors=this.vertexColors),this.shading!==undefined&&this.shading!==THREE.SmoothShading&&(t.shading=this.shading),this.blending!==undefined&&this.blending!==THREE.NormalBlending&&(t.blending=this.blending),this.side!==undefined&&this.side!==THREE.FrontSide&&(t.side=this.side),this.opacity<1&&(t.opacity=this.opacity),this.transparent===!0&&(t.transparent=this.transparent),this.alphaTest>0&&(t.alphaTest=this.alphaTest),this.wireframe===!0&&(t.wireframe=this.wireframe),this.wireframeLinewidth>1&&(t.wireframeLinewidth=this.wireframeLinewidth),t},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.side=e.side,this.opacity=e.opacity,this.transparent=e.transparent,this.blending=e.blending,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.alphaTest=e.alphaTest,this.overdraw=e.overdraw,this.visible=e.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})},get wrapAround(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set wrapAround(e){console.warn("THREE."+this.type+": .wrapAround has been removed.")},get wrapRGB(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new THREE.Color}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.type="LineBasicMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial,THREE.LineBasicMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.type="LineDashedMaterial",this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial,THREE.LineDashedMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.type="MeshBasicMaterial",this.color=new THREE.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial,THREE.MeshBasicMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.type="MeshLambertMaterial",this.color=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.map=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial,THREE.MeshLambertMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.map=e.map,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.type="MeshPhongMaterial",this.color=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial,THREE.MeshPhongMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.emissive.copy(e.emissive),this.specular.copy(e.specular),this.shininess=e.shininess,this.metal=e.metal,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissiveMap=e.emissiveMap,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.fog=e.fog,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial,THREE.MeshDepthMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial,THREE.MeshNormalMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},THREE.MultiMaterial=function(e){this.uuid=THREE.Math.generateUUID(),this.type="MultiMaterial",this.materials=e instanceof Array?e:[],this.visible=!0},THREE.MultiMaterial.prototype={constructor:THREE.MultiMaterial,toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var t=0,n=this.materials.length;t<n;t++)e.materials.push(this.materials[t].toJSON());return e.visible=this.visible,e},clone:function(){var e=new this.constructor;for(var t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e.visible=this.visible,e}},THREE.MeshFaceMaterial=THREE.MultiMaterial,THREE.PointsMaterial=function(e){THREE.Material.call(this),this.type="PointsMaterial",this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=THREE.NoColors,this.fog=!0,this.setValues(e)},THREE.PointsMaterial.prototype=Object.create(THREE.Material.prototype),THREE.PointsMaterial.prototype.constructor=THREE.PointsMaterial,THREE.PointsMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.vertexColors=e.vertexColors,this.fog=e.fog,this},THREE.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},THREE.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},THREE.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new THREE.PointsMaterial(e)},THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.derivatives=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=undefined,e!==undefined&&(e.attributes!==undefined&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial,THREE.ShaderMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.attributes=e.attributes,this.defines=e.defines,this.shading=e.shading,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.vertexColors=e.vertexColors,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.derivatives=e.derivatives,this},THREE.ShaderMaterial.prototype.toJSON=function(e){var t=THREE.Material.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.attributes=this.attributes,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial,THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.type="SpriteMaterial",this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial,THREE.SpriteMaterial.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.fog=e.fog,this},THREE.Texture=function(e,t,n,r,i,s,o,u,a){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++}),this.uuid=THREE.Math.generateUUID(),this.name="",this.sourceFile="",this.image=e!==undefined?e:THREE.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==undefined?t:THREE.Texture.DEFAULT_MAPPING,this.wrapS=n!==undefined?n:THREE.ClampToEdgeWrapping,this.wrapT=r!==undefined?r:THREE.ClampToEdgeWrapping,this.magFilter=i!==undefined?i:THREE.LinearFilter,this.minFilter=s!==undefined?s:THREE.LinearMipMapLinearFilter,this.anisotropy=a!==undefined?a:1,this.format=o!==undefined?o:THREE.RGBAFormat,this.type=u!==undefined?u:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.version=0,this.onUpdate=null},THREE.Texture.DEFAULT_IMAGE=undefined,THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping,THREE.Texture.prototype={constructor:THREE.Texture,set needsUpdate(e){e===!0&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this},toJSON:function(e){function t(e){var t;return e.toDataURL!==undefined?t=e:(t=document.createElement("canvas"),t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height)),t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}if(e.textures[this.uuid]!==undefined)return e.textures[this.uuid];var n={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(this.image!==undefined){var r=this.image;r.uuid===undefined&&(r.uuid=THREE.Math.generateUUID()),e.images[r.uuid]===undefined&&(e.images[r.uuid]={uuid:r.uuid,url:t(r)}),n.image=r.uuid}return e.textures[this.uuid]=n,n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==THREE.UVMapping)return;e.multiply(this.repeat),e.add(this.offset);if(e.x<0||e.x>1)switch(this.wrapS){case THREE.RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case THREE.ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case THREE.MirroredRepeatWrapping:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case THREE.RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case THREE.ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case THREE.MirroredRepeatWrapping:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CanvasTexture=function(e,t,n,r,i,s,o,u,a){THREE.Texture.call(this,e,t,n,r,i,s,o,u,a),this.needsUpdate=!0},THREE.CanvasTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CanvasTexture.prototype.constructor=THREE.CanvasTexture,THREE.CubeTexture=function(e,t,n,r,i,s,o,u,a){t=t!==undefined?t:THREE.CubeReflectionMapping,THREE.Texture.call(this,e,t,n,r,i,s,o,u,a),this.images=e,this.flipY=!1},THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CubeTexture.prototype.constructor=THREE.CubeTexture,THREE.CubeTexture.prototype.copy=function(e){return THREE.Texture.prototype.copy.call(this,e),this.images=e.images,this},THREE.CompressedTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture,THREE.DataTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l),this.image={data:e,width:t,height:n},this.magFilter=a!==undefined?a:THREE.NearestFilter,this.minFilter=f!==undefined?f:THREE.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.constructor=THREE.DataTexture,THREE.VideoTexture=function(e,t,n,r,i,s,o,u,a){THREE.Texture.call(this,e,t,n,r,i,s,o,u,a),this.generateMipmaps=!1;var f=this,l=function(){requestAnimationFrame(l),e.readyState===e.HAVE_ENOUGH_DATA&&(f.needsUpdate=!0)};l()},THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype),THREE.VideoTexture.prototype.constructor=THREE.VideoTexture,THREE.DepthTexture=function(e,t,n){var r=n?THREE.DepthStencilFormat:THREE.DepthFormat,i=n?THREE.UnsignedInt24_8Type:THREE.UnsignedIntType;THREE.Texture.call(this,null,THREE.Texture.DEFAULT_MAPPING,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,r,i),this.width=e,this.height=t},THREE.DepthTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DepthTexture.prototype.clone=function(){var e=new THREE.DepthTexture;return THREE.Texture.prototype.clone.call(this,e),e.width=this.width,e.height=this.height,e},THREE.Group=function(){THREE.Object3D.call(this),this.type="Group"},THREE.Group.prototype=Object.create(THREE.Object3D.prototype),THREE.Group.prototype.constructor=THREE.Group,THREE.Points=function(e,t){THREE.Object3D.call(this),this.type="Points",this.geometry=e!==undefined?e:new THREE.Geometry,this.material=t!==undefined?t:new THREE.PointsMaterial({color:Math.random()*16777215})},THREE.Points.prototype=Object.create(THREE.Object3D.prototype),THREE.Points.prototype.constructor=THREE.Points,THREE.Points.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray;return function(r,i){function c(e,n){var o=t.distanceSqToPoint(e);if(o<f){var u=t.closestPointToPoint(e);u.applyMatrix4(s.matrixWorld);var a=r.ray.origin.distanceTo(u);if(a<r.near||a>r.far)return;i.push({distance:a,distanceToRay:Math.sqrt(o),point:u.clone(),index:n,face:null,object:s})}}var s=this,o=s.geometry,u=r.params.Points.threshold;e.getInverse(this.matrixWorld),t.copy(r.ray).applyMatrix4(e);if(o.boundingBox!==null&&t.isIntersectionBox(o.boundingBox)===!1)return;var a=u/((this.scale.x+this.scale.y+this.scale.z)/3),f=a*a,l=new THREE.Vector3;if(o instanceof THREE.BufferGeometry){var h=o.index,p=o.attributes,d=p.position.array;if(h!==null){var v=h.array;for(var m=0,g=v.length;m<g;m++){var y=v[m];l.fromArray(d,y*3),c(l,y)}}else for(var m=0,b=d.length/3;m<b;m++)l.fromArray(d,m*3),c(l,m)}else{var w=o.vertices;for(var m=0,b=w.length;m<b;m++)c(w[m],m)}}}(),THREE.Points.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)},THREE.Points.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return e.geometries[this.geometry.uuid]===undefined&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON()),e.materials[this.material.uuid]===undefined&&(e.materials[this.material.uuid]=this.material.toJSON()),t.object.geometry=this.geometry.uuid,t.object.material=this.material.uuid,t},THREE.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new THREE.Points(e,t)},THREE.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new THREE.Points(e,t)},THREE.Line=function(e,t,n){if(n===1)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new THREE.LineSegments(e,t);THREE.Object3D.call(this),this.type="Line",this.geometry=e!==undefined?e:new THREE.Geometry,this.material=t!==undefined?t:new THREE.LineBasicMaterial({color:Math.random()*16777215})},THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.constructor=THREE.Line,THREE.Line.prototype.raycast=function(){var e=new THREE.Matrix4,t=new THREE.Ray,n=new THREE.Sphere;return function(i,s){var o=i.linePrecision,u=o*o,a=this.geometry;a.boundingSphere===null&&a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(this.matrixWorld);if(i.ray.isIntersectionSphere(n)===!1)return;e.getInverse(this.matrixWorld),t.copy(i.ray).applyMatrix4(e);var f=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector3,p=this instanceof THREE.LineSegments?2:1;if(a instanceof THREE.BufferGeometry){var d=a.index,v=a.attributes;if(d!==null){var m=d.array,g=v.position.array;for(var y=0,b=m.length-1;y<b;y+=p){var w=m[y],E=m[y+1];f.fromArray(g,w*3),l.fromArray(g,E*3);var S=t.distanceSqToSegment(f,l,h,c);if(S>u)continue;h.applyMatrix4(this.matrixWorld);var x=i.ray.origin.distanceTo(h);if(x<i.near||x>i.far)continue;s.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else{var g=v.position.array;for(var y=0,b=g.length/3-1;y<b;y+=p){f.fromArray(g,3*y),l.fromArray(g,3*y+3);var S=t.distanceSqToSegment(f,l,h,c);if(S>u)continue;h.applyMatrix4(this.matrixWorld);var x=i.ray.origin.distanceTo(h);if(x<i.near||x>i.far)continue;s.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}else if(a instanceof THREE.Geometry){var T=a.vertices,N=T.length;for(var y=0;y<N-1;y+=p){var S=t.distanceSqToSegment(T[y],T[y+1],h,c);if(S>u)continue;h.applyMatrix4(this.matrixWorld);var x=i.ray.origin.distanceTo(h);if(x<i.near||x>i.far)continue;s.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}(),THREE.Line.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)},THREE.Line.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return e.geometries[this.geometry.uuid]===undefined&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON()),e.materials[this.material.uuid]===undefined&&(e.materials[this.material.uuid]=this.material.toJSON()),t.object.geometry=this.geometry.uuid,t.object.material=this.material.uuid,t},THREE.LineStrip=0,THREE.LinePieces=1,THREE.LineSegments=function(e,t){THREE.Line.call(this,e,t),this.type="LineSegments"},THREE.LineSegments.prototype=Object.create(THREE.Line.prototype),THREE.LineSegments.prototype.constructor=THREE.LineSegments,THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.type="Mesh",this.geometry=e!==undefined?e:new THREE.Geometry,this.material=t!==undefined?t:new THREE.MeshBasicMaterial({color:Math.random()*16777215}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.constructor=THREE.Mesh,THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return this.morphTargetDictionary[e]!==undefined?this.morphTargetDictionary[e]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.raycast=function(){function v(e,t,n,r,i,s,o){return THREE.Triangle.barycoordFromPoint(e,t,n,r,h),i.multiplyScalar(h.x),s.multiplyScalar(h.y),o.multiplyScalar(h.z),i.add(s).add(o),i.clone()}var e=new THREE.Matrix4,t=new THREE.Ray,n=new THREE.Sphere,r=new THREE.Vector3,i=new THREE.Vector3,s=new THREE.Vector3,o=new THREE.Vector3,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector2,l=new THREE.Vector2,c=new THREE.Vector2,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3;return function(m,g){var y=this.geometry,b=this.material;if(b===undefined)return;y.boundingSphere===null&&y.computeBoundingSphere(),n.copy(y.boundingSphere),n.applyMatrix4(this.matrixWorld);if(m.ray.isIntersectionSphere(n)===!1)return;e.getInverse(this.matrixWorld),t.copy(m.ray).applyMatrix4(e);if(y.boundingBox!==null&&t.isIntersectionBox(y.boundingBox)===!1)return;var w,E,S;if(y instanceof THREE.BufferGeometry){var x=y.index,T=y.attributes;if(x!==null){var N=x.array,C=T.position.array;for(var k=0,L=N.length;k<L;k+=3){w=N[k],E=N[k+1],S=N[k+2],r.fromArray(C,w*3),i.fromArray(C,E*3),s.fromArray(C,S*3);if(b.side===THREE.BackSide){if(t.intersectTriangle(s,i,r,!0,p)===null)continue}else if(t.intersectTriangle(r,i,s,b.side!==THREE.DoubleSide,p)===null)continue;d.copy(p),d.applyMatrix4(this.matrixWorld);var A=m.ray.origin.distanceTo(d);if(A<m.near||A>m.far)continue;var O;if(T.uv!==undefined){var M=T.uv.array;f.fromArray(M,w*2),l.fromArray(M,E*2),c.fromArray(M,S*2),O=v(p,r,i,s,f,l,c)}g.push({distance:A,point:d.clone(),uv:O,face:new THREE.Face3(w,E,S,THREE.Triangle.normal(r,i,s)),faceIndex:Math.floor(k/3),object:this})}}else{var C=T.position.array;for(var k=0,L=C.length;k<L;k+=9){r.fromArray(C,k),i.fromArray(C,k+3),s.fromArray(C,k+6);if(b.side===THREE.BackSide){if(t.intersectTriangle(s,i,r,!0,p)===null)continue}else if(t.intersectTriangle(r,i,s,b.side!==THREE.DoubleSide,p)===null)continue;d.copy(p),d.applyMatrix4(this.matrixWorld);var A=m.ray.origin.distanceTo(d);if(A<m.near||A>m.far)continue;var O;if(T.uv!==undefined){var M=T.uv.array;f.fromArray(M,k),l.fromArray(M,k+2),c.fromArray(M,k+4),O=v(p,r,i,s,f,l,c)}w=k/3,E=w+1,S=w+2,g.push({distance:A,point:d.clone(),uv:O,face:new THREE.Face3(w,E,S,THREE.Triangle.normal(r,i,s)),index:w,object:this})}}}else if(y instanceof THREE.Geometry){var _=b instanceof THREE.MeshFaceMaterial,D=_===!0?b.materials:null,P=y.vertices,H=y.faces;for(var B=0,j=H.length;B<j;B++){var F=H[B],I=_===!0?D[F.materialIndex]:b;if(I===undefined)continue;w=P[F.a],E=P[F.b],S=P[F.c];if(I.morphTargets===!0){var q=y.morphTargets,R=this.morphTargetInfluences;r.set(0,0,0),i.set(0,0,0),s.set(0,0,0);for(var U=0,z=q.length;U<z;U++){var W=R[U];if(W===0)continue;var X=q[U].vertices;r.addScaledVector(o.subVectors(X[F.a],w),W),i.addScaledVector(u.subVectors(X[F.b],E),W),s.addScaledVector(a.subVectors(X[F.c],S),W)}r.add(w),i.add(E),s.add(S),w=r,E=i,S=s}if(I.side===THREE.BackSide){if(t.intersectTriangle(S,E,w,!0,p)===null)continue}else if(t.intersectTriangle(w,E,S,I.side!==THREE.DoubleSide,p)===null)continue;d.copy(p),d.applyMatrix4(this.matrixWorld);var A=m.ray.origin.distanceTo(d);if(A<m.near||A>m.far)continue;var O;if(y.faceVertexUvs[0].length>0){var M=y.faceVertexUvs[0][B];f.copy(M[0]),l.copy(M[1]),c.copy(M[2]),O=v(p,w,E,S,f,l,c)}g.push({distance:A,point:d.clone(),uv:O,face:F,faceIndex:B,object:this})}}}}(),THREE.Mesh.prototype.clone=function(){return(new this.constructor(this.geometry,this.material)).copy(this)},THREE.Mesh.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return e.geometries[this.geometry.uuid]===undefined&&(e.geometries[this.geometry.uuid]=this.geometry.toJSON(e)),e.materials[this.material.uuid]===undefined&&(e.materials[this.material.uuid]=this.material.toJSON(e)),t.object.geometry=this.geometry.uuid,t.object.material=this.material.uuid,t},THREE.Bone=function(e){THREE.Object3D.call(this),this.type="Bone",this.skin=e},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.constructor=THREE.Bone,THREE.Bone.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),this.skin=e.skin,this},THREE.Skeleton=function(e,t,n){this.useVertexTexture=n!==undefined?n:!0,this.identityMatrix=new THREE.Matrix4,e=e||[],this.bones=e.slice(0);if(this.useVertexTexture){var r=Math.sqrt(this.bones.length*4);r=THREE.Math.nextPowerOfTwo(Math.ceil(r)),r=Math.max(r,4),this.boneTextureWidth=r,this.boneTextureHeight=r,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(t===undefined)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new THREE.Matrix4)}},THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new THREE.Matrix4;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},THREE.Skeleton.prototype.pose=function(){var e;for(var t=0,n=this.bones.length;t<n;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(var t=0,n=this.bones.length;t<n;t++)e=this.bones[t],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},THREE.Skeleton.prototype.update=function(){var e=new THREE.Matrix4;return function(){for(var n=0,r=this.bones.length;n<r;n++){var i=this.bones[n]?this.bones[n].matrixWorld:this.identityMatrix;e.multiplyMatrices(i,this.boneInverses[n]),e.flattenToArrayOffset(this.boneMatrices,n*16)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),THREE.Skeleton.prototype.clone=function(){return new THREE.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},THREE.SkinnedMesh=function(e,t,n){THREE.Mesh.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new THREE.Matrix4,this.bindMatrixInverse=new THREE.Matrix4;var r=[];if(this.geometry&&this.geometry.bones!==undefined){var i,s;for(var o=0,u=this.geometry.bones.length;o<u;++o)s=this.geometry.bones[o],i=new THREE.Bone(this),r.push(i),i.name=s.name,i.position.fromArray(s.pos),i.quaternion.fromArray(s.rotq),s.scl!==undefined&&i.scale.fromArray(s.scl);for(var o=0,u=this.geometry.bones.length;o<u;++o)s=this.geometry.bones[o],s.parent!==-1?r[s.parent].add(r[o]):this.add(r[o])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new THREE.Skeleton(r,undefined,n),this.matrixWorld)},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh,THREE.SkinnedMesh.prototype.bind=function(e,t){this.skeleton=e,t===undefined&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();n!==Infinity?t.multiplyScalar(n):t.set(1)}},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){THREE.Mesh.prototype.updateMatrixWorld.call(this,!0),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},THREE.SkinnedMesh.prototype.clone=function(){return(new this.constructor(this.geometry,this.material,this.useVertexTexture)).copy(this)},THREE.LOD=function(){THREE.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}})},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.constructor=THREE.LOD,THREE.LOD.prototype.addLevel=function(e,t){t===undefined&&(t=0),t=Math.abs(t);var n=this.levels;for(var r=0;r<n.length;r++)if(t<n[r].distance)break;n.splice(r,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){var t=this.levels;for(var n=1,r=t.length;n<r;n++)if(e<t[n].distance)break;return t[n-1].object},THREE.LOD.prototype.raycast=function(){var e=new THREE.Vector3;return function(n,r){e.setFromMatrixPosition(this.matrixWorld);var i=n.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(n,r)}}(),THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(r){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var s=e.distanceTo(t);i[0].object.visible=!0;for(var o=1,u=i.length;o<u;o++){if(!(s>=i[o].distance))break;i[o-1].object.visible=!1,i[o].object.visible=!0}for(;o<u;o++)i[o].object.visible=!1}}}(),THREE.LOD.prototype.copy=function(e){THREE.Object3D.prototype.copy.call(this,e,!1);var t=e.levels;for(var n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this},THREE.LOD.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);t.object.levels=[];var n=this.levels;for(var r=0,i=n.length;r<i;r++){var s=n[r];t.object.levels.push({object:s.object.uuid,distance:s.distance})}return t},THREE.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),t=new Float32Array([-0.5,-0.5,0,.5,-0.5,0,.5,.5,0,-0.5,.5,0]),n=new Float32Array([0,0,1,0,1,1,0,1]),r=new THREE.BufferGeometry;return r.setIndex(new THREE.BufferAttribute(e,1)),r.addAttribute("position",new THREE.BufferAttribute(t,3)),r.addAttribute("uv",new THREE.BufferAttribute(n,2)),function(t){THREE.Object3D.call(this),this.type="Sprite",this.geometry=r,this.material=t!==undefined?t:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.constructor=THREE.Sprite,THREE.Sprite.prototype.raycast=function(){var e=new THREE.Vector3;return function(n,r){e.setFromMatrixPosition(this.matrixWorld);var i=n.ray.distanceSqToPoint(e),s=this.scale.x*this.scale.y;if(i>s)return;r.push({distance:Math.sqrt(i),point:this.position,face:null,object:this})}}(),THREE.Sprite.prototype.clone=function(){return(new this.constructor(this.material)).copy(this)},THREE.Sprite.prototype.toJSON=function(e){var t=THREE.Object3D.prototype.toJSON.call(this,e);return e.materials[this.material.uuid]===undefined&&(e.materials[this.material.uuid]=this.material.toJSON()),t.object.material=this.material.uuid,t},THREE.Particle=THREE.Sprite,THREE.LensFlare=function(e,t,n,r,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=undefined,e!==undefined&&this.add(e,t,n,r,i)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.constructor=THREE.LensFlare,THREE.LensFlare.prototype.add=function(e,t,n,r,i,s){t===undefined&&(t=-1),n===undefined&&(n=0),s===undefined&&(s=1),i===undefined&&(i=new THREE.Color(16777215)),r===undefined&&(r=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:0,opacity:s,color:i,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=-this.positionScreen.x*2,i=-this.positionScreen.y*2;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation+=(n.wantedRotation-n.rotation)*.25},THREE.LensFlare.prototype.copy=function(e){THREE.Object3D.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,n=e.lensFlares.length;t<n;t++)this.lensFlares.push(e.lensFlares[t]);return this},THREE.Scene=function(){THREE.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.constructor=THREE.Scene,THREE.Scene.prototype.copy=function(e){return THREE.Object3D.prototype.copy.call(this,e),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},THREE.Fog=function(e,t,n){this.name="",this.color=new THREE.Color(e),this.near=t!==undefined?t:1,this.far=n!==undefined?n:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=t!==undefined?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.ShaderChunk={},THREE.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\n	diffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",THREE.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n",THREE.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\n	if ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",THREE.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\n	totalAmbientLight *= ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n#endif\n",THREE.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\n	uniform sampler2D aoMap;\n	uniform float aoMapIntensity;\n\n#endif",THREE.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",THREE.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",THREE.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n	// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n	// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n	// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif\n",THREE.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\n	diffuseColor.rgb *= vColor;\n\n#endif",THREE.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n",THREE.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif",THREE.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\n	vColor.xyz = color.xyz;\n\n#endif",THREE.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\n\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n\n}\n\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\n	return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	float distance = dot( planeNormal, point - pointOnPlane );\n\n	return - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\n	if ( decayExponent > 0.0 ) {\n\n	  return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n	}\n\n	return 1.0;\n\n}\n\nvec3 F_Schlick( in vec3 specularColor, in float dotLH ) {\n\n	// Original approximation by Christophe Schlick '94\n	//;float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n	// Optimized variant (presented by Epic at SIGGRAPH '13)\n	float fresnel = exp2( ( -5.55437 * dotLH - 6.98316 ) * dotLH );\n\n	return ( 1.0 - specularColor ) * fresnel + specularColor;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* in float dotNL, in float dotNV */ ) {\n\n	// geometry term is (nâl)(nâv) / 4(nâl)(nâv)\n\n	return 0.25;\n\n}\n\nfloat D_BlinnPhong( in float shininess, in float dotNH ) {\n\n	// factor of 1/PI in distribution term omitted\n\n	return ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_BlinnPhong( in vec3 specularColor, in float shininess, in vec3 normal, in vec3 lightDir, in vec3 viewDir ) {\n\n	vec3 halfDir = normalize( lightDir + viewDir );\n\n	//float dotNL = saturate( dot( normal, lightDir ) );\n	//float dotNV = saturate( dot( normal, viewDir ) );\n	float dotNH = saturate( dot( normal, halfDir ) );\n	float dotLH = saturate( dot( lightDir, halfDir ) );\n\n	vec3 F = F_Schlick( specularColor, dotLH );\n\n	float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n	float D = D_BlinnPhong( shininess, dotNH );\n\n	return F * G * D;\n\n}\n\nvec3 inputToLinear( in vec3 a ) {\n\n	#ifdef GAMMA_INPUT\n\n		return pow( a, vec3( float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n\nvec3 linearToOutput( in vec3 a ) {\n\n	#ifdef GAMMA_OUTPUT\n\n		return pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n\n	#else\n\n		return a;\n\n	#endif\n\n}\n",THREE.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n",THREE.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	transformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n\n#endif\n",THREE.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\n	uniform sampler2D displacementMap;\n	uniform float displacementScale;\n	uniform float displacementBias;\n\n#endif\n",THREE.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\n	vec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n	emissiveColor.rgb = inputToLinear( emissiveColor.rgb );\n\n	totalEmissiveLight *= emissiveColor.rgb;\n\n#endif\n",THREE.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\n	uniform sampler2D emissiveMap;\n\n#endif\n",THREE.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// Transforming Normal Vectors with the Inverse Transformation\n		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n		#ifdef ENVMAP_MODE_REFLECTION\n\n			vec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n		#else\n\n			vec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		#endif\n\n	#else\n\n		vec3 reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n	#else\n		float flipNormal = 1.0;\n	#endif\n\n	#ifdef ENVMAP_TYPE_CUBE\n		vec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#elif defined( ENVMAP_TYPE_EQUIREC )\n		vec2 sampleUV;\n		sampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n		sampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n		vec4 envColor = texture2D( envMap, sampleUV );\n\n	#elif defined( ENVMAP_TYPE_SPHERE )\n		vec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n	#endif\n\n	envColor.xyz = inputToLinear( envColor.xyz );\n\n	#ifdef ENVMAP_BLENDING_MULTIPLY\n\n		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_MIX )\n\n		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n	#elif defined( ENVMAP_BLENDING_ADD )\n\n		outgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.envmap_pars_fragment="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	#ifdef ENVMAP_TYPE_CUBE\n		uniform samplerCube envMap;\n	#else\n		uniform sampler2D envMap;\n	#endif\n	uniform float flipEnvMap;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n\n#endif\n",THREE.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	#ifdef ENVMAP_MODE_REFLECTION\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	#else\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	outgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif",THREE.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif",THREE.ShaderChunk.hemilight_fragment="#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 lightColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		totalAmbientLight += lightColor;\n\n	}\n\n#endif\n\n",THREE.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\n	totalAmbientLight += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\n#endif\n",THREE.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\n	uniform sampler2D lightMap;\n	uniform float lightMapIntensity;\n\n#endif",THREE.ShaderChunk.lights_lambert_pars_vertex="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n",THREE.ShaderChunk.lights_lambert_vertex="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\nvec3 normal = normalize( transformedNormal );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lVector = pointLightPosition[ i ] - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		// attenuation\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition - mvPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n			// attenuation\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n			// diffuse\n\n			float dotProduct = dot( normal, lightDir );\n\n			vLightFront += lightColor * attenuation * saturate( dotProduct );\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += lightColor * attenuation * saturate( - dotProduct );\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		vLightFront += lightColor * saturate( dotProduct );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += lightColor * saturate( - dotProduct );\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec3 lightDir = hemisphereLightDirection[ i ];\n\n		// diffuse\n\n		float dotProduct = dot( normal, lightDir );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			float hemiDiffuseWeightBack = - 0.5 * dotProduct + 0.5;\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack += ambientLightColor;\n\n#endif\n",THREE.ShaderChunk.lights_phong_fragment="vec3 viewDir = normalize( vViewPosition );\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = pointLightColor[ i ];\n\n		vec3 lightPosition = pointLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		// attenuation\n\n		float attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n		// diffuse\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n		// specular\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec3 lightColor = spotLightColor[ i ];\n\n		vec3 lightPosition = spotLightPosition[ i ];\n		vec3 lVector = lightPosition + vViewPosition.xyz;\n		vec3 lightDir = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], lightDir );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = saturate( pow( saturate( spotEffect ), spotLightExponent[ i ] ) );\n\n			// attenuation\n\n			float attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n			attenuation *= spotEffect;\n\n			// diffuse\n\n			float cosineTerm = saturate( dot( normal, lightDir ) );\n\n			totalDiffuseLight += lightColor * attenuation * cosineTerm;\n\n			// specular\n\n			vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n			totalSpecularLight += brdf * specularStrength * lightColor * attenuation * cosineTerm;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec3 lightColor = directionalLightColor[ i ];\n\n		vec3 lightDir = directionalLightDirection[ i ];\n\n		// diffuse\n\n		float cosineTerm = saturate( dot( normal, lightDir ) );\n\n		totalDiffuseLight += lightColor * cosineTerm;\n\n		// specular\n\n		vec3 brdf = BRDF_BlinnPhong( specular, shininess, normal, lightDir, viewDir );\n\n		totalSpecularLight += brdf * specularStrength * lightColor * cosineTerm;\n\n	}\n\n#endif\n\n#ifdef METAL\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) * specular + totalSpecularLight + totalEmissiveLight;\n\n#else\n\n	outgoingLight += diffuseColor.rgb * ( totalDiffuseLight + totalAmbientLight ) + totalSpecularLight + totalEmissiveLight;\n\n#endif\n",THREE.ShaderChunk.lights_phong_pars_fragment="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n	varying vec3 vNormal;\n\n#endif\n",THREE.ShaderChunk.lights_phong_pars_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\n#endif\n",THREE.ShaderChunk.lights_phong_vertex="#if MAX_SPOT_LIGHTS > 0 || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif\n",THREE.ShaderChunk.linear_to_gamma_fragment="\n	outgoingLight = linearToOutput( outgoingLight );\n",THREE.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif",THREE.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif",THREE.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif",THREE.ShaderChunk.map_fragment="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	texelColor.xyz = inputToLinear( texelColor.xyz );\n\n	diffuseColor *= texelColor;\n\n#endif\n",THREE.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif",THREE.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\n	diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n",THREE.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\n	uniform vec4 offsetRepeat;\n	uniform sampler2D map;\n\n#endif\n",THREE.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\n	objectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	objectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	objectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	objectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n#endif\n",THREE.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif",THREE.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\n	transformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	transformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	transformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	transformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	transformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	transformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	transformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	transformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.normal_phong_fragment="#ifndef FLAT_SHADED\n\n	vec3 normal = normalize( vNormal );\n\n	#ifdef DOUBLE_SIDED\n\n		normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n	#endif\n\n#else\n\n	vec3 fdx = dFdx( vViewPosition );\n	vec3 fdy = dFdy( vViewPosition );\n	vec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n",THREE.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n	// Per-Pixel Tangent Space Normal Mapping\n	// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n",THREE.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\n	vec4 mvPosition = modelViewMatrix * skinned;\n\n#else\n\n	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n",THREE.ShaderChunk.shadowmap_fragment="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		// to save on uniform space, we use the sign of @shadowDarkness[ i ] to determine\n		// whether or not this light is a point light ( shadowDarkness[ i ] < 0 == point light)\n		bool isPointLight = shadowDarkness[ i ] < 0.0;\n\n		// get the real shadow darkness\n		float realShadowDarkness = abs( shadowDarkness[ i ] );\n\n		// for point lights, the uniform @vShadowCoord is re-purposed to hold\n		// the distance from the light to the world-space position of the fragment.\n		vec3 lightToPosition = vShadowCoord[ i ].xyz;\n\n		float texelSizeX =  1.0 / shadowMapSize[ i ].x;\n		float texelSizeY =  1.0 / shadowMapSize[ i ].y;\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n		float shadow = 0.0;\n\n		// if ( something && something ) breaks ATI OpenGL shader compiler\n		// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest || isPointLight ) {			\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n				#if defined(POINT_LIGHT_SHADOWS)\n\n					if( isPointLight ) {\n\n						float cubeTexelSize = 1.0 / ( shadowMapSize[ i ].x * 0.25 );\n						vec3 baseDirection3D = normalize( lightToPosition );\n						vec2 baseDirection2D = cubeToUV( baseDirection3D, texelSizeY );\n\n						initGridSamplingDisk();\n\n						float diskRadius = 1.25;\n						float numSamples = 1.0;\n						shadow = 0.0;\n\n						vec3 baseDirection = normalize( lightToPosition );\n						float curDistance = length( lightToPosition );\n\n						float dist = unpack1K( texture2D( shadowMap[ i ],  baseDirection2D ) ) + 0.1;\n						if ( curDistance >= dist )\n							shadow += 1.0;\n						\n						// evaluate each sampling direction\n						for( int s = 0; s < 20; s++ ) {\n						 \n							vec3 offset = gridSamplingDisk[ s ] * diskRadius * cubeTexelSize;\n							vec3 adjustedBaseDirection3D = baseDirection3D + offset;\n							vec2 adjustedBaseDirection2D = cubeToUV( adjustedBaseDirection3D, texelSizeY );\n							dist = unpack1K( texture2D( shadowMap[ i ],  adjustedBaseDirection2D ) ) + shadowBias[ i ];\n							if ( curDistance >= dist )\n								shadow += 1.0;\n							numSamples += 1.0;\n\n						}\n\n						shadow /= numSamples;\n\n					} else {\n\n				#endif\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n						\n						/*\n								// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n								// must enroll loop manually\n							for ( float y = -1.25; y <= 1.25; y += 1.25 )\n								for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n									vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n											// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n											//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n									float fDepth = unpackDepth( rgbaDepth );\n									if ( fDepth < shadowCoord.z )\n										shadow += 1.0;\n							}\n							shadow /= 9.0;\n						*/\n\n						shadowCoord.z += shadowBias[ i ];\n\n						const float shadowDelta = 1.0 / 9.0;\n\n						float xPixelOffset = texelSizeX;\n						float yPixelOffset = texelSizeY;\n\n						float dx0 = -1.25 * xPixelOffset;\n						float dy0 = -1.25 * yPixelOffset;\n						float dx1 = 1.25 * xPixelOffset;\n						float dy1 = 1.25 * yPixelOffset;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n						fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n						if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				#if defined(POINT_LIGHT_SHADOWS)\n\n					}\n\n				#endif\n\n				shadowColor = shadowColor * vec3( ( 1.0 - realShadowDarkness * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n				#if defined(POINT_LIGHT_SHADOWS)\n\n					if( isPointLight ) {\n\n						float cubeTexelSize = 1.0 / ( shadowMapSize[ i ].x * 0.25 );\n						vec3 baseDirection3D = normalize( lightToPosition );\n						vec2 baseDirection2D = cubeToUV( baseDirection3D, texelSizeY );\n\n						initGridSamplingDisk();\n\n						float diskRadius = 2.25;\n						float numSamples = 1.0;\n						shadow = 0.0;\n\n						vec3 baseDirection = normalize( lightToPosition );\n						float curDistance = length( lightToPosition );\n\n						float dist = unpack1K( texture2D( shadowMap[ i ],  baseDirection2D ) ) + 0.1;\n						if ( curDistance >= dist )\n							shadow += 1.0;\n\n						// evaluate each sampling direction\n						for( int s = 0; s < 20; s++ ) {\n\n							vec3 offset = gridSamplingDisk[ s ] * diskRadius * cubeTexelSize;\n							vec3 adjustedBaseDirection3D = baseDirection3D + offset;\n							vec2 adjustedBaseDirection2D = cubeToUV( adjustedBaseDirection3D, texelSizeY );\n							dist = unpack1K( texture2D( shadowMap[ i ],  adjustedBaseDirection2D ) ) + shadowBias[ i ];\n							if ( curDistance >= dist )\n								shadow += 1.0;\n							numSamples += 1.0;\n\n						}\n\n						shadow /= numSamples;\n\n					} else {\n\n				#endif\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n						shadowCoord.z += shadowBias[ i ];\n\n						float xPixelOffset = texelSizeX;\n						float yPixelOffset = texelSizeY;\n\n						float dx0 = -1.0 * xPixelOffset;\n						float dy0 = -1.0 * yPixelOffset;\n						float dx1 = 1.0 * xPixelOffset;\n						float dy1 = 1.0 * yPixelOffset;\n\n						mat3 shadowKernel;\n						mat3 depthKernel;\n\n						depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n						depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n						depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n						depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n						depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n						depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n						depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n						depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n						depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n						vec3 shadowZ = vec3( shadowCoord.z );\n						shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n						shadowKernel[0] *= vec3(0.25);\n\n						shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n						shadowKernel[1] *= vec3(0.25);\n\n						shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n						shadowKernel[2] *= vec3(0.25);\n\n						vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n						shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n						shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n						vec4 shadowValues;\n						shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n						shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n						shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n						shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n						shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				#if defined(POINT_LIGHT_SHADOWS)\n					\n					}\n\n				#endif\n\n				shadowColor = shadowColor * vec3( ( 1.0 - realShadowDarkness * shadow ) );\n\n			#else\n\n				#if defined(POINT_LIGHT_SHADOWS)\n\n					if( isPointLight ) {\n\n						vec3 baseDirection3D = normalize( lightToPosition );\n						vec2 baseDirection2D = cubeToUV( baseDirection3D, texelSizeY );\n						vec4 data = texture2D( shadowMap[ i ],  baseDirection2D );\n						float dist = unpack1K( data ) + shadowBias[ i ];\n						if ( length( lightToPosition ) >= dist)\n							shadowColor = shadowColor * vec3( 1.0 - realShadowDarkness );\n\n					} else {\n\n				#endif\n						shadowCoord.z += shadowBias[ i ];\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n\n						// spot with multiple shadows is darker\n\n						shadowColor = shadowColor * vec3( 1.0 - realShadowDarkness );\n\n						// spot with multiple shadows has the same color as single shadow spot\n\n						// 	shadowColor = min( shadowColor, vec3( realShadowDarkness ) );\n\n				#if defined(POINT_LIGHT_SHADOWS)\n\n					}\n\n				#endif\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			if ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n		#endif\n\n	}\n\n	outgoingLight = outgoingLight * shadowColor;\n\n#endif\n",THREE.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n	#if defined(POINT_LIGHT_SHADOWS)\n\n		float unpack1K ( vec4 color ) {\n\n			const vec4 bitSh = vec4( 1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0 );\n			return dot( color, bitSh ) * 1000.0;\n\n		}\n\n		// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n		// vector suitable for 2D texture mapping. This code uses the following layout for the\n		// 2D texture:\n		//\n		// xzXZ\n		//  y Y\n		//\n		// Y - Positive y direction\n		// y - Negative y direction\n		// X - Positive x direction\n		// x - Negative x direction\n		// Z - Positive z direction\n		// z - Negative z direction\n		//\n		// Source and test bed:\n		// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n		vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n			// Number of texels to avoid at the edge of each square\n\n			vec3 absV = abs( v );\n\n			// Intersect unit cube\n\n			float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n			absV *= scaleToCube;\n\n			// Apply scale to avoid seams\n\n			// two texels less per square (one texel will do for NEAREST)\n			v *= scaleToCube * ( 1.0 - 4.0 * texelSizeY );\n\n			// Unwrap\n\n			// space: -1 ... 1 range for each square\n			//\n			// #X##		dim    := ( 4 , 2 )\n			//  # #		center := ( 1 , 1 )\n\n			vec2 planar = v.xy;\n\n			float almostATexel = 1.5 * texelSizeY;\n			float almostOne = 1.0 - almostATexel;\n\n			if ( absV.z >= almostOne ) {\n\n				if ( v.z > 0.0 )\n					planar.x = 4.0 - v.x;\n\n			} else if ( absV.x >= almostOne ) {\n\n				float signX = sign( v.x );\n				planar.x = v.z * signX + 2.0 * signX;\n\n			} else if ( absV.y >= almostOne ) {\n\n				float signY = sign( v.y );\n				planar.x = v.x + 2.0 * signY + 2.0;\n				planar.y = v.z * signY - 2.0;\n\n			}\n\n			// Transform to UV space\n\n			// scale := 0.5 / dim\n			// translate := ( center + 0.5 ) / dim\n			return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n		}\n\n		vec3 gridSamplingDisk[ 20 ];\n		bool gridSamplingInitialized = false;\n\n		void initGridSamplingDisk() {\n\n			if( gridSamplingInitialized ) {\n\n				return;\n\n			}\n\n			gridSamplingDisk[0] = vec3(1, 1, 1);\n			gridSamplingDisk[1] = vec3(1, -1, 1);\n			gridSamplingDisk[2] = vec3(-1, -1, 1);\n			gridSamplingDisk[3] = vec3(-1, 1, 1);\n			gridSamplingDisk[4] = vec3(1, 1, -1);\n			gridSamplingDisk[5] = vec3(1, -1, -1);\n			gridSamplingDisk[6] = vec3(-1, -1, -1);\n			gridSamplingDisk[7] = vec3(-1, 1, -1);\n			gridSamplingDisk[8] = vec3(1, 1, 0);\n			gridSamplingDisk[9] = vec3(1, -1, 0);\n			gridSamplingDisk[10] = vec3(-1, -1, 0);\n			gridSamplingDisk[11] = vec3(-1, 1, 0);\n			gridSamplingDisk[12] = vec3(1, 0, 1);\n			gridSamplingDisk[13] = vec3(-1, 0, 1);\n			gridSamplingDisk[14] = vec3(1, 0, -1);\n			gridSamplingDisk[15] = vec3(-1, 0, -1);\n			gridSamplingDisk[16] = vec3(0, 1, 1);\n			gridSamplingDisk[17] = vec3(0, -1, 1);\n			gridSamplingDisk[18] = vec3(0, -1, -1);\n			gridSamplingDisk[19] = vec3(0, 1, -1);\n\n			gridSamplingInitialized = true;\n\n		}\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n#endif",THREE.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		#if defined(POINT_LIGHT_SHADOWS)\n\n			// if shadowDarkness[ i ] < 0.0, that means we have a point light with a cube\n			// shadow map\n			if( shadowDarkness[ i ] < 0.0 ) {\n\n				// calculate vector from light to vertex in view space\n\n				vec3 fromLight = mvPosition.xyz - pointLightPosition[ i ];\n\n				// Transform 'fromLight' into world space by multiplying it on the left\n				// side of 'viewMatrix'. This is equivalent to multiplying it on the right\n				// side of the transpose of 'viewMatrix'. Since 'viewMatrix' is orthogonal, \n				// its transpose is the same as its inverse.\n\n				fromLight = fromLight * mat3( viewMatrix );\n\n				// We repurpose vShadowCoord to hold the distance in world space from the\n				// light to the vertex. This value will be interpolated correctly in the fragment shader.\n\n				vShadowCoord[ i ] = vec4( fromLight, 1.0 );\n\n			} else {\n\n				vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n			}\n\n		#else\n\n			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n		#endif\n\n	}\n\n#endif",THREE.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif",THREE.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n",THREE.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\n	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n",THREE.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n#endif\n",THREE.ShaderChunk.specularmap_fragment="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif",THREE.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif",THREE.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	varying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	attribute vec2 uv2;\n	varying vec2 vUv2;\n\n#endif",THREE.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n	vUv2 = uv2;\n\n#endif",THREE.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n\n#endif",THREE.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n",THREE.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif",THREE.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#else\n\n		vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\n	#endif\n\n#endif\n",THREE.UniformsUtils={merge:function(e){var t={};for(var n=0;n<e.length;n++){var r=this.clone(e[n]);for(var i in r)t[i]=r[i]}return t},clone:function(e){var t={};for(var n in e){t[n]={};for(var r in e[n]){var i=e[n][r];i instanceof THREE.Color||i instanceof THREE.Vector2||i instanceof THREE.Vector3||i instanceof THREE.Vector4||i instanceof THREE.Matrix3||i instanceof THREE.Matrix4||i instanceof THREE.Texture?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},points:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	#endif",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = vec3( 1.0 );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.aomap_fragment,"	outgoingLight = diffuseColor.rgb * totalAmbientLight;",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			outgoingLight += diffuseColor.rgb * vLightFront + emissive;","		else","			outgoingLight += diffuseColor.rgb * vLightBack + emissive;","	#else","		outgoingLight += diffuseColor.rgb * vLightFront + emissive;","	#endif",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.aomap,THREE.UniformsLib.lightmap,THREE.UniformsLib.emissivemap,THREE.UniformsLib.bumpmap,THREE.UniformsLib.normalmap,THREE.UniformsLib.displacementmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","	varying vec3 vNormal;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.displacementmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#ifndef FLAT_SHADED","	vNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.displacementmap_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = - mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.aomap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.emissivemap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );","	vec3 totalAmbientLight = ambientLightColor;","	vec3 totalEmissiveLight = emissive;",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.normal_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.hemilight_fragment,THREE.ShaderChunk.aomap_fragment,THREE.ShaderChunk.emissivemap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},points:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.points,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphatest_fragment,"	outgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,"	outgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vWorldPosition = transformDirection( position, modelMatrix );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new THREE.Vector3(0,0,0)}},vertexShader:["varying vec4 vWorldPosition;",THREE.ShaderChunk.common,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.worldpos_vertex,"vWorldPosition = worldPosition;","}"].join("\n"),fragmentShader:["uniform vec3 lightPos;","varying vec4 vWorldPosition;",THREE.ShaderChunk.common,"vec4 pack1K ( float depth ) {","   depth /= 1000.0;","   const vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = fract( depth * bitSh );","	res -= res.xxyz * bitMsk;","	return res; ","}","float unpack1K ( vec4 color ) {","	const vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","	return dot( color, bitSh ) * 1000.0;","}","void main () {","	gl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );","}"].join("\n")}},THREE.WebGLRenderer=function(e){function et(e,t,n,r){l===!0&&(e*=r,t*=r,n*=r),z.clearColor(e,t,n,r)}function tt(){J.init(),z.viewport(A,O,M,_),et(h.r,h.g,h.b,p)}function nt(){x=null,k=null,C="",N=-1,I=!0,J.reset()}function ot(e){e.preventDefault(),nt(),tt(),K.clear()}function ut(e){var t=e.target;t.removeEventListener("dispose",ut),lt(t),R.textures--}function at(e){var t=e.target;t.removeEventListener("dispose",at),ct(t),R.textures--}function ft(e){var t=e.target;t.removeEventListener("dispose",ft),ht(t)}function lt(e){var t=K.get(e);if(e.image&&t.__image__webglTextureCube)z.deleteTexture(t.__image__webglTextureCube);else{if(t.__webglInit===undefined)return;z.deleteTexture(t.__webglTexture)}K.delete(e)}function ct(e){var t=K.get(e),n=K.get(e.texture);if(!e||n.__webglTexture===undefined)return;z.deleteTexture(n.__webglTexture);if(e instanceof THREE.WebGLRenderTargetCube)for(var r=0;r<6;r++)z.deleteFramebuffer(t.__webglFramebuffer[r]),t.__webglRenderbuffer&&z.deleteRenderbuffer(t.__webglRenderbuffer[r]);else z.deleteFramebuffer(t.__webglFramebuffer),t.__webglRenderbuffer&&z.deleteRenderbuffer(t.__webglRenderbuffer);K.delete(e.texture),K.delete(e)}function ht(e){pt(e),K.delete(e)}function pt(e){var t=K.get(e).program;e.program=undefined,t!==undefined&&G.releaseProgram(t)}function dt(e,t,n,r){var i;if(n instanceof THREE.InstancedBufferGeometry){i=V.get("ANGLE_instanced_arrays");if(i===null){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}r===undefined&&(r=0),J.initAttributes();var s=n.attributes,o=t.getAttributes(),u=e.defaultAttributeValues;for(var a in o){var f=o[a];if(f>=0){var l=s[a];if(l!==undefined){var c=l.itemSize,h=Q.getAttributeBuffer(l);if(l instanceof THREE.InterleavedBufferAttribute){var p=l.data,d=p.stride,v=l.offset;p instanceof THREE.InstancedInterleavedBuffer?(J.enableAttributeAndDivisor(f,p.meshPerAttribute,i),n.maxInstancedCount===undefined&&(n.maxInstancedCount=p.meshPerAttribute*p.count)):J.enableAttribute(f),z.bindBuffer(z.ARRAY_BUFFER,h),z.vertexAttribPointer(f,c,z.FLOAT,!1,d*p.array.BYTES_PER_ELEMENT,(r*d+v)*p.array.BYTES_PER_ELEMENT)}else l instanceof THREE.InstancedBufferAttribute?(J.enableAttributeAndDivisor(f,l.meshPerAttribute,i),n.maxInstancedCount===undefined&&(n.maxInstancedCount=l.meshPerAttribute*l.count)):J.enableAttribute(f),z.bindBuffer(z.ARRAY_BUFFER,h),z.vertexAttribPointer(f,c,z.FLOAT,!1,0,r*c*4)}else if(u!==undefined){var m=u[a];if(m!==undefined)switch(m.length){case 2:z.vertexAttrib2fv(f,m);break;case 3:z.vertexAttrib3fv(f,m);break;case 4:z.vertexAttrib4fv(f,m);break;default:z.vertexAttrib1fv(f,m)}}}}J.disableUnusedAttributes()}function vt(e,t){return t[0]-e[0]}function mt(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function gt(e,t){return e.object.renderOrder!==t.object.renderOrder?e.object.renderOrder-t.object.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function yt(e,t,n,r,i){var s,o;n.transparent?(s=g,o=++y):(s=v,o=++m);var u=s[o];u!==undefined?(u.id=e.id,u.object=e,u.geometry=t,u.material=n,u.z=j.z,u.group=i):(u={id:e.id,object:e,geometry:t,material:n,z:j.z,group:i},s.push(u))}function bt(e){if(e.visible===!1)return;if(e instanceof THREE.Light)d.push(e);else if(e instanceof THREE.Sprite)w.push(e);else if(e instanceof THREE.LensFlare)E.push(e);else if(e instanceof THREE.ImmediateRenderObject)S.sortObjects===!0&&(j.setFromMatrixPosition(e.matrixWorld),j.applyProjection(B)),yt(e,null,e.material,j.z,null);else if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points){e instanceof THREE.SkinnedMesh&&e.skeleton.update();if(e.frustumCulled===!1||H.intersectsObject(e)===!0){var t=e.material;if(t.visible===!0){S.sortObjects===!0&&(j.setFromMatrixPosition(e.matrixWorld),j.applyProjection(B));var n=Q.update(e);if(t instanceof THREE.MeshFaceMaterial){var r=n.groups,i=t.materials;for(var s=0,o=r.length;s<o;s++){var u=r[s],a=i[u.materialIndex];a.visible===!0&&yt(e,n,a,j.z,u)}}else yt(e,n,t,j.z,null)}}}var f=e.children;for(var s=0,o=f.length;s<o;s++)bt(f[s])}function wt(e,t,n,r,i){for(var s=0,o=e.length;s<o;s++){var u=e[s],a=u.object,f=u.geometry,l=i===undefined?u.material:i,c=u.group;a.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,a.matrixWorld),a.normalMatrix.getNormalMatrix(a.modelViewMatrix);if(a instanceof THREE.ImmediateRenderObject){St(l);var h=Tt(t,n,r,l,a);C="",a.render(function(e){S.renderBufferImmediate(e,h,l)})}else S.renderBufferDirect(t,n,r,f,l,a,c)}}function Et(e,t,n,r){var i=K.get(e),s=G.getParameters(e,t,n,r),o=G.getProgramCode(e,s),u=i.program,a=!0;if(u===undefined)e.addEventListener("dispose",ft);else if(u.code!==o)pt(e);else{if(s.shaderID!==undefined)return;a=!1}if(a){if(s.shaderID){var f=THREE.ShaderLib[s.shaderID];i.__webglShader={name:e.type,uniforms:THREE.UniformsUtils.clone(f.uniforms),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}}else i.__webglShader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.__webglShader=i.__webglShader,u=G.acquireProgram(e,s,o),i.program=u,e.program=u}var l=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var c=0;c<S.maxMorphTargets;c++)l["morphTarget"+c]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(c=0;c<S.maxMorphNormals;c++)l["morphNormal"+c]>=0&&e.numSupportedMorphNormals++}i.uniformsList=[];var h=i.program.getUniforms();for(var p in i.__webglShader.uniforms){var d=h[p];d&&i.uniformsList.push([i.__webglShader.uniforms[p],d])}}function St(e){xt(e),e.transparent===!0?J.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha):J.setBlending(THREE.NoBlending),J.setDepthFunc(e.depthFunc),J.setDepthTest(e.depthTest),J.setDepthWrite(e.depthWrite),J.setColorWrite(e.colorWrite),J.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function xt(e){e.side!==THREE.DoubleSide?J.enable(z.CULL_FACE):J.disable(z.CULL_FACE),J.setFlipSided(e.side===THREE.BackSide)}function Tt(e,t,n,r,i){L=0;var s=K.get(r);if(r.needsUpdate||!s.program)Et(r,t,n,i),r.needsUpdate=!1;var o=!1,u=!1,a=!1,f=s.program,l=f.getUniforms(),c=s.__webglShader.uniforms;f.id!==x&&(z.useProgram(f.program),x=f.id,o=!0,u=!0,a=!0),r.id!==N&&(N===-1&&(a=!0),N=r.id,u=!0);if(o||e!==k)z.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),$.logarithmicDepthBuffer&&z.uniform1f(l.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==k&&(k=e),(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&l.cameraPosition!==undefined&&(j.setFromMatrixPosition(e.matrixWorld),z.uniform3f(l.cameraPosition,j.x,j.y,j.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshBasicMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&l.viewMatrix!==undefined&&z.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements);if(r.skinning){i.bindMatrix&&l.bindMatrix!==undefined&&z.uniformMatrix4fv(l.bindMatrix,!1,i.bindMatrix.elements),i.bindMatrixInverse&&l.bindMatrixInverse!==undefined&&z.uniformMatrix4fv(l.bindMatrixInverse,!1,i.bindMatrixInverse.elements);if($.floatVertexTextures&&i.skeleton&&i.skeleton.useVertexTexture){if(l.boneTexture!==undefined){var h=Ht();z.uniform1i(l.boneTexture,h),S.setTexture(i.skeleton.boneTexture,h)}l.boneTextureWidth!==undefined&&z.uniform1i(l.boneTextureWidth,i.skeleton.boneTextureWidth),l.boneTextureHeight!==undefined&&z.uniform1i(l.boneTextureHeight,i.skeleton.boneTextureHeight)}else i.skeleton&&i.skeleton.boneMatrices&&l.boneGlobalMatrices!==undefined&&z.uniformMatrix4fv(l.boneGlobalMatrices,!1,i.skeleton.boneMatrices)}if(u){n&&r.fog&&At(c,n);if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights)I&&(a=!0,Ft(t,e),I=!1),a?(Mt(c,q),_t(c,!0)):_t(c,!1);(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial)&&Nt(c,r),r instanceof THREE.LineBasicMaterial?Ct(c,r):r instanceof THREE.LineDashedMaterial?(Ct(c,r),kt(c,r)):r instanceof THREE.PointsMaterial?Lt(c,r):r instanceof THREE.MeshPhongMaterial?Ot(c,r):r instanceof THREE.MeshDepthMaterial?(c.mNear.value=e.near,c.mFar.value=e.far,c.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(c.opacity.value=r.opacity),i.receiveShadow&&!r._shadowPass&&Dt(c,t,e),Bt(s.uniformsList)}return Pt(l,i),l.modelMatrix!==undefined&&z.uniformMatrix4fv(l.modelMatrix,!1,i.matrixWorld.elements),f}function Nt(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&(e.emissive.value=t.emissive),e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var n;t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap);if(n!==undefined){n instanceof THREE.WebGLRenderTarget&&(n=n.texture);var r=n.offset,i=n.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function Ct(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function kt(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function Lt(e,n){e.psColor.value=n.color,e.opacity.value=n.opacity,e.size.value=n.size,e.scale.value=t.height/2,e.map.value=n.map;if(n.map!==null){var r=n.map.offset,i=n.map.repeat;e.offsetRepeat.value.set(r.x,r.y,i.x,i.y)}}function At(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function Ot(e,t){e.specular.value=t.specular,e.shininess.value=t.shininess,t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Mt(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecay.value=t.point.decays,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.spotLightDecay.value=t.spot.decays,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function _t(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLightColor.needsUpdate=t,e.directionalLightDirection.needsUpdate=t,e.pointLightColor.needsUpdate=t,e.pointLightPosition.needsUpdate=t,e.pointLightDistance.needsUpdate=t,e.pointLightDecay.needsUpdate=t,e.spotLightColor.needsUpdate=t,e.spotLightPosition.needsUpdate=t,e.spotLightDistance.needsUpdate=t,e.spotLightDirection.needsUpdate=t,e.spotLightAngleCos.needsUpdate=t,e.spotLightExponent.needsUpdate=t,e.spotLightDecay.needsUpdate=t,e.hemisphereLightSkyColor.needsUpdate=t,e.hemisphereLightGroundColor.needsUpdate=t,e.hemisphereLightDirection.needsUpdate=t}function Dt(e,t,n){if(e.shadowMatrix){var r=0;for(var i=0,s=t.length;i<s;i++){var o=t[i];if(!o.castShadow)continue;if(o instanceof THREE.PointLight||o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight)o instanceof THREE.PointLight?e.shadowDarkness.value[r]=-o.shadowDarkness:e.shadowDarkness.value[r]=o.shadowDarkness,e.shadowMatrix.value[r]=o.shadowMatrix,e.shadowMap.value[r]=o.shadowMap,e.shadowMapSize.value[r]=o.shadowMapSize,e.shadowBias.value[r]=o.shadowBias,r++}}}function Pt(e,t){z.uniformMatrix4fv(e.modelViewMatrix,!1,t.modelViewMatrix.elements),e.normalMatrix&&z.uniformMatrix3fv(e.normalMatrix,!1,t.normalMatrix.elements)}function Ht(){var e=L;return e>=$.maxTextures&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+$.maxTextures),L+=1,e}function Bt(e){var t,n;for(var r=0,i=e.length;r<i;r++){var s=e[r][0];if(s.needsUpdate===!1)continue;var o=s.type,u=s.value,a=e[r][1];switch(o){case"1i":z.uniform1i(a,u);break;case"1f":z.uniform1f(a,u);break;case"2f":z.uniform2f(a,u[0],u[1]);break;case"3f":z.uniform3f(a,u[0],u[1],u[2]);break;case"4f":z.uniform4f(a,u[0],u[1],u[2],u[3]);break;case"1iv":z.uniform1iv(a,u);break;case"3iv":z.uniform3iv(a,u);break;case"1fv":z.uniform1fv(a,u);break;case"2fv":z.uniform2fv(a,u);break;case"3fv":z.uniform3fv(a,u);break;case"4fv":z.uniform4fv(a,u);break;case"Matrix3fv":z.uniformMatrix3fv(a,!1,u);break;case"Matrix4fv":z.uniformMatrix4fv(a,!1,u);break;case"i":z.uniform1i(a,u);break;case"f":z.uniform1f(a,u);break;case"v2":z.uniform2f(a,u.x,u.y);break;case"v3":z.uniform3f(a,u.x,u.y,u.z);break;case"v4":z.uniform4f(a,u.x,u.y,u.z,u.w);break;case"c":z.uniform3f(a,u.r,u.g,u.b);break;case"iv1":z.uniform1iv(a,u);break;case"iv":z.uniform3iv(a,u);break;case"fv1":z.uniform1fv(a,u);break;case"fv":z.uniform3fv(a,u);break;case"v2v":s._array===undefined&&(s._array=new Float32Array(2*u.length));for(var f=0,l=0,c=u.length;f<c;f++,l+=2)s._array[l+0]=u[f].x,s._array[l+1]=u[f].y;z.uniform2fv(a,s._array);break;case"v3v":s._array===undefined&&(s._array=new Float32Array(3*u.length));for(var f=0,h=0,c=u.length;f<c;f++,h+=3)s._array[h+0]=u[f].x,s._array[h+1]=u[f].y,s._array[h+2]=u[f].z;z.uniform3fv(a,s._array);break;case"v4v":s._array===undefined&&(s._array=new Float32Array(4*u.length));for(var f=0,p=0,c=u.length;f<c;f++,p+=4)s._array[p+0]=u[f].x,s._array[p+1]=u[f].y,s._array[p+2]=u[f].z,s._array[p+3]=u[f].w;z.uniform4fv(a,s._array);break;case"m3":z.uniformMatrix3fv(a,!1,u.elements);break;case"m3v":s._array===undefined&&(s._array=new Float32Array(9*u.length));for(var f=0,c=u.length;f<c;f++)u[f].flattenToArrayOffset(s._array,f*9);z.uniformMatrix3fv(a,!1,s._array);break;case"m4":z.uniformMatrix4fv(a,!1,u.elements);break;case"m4v":s._array===undefined&&(s._array=new Float32Array(16*u.length));for(var f=0,c=u.length;f<c;f++)u[f].flattenToArrayOffset(s._array,f*16);z.uniformMatrix4fv(a,!1,s._array);break;case"t":t=u,n=Ht(),z.uniform1i(a,n);if(!t)continue;t instanceof THREE.CubeTexture||Array.isArray(t.image)&&t.image.length===6?Ut(t,n):t instanceof THREE.WebGLRenderTargetCube?zt(t.texture,n):t instanceof THREE.WebGLRenderTarget?S.setTexture(t.texture,n):S.setTexture(t,n);break;case"tv":s._array===undefined&&(s._array=[]);for(var f=0,c=s.value.length;f<c;f++)s._array[f]=Ht();z.uniform1iv(a,s._array);for(var f=0,c=s.value.length;f<c;f++){t=s.value[f],n=s._array[f];if(!t)continue;t instanceof THREE.CubeTexture||t.image instanceof Array&&t.image.length===6?Ut(t,n):t instanceof THREE.WebGLRenderTargetCube?zt(t,n):S.setTexture(t,n)}break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+o)}}}function jt(e,t,n,r){e[t+0]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function Ft(e,t){var n,r,i,s=0,o=0,u=0,a,f,l,c,h,p=q,d=t.matrixWorldInverse,v=p.directional.colors,m=p.directional.positions,g=p.point.colors,y=p.point.positions,b=p.point.distances,w=p.point.decays,E=p.spot.colors,S=p.spot.positions,x=p.spot.distances,T=p.spot.directions,N=p.spot.anglesCos,C=p.spot.exponents,k=p.spot.decays,L=p.hemi.skyColors,A=p.hemi.groundColors,O=p.hemi.positions,M=0,_=0,D=0,P=0,H=0,B=0,I=0,R=0,U=0,z=0,W=0,X=0;for(n=0,r=e.length;n<r;n++){i=e[n];if(i.onlyShadow)continue;a=i.color,c=i.intensity,h=i.distance;if(i instanceof THREE.AmbientLight){if(!i.visible)continue;s+=a.r,o+=a.g,u+=a.b}else if(i instanceof THREE.DirectionalLight){H+=1;if(!i.visible)continue;F.setFromMatrixPosition(i.matrixWorld),j.setFromMatrixPosition(i.target.matrixWorld),F.sub(j),F.transformDirection(d),U=M*3,m[U+0]=F.x,m[U+1]=F.y,m[U+2]=F.z,jt(v,U,a,c),M+=1}else if(i instanceof THREE.PointLight){B+=1;if(!i.visible)continue;z=_*3,jt(g,z,a,c),j.setFromMatrixPosition(i.matrixWorld),j.applyMatrix4(d),y[z+0]=j.x,y[z+1]=j.y,y[z+2]=j.z,b[_]=h,w[_]=i.distance===0?0:i.decay,_+=1}else if(i instanceof THREE.SpotLight){I+=1;if(!i.visible)continue;W=D*3,jt(E,W,a,c),F.setFromMatrixPosition(i.matrixWorld),j.copy(F).applyMatrix4(d),S[W+0]=j.x,S[W+1]=j.y,S[W+2]=j.z,x[D]=h,j.setFromMatrixPosition(i.target.matrixWorld),F.sub(j),F.transformDirection(d),T[W+0]=F.x,T[W+1]=F.y,T[W+2]=F.z,N[D]=Math.cos(i.angle),C[D]=i.exponent,k[D]=i.distance===0?0:i.decay,D+=1}else if(i instanceof THREE.HemisphereLight){R+=1;if(!i.visible)continue;F.setFromMatrixPosition(i.matrixWorld),F.transformDirection(d),X=P*3,O[X+0]=F.x,O[X+1]=F.y,O[X+2]=F.z,f=i.color,l=i.groundColor,jt(L,X,f,c),jt(A,X,l,c),P+=1}}for(n=M*3,r=Math.max(v.length,H*3);n<r;n++)v[n]=0;for(n=_*3,r=Math.max(g.length,B*3);n<r;n++)g[n]=0;for(n=D*3,r=Math.max(E.length,I*3);n<r;n++)E[n]=0;for(n=P*3,r=Math.max(L.length,R*3);n<r;n++)L[n]=0;for(n=P*3,r=Math.max(A.length,R*3);n<r;n++)A[n]=0;p.directional.length=M,p.point.length=_,p.spot.length=D,p.hemi.length=P,p.ambient[0]=s,p.ambient[1]=o,p.ambient[2]=u}function It(e,t,n){var r;n?(z.texParameteri(e,z.TEXTURE_WRAP_S,Qt(t.wrapS)),z.texParameteri(e,z.TEXTURE_WRAP_T,Qt(t.wrapT)),z.texParameteri(e,z.TEXTURE_MAG_FILTER,Qt(t.magFilter)),z.texParameteri(e,z.TEXTURE_MIN_FILTER,Qt(t.minFilter))):(z.texParameteri(e,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(e,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),(t.wrapS!==THREE.ClampToEdgeWrapping||t.wrapT!==THREE.ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+t.sourceFile+" )"),z.texParameteri(e,z.TEXTURE_MAG_FILTER,Kt(t.magFilter)),z.texParameteri(e,z.TEXTURE_MIN_FILTER,Kt(t.minFilter)),t.minFilter!==THREE.NearestFilter&&t.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+t.sourceFile+" )")),r=V.get("EXT_texture_filter_anisotropic");if(r){if(t.type===THREE.FloatType&&V.get("OES_texture_float_linear")===null)return;if(t.type===THREE.HalfFloatType&&V.get("OES_texture_half_float_linear")===null)return;if(t.anisotropy>1||K.get(t).__currentAnisotropy)z.texParameterf(e,r.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,S.getMaxAnisotropy())),K.get(t).__currentAnisotropy=t.anisotropy}}function qt(e,t,n){e.__webglInit===undefined&&(e.__webglInit=!0,t.__webglInit=!0,t.addEventListener("dispose",ut),e.__webglTexture=z.createTexture(),R.textures++),J.activeTexture(z.TEXTURE0+n),J.bindTexture(z.TEXTURE_2D,e.__webglTexture),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,t.flipY),z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),z.pixelStorei(z.UNPACK_ALIGNMENT,t.unpackAlignment),t.image=Rt(t.image,$.maxTextureSize);var r=t.image,i=THREE.Math.isPowerOfTwo(r.width)&&THREE.Math.isPowerOfTwo(r.height),s=Qt(t.format),o=Qt(t.type);It(z.TEXTURE_2D,t,i);var u,a=t.mipmaps;if(t instanceof THREE.DataTexture)if(a.length>0&&i){for(var f=0,l=a.length;f<l;f++)u=a[f],J.texImage2D(z.TEXTURE_2D,f,s,u.width,u.height,0,s,o,u.data);t.generateMipmaps=!1}else J.texImage2D(z.TEXTURE_2D,0,s,r.width,r.height,0,s,o,r.data);else if(t instanceof THREE.CompressedTexture)for(var f=0,l=a.length;f<l;f++)u=a[f],t.format!==THREE.RGBAFormat&&t.format!==THREE.RGBFormat?J.getCompressedTextureFormats().indexOf(s)>-1?J.compressedTexImage2D(z.TEXTURE_2D,f,s,u.width,u.height,0,u.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):J.texImage2D(z.TEXTURE_2D,f,s,u.width,u.height,0,s,o,u.data);else if(a.length>0&&i){for(var f=0,l=a.length;f<l;f++)u=a[f],J.texImage2D(z.TEXTURE_2D,f,s,s,o,u);t.generateMipmaps=!1}else J.texImage2D(z.TEXTURE_2D,0,s,s,o,t.image);t.generateMipmaps&&i&&z.generateMipmap(z.TEXTURE_2D),e.__version=t.version,t.onUpdate&&t.onUpdate(t)}function Rt(e,t){if(e.width>t||e.height>t){var n=t/Math.max(e.width,e.height),r=document.createElement("canvas");r.width=Math.floor(e.width*n),r.height=Math.floor(e.height*n);var i=r.getContext("2d");return i.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function Ut(e,t){var n=K.get(e);if(e.image.length===6)if(e.version>0&&n.__version!==e.version){n.__image__webglTextureCube||(e.addEventListener("dispose",ut),n.__image__webglTextureCube=z.createTexture(),R.textures++),J.activeTexture(z.TEXTURE0+t),J.bindTexture(z.TEXTURE_CUBE_MAP,n.__image__webglTextureCube),z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,e.flipY);var r=e instanceof THREE.CompressedTexture,i=e.image[0]instanceof THREE.DataTexture,s=[];for(var o=0;o<6;o++)S.autoScaleCubemaps&&!r&&!i?s[o]=Rt(e.image[o],$.maxCubemapSize):s[o]=i?e.image[o].image:e.image[o];var u=s[0],a=THREE.Math.isPowerOfTwo(u.width)&&THREE.Math.isPowerOfTwo(u.height),f=Qt(e.format),l=Qt(e.type);It(z.TEXTURE_CUBE_MAP,e,a);for(var o=0;o<6;o++)if(!r)i?J.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,f,s[o].width,s[o].height,0,f,l,s[o].data):J.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,f,f,l,s[o]);else{var c,h=s[o].mipmaps;for(var p=0,d=h.length;p<d;p++)c=h[p],e.format!==THREE.RGBAFormat&&e.format!==THREE.RGBFormat?J.getCompressedTextureFormats().indexOf(f)>-1?J.compressedTexImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+o,p,f,c.width,c.height,0,c.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):J.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+o,p,f,c.width,c.height,0,f,l,c.data)}e.generateMipmaps&&a&&z.generateMipmap(z.TEXTURE_CUBE_MAP),n.__version=e.version,e.onUpdate&&e.onUpdate(e)}else J.activeTexture(z.TEXTURE0+t),J.bindTexture(z.TEXTURE_CUBE_MAP,n.__image__webglTextureCube)}function zt(e,t){J.activeTexture(z.TEXTURE0+t),J.bindTexture(z.TEXTURE_CUBE_MAP,K.get(e).__webglTexture)}function Wt(e,t,n,r){z.bindFramebuffer(z.FRAMEBUFFER,e),z.framebufferTexture2D(z.FRAMEBUFFER,n,r,K.get(t.texture).__webglTexture,0)}function Xt(e,t){z.bindRenderbuffer(z.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(z.renderbufferStorage(z.RENDERBUFFER,z.DEPTH_COMPONENT16,t.width,t.height),z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(z.renderbufferStorage(z.RENDERBUFFER,z.DEPTH_STENCIL,t.width,t.height),z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,e)):z.renderbufferStorage(z.RENDERBUFFER,z.RGBA4,t.width,t.height)}function Vt(e){var t=K.get(e),n=e instanceof THREE.WebGLRenderTargetCube;if(n){t.__webglRenderbuffer=[];for(var r=0;r<6;r++)t.__webglRenderbuffer[r]=z.createRenderbuffer(),Xt(t.__webglRenderbuffer[r],e)}else if(e.shareDepthFrom){var i=K.get(e.shareDepthFrom);t.__webglRenderbuffer=i.__webglRenderbuffer,e.depthBuffer&&!e.stencilBuffer?z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.RENDERBUFFER,t.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&z.framebufferRenderbuffer(z.FRAMEBUFFER,z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,t.__webglRenderbuffer)}else t.__webglRenderbuffer=z.createRenderbuffer(),Xt(t.__webglRenderbuffer,e);z.bindRenderbuffer(z.RENDERBUFFER,null)}function $t(e){var t=e.depthTexture,n=K.get(e.depthTexture),r=THREE.Math.isPowerOfTwo(t.width)&&THREE.Math.isPowerOfTwo(t.height);n.__webglTexture=z.createTexture(),z.bindTexture(z.TEXTURE_2D,n.__webglTexture),It(z.TEXTURE_2D,t,r),e.depthBuffer&&!e.stencilBuffer?(z.texImage2D(z.TEXTURE_2D,0,z.DEPTH_COMPONENT,t.width,t.height,0,z.DEPTH_COMPONENT,z.UNSIGNED_INT,null),z.framebufferTexture2D(z.FRAMEBUFFER,z.DEPTH_ATTACHMENT,z.TEXTURE_2D,n.__webglTexture,0)):e.stencilBuffer&&(z.texImage2D(z.TEXTURE_2D,0,z.DEPTH_STENCIL,t.width,t.height,0,z.DEPTH_STENCIL,V.get("WEBGL_depth_texture").UNSIGNED_INT_24_8_WEBGL,null),z.framebufferTexture2D(z.FRAMEBUFFER,z.DEPTH_STENCIL_ATTACHMENT,z.TEXTURE_2D,n.__webglTexture,0)),z.bindTexture(z.TEXTURE_2D,null)}function Jt(e){var t=e instanceof THREE.WebGLRenderTargetCube?z.TEXTURE_CUBE_MAP:z.TEXTURE_2D,n=K.get(e.texture).__webglTexture;J.bindTexture(t,n),console.log("updateRenderTargetMipmap"),z.generateMipmap(t),J.bindTexture(t,null)}function Kt(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?z.NEAREST:z.LINEAR}function Qt(e){var t;if(e===THREE.RepeatWrapping)return z.REPEAT;if(e===THREE.ClampToEdgeWrapping)return z.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return z.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return z.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return z.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return z.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return z.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return z.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return z.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return z.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return z.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return z.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return z.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return z.BYTE;if(e===THREE.ShortType)return z.SHORT;if(e===THREE.UnsignedShortType)return z.UNSIGNED_SHORT;if(e===THREE.IntType)return z.INT;if(e===THREE.UnsignedIntType)return z.UNSIGNED_INT;if(e===THREE.FloatType)return z.FLOAT;t=V.get("OES_texture_half_float");if(t!==null&&e===THREE.HalfFloatType)return t.HALF_FLOAT_OES;if(e===THREE.AlphaFormat)return z.ALPHA;if(e===THREE.RGBFormat)return z.RGB;if(e===THREE.RGBAFormat)return z.RGBA;if(e===THREE.LuminanceFormat)return z.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return z.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return z.FUNC_ADD;if(e===THREE.SubtractEquation)return z.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return z.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return z.ZERO;if(e===THREE.OneFactor)return z.ONE;if(e===THREE.SrcColorFactor)return z.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return z.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return z.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return z.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return z.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return z.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return z.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return z.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return z.SRC_ALPHA_SATURATE;t=V.get("WEBGL_compressed_texture_s3tc");if(t!==null){if(e===THREE.RGB_S3TC_DXT1_Format)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}t=V.get("WEBGL_compressed_texture_pvrtc");if(t!==null){if(e===THREE.RGB_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===THREE.RGB_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===THREE.RGBA_PVRTC_4BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===THREE.RGBA_PVRTC_2BPPV1_Format)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}t=V.get("EXT_blend_minmax");if(t!==null){if(e===THREE.MinEquation)return t.MIN_EXT;if(e===THREE.MaxEquation)return t.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var t=e.canvas!==undefined?e.canvas:document.createElement("canvas"),n=e.context!==undefined?e.context:null,r=t.width,i=t.height,s=1,o=e.alpha!==undefined?e.alpha:!1,u=e.depth!==undefined?e.depth:!0,a=e.stencil!==undefined?e.stencil:!0,f=e.antialias!==undefined?e.antialias:!1,l=e.premultipliedAlpha!==undefined?e.premultipliedAlpha:!0,c=e.preserveDrawingBuffer!==undefined?e.preserveDrawingBuffer:!1,h=new THREE.Color(0),p=0,d=[],v=[],m=-1,g=[],y=-1,b=new Float32Array(8),w=[],E=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var S=this,x=null,T=null,N=-1,C="",k=null,L=0,A=0,O=0,M=t.width,_=t.height,D=0,P=0,H=new THREE.Frustum,B=new THREE.Matrix4,j=new THREE.Vector3,F=new THREE.Vector3,I=!0,q={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},R={geometries:0,textures:0},U={calls:0,vertices:0,faces:0,points:0};this.info={render:U,memory:R,programs:null};var z;try{var W={alpha:o,depth:u,stencil:a,antialias:f,premultipliedAlpha:l,preserveDrawingBuffer:c};z=n||t.getContext("webgl",W)||t.getContext("experimental-webgl",W);if(z===null)throw t.getContext("webgl")!==null?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";t.addEventListener("webglcontextlost",ot,!1)}catch(X){console.error("THREE.WebGLRenderer: "+X)}var V=new THREE.WebGLExtensions(z);V.get("OES_texture_float"),V.get("OES_texture_float_linear"),V.get("WEBGL_depth_texture"),V.get("OES_texture_half_float"),V.get("OES_texture_half_float_linear"),V.get("OES_standard_derivatives"),V.get("ANGLE_instanced_arrays"),V.get("OES_element_index_uint")&&(THREE.BufferGeometry.MaxIndex=4294967296);var $=new THREE.WebGLCapabilities(z,V,e),J=new THREE.WebGLState(z,V,Qt),K=new THREE.WebGLProperties,Q=new THREE.WebGLObjects(z,K,this.info),G=new THREE.WebGLPrograms(this,$);this.info.programs=G.programs;var Y=new THREE.WebGLBufferRenderer(z,V,U),Z=new THREE.WebGLIndexedBufferRenderer(z,V,U);tt(),this.context=z,this.capabilities=$,this.extensions=V,this.state=J;var rt=new THREE.WebGLShadowMap(this,d,Q);this.shadowMap=rt;var it=new THREE.SpritePlugin(this,w),st=new THREE.LensFlarePlugin(this,E);this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.forceContextLoss=function(){V.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var e;return function(){if(e!==undefined)return e;var n=V.get("EXT_texture_filter_anisotropic");return n!==null?e=z.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):e=0,e}}(),this.getPrecision=function(){return $.precision},this.getPixelRatio=function(){return s},this.setPixelRatio=function(e){e!==undefined&&(s=e)},this.getSize=function(){return{width:r,height:i}},this.setSize=function(e,n,o){r=e,i=n,t.width=e*s,t.height=n*s,o!==!1&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n)},this.setViewport=function(e,t,n,r){A=e*s,O=t*s,M=n*s,_=r*s,z.viewport(A,O,M,_)},this.getViewport=function(e){e.x=A,e.y=O,e.z=M,e.w=_},this.setScissor=function(e,t,n,r){z.scissor(e*s,t*s,n*s,r*s)},this.enableScissorTest=function(e){J.setScissorTest(e)},this.getClearColor=function(){return h},this.setClearColor=function(e,t){h.set(e),p=t!==undefined?t:1,et(h.r,h.g,h.b,p)},this.getClearAlpha=function(){return p},this.setClearAlpha=function(e){p=e,et(h.r,h.g,h.b,p)},this.clear=function(e,t,n){var r=0;if(e===undefined||e)r|=z.COLOR_BUFFER_BIT;if(t===undefined||t)r|=z.DEPTH_BUFFER_BIT;if(n===undefined||n)r|=z.STENCIL_BUFFER_BIT;z.clear(r)},this.clearColor=function(){z.clear(z.COLOR_BUFFER_BIT)},this.clearDepth=function(){z.clear(z.DEPTH_BUFFER_BIT)},this.clearStencil=function(){z.clear(z.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.resetGLState=nt,this.dispose=function(){t.removeEventListener("webglcontextlost",ot,!1)},this.renderBufferImmediate=function(e,t,n){J.initAttributes();var r=K.get(e);e.hasPositions&&!r.position&&(r.position=z.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=z.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=z.createBuffer()),e.hasColors&&!r.color&&(r.color=z.createBuffer());var i=t.getAttributes();e.hasPositions&&(z.bindBuffer(z.ARRAY_BUFFER,r.position),z.bufferData(z.ARRAY_BUFFER,e.positionArray,z.DYNAMIC_DRAW),J.enableAttribute(i.position),z.vertexAttribPointer(i.position,3,z.FLOAT,!1,0,0));if(e.hasNormals){z.bindBuffer(z.ARRAY_BUFFER,r.normal);if(n.type!=="MeshPhongMaterial"&&n.shading===THREE.FlatShading)for(var s=0,o=e.count*3;s<o;s+=9){var u=e.normalArray,a=(u[s+0]+u[s+3]+u[s+6])/3,f=(u[s+1]+u[s+4]+u[s+7])/3,l=(u[s+2]+u[s+5]+u[s+8])/3;u[s+0]=a,u[s+1]=f,u[s+2]=l,u[s+3]=a,u[s+4]=f,u[s+5]=l,u[s+6]=a,u[s+7]=f,u[s+8]=l}z.bufferData(z.ARRAY_BUFFER,e.normalArray,z.DYNAMIC_DRAW),J.enableAttribute(i.normal),z.vertexAttribPointer(i.normal,3,z.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(z.bindBuffer(z.ARRAY_BUFFER,r.uv),z.bufferData(z.ARRAY_BUFFER,e.uvArray,z.DYNAMIC_DRAW),J.enableAttribute(i.uv),z.vertexAttribPointer(i.uv,2,z.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==THREE.NoColors&&(z.bindBuffer(z.ARRAY_BUFFER,r.color),z.bufferData(z.ARRAY_BUFFER,e.colorArray,z.DYNAMIC_DRAW),J.enableAttribute(i.color),z.vertexAttribPointer(i.color,3,z.FLOAT,!1,0,0)),J.disableUnusedAttributes(),z.drawArrays(z.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o,u){St(i);var a=Tt(e,t,n,i,o),f=!1,l=r.id+"_"+a.id+"_"+i.wireframe;l!==C&&(C=l,f=!0);var c=o.morphTargetInfluences;if(c!==undefined){var h=[];for(var p=0,d=c.length;p<d;p++){var v=c[p];h.push([v,p])}h.sort(vt),h.length>8&&(h.length=8);var m=r.morphAttributes;for(var p=0,d=h.length;p<d;p++){var v=h[p];b[p]=v[0];if(v[0]!==0){var g=v[1];i.morphTargets===!0&&m.position&&r.addAttribute("morphTarget"+p,m.position[g]),i.morphNormals===!0&&m.normal&&r.addAttribute("morphNormal"+p,m.normal[g])}else i.morphTargets===!0&&r.removeAttribute("morphTarget"+p),i.morphNormals===!0&&r.removeAttribute("morphNormal"+p)}var y=a.getUniforms();y.morphTargetInfluences!==null&&z.uniform1fv(y.morphTargetInfluences,b),f=!0}var g=r.index,w=r.attributes.position;i.wireframe===!0&&(g=Q.getWireframeAttribute(r));var E;g!==null?(E=Z,E.setIndex(g)):E=Y,f&&(dt(i,a,r),g!==null&&z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,Q.getAttributeBuffer(g)));if(u===null){var S;g!==null?S=g.array.length:S=w.count;var x=r.drawRange;u={start:x.start,count:Math.min(x.count,S)}}if(o instanceof THREE.Mesh)i.wireframe===!0?(J.setLineWidth(i.wireframeLinewidth*s),E.setMode(z.LINES)):E.setMode(z.TRIANGLES),r instanceof THREE.InstancedBufferGeometry&&r.maxInstancedCount>0?E.renderInstances(r):E.render(u.start,u.count);else if(o instanceof THREE.Line){var T=i.linewidth;T===undefined&&(T=1),J.setLineWidth(T*s),o instanceof THREE.LineSegments?E.setMode(z.LINES):E.setMode(z.LINE_STRIP),E.render(u.start,u.count)}else o instanceof THREE.Points&&(E.setMode(z.POINTS),E.render(u.start,u.count))},this.render=function(e,t,n,r){if(t instanceof THREE.Camera==0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var i=e.fog;C="",N=-1,k=null,I=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),H.setFromMatrix(B),d.length=0,m=-1,y=-1,w.length=0,E.length=0,bt(e),v.length=m+1,g.length=y+1,S.sortObjects===!0&&(v.sort(mt),g.sort(gt)),rt.render(e),U.calls=0,U.vertices=0,U.faces=0,U.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);if(e.overrideMaterial){var s=e.overrideMaterial;wt(v,t,d,i,s),wt(g,t,d,i,s)}else J.setBlending(THREE.NoBlending),wt(v,t,d,i),wt(g,t,d,i);it.render(e,t),st.render(e,t,D,P),n&&n.generateMipmaps&&n.texture.minFilter!==THREE.NearestFilter&&n.texture.minFilter!==THREE.LinearFilter&&Jt(n),J.setDepthTest(!0),J.setDepthWrite(!0),J.setColorWrite(!0)},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?J.disable(z.CULL_FACE):(t===THREE.FrontFaceDirectionCW?z.frontFace(z.CW):z.frontFace(z.CCW),e===THREE.CullFaceBack?z.cullFace(z.BACK):e===THREE.CullFaceFront?z.cullFace(z.FRONT):z.cullFace(z.FRONT_AND_BACK),J.enable(z.CULL_FACE))},this.setTexture=function(e,t){var n=K.get(e);if(e.version>0&&n.__version!==e.version){var r=e.image;if(r===undefined){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);return}if(r.complete===!1){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e);return}qt(n,e,t);return}J.activeTexture(z.TEXTURE0+t),J.bindTexture(z.TEXTURE_2D,n.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&K.get(e).__webglFramebuffer===undefined){var n=K.get(e),r=K.get(e.texture);e.addEventListener("dispose",at),r.__webglTexture=z.createTexture(),R.textures++;var i=THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height),s=Qt(e.texture.format),o=Qt(e.texture.type);if(t){n.__webglFramebuffer=[],J.bindTexture(z.TEXTURE_CUBE_MAP,r.__webglTexture),It(z.TEXTURE_CUBE_MAP,e.texture,i);for(var u=0;u<6;u++)n.__webglFramebuffer[u]=z.createFramebuffer(),n.__webglRenderbuffer[u]=z.createRenderbuffer(),J.texImage2D(z.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,s,e.width,e.height,0,s,o,null),Wt(n.__webglFramebuffer[u],e,z.TEXTURE_CUBE_MAP_POSITIVE_X+u);e.generateMipmaps&&i&&z.generateMipmap(z.TEXTURE_CUBE_MAP)}else n.__webglFramebuffer=z.createFramebuffer(),J.bindTexture(z.TEXTURE_2D,r.__webglTexture),It(z.TEXTURE_2D,e.texture,i),J.texImage2D(z.TEXTURE_2D,0,s,e.width,e.height,0,s,o,null),Wt(n.__webglFramebuffer,e,z.COLOR_ATTACHMENT0,z.TEXTURE_2D),e.generateMipmaps&&i&&z.generateMipmap(z.TEXTURE_2D);t?J.bindTexture(z.TEXTURE_CUBE_MAP,null):J.bindTexture(z.TEXTURE_2D,null),e.depthBuffer===undefined&&(e.depthBuffer=!0),e.stencilBuffer===undefined&&(e.stencilBuffer=!0);if(e.depthBuffer||e.stencilBuffer)e.depthTexture&&V.get("WEBGL_depth_texture")?$t(e):Vt(e);z.bindFramebuffer(z.FRAMEBUFFER,null)}var a,f,l,c,h;if(e){var n=K.get(e);t?a=n.__webglFramebuffer[e.activeCubeFace]:a=n.__webglFramebuffer,f=e.width,l=e.height,c=0,h=0}else a=null,f=M,l=_,c=A,h=O;a!==T&&(z.bindFramebuffer(z.FRAMEBUFFER,a),z.viewport(c,h,f,l),T=a);if(t){var n=K.get(e);z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,0)}D=f,P=l},this.readRenderTargetPixels=function(e,t,n,r,i,s){if(!(e instanceof THREE.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}if(K.get(e).__webglFramebuffer){var o=!1;K.get(e).__webglFramebuffer!==T&&(z.bindFramebuffer(z.FRAMEBUFFER,K.get(e).__webglFramebuffer),o=!0);try{if(e.texture.format!==THREE.RGBAFormat&&Qt(e.texture.format)!==z.getParameter(z.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(e.texture.type!==THREE.UnsignedByteType&&Qt(e.texture.type)!==z.getParameter(z.IMPLEMENTATION_COLOR_READ_TYPE)&&(e.texture.type!==THREE.FloatType||!V.get("WEBGL_color_buffer_float"))&&(e.texture.type!==THREE.HalfFloatType||!V.get("EXT_color_buffer_half_float"))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z.checkFramebufferStatus(z.FRAMEBUFFER)===z.FRAMEBUFFER_COMPLETE?z.readPixels(t,n,r,i,Qt(e.texture.format),Qt(e.texture.type),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{o&&z.bindFramebuffer(z.FRAMEBUFFER,T)}}},this.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),V.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),V.get("OES_texture_half_float")},this.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),V.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),V.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),V.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),V.get("EXT_blend_minmax")},this.supportsVertexTextures=function(){return $.vertexTextures},this.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),V.get("ANGLE_instanced_arrays")},this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Object.defineProperties(this,{shadowMapEnabled:{get:function(){return rt.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),rt.enabled=e}},shadowMapType:{get:function(){return rt.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),rt.type=e}},shadowMapCullFace:{get:function(){return rt.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),rt.cullFace=e}},shadowMapDebug:{get:function(){return rt.debug},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapDebug is now .shadowMap.debug."),rt.debug=e}}})},THREE.WebGLRenderTarget=function(e,t,n){this.uuid=THREE.Math.generateUUID(),this.width=e,this.height=t,n=n||{},this.texture=n.texture,this.texture||(this.texture=new THREE.Texture(undefined,undefined,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy)),this.depthBuffer=n.depthBuffer!==undefined?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==undefined?n.stencilBuffer:!0,this.depthTexture=n.depthTexture,this.generateMipmaps=!0,this.shareDepthFrom=n.shareDepthFrom!==undefined?n.shareDepthFrom:null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(e,t){if(this.width!==e||this.height!==t)this.width=e,this.height=t,this.dispose()},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.texture=e.texture.clone(),e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.generateMipmaps=e.generateMipmaps,this.shareDepthFrom=e.shareDepthFrom,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube,THREE.WebGLBufferRenderer=function(e,t,n){function i(e){r=e}function s(t,i){e.drawArrays(r,t,i),n.calls++,n.vertices+=i,r===e.TRIANGLES&&(n.faces+=i/3)}function o(e){var n=t.get("ANGLE_instanced_arrays");if(n===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var i=e.attributes.position;i instanceof THREE.InterleavedBufferAttribute?n.drawArraysInstancedANGLE(r,0,i.data.count,e.maxInstancedCount):n.drawArraysInstancedANGLE(r,0,i.count,e.maxInstancedCount)}var r;this.setMode=i,this.render=s,this.renderInstances=o},THREE.WebGLIndexedBufferRenderer=function(e,t,n){function i(e){r=e}function u(n){n.array instanceof Uint32Array&&t.get("OES_element_index_uint")?(s=e.UNSIGNED_INT,o=4):(s=e.UNSIGNED_SHORT,o=2)}function a(t,i){e.drawElements(r,i,s,t*o),n.calls++,n.vertices+=i,r===e.TRIANGLES&&(n.faces+=i/3)}function f(e){var n=t.get("ANGLE_instanced_arrays");if(n===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var i=e.index;n.drawElementsInstancedANGLE(r,i.array.length,s,0,e.maxInstancedCount)}var r,s,o;this.setMode=i,this.setIndex=u,this.render=a,this.renderInstances=f},THREE.WebGLExtensions=function(e){var t={};this.get=function(n){if(t[n]!==undefined)return t[n];var r;switch(n){case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}},THREE.WebGLCapabilities=function(e,t,n){function r(t){if(t==="highp"){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return t==="mediump"&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=r,this.precision=n.precision!==undefined?n.precision:"highp",this.logarithmicDepthBuffer=n.logarithmicDepthBuffer!==undefined?n.logarithmicDepthBuffer:!1,this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=e.getParameter(e.MAX_VARYING_VECTORS),this.maxFragmentUniforms=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!t.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var i=r(this.precision);i!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",i,"instead."),this.precision=i),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!t.get("EXT_frag_depth"))},THREE.WebGLGeometries=function(e,t,n){function i(e){var t=e.geometry;if(r[t.id]!==undefined)return r[t.id];t.addEventListener("dispose",s);var i;return t instanceof THREE.BufferGeometry?i=t:t instanceof THREE.Geometry&&(t._bufferGeometry===undefined&&(t._bufferGeometry=(new THREE.BufferGeometry).setFromObject(e)),i=t._bufferGeometry),r[t.id]=i,n.memory.geometries++,i}function s(e){var i=e.target,o=r[i.id];a(o.attributes),i.removeEventListener("dispose",s),delete r[i.id];var f=t.get(i);f.wireframe&&u(f.wireframe),n.memory.geometries--}function o(e){return e instanceof THREE.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function u(t){var n=o(t);n!==undefined&&(e.deleteBuffer(n),f(t))}function a(e){for(var t in e)u(e[t])}function f(e){e instanceof THREE.InterleavedBufferAttribute?t.delete(e.data):t.delete(e)}var r={};this.get=i},THREE.WebGLObjects=function(e,t,n){function i(t){var n=r.get(t);t.geometry instanceof THREE.Geometry&&n.updateFromObject(t);var i=n.index,o=n.attributes;i!==null&&s(i,e.ELEMENT_ARRAY_BUFFER);for(var u in o)s(o[u],e.ARRAY_BUFFER);var a=n.morphAttributes;for(var u in a){var f=a[u];for(var l=0,c=f.length;l<c;l++)s(f[l],e.ARRAY_BUFFER)}return n}function s(e,n){var r=e instanceof THREE.InterleavedBufferAttribute?e.data:e,i=t.get(r);i.__webglBuffer===undefined?o(i,r,n):i.version!==r.version&&u(i,r,n)}function o(t,n,r){t.__webglBuffer=e.createBuffer(),e.bindBuffer(r,t.__webglBuffer);var i=n.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW;e.bufferData(r,n.array,i),t.version=n.version}function u(t,n,r){e.bindBuffer(r,t.__webglBuffer),n.dynamic===!1||n.updateRange.count===-1?e.bufferSubData(r,0,n.array):n.updateRange.count===0?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,n.updateRange.offset*n.array.BYTES_PER_ELEMENT,n.array.subarray(n.updateRange.offset,n.updateRange.offset+n.updateRange.count)),n.updateRange.count=0),t.version=n.version}function a(e){return e instanceof THREE.InterleavedBufferAttribute?t.get(e.data).__webglBuffer:t.get(e).__webglBuffer}function f(n){var r=t.get(n);if(r.wireframe!==undefined)return r.wireframe;var i=[],o=n.index,u=n.attributes,a=u.position;if(o!==null){var f={},c=o.array;for(var h=0,p=c.length;h<p;h+=3){var d=c[h+0],v=c[h+1],m=c[h+2];l(f,d,v)&&i.push(d,v),l(f,v,m)&&i.push(v,m),l(f,m,d)&&i.push(m,d)}}else{var c=u.position.array;for(var h=0,p=c.length/3-1;h<p;h+=3){var d=h+0,v=h+1,m=h+2;i.push(d,v,v,m,m,d)}}var g=a.count>65535?Uint32Array:Uint16Array,y=new THREE.BufferAttribute(new g(i),1);return s(y,e.ELEMENT_ARRAY_BUFFER),r.wireframe=y,y}function l(e,t,n){if(t>n){var r=t;t=n,n=r}var i=e[t];return i===undefined?(e[t]=[n],!0):i.indexOf(n)===-1?(i.push(n),!0):!1}var r=new THREE.WebGLGeometries(e,t,n);this.getAttributeBuffer=a,this.getWireframeAttribute=f,this.update=i},THREE.WebGLProgram=function(){function t(e){var t=[];for(var n in e){var r=e[n];if(r===!1)continue;t.push("#define "+n+" "+r)}return t.join("\n")}function n(e,t,n){var r={},i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(var s=0;s<i;s++){var o=e.getActiveUniform(t,s),u=o.name,a=e.getUniformLocation(t,u),f=u.lastIndexOf("[0]");f!==-1&&f===u.length-3&&(r[u.substr(0,f)]=a),r[u]=a}return r}function r(e,t,n){var r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(var s=0;s<i;s++){var o=e.getActiveAttrib(t,s),u=o.name;r[u]=e.getAttribLocation(t,u)}return r}function i(e){return e!==""}var e=0;return function(o,u,a,f){var l=o.context,c=a.defines,h=a.__webglShader.vertexShader,p=a.__webglShader.fragmentShader,d="SHADOWMAP_TYPE_BASIC";f.shadowMapType===THREE.PCFShadowMap?d="SHADOWMAP_TYPE_PCF":f.shadowMapType===THREE.PCFSoftShadowMap&&(d="SHADOWMAP_TYPE_PCF_SOFT");var v="ENVMAP_TYPE_CUBE",m="ENVMAP_MODE_REFLECTION",g="ENVMAP_BLENDING_MULTIPLY";if(f.envMap){switch(a.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:v="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:v="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:v="ENVMAP_TYPE_SPHERE"}switch(a.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:m="ENVMAP_MODE_REFRACTION"}switch(a.combine){case THREE.MultiplyOperation:g="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:g="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:g="ENVMAP_BLENDING_ADD"}}var y=o.gammaFactor>0?o.gammaFactor:1,b=t(c),w=l.createProgram(),E,S;a instanceof THREE.RawShaderMaterial?(E="",S=""):(E=["precision "+f.precision+" float;","precision "+f.precision+" int;","#define SHADER_NAME "+a.__webglShader.name,b,f.supportsVertexTextures?"#define VERTEX_TEXTURES":"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,"#define MAX_DIR_LIGHTS "+f.maxDirLights,"#define MAX_POINT_LIGHTS "+f.maxPointLights,"#define MAX_SPOT_LIGHTS "+f.maxSpotLights,"#define MAX_HEMI_LIGHTS "+f.maxHemiLights,"#define MAX_SHADOWS "+f.maxShadows,"#define MAX_BONES "+f.maxBones,f.map?"#define USE_MAP":"",f.envMap?"#define USE_ENVMAP":"",f.envMap?"#define "+m:"",f.lightMap?"#define USE_LIGHTMAP":"",f.aoMap?"#define USE_AOMAP":"",f.emissiveMap?"#define USE_EMISSIVEMAP":"",f.bumpMap?"#define USE_BUMPMAP":"",f.normalMap?"#define USE_NORMALMAP":"",f.displacementMap&&f.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",f.specularMap?"#define USE_SPECULARMAP":"",f.alphaMap?"#define USE_ALPHAMAP":"",f.vertexColors?"#define USE_COLOR":"",f.flatShading?"#define FLAT_SHADED":"",f.skinning?"#define USE_SKINNING":"",f.useVertexTexture?"#define BONE_TEXTURE":"",f.morphTargets?"#define USE_MORPHTARGETS":"",f.morphNormals&&f.flatShading===!1?"#define USE_MORPHNORMALS":"",f.doubleSided?"#define DOUBLE_SIDED":"",f.flipSided?"#define FLIP_SIDED":"",f.shadowMapEnabled?"#define USE_SHADOWMAP":"",f.shadowMapEnabled?"#define "+d:"",f.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",f.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",f.sizeAttenuation?"#define USE_SIZEATTENUATION":"",f.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",f.logarithmicDepthBuffer&&o.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif","\n"].filter(i).join("\n"),S=[f.bumpMap||f.normalMap||f.flatShading||a.derivatives?"#extension GL_OES_standard_derivatives : enable":"",f.logarithmicDepthBuffer&&o.extensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"","precision "+f.precision+" float;","precision "+f.precision+" int;","#define SHADER_NAME "+a.__webglShader.name,b,"#define MAX_DIR_LIGHTS "+f.maxDirLights,"#define MAX_POINT_LIGHTS "+f.maxPointLights,"#define MAX_SPOT_LIGHTS "+f.maxSpotLights,"#define MAX_HEMI_LIGHTS "+f.maxHemiLights,"#define MAX_SHADOWS "+f.maxShadows,f.alphaTest?"#define ALPHATEST "+f.alphaTest:"",o.gammaInput?"#define GAMMA_INPUT":"",o.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+y,f.useFog&&f.fog?"#define USE_FOG":"",f.useFog&&f.fogExp?"#define FOG_EXP2":"",f.map?"#define USE_MAP":"",f.envMap?"#define USE_ENVMAP":"",f.envMap?"#define "+v:"",f.envMap?"#define "+m:"",f.envMap?"#define "+g:"",f.lightMap?"#define USE_LIGHTMAP":"",f.aoMap?"#define USE_AOMAP":"",f.emissiveMap?"#define USE_EMISSIVEMAP":"",f.bumpMap?"#define USE_BUMPMAP":"",f.normalMap?"#define USE_NORMALMAP":"",f.specularMap?"#define USE_SPECULARMAP":"",f.alphaMap?"#define USE_ALPHAMAP":"",f.vertexColors?"#define USE_COLOR":"",f.flatShading?"#define FLAT_SHADED":"",f.metal?"#define METAL":"",f.doubleSided?"#define DOUBLE_SIDED":"",f.flipSided?"#define FLIP_SIDED":"",f.shadowMapEnabled?"#define USE_SHADOWMAP":"",f.shadowMapEnabled?"#define "+d:"",f.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",f.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",f.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",f.logarithmicDepthBuffer&&o.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","\n"].filter(i).join("\n"));var x=E+h,T=S+p,N=THREE.WebGLShader(l,l.VERTEX_SHADER,x),C=THREE.WebGLShader(l,l.FRAGMENT_SHADER,T);l.attachShader(w,N),l.attachShader(w,C),a.index0AttributeName!==undefined?l.bindAttribLocation(w,0,a.index0AttributeName):f.morphTargets===!0&&l.bindAttribLocation(w,0,"position"),l.linkProgram(w);var k=l.getProgramInfoLog(w),L=l.getShaderInfoLog(N),A=l.getShaderInfoLog(C),O=!0,M=!0;if(l.getProgramParameter(w,l.LINK_STATUS)===!1)O=!1,console.error("THREE.WebGLProgram: shader error: ",l.getError(),"gl.VALIDATE_STATUS",l.getProgramParameter(w,l.VALIDATE_STATUS),"gl.getProgramInfoLog",k,L,A);else if(k!=="")console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",k);else if(L===""||A==="")M=!1;M&&(this.diagnostics={runnable:O,material:a,programLog:k,vertexShader:{log:L,prefix:E},fragmentShader:{log:A,prefix:S}}),l.deleteShader(N),l.deleteShader(C);var _;this.getUniforms=function(){return _===undefined&&(_=n(l,w)),_};var D;return this.getAttributes=function(){return D===undefined&&(D=r(l,w)),D},this.destroy=function(){l.deleteProgram(w),this.program=undefined},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=e++,this.code=u,this.usedTimes=1,this.program=w,this.vertexShader=N,this.fragmentShader=C,this}}(),THREE.WebGLPrograms=function(e,t){function s(e){if(t.floatVertexTextures&&e&&e.skeleton&&e.skeleton.useVertexTexture)return 1024;var n=t.maxVertexUniforms,r=Math.floor((n-20)/4),i=r;return e!==undefined&&e instanceof THREE.SkinnedMesh&&(i=Math.min(e.skeleton.bones.length,i),i<e.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.skeleton.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")),i}function o(e){var t=0,n=0,r=0,i=0;for(var s=0,o=e.length;s<o;s++){var u=e[s];if(u.onlyShadow||u.visible===!1)continue;u instanceof THREE.DirectionalLight&&t++,u instanceof THREE.PointLight&&n++,u instanceof THREE.SpotLight&&r++,u instanceof THREE.HemisphereLight&&i++}return{directional:t,point:n,spot:r,hemi:i}}function u(e){var t=0,n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];if(!s.castShadow)continue;(s instanceof THREE.SpotLight||s instanceof THREE.DirectionalLight)&&t++,s instanceof THREE.PointLight&&(t++,n++)}return{maxShadows:t,pointLightShadows:n}}var n=[],r={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},i=["precision","supportsVertexTextures","map","envMap","envMapMode","lightMap","aoMap","emissiveMap","bumpMap","normalMap","specularMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","maxDirLights","maxPointLights","maxSpotLights","maxHemiLights","maxShadows","shadowMapEnabled","pointLightShadows","shadowMapType","shadowMapDebug","alphaTest","metal","doubleSided","flipSided"];this.getParameters=function(n,i,a,f){var l=r[n.type],c=o(i),h=u(i),p=s(f),d=e.getPrecision();n.precision!==null&&(d=t.getMaxPrecision(n.precision),d!==n.precision&&console.warn("THREE.WebGLRenderer.initMaterial:",n.precision,"not supported, using",d,"instead."));var v={shaderID:l,precision:d,supportsVertexTextures:t.vertexTextures,map:!!n.map,envMap:!!n.envMap,envMapMode:n.envMap&&n.envMap.mapping,lightMap:!!n.lightMap,aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,displacementMap:!!n.displacementMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,combine:n.combine,vertexColors:n.vertexColors,fog:a,useFog:n.fog,fogExp:a instanceof THREE.FogExp2,flatShading:n.shading===THREE.FlatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:n.skinning,maxBones:p,useVertexTexture:t.floatVertexTextures&&f&&f.skeleton&&f.skeleton.useVertexTexture,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,maxDirLights:c.directional,maxPointLights:c.point,maxSpotLights:c.spot,maxHemiLights:c.hemi,maxShadows:h.maxShadows,pointLightShadows:h.pointLightShadows,shadowMapEnabled:e.shadowMap.enabled&&f.receiveShadow&&h.maxShadows>0,shadowMapType:e.shadowMap.type,shadowMapDebug:e.shadowMap.debug,alphaTest:n.alphaTest,metal:n.metal,doubleSided:n.side===THREE.DoubleSide,flipSided:n.side===THREE.BackSide};return v},this.getProgramCode=function(e,t){var n=[];t.shaderID?n.push(t.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader));if(e.defines!==undefined)for(var r in e.defines)n.push(r),n.push(e.defines[r]);for(var s=0;s<i.length;s++){var o=i[s];n.push(o),n.push(t[o])}return n.join()},this.acquireProgram=function(t,r,i){var s;for(var o=0,u=n.length;o<u;o++){var a=n[o];if(a.code===i){s=a,++s.usedTimes;break}}return s===undefined&&(s=new THREE.WebGLProgram(e,i,t,r),n.push(s)),s},this.releaseProgram=function(e){if(--e.usedTimes===0){var t=n.indexOf(e);n[t]=n[n.length-1],n.pop(),e.destroy()}},this.programs=n},THREE.WebGLProperties=function(){var e={};this.get=function(t){var n=t.uuid,r=e[n];return r===undefined&&(r={},e[n]=r),r},this.delete=function(t){delete e[t.uuid]},this.clear=function(){e={}}},THREE.WebGLShader=function(){var e=function(e){var t=e.split("\n");for(var n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")};return function(n,r,i){var s=n.createShader(r);return n.shaderSource(s,i),n.compileShader(s),n.getShaderParameter(s,n.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),n.getShaderInfoLog(s)!==""&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",r===n.VERTEX_SHADER?"vertex":"fragment",n.getShaderInfoLog(s),e(i)),s}}(),THREE.WebGLShadowMap=function(e,t,n){function M(e,t,n,r){var i=e.geometry,s=null,o=v,u=e.customDepthMaterial;n&&(o=m,u=e.customDistanceMaterial);if(!u){var a=i.morphTargets!==undefined&&i.morphTargets.length>0&&t.morphTargets,f=e instanceof THREE.SkinnedMesh&&t.skinning,l=0;a&&(l|=h),f&&(l|=p),s=o[l]}else s=u;return s.visible=t.visible,s.wireframe=t.wireframe,s.wireframeLinewidth=t.wireframeLinewidth,n&&s.uniforms.lightPos!==undefined&&s.uniforms.lightPos.value.copy(r),s}function _(e,t){if(e.visible===!1)return;if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points)if(e.castShadow&&(e.frustumCulled===!1||s.intersectsObject(e)===!0)){var n=e.material;n.visible===!0&&(e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),c.push(e))}var r=e.children;for(var i=0,o=r.length;i<o;i++)_(r[i],t)}var r=e.context,i=e.state,s=new THREE.Frustum,o=new THREE.Matrix4,u=new THREE.Vector3,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3,c=[],h=1,p=2,d=(h|p)+1,v=new Array(d),m=new Array(d),g=[new THREE.Vector3(1,0,0),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1),new THREE.Vector3(0,1,0),new THREE.Vector3(0,-1,0)],y=[new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,-1)],b=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],w=new THREE.Vector4,E=THREE.ShaderLib.depthRGBA,S=THREE.UniformsUtils.clone(E.uniforms),x=THREE.ShaderLib.distanceRGBA,T=THREE.UniformsUtils.clone(x.uniforms);for(var N=0;N!==d;++N){var C=(N&h)!==0,k=(N&p)!==0,L=new THREE.ShaderMaterial({uniforms:S,vertexShader:E.vertexShader,fragmentShader:E.fragmentShader,morphTargets:C,skinning:k});L._shadowPass=!0,v[N]=L;var A=new THREE.ShaderMaterial({uniforms:T,vertexShader:x.vertexShader,fragmentShader:x.fragmentShader,morphTargets:C,skinning:k});A._shadowPass=!0,m[N]=A}var O=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=THREE.PCFShadowMap,this.cullFace=THREE.CullFaceFront,this.render=function(u){var a,h;if(O.enabled===!1)return;if(O.autoUpdate===!1&&O.needsUpdate===!1)return;r.clearColor(1,1,1,1),i.disable(r.BLEND),i.enable(r.CULL_FACE),r.frontFace(r.CCW),O.cullFace===THREE.CullFaceFront?r.cullFace(r.FRONT):r.cullFace(r.BACK),i.setDepthTest(!0);for(var p=0,d=t.length;p<d;p++){var v=t[p];if(v instanceof THREE.PointLight){a=6,h=!0;var m=v.shadowMapWidth/4,E=v.shadowMapHeight/2;b[0].set(m*2,E,m,E),b[1].set(0,E,m,E),b[2].set(m*3,E,m,E),b[3].set(m,E,m,E),b[4].set(m*3,0,m,E),b[5].set(m,0,m,E)}else a=1,h=!1;if(!v.castShadow)continue;if(!v.shadowMap){var S=THREE.LinearFilter;O.type===THREE.PCFSoftShadowMap&&(S=THREE.NearestFilter);var x={minFilter:S,magFilter:S,format:THREE.RGBAFormat};v.shadowMap=new THREE.WebGLRenderTarget(v.shadowMapWidth,v.shadowMapHeight,x),v.shadowMapSize=new THREE.Vector2(v.shadowMapWidth,v.shadowMapHeight),v.shadowMatrix=new THREE.Matrix4}v.shadowCamera||(v instanceof THREE.SpotLight?v.shadowCamera=new THREE.PerspectiveCamera(v.shadowCameraFov,v.shadowMapWidth/v.shadowMapHeight,v.shadowCameraNear,v.shadowCameraFar):v instanceof THREE.DirectionalLight?v.shadowCamera=new THREE.OrthographicCamera(v.shadowCameraLeft,v.shadowCameraRight,v.shadowCameraTop,v.shadowCameraBottom,v.shadowCameraNear,v.shadowCameraFar):v.shadowCamera=new THREE.PerspectiveCamera(v.shadowCameraFov,1,v.shadowCameraNear,v.shadowCameraFar),u.add(v.shadowCamera),u.autoUpdate===!0&&u.updateMatrixWorld()),v.shadowCameraVisible&&!v.cameraHelper&&(v.cameraHelper=new THREE.CameraHelper(v.shadowCamera),u.add(v.cameraHelper));var T=v.shadowMap,N=v.shadowMatrix,C=v.shadowCamera;l.setFromMatrixPosition(v.matrixWorld),C.position.copy(l),e.getViewport(w),e.setRenderTarget(T),e.clear();for(var k=0;k<a;k++){if(h){f.copy(C.position),f.add(g[k]),C.up.copy(y[k]),C.lookAt(f);var L=b[k];e.setViewport(L.x,L.y,L.z,L.w)}else f.setFromMatrixPosition(v.target.matrixWorld),C.lookAt(f);C.updateMatrixWorld(),C.matrixWorldInverse.getInverse(C.matrixWorld),v.cameraHelper&&(v.cameraHelper.visible=v.shadowCameraVisible),v.shadowCameraVisible&&v.cameraHelper.update(),N.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),N.multiply(C.projectionMatrix),N.multiply(C.matrixWorldInverse),o.multiplyMatrices(C.projectionMatrix,C.matrixWorldInverse),s.setFromMatrix(o),c.length=0,_(u,C);for(var A=0,D=c.length;A<D;A++){var P=c[A],H=n.update(P),B=P.material;if(B instanceof THREE.MeshFaceMaterial){var j=H.groups,F=B.materials;for(var I=0,q=j.length;I<q;I++){var R=j[I],U=F[R.materialIndex];if(U.visible===!0){var z=M(P,U,h,l);e.renderBufferDirect(C,t,null,H,z,P,R)}}}else{var z=M(P,B,h,l);e.renderBufferDirect(C,t,null,H,z,P,null)}}}}var W=e.getClearColor(),X=e.getClearAlpha();e.setClearColor(W,X),i.enable(r.BLEND),O.cullFace===THREE.CullFaceFront&&r.cullFace(r.BACK),e.setViewport(w.x,w.y,w.z,w.w),e.resetGLState(),O.needsUpdate=!1}},THREE.WebGLState=function(e,t,n){var r=this,i=new Uint8Array(16),s=new Uint8Array(16),o=new Uint8Array(16),u={},a=null,f=null,l=null,c=null,h=null,p=null,d=null,v=null,m=null,g=null,y=null,b=null,w=null,E=null,S=null,x=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),T=undefined,N={};this.init=function(){e.clearColor(0,0,0,1),e.clearDepth(1),e.clearStencil(0),this.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.cullFace(e.BACK),this.enable(e.CULL_FACE),this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var e=0,t=i.length;e<t;e++)i[e]=0},this.enableAttribute=function(n){i[n]=1,s[n]===0&&(e.enableVertexAttribArray(n),s[n]=1);if(o[n]!==0){var r=t.get("ANGLE_instanced_arrays");r.vertexAttribDivisorANGLE(n,0),o[n]=0}},this.enableAttributeAndDivisor=function(t,n,r){i[t]=1,s[t]===0&&(e.enableVertexAttribArray(t),s[t]=1),o[t]!==n&&(r.vertexAttribDivisorANGLE(t,n),o[t]=n)},this.disableUnusedAttributes=function(){for(var t=0,n=s.length;t<n;t++)s[t]!==i[t]&&(e.disableVertexAttribArray(t),s[t]=0)},this.enable=function(t){u[t]!==!0&&(e.enable(t),u[t]=!0)},this.disable=function(t){u[t]!==!1&&(e.disable(t),u[t]=!1)},this.getCompressedTextureFormats=function(){if(a===null){a=[];if(t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")){var n=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS);for(var r=0;r<n.length;r++)a.push(n[r])}}return a},this.setBlending=function(t,r,i,s,o,u,a){t!==f&&(t===THREE.NoBlending?this.disable(e.BLEND):t===THREE.AdditiveBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===THREE.SubtractiveBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===THREE.MultiplyBlending?(this.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):t===THREE.CustomBlending?this.enable(e.BLEND):(this.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),f=t);if(t===THREE.CustomBlending){o=o||r,u=u||i,a=a||s;if(r!==l||o!==p)e.blendEquationSeparate(n(r),n(o)),l=r,p=o;if(i!==c||s!==h||u!==d||a!==v)e.blendFuncSeparate(n(i),n(s),n(u),n(a)),c=i,h=s,d=u,v=a}else l=null,c=null,h=null,p=null,d=null,v=null},this.setDepthFunc=function(t){if(m!==t){if(t)switch(t){case THREE.NeverDepth:e.depthFunc(e.NEVER);break;case THREE.AlwaysDepth:e.depthFunc(e.ALWAYS);break;case THREE.LessDepth:e.depthFunc(e.LESS);break;case THREE.LessEqualDepth:e.depthFunc(e.LEQUAL);break;case THREE.EqualDepth:e.depthFunc(e.EQUAL);break;case THREE.GreaterEqualDepth:e.depthFunc(e.GEQUAL);break;case THREE.GreaterDepth:e.depthFunc(e.GREATER);break;case THREE.NotEqualDepth:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);m=t}},this.setDepthTest=function(t){t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)},this.setDepthWrite=function(t){g!==t&&(e.depthMask(t),g=t)},this.setColorWrite=function(t){y!==t&&(e.colorMask(t,t,t,t),y=t)},this.setFlipSided=function(t){b!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),b=t)},this.setLineWidth=function(t){t!==w&&(e.lineWidth(t),w=t)},this.setPolygonOffset=function(t,n,r){t?this.enable(e.POLYGON_OFFSET_FILL):this.disable(e.POLYGON_OFFSET_FILL),t&&(E!==n||S!==r)&&(e.polygonOffset(n,r),E=n,S=r)},this.setScissorTest=function(t){t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)},this.activeTexture=function(t){t===undefined&&(t=e.TEXTURE0+x-1),T!==t&&(e.activeTexture(t),T=t)},this.bindTexture=function(t,n){T===undefined&&r.activeTexture();var i=N[T];i===undefined&&(i={type:undefined,texture:undefined},N[T]=i);if(i.type!==t||i.texture!==n)e.bindTexture(t,n),i.type=t,i.texture=n},this.compressedTexImage2D=function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.texImage2D=function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error(t)}},this.reset=function(){for(var t=0;t<s.length;t++)s[t]===1&&(e.disableVertexAttribArray(t),s[t]=0);u={},a=null,f=null,g=null,y=null,b=null}},THREE.LensFlarePlugin=function(e,t){function p(t){var r=n.createProgram(),i=n.createShader(n.FRAGMENT_SHADER),s=n.createShader(n.VERTEX_SHADER),o="precision "+e.getPrecision()+" float;\n";return n.shaderSource(i,o+t.fragmentShader),n.shaderSource(s,o+t.vertexShader),n.compileShader(i),n.compileShader(s),n.attachShader(r,i),n.attachShader(r,s),n.linkProgram(r),r}var n=e.context,r=e.state,i,s,o,u,a,f,l,c,h=function(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);i=n.createBuffer(),s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW),l=n.createTexture(),c=n.createTexture(),r.bindTexture(n.TEXTURE_2D,l),n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),r.bindTexture(n.TEXTURE_2D,c),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var h;f?h={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:h={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},o=p(h),u={vertex:n.getAttribLocation(o,"position"),uv:n.getAttribLocation(o,"uv")},a={renderType:n.getUniformLocation(o,"renderType"),map:n.getUniformLocation(o,"map"),occlusionMap:n.getUniformLocation(o,"occlusionMap"),opacity:n.getUniformLocation(o,"opacity"),color:n.getUniformLocation(o,"color"),scale:n.getUniformLocation(o,"scale"),rotation:n.getUniformLocation(o,"rotation"),screenPosition:n.getUniformLocation(o,"screenPosition")}};this.render=function(p,d,v,m){if(t.length===0)return;var g=new THREE.Vector3,y=m/v,b=v*.5,w=m*.5,E=16/m,S=new THREE.Vector2(E*y,E),x=new THREE.Vector3(1,1,0),T=new THREE.Vector2(1,1);o===undefined&&h(),n.useProgram(o),r.initAttributes(),r.enableAttribute(u.vertex),r.enableAttribute(u.uv),r.disableUnusedAttributes(),n.uniform1i(a.occlusionMap,0),n.uniform1i(a.map,1),n.bindBuffer(n.ARRAY_BUFFER,i),n.vertexAttribPointer(u.vertex,2,n.FLOAT,!1,16,0),n.vertexAttribPointer(u.uv,2,n.FLOAT,!1,16,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s),r.disable(n.CULL_FACE),n.depthMask(!1);for(var N=0,C=t.length;N<C;N++){E=16/m,S.set(E*y,E);var k=t[N];g.set(k.matrixWorld.elements[12],k.matrixWorld.elements[13],k.matrixWorld.elements[14]),g.applyMatrix4(d.matrixWorldInverse),g.applyProjection(d.projectionMatrix),x.copy(g),T.x=x.x*b+b,T.y=x.y*w+w;if(f||T.x>0&&T.x<v&&T.y>0&&T.y<m){r.activeTexture(n.TEXTURE0),r.bindTexture(n.TEXTURE_2D,null),r.activeTexture(n.TEXTURE1),r.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,T.x-8,T.y-8,16,16,0),n.uniform1i(a.renderType,0),n.uniform2f(a.scale,S.x,S.y),n.uniform3f(a.screenPosition,x.x,x.y,x.z),r.disable(n.BLEND),r.enable(n.DEPTH_TEST),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),r.activeTexture(n.TEXTURE0),r.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,T.x-8,T.y-8,16,16,0),n.uniform1i(a.renderType,1),r.disable(n.DEPTH_TEST),r.activeTexture(n.TEXTURE1),r.bindTexture(n.TEXTURE_2D,l),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),k.positionScreen.copy(x),k.customUpdateCallback?k.customUpdateCallback(k):k.updateLensFlares(),n.uniform1i(a.renderType,2),r.enable(n.BLEND);for(var L=0,A=k.lensFlares.length;L<A;L++){var O=k.lensFlares[L];O.opacity>.001&&O.scale>.001&&(x.x=O.x,x.y=O.y,x.z=O.z,E=O.size*O.scale/m,S.x=E*y,S.y=E,n.uniform3f(a.screenPosition,x.x,x.y,x.z),n.uniform2f(a.scale,S.x,S.y),n.uniform1f(a.rotation,O.rotation),n.uniform1f(a.opacity,O.opacity),n.uniform3f(a.color,O.color.r,O.color.g,O.color.b),r.setBlending(O.blending,O.blendEquation,O.blendSrc,O.blendDst),e.setTexture(O.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}}}r.enable(n.CULL_FACE),r.enable(n.DEPTH_TEST),n.depthMask(!0),e.resetGLState()}},THREE.SpritePlugin=function(e,t){function d(){var t=n.createProgram(),r=n.createShader(n.VERTEX_SHADER),i=n.createShader(n.FRAGMENT_SHADER);return n.shaderSource(r,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),n.shaderSource(i,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),n.compileShader(r),n.compileShader(i),n.attachShader(t,r),n.attachShader(t,i),n.linkProgram(t),t}function v(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var n=e.context,r=e.state,i,s,o,u,a,f,l=new THREE.Vector3,c=new THREE.Quaternion,h=new THREE.Vector3,p=function(){var e=new Float32Array([-0.5,-0.5,0,0,.5,-0.5,1,0,.5,.5,1,1,-0.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);i=n.createBuffer(),s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW),o=d(),u={position:n.getAttribLocation(o,"position"),uv:n.getAttribLocation(o,"uv")},a={uvOffset:n.getUniformLocation(o,"uvOffset"),uvScale:n.getUniformLocation(o,"uvScale"),rotation:n.getUniformLocation(o,"rotation"),scale:n.getUniformLocation(o,"scale"),color:n.getUniformLocation(o,"color"),map:n.getUniformLocation(o,"map"),opacity:n.getUniformLocation(o,"opacity"),modelViewMatrix:n.getUniformLocation(o,"modelViewMatrix"),projectionMatrix:n.getUniformLocation(o,"projectionMatrix"),fogType:n.getUniformLocation(o,"fogType"),fogDensity:n.getUniformLocation(o,"fogDensity"),fogNear:n.getUniformLocation(o,"fogNear"),fogFar:n.getUniformLocation(o,"fogFar"),fogColor:n.getUniformLocation(o,"fogColor"),alphaTest:n.getUniformLocation(o,"alphaTest")};var r=document.createElement("canvas");r.width=8,r.height=8;var l=r.getContext("2d");l.fillStyle="white",l.fillRect(0,0,8,8),f=new THREE.Texture(r),f.needsUpdate=!0};this.render=function(d,m){if(t.length===0)return;o===undefined&&p(),n.useProgram(o),r.initAttributes(),r.enableAttribute(u.position),r.enableAttribute(u.uv),r.disableUnusedAttributes(),r.disable(n.CULL_FACE),r.enable(n.BLEND),n.bindBuffer(n.ARRAY_BUFFER,i),n.vertexAttribPointer(u.position,2,n.FLOAT,!1,16,0),n.vertexAttribPointer(u.uv,2,n.FLOAT,!1,16,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s),n.uniformMatrix4fv(a.projectionMatrix,!1,m.projectionMatrix.elements),r.activeTexture(n.TEXTURE0),n.uniform1i(a.map,0);var g=0,y=0,b=d.fog;b?(n.uniform3f(a.fogColor,b.color.r,b.color.g,b.color.b),b instanceof THREE.Fog?(n.uniform1f(a.fogNear,b.near),n.uniform1f(a.fogFar,b.far),n.uniform1i(a.fogType,1),g=1,y=1):b instanceof THREE.FogExp2&&(n.uniform1f(a.fogDensity,b.density),n.uniform1i(a.fogType,2),g=2,y=2)):(n.uniform1i(a.fogType,0),g=0,y=0);for(var w=0,E=t.length;w<E;w++){var S=t[w];S.modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,S.matrixWorld),S.z=-S.modelViewMatrix.elements[14]}t.sort(v);var x=[];for(var w=0,E=t.length;w<E;w++){var S=t[w],T=S.material;n.uniform1f(a.alphaTest,T.alphaTest),n.uniformMatrix4fv(a.modelViewMatrix,!1,S.modelViewMatrix.elements),S.matrixWorld.decompose(l,c,h),x[0]=h.x,x[1]=h.y;var N=0;d.fog&&T.fog&&(N=y),g!==N&&(n.uniform1i(a.fogType,N),g=N),T.map!==null?(n.uniform2f(a.uvOffset,T.map.offset.x,T.map.offset.y),n.uniform2f(a.uvScale,T.map.repeat.x,T.map.repeat.y)):(n.uniform2f(a.uvOffset,0,0),n.uniform2f(a.uvScale,1,1)),n.uniform1f(a.opacity,T.opacity),n.uniform3f(a.color,T.color.r,T.color.g,T.color.b),n.uniform1f(a.rotation,T.rotation),n.uniform2fv(a.scale,x),r.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),r.setDepthTest(T.depthTest),r.setDepthWrite(T.depthWrite),T.map&&T.map.image&&T.map.image.width?e.setTexture(T.map,0):e.setTexture(f,0),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}r.enable(n.CULL_FACE),e.resetGLState()}},THREE.GeometryUtils={merge:function(e,t,n){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},THREE.ImageUtils={crossOrigin:undefined,loadTexture:function(e,t,n,r){var i=new THREE.ImageLoader;i.crossOrigin=this.crossOrigin;var s=new THREE.Texture(undefined,t);return i.load(e,function(e){s.image=e,s.needsUpdate=!0,n&&n(s)},undefined,function(e){r&&r(e)}),s.sourceFile=e,s},loadTextureCube:function(e,t,n,r){var i=[],s=new THREE.ImageLoader;s.crossOrigin=this.crossOrigin;var o=new THREE.CubeTexture(i,t),u=0,a=function(t){s.load(e[t],function(e){o.images[t]=e,u+=1,u===6&&(o.needsUpdate=!0,n&&n(o))},undefined,r)};for(var f=0,l=e.length;f<l;++f)a(f);return o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,t){var n=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},r=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var s=e.width,o=e.height,u=document.createElement("canvas");u.width=s,u.height=o;var a=u.getContext("2d");a.drawImage(e,0,0);var f=a.getImageData(0,0,s,o).data,l=a.createImageData(s,o),c=l.data;for(var h=0;h<s;h++)for(var p=0;p<o;p++){var d=p-1<0?0:p-1,v=p+1>o-1?o-1:p+1,m=h-1<0?0:h-1,g=h+1>s-1?s-1:h+1,y=[],b=[0,0,f[(p*s+h)*4]/255*t];y.push([-1,0,f[(p*s+m)*4]/255*t]),y.push([-1,-1,f[(d*s+m)*4]/255*t]),y.push([0,-1,f[(d*s+h)*4]/255*t]),y.push([1,-1,f[(d*s+g)*4]/255*t]),y.push([1,0,f[(p*s+g)*4]/255*t]),y.push([1,1,f[(v*s+g)*4]/255*t]),y.push([0,1,f[(v*s+h)*4]/255*t]),y.push([-1,1,f[(v*s+m)*4]/255*t]);var w=[],E=y.length;for(var S=0;S<E;S++){var x=y[S],T=y[(S+1)%E];x=r(x,b),T=r(T,b),w.push(i(n(x,T)))}var N=[0,0,0];for(var S=0;S<w.length;S++)N[0]+=w[S][0],N[1]+=w[S][1],N[2]+=w[S][2];N[0]/=w.length,N[1]/=w.length,N[2]/=w.length;var C=(p*s+h)*4;c[C]=(N[0]+1)/2*255|0,c[C+1]=(N[1]+1)/2*255|0,c[C+2]=N[2]*255|0,c[C+3]=255}return a.putImageData(l,0,0),u},generateDataTexture:function(e,t,n){var r=e*t,i=new Uint8Array(3*r),s=Math.floor(n.r*255),o=Math.floor(n.g*255),u=Math.floor(n.b*255);for(var a=0;a<r;a++)i[a*3]=s,i[a*3+1]=o,i[a*3+2]=u;var f=new THREE.DataTexture(i,e,t,THREE.RGBFormat);return f.needsUpdate=!0,f}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){var n=new THREE.Group;for(var r=0,i=t.length;r<i;r++)n.add(new THREE.Mesh(e,t[r]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face.toLowerCase()][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var t=e.familyName.toLowerCase(),n=this;return n.faces[t]=n.faces[t]||{},n.faces[t][e.cssFontWeight]=n.faces[t][e.cssFontWeight]||{},n.faces[t][e.cssFontWeight][e.cssFontStyle]=e,n.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,n=this.getFace(),r=this.size/n.resolution,i=0,s=String(e).split(""),o=s.length,u=[];for(t=0;t<o;t++){var a=new THREE.Path,f=this.extractGlyphPoints(s[t],n,r,i,a);i+=f.offset,u.push(f.path)}var l=i/2;return{paths:u,offset:l}},extractGlyphPoints:function(e,t,n,r,i){var s=[],o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=t.glyphs[e]||t.glyphs["?"];if(!N)return;if(N.o){f=N._cachedOutline||(N._cachedOutline=N.o.split(" ")),c=f.length,h=n,p=n;for(o=0;o<c;){l=f[o++];switch(l){case"m":d=f[o++]*h+r,v=f[o++]*p,i.moveTo(d,v);break;case"l":d=f[o++]*h+r,v=f[o++]*p,i.lineTo(d,v);break;case"q":m=f[o++]*h+r,g=f[o++]*p,w=f[o++]*h+r,E=f[o++]*p,i.quadraticCurveTo(w,E,m,g),T=s[s.length-1];if(T){y=T.x,b=T.y;for(u=1,a=this.divisions;u<=a;u++){var C=u/a;THREE.Shape.Utils.b2(C,y,w,m),THREE.Shape.Utils.b2(C,b,E,g)}}break;case"b":m=f[o++]*h+r,g=f[o++]*p,w=f[o++]*h+r,E=f[o++]*p,S=f[o++]*h+r,x=f[o++]*p,i.bezierCurveTo(w,E,S,x,m,g),T=s[s.length-1];if(T){y=T.x,b=T.y;for(u=1,a=this.divisions;u<=a;u++){var C=u/a;THREE.Shape.Utils.b3(C,y,w,S,m),THREE.Shape.Utils.b3(C,b,E,x,g)}}}}}return{offset:N.ha*n,path:i}}},THREE.FontUtils.generateShapes=function(e,t){t=t||{};var n=t.size!==undefined?t.size:100,r=t.curveSegments!==undefined?t.curveSegments:4,i=t.font!==undefined?t.font:"helvetiker",s=t.weight!==undefined?t.weight:"normal",o=t.style!==undefined?t.style:"normal";THREE.FontUtils.size=n,THREE.FontUtils.divisions=r,THREE.FontUtils.face=i,THREE.FontUtils.weight=s,THREE.FontUtils.style=o;var u=THREE.FontUtils.drawText(e),a=u.paths,f=[];for(var l=0,c=a.length;l<c;l++)Array.prototype.push.apply(f,a[l].toShapes());return f},function(e){var t=1e-10,n=function(e,t){var n=e.length;if(n<3)return null;var s=[],o=[],u=[],a,f,l;if(r(e)>0)for(f=0;f<n;f++)o[f]=f;else for(f=0;f<n;f++)o[f]=n-1-f;var c=n,h=2*c;for(f=c-1;c>2;){if(h--<=0)return console.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()"),t?u:s;a=f,c<=a&&(a=0),f=a+1,c<=f&&(f=0),l=f+1,c<=l&&(l=0);if(i(e,a,f,l,c,o)){var p,d,v,m,g;p=o[a],d=o[f],v=o[l],s.push([e[p],e[d],e[v]]),u.push([o[a],o[f],o[l]]);for(m=f,g=f+1;g<c;m++,g++)o[m]=o[g];c--,h=2*c}}return t?u:s},r=function(e){var t=e.length,n=0;for(var r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return n*.5},i=function(e,n,r,i,s,o){var u,a,f,l,c,h,p,d,v;a=e[o[n]].x,f=e[o[n]].y,l=e[o[r]].x,c=e[o[r]].y,h=e[o[i]].x,p=e[o[i]].y;if(t>(l-a)*(p-f)-(c-f)*(h-a))return!1;var m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;m=h-l,g=p-c,y=a-h,b=f-p,w=l-a,E=c-f;for(u=0;u<s;u++){d=e[o[u]].x,v=e[o[u]].y;if(d===a&&v===f||d===l&&v===c||d===h&&v===p)continue;S=d-a,x=v-f,T=d-l,N=v-c,C=d-h,k=v-p,O=m*N-g*T,L=w*x-E*S,A=y*k-b*C;if(O>=-t&&A>=-t&&L>=-t)return!1}return!0};return e.Triangulate=n,e.Triangulate.area=r,e}(THREE.FontUtils),THREE.typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},typeof self!="undefined"&&(self._typeface_js=THREE.typeface_js),THREE.Audio=function(e){THREE.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1},THREE.Audio.prototype=Object.create(THREE.Object3D.prototype),THREE.Audio.prototype.constructor=THREE.Audio,THREE.Audio.prototype.load=function(e){var t=this,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(e){t.context.decodeAudioData(this.response,function(e){t.source.buffer=e,t.autoplay&&t.play()})},n.send(),this},THREE.Audio.prototype.play=function(){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}var e=this.context.createBufferSource();e.buffer=this.source.buffer,e.loop=this.source.loop,e.onended=this.source.onended,e.start(0,this.startTime),e.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=e,this.connect()},THREE.Audio.prototype.pause=function(){this.source.stop(),this.startTime=this.context.currentTime},THREE.Audio.prototype.stop=function(){this.source.stop(),this.startTime=0},THREE.Audio.prototype.connect=function(){this.filter!==undefined?(this.source.connect(this.filter),this.filter.connect(this.panner)):this.source.connect(this.panner)},THREE.Audio.prototype.disconnect=function(){this.filter!==undefined?(this.source.disconnect(this.filter),this.filter.disconnect(this.panner)):this.source.disconnect(this.panner)},THREE.Audio.prototype.setFilter=function(e){this.isPlaying===!0?(this.disconnect(),this.filter=e,this.connect()):this.filter=e},THREE.Audio.prototype.getFilter=function(){return this.filter},THREE.Audio.prototype.setPlaybackRate=function(e){this.playbackRate=e,this.isPlaying===!0&&(this.source.playbackRate.value=this.playbackRate)},THREE.Audio.prototype.getPlaybackRate=function(){return this.playbackRate},THREE.Audio.prototype.onEnded=function(){this.isPlaying=!1},THREE.Audio.prototype.setLoop=function(e){this.source.loop=e},THREE.Audio.prototype.getLoop=function(){return this.source.loop},THREE.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},THREE.Audio.prototype.getRefDistance=function(){return this.panner.refDistance},THREE.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},THREE.Audio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},THREE.Audio.prototype.setVolume=function(e){this.gain.gain.value=e},THREE.Audio.prototype.getVolume=function(){return this.gain.gain.value},THREE.Audio.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3;return function(n){THREE.Object3D.prototype.updateMatrixWorld.call(this,n),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),THREE.AudioListener=function(){THREE.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype),THREE.AudioListener.prototype.constructor=THREE.AudioListener,THREE.AudioListener.prototype.updateMatrixWorld=function(){var e=new THREE.Vector3,t=new THREE.Quaternion,n=new THREE.Vector3,r=new THREE.Vector3;return function(s){THREE.Object3D.prototype.updateMatrixWorld.call(this,s);var o=this.context.listener,u=this.up;this.matrixWorld.decompose(e,t,n),r.set(0,0,-1).applyQuaternion(t),o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z,u.x,u.y,u.z)}}(),THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(e){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t,t},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;t?s=t:s=e*n[i-1];var o=0,u=i-1,a;while(o<=u){r=Math.floor(o+(u-o)/2),a=n[r]-s;if(a<0)o=r+1;else{if(!(a>0)){u=r;break}u=r-1}}r=u;if(n[r]===s){var f=r/(i-1);return f}var l=n[r],c=n[r+1],h=c-l,p=(s-l)/h,f=(r+p)/(i-1);return f},THREE.Curve.prototype.getTangent=function(e){var t=1e-4,n=e-t,r=e+t;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),s=this.getPoint(r),o=s.clone().sub(i);return o.normalize()},THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){var s=6*e*e-6*e,o=3*e*e-4*e+1,u=-6*e*e+6*e,a=3*e*e-2*e;return s+o+u+a},interpolate:function(e,t,n,r,i){var s=(n-e)*.5,o=(r-t)*.5,u=i*i,a=i*u;return(2*t-2*n+s+o)*a+(-3*t+3*n-2*s-o)*u+s*i+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.constructor=THREE.CurvePath,THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength(),n=this.getCurveLengths(),r=0,i,s;while(r<n.length){if(n[r]>=t){i=n[r]-t,s=this.curves[r];var o=1-i/s.getLength();return s.getPointAt(o)}r++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,n,r,i,s,o;t=n=Number.NEGATIVE_INFINITY,i=s=Number.POSITIVE_INFINITY;var u,a,f,l,c=e[0]instanceof THREE.Vector3;l=c?new THREE.Vector3:new THREE.Vector2;for(a=0,f=e.length;a<f;a++)u=e[a],u.x>t?t=u.x:u.x<i&&(i=u.x),u.y>n?n=u.y:u.y<s&&(s=u.y),c&&(u.z>r?r=u.z:u.z<o&&(o=u.z)),l.add(u);var h={minX:i,minY:s,maxX:t,maxY:n};return c&&(h.maxZ=r,h.minZ=o),h},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){var t=new THREE.Geometry;for(var n=0;n<e.length;n++)t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,e[n].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends);for(r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends);for(r=0,i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;for(r=0,i=e.length;r<i;r++){s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o);var f=t.getPoint(a),l=t.getTangent(a);l.set(-l.y,l.x).multiplyScalar(u),s.x=f.x+l.x,s.y=f.y+l.y}return e},THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.Path.prototype.constructor=THREE.Path,THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],s=r[r.length-1],o=new THREE.LineCurve(new THREE.Vector2(i,s),new THREE.Vector2(e,t));this.curves.push(o),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,o=s[s.length-2],u=s[s.length-1],a=new THREE.QuadraticBezierCurve(new THREE.Vector2(o,u),new THREE.Vector2(e,t),new THREE.Vector2(n,r));this.curves.push(a),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=this.actions[this.actions.length-1].args,a=u[u.length-2],f=u[u.length-1],l=new THREE.CubicBezierCurve(new THREE.Vector2(a,f),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,s));this.curves.push(l),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,r=n[n.length-2],i=n[n.length-1],s=[new THREE.Vector2(r,i)];Array.prototype.push.apply(s,e);var o=new THREE.SplineCurve(s);this.curves.push(o),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args,u=o[o.length-2],a=o[o.length-1];this.absarc(e+u,t+a,n,r,i,s)},THREE.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},THREE.Path.prototype.ellipse=function(e,t,n,r,i,s,o,u){var a=this.actions[this.actions.length-1].args,f=a[a.length-2],l=a[a.length-1];this.absellipse(e+f,t+l,n,r,i,s,o,u)},THREE.Path.prototype.absellipse=function(e,t,n,r,i,s,o,u){var a=[e,t,n,r,i,s,o,u||0],f=new THREE.EllipseCurve(e,t,n,r,i,s,o,u);this.curves.push(f);var l=f.getPoint(1);a.push(l.x),a.push(l.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:a})},THREE.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);var n=[];for(var r=0;r<e;r++)n.push(this.getPoint(r/e));return n},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return this.getSpacedPoints(e,t);e=e||12;var n=[],r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;for(r=0,i=this.actions.length;r<i;r++){s=this.actions[r],o=s.action,u=s.args;switch(o){case THREE.PathActions.MOVE_TO:n.push(new THREE.Vector2(u[0],u[1]));break;case THREE.PathActions.LINE_TO:n.push(new THREE.Vector2(u[0],u[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:a=u[2],f=u[3],h=u[0],p=u[1],n.length>0?(m=n[n.length-1],d=m.x,v=m.y):(m=this.actions[r-1].args,d=m[m.length-2],v=m[m.length-1]);for(g=1;g<=e;g++)y=g/e,b=THREE.Shape.Utils.b2(y,d,h,a),w=THREE.Shape.Utils.b2(y,v,p,f),n.push(new THREE.Vector2(b,w));break;case THREE.PathActions.BEZIER_CURVE_TO:a=u[4],f=u[5],h=u[0],p=u[1],l=u[2],c=u[3],n.length>0?(m=n[n.length-1],d=m.x,v=m.y):(m=this.actions[r-1].args,d=m[m.length-2],v=m[m.length-1]);for(g=1;g<=e;g++)y=g/e,b=THREE.Shape.Utils.b3(y,d,h,l,a),w=THREE.Shape.Utils.b3(y,v,p,c,f),n.push(new THREE.Vector2(b,w));break;case THREE.PathActions.CSPLINE_THRU:m=this.actions[r-1].args;var E=new THREE.Vector2(m[m.length-2],m[m.length-1]),S=[E],x=e*u[0].length;S=S.concat(u[0]);var T=new THREE.SplineCurve(S);for(g=1;g<=x;g++)n.push(T.getPointAt(g/x));break;case THREE.PathActions.ARC:var N=u[0],C=u[1],k=u[2],L=u[3],A=u[4],O=!!u[5],M=A-L,_,D=e*2;for(g=1;g<=D;g++)y=g/D,O||(y=1-y),_=L+y*M,b=N+k*Math.cos(_),w=C+k*Math.sin(_),n.push(new THREE.Vector2(b,w));break;case THREE.PathActions.ELLIPSE:var N=u[0],C=u[1],P=u[2],H=u[3],L=u[4],A=u[5],O=!!u[6],B=u[7],M=A-L,_,D=e*2,j,F;B!==0&&(j=Math.cos(B),F=Math.sin(B));for(g=1;g<=D;g++){y=g/D,O||(y=1-y),_=L+y*M,b=N+P*Math.cos(_),w=C+H*Math.sin(_);if(B!==0){var I=b,q=w;b=(I-N)*j-(q-C)*F+N,w=(I-N)*F+(q-C)*j+C}n.push(new THREE.Vector2(b,w))}}}var R=n[n.length-1],U=1e-10;return Math.abs(R.x-n[0].x)<U&&Math.abs(R.y-n[0].y)<U&&n.splice(n.length-1,1),t&&n.push(n[0]),n},THREE.Path.prototype.toShapes=function(e,t){function n(e){var t,n,r,i,s,o=[],u=new THREE.Path;for(t=0,n=e.length;t<n;t++)r=e[t],s=r.args,i=r.action,i===THREE.PathActions.MOVE_TO&&u.actions.length!==0&&(o.push(u),u=new THREE.Path),u[i].apply(u,s);return u.actions.length!==0&&o.push(u),o}function r(e){var t=[];for(var n=0,r=e.length;n<r;n++){var i=e[n],s=new THREE.Shape;s.actions=i.actions,s.curves=i.curves,t.push(s)}return t}function i(e,t){var n=1e-10,r=t.length,i=!1;for(var s=r-1,o=0;o<r;s=o++){var u=t[s],a=t[o],f=a.x-u.x,l=a.y-u.y;if(Math.abs(l)>n){l<0&&(u=t[o],f=-f,a=t[s],l=-l);if(e.y<u.y||e.y>a.y)continue;if(e.y===u.y){if(e.x===u.x)return!0}else{var c=l*(e.x-u.x)-f*(e.y-u.y);if(c===0)return!0;if(c<0)continue;i=!i}}else{if(e.y!==u.y)continue;if(a.x<=e.x&&e.x<=u.x||u.x<=e.x&&e.x<=a.x)return!0}}return i}var s=n(this.actions);if(s.length===0)return[];if(t===!0)return r(s);var o,u,a,f=[];if(s.length===1)return u=s[0],a=new THREE.Shape,a.actions=u.actions,a.curves=u.curves,f.push(a),f;var l=!THREE.Shape.Utils.isClockWise(s[0].getPoints());l=e?!l:l;var c=[],h=[],p=[],d=0,v;h[d]=undefined,p[d]=[];var m,g;for(m=0,g=s.length;m<g;m++)u=s[m],v=u.getPoints(),o=THREE.Shape.Utils.isClockWise(v),o=e?!o:o,o?(!l&&h[d]&&d++,h[d]={s:new THREE.Shape,p:v},h[d].s.actions=u.actions,h[d].s.curves=u.curves,l&&d++,p[d]=[]):p[d].push({h:u,p:v[0]});if(!h[0])return r(s);if(h.length>1){var y=!1,b=[];for(var w=0,E=h.length;w<E;w++)c[w]=[];for(var w=0,E=h.length;w<E;w++){var S=p[w];for(var x=0;x<S.length;x++){var T=S[x],N=!0;for(var C=0;C<h.length;C++)i(T.p,h[C].p)&&(w!==C&&b.push({froms:w,tos:C,hole:x}),N?(N=!1,c[C].push(T)):y=!0);N&&c[w].push(T)}}b.length>0&&(y||(p=c))}var k,L,A;for(m=0,g=h.length;m<g;m++){a=h[m].s,f.push(a),k=p[m];for(L=0,A=k.length;L<A;L++)a.holes.push(k[L].h)}return f},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.constructor=THREE.Shape,THREE.Shape.prototype.extrude=function(e){var t=new THREE.ExtrudeGeometry(this,e);return t},THREE.Shape.prototype.makeGeometry=function(e){var t=new THREE.ShapeGeometry(this,e);return t},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){return e.x!==t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function r(e,t,r,i,s){var o=1e-10,u=t.x-e.x,a=t.y-e.y,f=i.x-r.x,l=i.y-r.y,c=e.x-r.x,h=e.y-r.y,p=a*f-u*l,d=a*c-u*h;if(Math.abs(p)>o){var v;if(p>0){if(d<0||d>p)return[];v=l*c-f*h;if(v<0||v>p)return[]}else{if(d>0||d<p)return[];v=l*c-f*h;if(v>0||v<p)return[]}if(v===0)return!s||d!==0&&d!==p?[e]:[];if(v===p)return!s||d!==0&&d!==p?[t]:[];if(d===0)return[r];if(d===p)return[i];var m=v/p;return[{x:e.x+m*u,y:e.y+m*a}]}if(d!==0||l*c!==f*h)return[];var g=u===0&&a===0,y=f===0&&l===0;if(g&&y)return e.x!==r.x||e.y!==r.y?[]:[e];if(g)return n(r,i,e)?[e]:[];if(y)return n(e,t,r)?[r]:[];var b,w,E,S,x,T,N,C;u!==0?(e.x<t.x?(b=e,E=e.x,w=t,S=t.x):(b=t,E=t.x,w=e,S=e.x),r.x<i.x?(x=r,N=r.x,T=i,C=i.x):(x=i,N=i.x,T=r,C=r.x)):(e.y<t.y?(b=e,E=e.y,w=t,S=t.y):(b=t,E=t.y,w=e,S=e.y),r.y<i.y?(x=r,N=r.y,T=i,C=i.y):(x=i,N=i.y,T=r,C=r.y));if(E<=N)return S<N?[]:S===N?s?[]:[x]:S<=C?[x,w]:[x,T];return E>C?[]:E===C?s?[]:[b]:S<=C?[b,w]:[b,T]}function i(e,t,n,r){var i=1e-10,s=t.x-e.x,o=t.y-e.y,u=n.x-e.x,a=n.y-e.y,f=r.x-e.x,l=r.y-e.y,c=s*a-o*u,h=s*l-o*f;if(Math.abs(c)>i){var p=f*a-l*u;return c>0?h>=0&&p>=0:h>=0||p>=0}return h>0}function s(e,t){function o(e,t){var r=n.length-1,o=e-1;o<0&&(o=r);var u=e+1;u>r&&(u=0);var a=i(n[e],n[o],n[u],s[t]);if(!a)return!1;var f=s.length-1,l=t-1;l<0&&(l=f);var c=t+1;return c>f&&(c=0),a=i(s[t],s[l],s[c],n[e]),a?!0:!1}function u(e,t){var i,s,o;for(i=0;i<n.length;i++){s=i+1,s%=n.length,o=r(e,t,n[i],n[s],!0);if(o.length>0)return!0}return!1}function f(e,n){var i,s,o,u,f;for(i=0;i<a.length;i++){s=t[a[i]];for(o=0;o<s.length;o++){u=o+1,u%=s.length,f=r(e,n,s[o],s[u],!0);if(f.length>0)return!0}}return!1}var n=e.concat(),s,a=[],l,c,h,p,d,v,m=[],g,y,b,w;for(var E=0,S=t.length;E<S;E++)a.push(E);var x=0,T=a.length*2;while(a.length>0){T--;if(T<0){console.log("Infinite Loop! Holes left:"+a.length+", Probably Hole outside Shape!");break}for(c=x;c<n.length;c++){h=n[c],l=-1;for(var E=0;E<a.length;E++){d=a[E],v=h.x+":"+h.y+":"+d;if(m[v]!==undefined)continue;s=t[d];for(var N=0;N<s.length;N++){p=s[N];if(!o(c,N))continue;if(u(h,p))continue;if(f(h,p))continue;l=N,a.splice(E,1),g=n.slice(0,c+1),y=n.slice(c),b=s.slice(l),w=s.slice(0,l+1),n=g.concat(b).concat(w).concat(y),x=c;break}if(l>=0)break;m[v]=!0}if(l>=0)break}}return n}var o,u,a,f,l,c,h={},p=e.concat();for(var d=0,v=t.length;d<v;d++)Array.prototype.push.apply(p,t[d]);for(o=0,u=p.length;o<u;o++)l=p[o].x+":"+p[o].y,h[l]!==undefined&&console.warn("THREE.Shape: Duplicate point",l),h[l]=o;var m=s(e,t),g=THREE.FontUtils.Triangulate(m,!1);for(o=0,u=g.length;o<u;o++){f=g[o];for(a=0;a<3;a++)l=f[a].x+":"+f[a].y,c=h[l],c!==undefined&&(f[a]=c)}return g.concat()},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){var n=1-e;return 3*n*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.constructor=THREE.LineCurve,THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve,THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t=new THREE.Vector2;return t.x=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t=new THREE.Vector2;return t.x=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),t.y=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t.normalize()},THREE.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve,THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,n)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,n;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var r=new THREE.Vector2(t,n);return r.normalize(),r},THREE.SplineCurve=function(e){this.points=e==undefined?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.constructor=THREE.SplineCurve,THREE.SplineCurve.prototype.getPoint=function(e){var t=this.points,n=(t.length-1)*e,r=Math.floor(n),i=n-r,s=t[r===0?r:r-1],o=t[r],u=t[r>t.length-2?t.length-1:r+1],a=t[r>t.length-3?t.length-1:r+2],f=new THREE.Vector2;return f.x=THREE.Curve.Utils.interpolate(s.x,o.x,u.x,a.x,i),f.y=THREE.Curve.Utils.interpolate(s.y,o.y,u.y,a.y,i),f},THREE.EllipseCurve=function(e,t,n,r,i,s,o,u){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o,this.aRotation=u||0},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve,THREE.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;t<0&&(t+=Math.PI*2),t>Math.PI*2&&(t-=Math.PI*2);var n;this.aClockwise===!0?n=this.aEndAngle+(1-e)*(Math.PI*2-t):n=this.aStartAngle+e*t;var r=this.aX+this.xRadius*Math.cos(n),i=this.aY+this.yRadius*Math.sin(n);if(this.aRotation!==0){var s=Math.cos(this.aRotation),o=Math.sin(this.aRotation),u=r,a=i;r=(u-this.aX)*s-(a-this.aY)*o+this.aX,i=(u-this.aX)*o+(a-this.aY)*s+this.aY}return new THREE.Vector2(r,i)},THREE.ArcCurve=function(e,t,n,r,i,s){THREE.EllipseCurve.call(this,e,t,n,n,r,i,s)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.ArcCurve.prototype.constructor=THREE.ArcCurve,THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t=new THREE.Vector3;return t.x=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),t.y=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),t.z=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),t}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t=new THREE.Vector3;return t.x=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t.y=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t.z=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),t}),THREE.SplineCurve3=THREE.Curve.create(function(e){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=e==undefined?[]:e},function(e){var t=this.points,n=(t.length-1)*e,r=Math.floor(n),i=n-r,s=t[r==0?r:r-1],o=t[r],u=t[r>t.length-2?t.length-1:r+1],a=t[r>t.length-3?t.length-1:r+2],f=new THREE.Vector3;return f.x=THREE.Curve.Utils.interpolate(s.x,o.x,u.x,a.x,i),f.y=THREE.Curve.Utils.interpolate(s.y,o.y,u.y,a.y,i),f.z=THREE.Curve.Utils.interpolate(s.z,o.z,u.z,a.z,i),f}),THREE.CatmullRomCurve3=function(){function i(){}var e=new THREE.Vector3,t=new i,n=new i,r=new i;return i.prototype.init=function(e,t,n,r){this.c0=e,this.c1=n,this.c2=-3*e+3*t-2*n-r,this.c3=2*e-2*t+n+r},i.prototype.initNonuniformCatmullRom=function(e,t,n,r,i,s,o){var u=(t-e)/i-(n-e)/(i+s)+(n-t)/s,a=(n-t)/s-(r-t)/(s+o)+(r-n)/o;u*=s,a*=s,this.init(t,n,u,a)},i.prototype.initCatmullRom=function(e,t,n,r,i){this.init(t,n,i*(n-e),i*(r-t))},i.prototype.calc=function(e){var t=e*e,n=t*e;return this.c0+this.c1*e+this.c2*t+this.c3*n},THREE.Curve.create(function(e){this.points=e||[]},function(i){var s=this.points,o,u,a,f;f=s.length,f<2&&console.log("duh, you need at least 2 points"),o=(f-1)*i,u=Math.floor(o),a=o-u,a===0&&u===f-1&&(u=f-2,a=1);var l,c,h,p;u===0?(e.subVectors(s[0],s[1]).add(s[0]),l=e):l=s[u-1],c=s[u],h=s[u+1],u+2<f?p=s[u+2]:(e.subVectors(s[f-1],s[f-2]).add(s[f-2]),p=e);if(this.type===undefined||this.type==="centripetal"||this.type==="chordal"){var d=this.type==="chordal"?.5:.25,v=Math.pow(l.distanceToSquared(c),d),m=Math.pow(c.distanceToSquared(h),d),g=Math.pow(h.distanceToSquared(p),d);m<1e-4&&(m=1),v<1e-4&&(v=m),g<1e-4&&(g=m),t.initNonuniformCatmullRom(l.x,c.x,h.x,p.x,v,m,g),n.initNonuniformCatmullRom(l.y,c.y,h.y,p.y,v,m,g),r.initNonuniformCatmullRom(l.z,c.z,h.z,p.z,v,m,g)}else if(this.type==="catmullrom"){var y=this.tension!==undefined?this.tension:.5;t.initCatmullRom(l.x,c.x,h.x,p.x,y),n.initCatmullRom(l.y,c.y,h.y,p.y,y),r.initCatmullRom(l.z,c.z,h.z,p.z,y)}var b=new THREE.Vector3(t.calc(a),n.calc(a),r.calc(a));return b})}(),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=e==undefined?[]:e},function(e){var t=this.points,n=(t.length-0)*e,r=Math.floor(n),i=n-r;r+=r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length;var s=t[(r-1)%t.length],o=t[r%t.length],u=t[(r+1)%t.length],a=t[(r+2)%t.length],f=new THREE.Vector3;return f.x=THREE.Curve.Utils.interpolate(s.x,o.x,u.x,a.x,i),f.y=THREE.Curve.Utils.interpolate(s.y,o.y,u.y,a.y,i),f.z=THREE.Curve.Utils.interpolate(s.z,o.z,u.z,a.z,i),f}),THREE.BoxGeometry=function(e,t,n,r,i,s){function l(e,t,n,r,i,s,u,a){var f,l,c,h=o.widthSegments,p=o.heightSegments,d=i/2,v=s/2,m=o.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x")f="z";else if(e==="x"&&t==="z"||e==="z"&&t==="x")f="y",p=o.depthSegments;else if(e==="z"&&t==="y"||e==="y"&&t==="z")f="x",h=o.depthSegments;var g=h+1,y=p+1,b=i/h,w=s/p,E=new THREE.Vector3;E[f]=u>0?1:-1;for(c=0;c<y;c++)for(l=0;l<g;l++){var S=new THREE.Vector3;S[e]=(l*b-d)*n,S[t]=(c*w-v)*r,S[f]=u,o.vertices.push(S)}for(c=0;c<p;c++)for(l=0;l<h;l++){var x=l+g*c,T=l+g*(c+1),N=l+1+g*(c+1),C=l+1+g*c,k=new THREE.Vector2(l/h,1-c/p),L=new THREE.Vector2(l/h,1-(c+1)/p),A=new THREE.Vector2((l+1)/h,1-(c+1)/p),O=new THREE.Vector2((l+1)/h,1-c/p),M=new THREE.Face3(x+m,T+m,C+m);M.normal.copy(E),M.vertexNormals.push(E.clone(),E.clone(),E.clone()),M.materialIndex=a,o.faces.push(M),o.faceVertexUvs[0].push([k,L,O]),M=new THREE.Face3(T+m,N+m,C+m),M.normal.copy(E),M.vertexNormals.push(E.clone(),E.clone(),E.clone()),M.materialIndex=a,o.faces.push(M),o.faceVertexUvs[0].push([L.clone(),A,O.clone()])}}THREE.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:s},this.widthSegments=r||1,this.heightSegments=i||1,this.depthSegments=s||1;var o=this,u=e/2,a=t/2,f=n/2;l("z","y",-1,-1,n,t,u,0),l("z","y",1,-1,n,t,-u,1),l("x","z",1,1,e,n,a,2),l("x","z",1,-1,e,n,-a,3),l("x","y",1,-1,e,t,f,4),l("x","y",-1,-1,e,t,-f,5),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry,THREE.BoxGeometry.prototype.clone=function(){var e=new THREE.BoxGeometry(this.parameters.width,this.parameters.height,this.parameters.depth,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.depthSegments);return e},THREE.CubeGeometry=THREE.BoxGeometry,THREE.CircleGeometry=function(e,t,n,r){THREE.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||50,t=t!==undefined?Math.max(3,t):8,n=n!==undefined?n:0,r=r!==undefined?r:Math.PI*2;var i,s=[],o=new THREE.Vector3,u=new THREE.Vector2(.5,.5);this.vertices.push(o),s.push(u);for(i=0;i<=t;i++){var a=new THREE.Vector3,f=n+i/t*r;a.x=e*Math.cos(f),a.y=e*Math.sin(f),this.vertices.push(a),s.push(new THREE.Vector2((a.x/e+1)/2,(a.y/e+1)/2))}var l=new THREE.Vector3(0,0,1);for(i=1;i<=t;i++)this.faces.push(new THREE.Face3(i,i+1,0,[l.clone(),l.clone(),l.clone()])),this.faceVertexUvs[0].push([s[i].clone(),s[i+1].clone(),u.clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry,THREE.CircleGeometry.prototype.clone=function(){var e=new THREE.CircleGeometry(this.parameters.radius,this.parameters.segments,this.parameters.thetaStart,this.parameters.thetaLength);return e},THREE.CircleBufferGeometry=function(e,t,n,r){THREE.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||50,t=t!==undefined?Math.max(3,t):8,n=n!==undefined?n:0,r=r!==undefined?r:Math.PI*2;var i=t+2,s=new Float32Array(i*3),o=new Float32Array(i*3),u=new Float32Array(i*2);o[3]=1,u[0]=.5,u[1]=.5;for(var a=0,f=3,l=2;a<=t;a++,f+=3,l+=2){var c=n+a/t*r;s[f]=e*Math.cos(c),s[f+1]=e*Math.sin(c),o[f+2]=1,u[l]=(s[f]/e+1)/2,u[l+1]=(s[f+1]/e+1)/2}var h=[];for(var f=1;f<=t;f++)h.push(f),h.push(f+1),h.push(0);this.setIndex(new THREE.BufferAttribute(new Uint16Array(h),1)),this.addAttribute("position",new THREE.BufferAttribute(s,3)),this.addAttribute("normal",new THREE.BufferAttribute(o,3)),this.addAttribute("uv",new THREE.BufferAttribute(u,2)),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.CircleBufferGeometry.prototype.constructor=THREE.CircleBufferGeometry,THREE.CircleBufferGeometry.prototype.clone=function(){var e=new THREE.CircleBufferGeometry(this.parameters.radius,this.parameters.segments,this.parameters.thetaStart,this.parameters.thetaLength);return e.copy(this),e},THREE.CylinderGeometry=function(e,t,n,r,i,s,o,u){THREE.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:u},e=e!==undefined?e:20,t=t!==undefined?t:20,n=n!==undefined?n:100,r=r||8,i=i||1,s=s!==undefined?s:!1,o=o!==undefined?o:0,u=u!==undefined?u:2*Math.PI;var a=n/2,f,l,c=[],h=[];for(l=0;l<=i;l++){var p=[],d=[],v=l/i,m=v*(t-e)+e;for(f=0;f<=r;f++){var g=f/r,y=new THREE.Vector3;y.x=m*Math.sin(g*u+o),y.y=-v*n+a,y.z=m*Math.cos(g*u+o),this.vertices.push(y),p.push(this.vertices.length-1),d.push(new THREE.Vector2(g,1-v))}c.push(p),h.push(d)}var b=(t-e)/n,w,E;for(f=0;f<r;f++){e!==0?(w=this.vertices[c[0][f]].clone(),E=this.vertices[c[0][f+1]].clone()):(w=this.vertices[c[1][f]].clone(),E=this.vertices[c[1][f+1]].clone()),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*b).normalize(),E.setY(Math.sqrt(E.x*E.x+E.z*E.z)*b).normalize();for(l=0;l<i;l++){var S=c[l][f],x=c[l+1][f],T=c[l+1][f+1],N=c[l][f+1],C=w.clone(),k=w.clone(),L=E.clone(),A=E.clone(),O=h[l][f].clone(),M=h[l+1][f].clone(),_=h[l+1][f+1].clone(),D=h[l][f+1].clone();this.faces.push(new THREE.Face3(S,x,N,[C,k,A])),this.faceVertexUvs[0].push([O,M,D]),this.faces.push(new THREE.Face3(x,T,N,[k.clone(),L,A.clone()])),this.faceVertexUvs[0].push([M.clone(),_,D.clone()])}}if(s===!1&&e>0){this.vertices.push(new THREE.Vector3(0,a,0));for(f=0;f<r;f++){var S=c[0][f],x=c[0][f+1],T=this.vertices.length-1,C=new THREE.Vector3(0,1,0),k=new THREE.Vector3(0,1,0),L=new THREE.Vector3(0,1,0),O=h[0][f].clone(),M=h[0][f+1].clone(),_=new THREE.Vector2(M.x,0);this.faces.push(new THREE.Face3(S,x,T,[C,k,L],undefined,1)),this.faceVertexUvs[0].push([O,M,_])}}if(s===!1&&t>0){this.vertices.push(new THREE.Vector3(0,-a,0));for(f=0;f<r;f++){var S=c[i][f+1],x=c[i][f],T=this.vertices.length-1,C=new THREE.Vector3(0,-1,0),k=new THREE.Vector3(0,-1,0),L=new THREE.Vector3(0,-1,0),O=h[i][f+1].clone(),M=h[i][f].clone(),_=new THREE.Vector2(M.x,1);this.faces.push(new THREE.Face3(S,x,T,[C,k,L],undefined,2)),this.faceVertexUvs[0].push([O,M,_])}}this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry,THREE.CylinderGeometry.prototype.clone=function(){var e=new THREE.CylinderGeometry(this.parameters.radiusTop,this.parameters.radiusBottom,this.parameters.height,this.parameters.radialSegments,this.parameters.heightSegments,this.parameters.openEnded,this.parameters.thetaStart,this.parameters.thetaLength);return e},THREE.EdgesGeometry=function(e,t){THREE.BufferGeometry.call(this),t=t!==undefined?t:1;var n=Math.cos(THREE.Math.degToRad(t)),r=[0,0],i={},s=function(e,t){return e-t},o=["a","b","c"],u;e instanceof THREE.BufferGeometry?(u=new THREE.Geometry,u.fromBufferGeometry(e)):u=e.clone(),u.mergeVertices(),u.computeFaceNormals();var a=u.vertices,f=u.faces;for(var l=0,c=f.length;l<c;l++){var h=f[l];for(var p=0;p<3;p++){r[0]=h[o[p]],r[1]=h[o[(p+1)%3]],r.sort(s);var d=r.toString();i[d]===undefined?i[d]={vert1:r[0],vert2:r[1],face1:l,face2:undefined}:i[d].face2=l}}var v=[];for(var d in i){var m=i[d];if(m.face2===undefined||f[m.face1].normal.dot(f[m.face2].normal)<=n){var g=a[m.vert1];v.push(g.x),v.push(g.y),v.push(g.z),g=a[m.vert2],v.push(g.x),v.push(g.y),v.push(g.z)}}this.addAttribute("position",new THREE.BufferAttribute(new Float32Array(v),3))},THREE.EdgesGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.EdgesGeometry.prototype.constructor=THREE.EdgesGeometry,THREE.ExtrudeGeometry=function(e,t){if(typeof e=="undefined"){e=[];return}THREE.Geometry.call(this),this.type="ExtrudeGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeFaceNormals()},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry,THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){var n=e.length;for(var r=0;r<n;r++){var i=e[r];this.addShape(i,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function L(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}function j(e,t,n){var r=1e-10,i,s,o=1,u=e.x-t.x,a=e.y-t.y,f=n.x-e.x,l=n.y-e.y,c=u*u+a*a,h=u*l-a*f;if(Math.abs(h)>r){var p=Math.sqrt(c),d=Math.sqrt(f*f+l*l),v=t.x-a/p,m=t.y+u/p,g=n.x-l/d,y=n.y+f/d,b=((g-v)*l-(y-m)*f)/(u*l-a*f);i=v+u*b-e.x,s=m+a*b-e.y;var w=i*i+s*s;if(w<=2)return new THREE.Vector2(i,s);o=Math.sqrt(w/2)}else{var E=!1;u>r?f>r&&(E=!0):u<-r?f<-r&&(E=!0):Math.sign(a)===Math.sign(l)&&(E=!0),E?(i=-a,s=u,o=Math.sqrt(c)):(i=u,s=a,o=Math.sqrt(c/2))}return new THREE.Vector2(i/o,s/o)}function $(){if(o){var e=0,t=P*e;for(I=0;I<B;I++)H=C[I],G(H[2]+t,H[1]+t,H[0]+t);e=a+s*2,t=P*e;for(I=0;I<B;I++)H=C[I],G(H[0]+t,H[1]+t,H[2]+t)}else{for(I=0;I<B;I++)H=C[I],G(H[2],H[1],H[0]);for(I=0;I<B;I++)H=C[I],G(H[0]+P*a,H[1]+P*a,H[2]+P*a)}}function J(){var e=0;K(k,e),e+=k.length;for(y=0,b=T.length;y<b;y++)g=T[y],K(g,e),e+=g.length}function K(e,t){var n,r;I=e.length;while(--I>=0){n=I,r=I-1,r<0&&(r=e.length-1);var i=0,o=a+s*2;for(i=0;i<o;i++){var u=P*i,f=P*(i+1),l=t+n+u,c=t+r+u,h=t+r+f,p=t+n+f;Y(l,c,h,p,e,i,o,n,r)}}}function Q(e,t,n){w.vertices.push(new THREE.Vector3(e,t,n))}function G(e,t,n){e+=E,t+=E,n+=E,w.faces.push(new THREE.Face3(e,t,n));var r=h.generateTopUV(w,e,t,n);w.faceVertexUvs[0].push(r)}function Y(e,t,n,r,i,s,o,u,a){e+=E,t+=E,n+=E,r+=E,w.faces.push(new THREE.Face3(e,t,r)),w.faces.push(new THREE.Face3(t,n,r));var f=h.generateSideWallUV(w,e,t,n,r);w.faceVertexUvs[0].push([f[0],f[1],f[3]]),w.faceVertexUvs[0].push([f[1],f[2],f[3]])}var n=t.amount!==undefined?t.amount:100,r=t.bevelThickness!==undefined?t.bevelThickness:6,i=t.bevelSize!==undefined?t.bevelSize:r-2,s=t.bevelSegments!==undefined?t.bevelSegments:3,o=t.bevelEnabled!==undefined?t.bevelEnabled:!0,u=t.curveSegments!==undefined?t.curveSegments:12,a=t.steps!==undefined?t.steps:1,f=t.extrudePath,l,c=!1,h=t.UVGenerator!==undefined?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,p,d,v,m;f&&(l=f.getSpacedPoints(a),c=!0,o=!1,p=t.frames!==undefined?t.frames:new THREE.TubeGeometry.FrenetFrames(f,a,!1),d=new THREE.Vector3,v=new THREE.Vector3,m=new THREE.Vector3),o||(s=0,r=0,i=0);var g,y,b,w=this,E=this.vertices.length,S=e.extractPoints(u),x=S.shape,T=S.holes,N=!THREE.Shape.Utils.isClockWise(x);if(N){x=x.reverse();for(y=0,b=T.length;y<b;y++)g=T[y],THREE.Shape.Utils.isClockWise(g)&&(T[y]=g.reverse());N=!1}var C=THREE.Shape.Utils.triangulateShape(x,T),k=x;for(y=0,b=T.length;y<b;y++)g=T[y],x=x.concat(g);var A,O,M,_,D,P=x.length,H,B=C.length,F=[];for(var I=0,q=k.length,R=q-1,U=I+1;I<q;I++,R++,U++)R===q&&(R=0),U===q&&(U=0),F[I]=j(k[I],k[R],k[U]);var z=[],W,X=F.concat();for(y=0,b=T.length;y<b;y++){g=T[y],W=[];for(I=0,q=g.length,R=q-1,U=I+1;I<q;I++,R++,U++)R===q&&(R=0),U===q&&(U=0),W[I]=j(g[I],g[R],g[U]);z.push(W),X=X.concat(W)}for(A=0;A<s;A++){M=A/s,_=r*(1-M),O=i*Math.sin(M*Math.PI/2);for(I=0,q=k.length;I<q;I++)D=L(k[I],F[I],O),Q(D.x,D.y,-_);for(y=0,b=T.length;y<b;y++){g=T[y],W=z[y];for(I=0,q=g.length;I<q;I++)D=L(g[I],W[I],O),Q(D.x,D.y,-_)}}O=i;for(I=0;I<P;I++)D=o?L(x[I],X[I],O):x[I],c?(v.copy(p.normals[0]).multiplyScalar(D.x),d.copy(p.binormals[0]).multiplyScalar(D.y),m.copy(l[0]).add(v).add(d),Q(m.x,m.y,m.z)):Q(D.x,D.y,0);var V;for(V=1;V<=a;V++)for(I=0;I<P;I++)D=o?L(x[I],X[I],O):x[I],c?(v.copy(p.normals[V]).multiplyScalar(D.x),d.copy(p.binormals[V]).multiplyScalar(D.y),m.copy(l[V]).add(v).add(d),Q(m.x,m.y,m.z)):Q(D.x,D.y,n/a*V);for(A=s-1;A>=0;A--){M=A/s,_=r*(1-M),O=i*Math.sin(M*Math.PI/2);for(I=0,q=k.length;I<q;I++)D=L(k[I],F[I],O),Q(D.x,D.y,n+_);for(y=0,b=T.length;y<b;y++){g=T[y],W=z[y];for(I=0,q=g.length;I<q;I++)D=L(g[I],W[I],O),c?Q(D.x,D.y+l[a-1].y,l[a-1].x+_):Q(D.x,D.y,n+_)}}$(),J()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r){var i=e.vertices,s=i[t],o=i[n],u=i[r];return[new THREE.Vector2(s.x,s.y),new THREE.Vector2(o.x,o.y),new THREE.Vector2(u.x,u.y)]},generateSideWallUV:function(e,t,n,r,i){var s=e.vertices,o=s[t],u=s[n],a=s[r],f=s[i];return Math.abs(o.y-u.y)<.01?[new THREE.Vector2(o.x,1-o.z),new THREE.Vector2(u.x,1-u.z),new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(f.x,1-f.z)]:[new THREE.Vector2(o.y,1-o.z),new THREE.Vector2(u.y,1-u.z),new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(f.y,1-f.z)]}},THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),this.type="ShapeGeometry",Array.isArray(e)===!1&&(e=[e]),this.addShapeList(e,t),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry,THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){t===undefined&&(t={});var n=t.curveSegments!==undefined?t.curveSegments:12,r=t.material,i=t.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,s,o,u,a=this.vertices.length,f=e.extractPoints(n),l=f.shape,c=f.holes,h=!THREE.Shape.Utils.isClockWise(l);if(h){l=l.reverse();for(s=0,o=c.length;s<o;s++)u=c[s],THREE.Shape.Utils.isClockWise(u)&&(c[s]=u.reverse());h=!1}var p=THREE.Shape.Utils.triangulateShape(l,c);for(s=0,o=c.length;s<o;s++)u=c[s],l=l.concat(u);var d,v=l.length,m,g=p.length;for(s=0;s<v;s++)d=l[s],this.vertices.push(new THREE.Vector3(d.x,d.y,0));for(s=0;s<g;s++){m=p[s];var y=m[0]+a,b=m[1]+a,w=m[2]+a;this.faces.push(new THREE.Face3(y,b,w,null,null,r)),this.faceVertexUvs[0].push(i.generateTopUV(this,y,b,w))}},THREE.LatheGeometry=function(e,t,n,r){THREE.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=t||12,n=n||0,r=r||2*Math.PI;var i=1/(e.length-1),s=1/t;for(var o=0,u=t;o<=u;o++){var a=n+o*s*r,f=Math.cos(a),l=Math.sin(a);for(var c=0,h=e.length;c<h;c++){var p=e[c],d=new THREE.Vector3;d.x=f*p.x-l*p.y,d.y=l*p.x+f*p.y,d.z=p.z,this.vertices.push(d)}}var v=e.length;for(var o=0,u=t;o<u;o++)for(var c=0,h=e.length-1;c<h;c++){var m=c+v*o,g=m,y=m+v,f=m+1+v,b=m+1,w=o*s,E=c*i,S=w+s,x=E+i;this.faces.push(new THREE.Face3(g,y,b)),this.faceVertexUvs[0].push([new THREE.Vector2(w,E),new THREE.Vector2(S,E),new THREE.Vector2(w,x)]),this.faces.push(new THREE.Face3(y,f,b)),this.faceVertexUvs[0].push([new THREE.Vector2(S,E),new THREE.Vector2(S,x),new THREE.Vector2(w,x)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry,THREE.PlaneGeometry=function(e,t,n,r){THREE.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new THREE.PlaneBufferGeometry(e,t,n,r))},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry,THREE.PlaneGeometry.prototype.clone=function(){var e=new THREE.PlaneGeometry(this.parameters.width,this.parameters.height,this.parameters.widthSegments,this.parameters.heightSegments);return e},THREE.PlaneBufferGeometry=function(e,t,n,r){THREE.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i=e/2,s=t/2,o=Math.floor(n)||1,u=Math.floor(r)||1,a=o+1,f=u+1,l=e/o,c=t/u,h=new Float32Array(a*f*3),p=new Float32Array(a*f*3),d=new Float32Array(a*f*2),v=0,m=0;for(var g=0;g<f;g++){var y=g*c-s;for(var b=0;b<a;b++){var w=b*l-i;h[v]=w,h[v+1]=-y,p[v+2]=1,d[m]=b/o,d[m+1]=1-g/u,v+=3,m+=2}}v=0;var E=new(h.length/3>65535?Uint32Array:Uint16Array)(o*u*6);for(var g=0;g<u;g++)for(var b=0;b<o;b++){var S=b+a*g,x=b+a*(g+1),T=b+1+a*(g+1),N=b+1+a*g;E[v]=S,E[v+1]=x,E[v+2]=N,E[v+3]=x,E[v+4]=T,E[v+5]=N,v+=6}this.setIndex(new THREE.BufferAttribute(E,1)),this.addAttribute("position",new THREE.BufferAttribute(h,3)),this.addAttribute("normal",new THREE.BufferAttribute(p,3)),this.addAttribute("uv",new THREE.BufferAttribute(d,2))},THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry,THREE.PlaneBufferGeometry.prototype.clone=function(){var e=new THREE.PlaneBufferGeometry(this.parameters.width,this.parameters.height,this.parameters.widthSegments,this.parameters.heightSegments);return e.copy(this),e},THREE.RingGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},e=e||0,t=t||50,i=i!==undefined?i:0,s=s!==undefined?s:Math.PI*2,n=n!==undefined?Math.max(3,n):8,r=r!==undefined?Math.max(1,r):8;var o,u,a=[],f=e,l=(t-e)/r;for(o=0;o<r+1;o++){for(u=0;u<n+1;u++){var c=new THREE.Vector3,h=i+u/n*s;c.x=f*Math.cos(h),c.y=f*Math.sin(h),this.vertices.push(c),a.push(new THREE.Vector2((c.x/t+1)/2,(c.y/t+1)/2))}f+=l}var p=new THREE.Vector3(0,0,1);for(o=0;o<r;o++){var d=o*(n+1);for(u=0;u<n;u++){var h=u+d,v=h,m=h+n+1,g=h+n+2;this.faces.push(new THREE.Face3(v,m,g,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([a[v].clone(),a[m].clone(),a[g].clone()]),v=h,m=h+n+2,g=h+1,this.faces.push(new THREE.Face3(v,m,g,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([a[v].clone(),a[m].clone(),a[g].clone()])}}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,f)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry.prototype.constructor=THREE.RingGeometry,THREE.RingGeometry.prototype.clone=function(){var e=new THREE.RingGeometry(this.parameters.innerRadius,this.parameters.outerRadius,this.parameters.thetaSegments,this.parameters.phiSegments,this.parameters.thetaStart,this.parameters.thetaLength);return e},THREE.SphereGeometry=function(e,t,n,r,i,s,o){THREE.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},this.fromBufferGeometry(new THREE.SphereBufferGeometry(e,t,n,r,i,s,o))},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry,THREE.SphereGeometry.prototype.clone=function(){var e=new THREE.SphereGeometry(this.parameters.radius,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.phiStart,this.parameters.phiLength,this.parameters.thetaStart,this.parameters.thetaLength);return e},THREE.SphereBufferGeometry=function(e,t,n,r,i,s,o){THREE.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=r!==undefined?r:0,i=i!==undefined?i:Math.PI*2,s=s!==undefined?s:0,o=o!==undefined?o:Math.PI;var u=s+o,a=(t+1)*(n+1),f=new THREE.BufferAttribute(new Float32Array(a*3),3),l=new THREE.BufferAttribute(new Float32Array(a*3),3),c=new THREE.BufferAttribute(new Float32Array(a*2),2),h=0,p=[],d=new THREE.Vector3;for(var v=0;v<=n;v++){var m=[],g=v/n;for(var y=0;y<=t;y++){var b=y/t,w=-e*Math.cos(r+b*i)*Math.sin(s+g*o),E=e*Math.cos(s+g*o),S=e*Math.sin(r+b*i)*Math.sin(s+g*o);d.set(w,E,S).normalize(),f.setXYZ(h,w,E,S),l.setXYZ(h,d.x,d.y,d.z),c.setXY(h,b,1-g),m.push(h),h++}p.push(m)}var x=[];for(var v=0;v<n;v++)for(var y=0;y<t;y++){var T=p[v][y+1],N=p[v][y],C=p[v+1][y],k=p[v+1][y+1];(v!==0||s>0)&&x.push(T,N,k),(v!==n-1||u<Math.PI)&&x.push(N,C,k)}this.setIndex(new THREE.BufferAttribute(new Uint16Array(x),1)),this.addAttribute("position",f),this.addAttribute("normal",l),this.addAttribute("uv",c),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.SphereBufferGeometry.prototype.constructor=THREE.SphereBufferGeometry,THREE.SphereBufferGeometry.prototype.clone=function(){var e=new THREE.SphereBufferGeometry(this.parameters.radius,this.parameters.widthSegments,this.parameters.heightSegments,this.parameters.phiStart,this.parameters.phiLength,this.parameters.thetaStart,this.parameters.thetaLength);return e.copy(this),e},THREE.TextGeometry=function(e,t){t=t||{};var n=THREE.FontUtils.generateShapes(e,t);t.amount=t.height!==undefined?t.height:50,t.bevelThickness===undefined&&(t.bevelThickness=10),t.bevelSize===undefined&&(t.bevelSize=8),t.bevelEnabled===undefined&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,n,t),this.type="TextGeometry"},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TextGeometry.prototype.constructor=THREE.TextGeometry,THREE.TorusGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||100,t=t||40,n=n||8,r=r||6,i=i||Math.PI*2;var s=new THREE.Vector3,o=[],u=[];for(var a=0;a<=n;a++)for(var f=0;f<=r;f++){var l=f/r*i,c=a/n*Math.PI*2;s.x=e*Math.cos(l),s.y=e*Math.sin(l);var h=new THREE.Vector3;h.x=(e+t*Math.cos(c))*Math.cos(l),h.y=(e+t*Math.cos(c))*Math.sin(l),h.z=t*Math.sin(c),this.vertices.push(h),o.push(new THREE.Vector2(f/r,a/n)),u.push(h.clone().sub(s).normalize())}for(var a=1;a<=n;a++)for(var f=1;f<=r;f++){var p=(r+1)*a+f-1,d=(r+1)*(a-1)+f-1,v=(r+1)*(a-1)+f,m=(r+1)*a+f,g=new THREE.Face3(p,d,m,[u[p].clone(),u[d].clone(),u[m].clone()]);this.faces.push(g),this.faceVertexUvs[0].push([o[p].clone(),o[d].clone(),o[m].clone()]),g=new THREE.Face3(d,v,m,[u[d].clone(),u[v].clone(),u[m].clone()]),this.faces.push(g),this.faceVertexUvs[0].push([o[d].clone(),o[v].clone(),o[m].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry,THREE.TorusGeometry.prototype.clone=function(){var e=new THREE.TorusGeometry(this.parameters.radius,this.parameters.tube,this.parameters.radialSegments,this.parameters.tubularSegments,this.parameters.arc);return e},THREE.TorusKnotGeometry=function(e,t,n,r,i,s,o){function O(e,t,n,r,i){var s=Math.cos(e),o=Math.sin(e),u=t/n*e,a=Math.cos(u),f=r*(2+a)*.5*s,l=r*(2+a)*o*.5,c=i*r*Math.sin(u)*.5;return new THREE.Vector3(f,l,c)}THREE.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,p:i,q:s,heightScale:o},e=e||100,t=t||40,n=n||64,r=r||8,i=i||2,s=s||3,o=o||1;var u=new Array(n),a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3;for(var c=0;c<n;++c){u[c]=new Array(r);var h=c/n*2*i*Math.PI,p=O(h,s,i,e,o),d=O(h+.01,s,i,e,o);a.subVectors(d,p),f.addVectors(d,p),l.crossVectors(a,f),f.crossVectors(l,a),l.normalize(),f.normalize();for(var v=0;v<r;++v){var m=v/r*2*Math.PI,g=-t*Math.cos(m),y=t*Math.sin(m),b=new THREE.Vector3;b.x=p.x+g*f.x+y*l.x,b.y=p.y+g*f.y+y*l.y,b.z=p.z+g*f.z+y*l.z,u[c][v]=this.vertices.push(b)-1}}for(var c=0;c<n;++c)for(var v=0;v<r;++v){var w=(c+1)%n,E=(v+1)%r,S=u[c][v],x=u[w][v],T=u[w][E],N=u[c][E],C=new THREE.Vector2(c/n,v/r),k=new THREE.Vector2((c+1)/n,v/r),L=new THREE.Vector2((c+1)/n,(v+1)/r),A=new THREE.Vector2(c/n,(v+1)/r);this.faces.push(new THREE.Face3(S,x,N)),this.faceVertexUvs[0].push([C,k,A]),this.faces.push(new THREE.Face3(x,T,N)),this.faceVertexUvs[0].push([k.clone(),L,A.clone()])}this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry,THREE.TorusKnotGeometry.prototype.clone=function(){var e=new THREE.TorusKnotGeometry(this.parameters.radius,this.parameters.tube,this.parameters.radialSegments,this.parameters.tubularSegments,this.parameters.p,this.parameters.q,this.parameters.heightScale);return e},THREE.TubeGeometry=function(e,t,n,r,i,s){function H(e,t,n){return u.vertices.push(new THREE.Vector3(e,t,n))-1}THREE.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1,s=s||THREE.TubeGeometry.NoTaper;var o=[],u=this,a,f,l,c=t+1,h,p,d,v,m,g,y=new THREE.Vector3,b,w,E,S,x,T,N,C,k,L,A,O,M=new THREE.TubeGeometry.FrenetFrames(e,t,i),_=M.tangents,D=M.normals,P=M.binormals;this.tangents=_,this.normals=D,this.binormals=P;for(b=0;b<c;b++){o[b]=[],h=b/(c-1),g=e.getPointAt(h),a=_[b],f=D[b],l=P[b],d=n*s(h);for(w=0;w<r;w++)p=w/r*2*Math.PI,v=-d*Math.cos(p),m=d*Math.sin(p),y.copy(g),y.x+=v*f.x+m*l.x,y.y+=v*f.y+m*l.y,y.z+=v*f.z+m*l.z,o[b][w]=H(y.x,y.y,y.z)}for(b=0;b<t;b++)for(w=0;w<r;w++)E=i?(b+1)%t:b+1,S=(w+1)%r,x=o[b][w],T=o[E][w],N=o[E][S],C=o[b][S],k=new THREE.Vector2(b/t,w/r),L=new THREE.Vector2((b+1)/t,w/r),A=new THREE.Vector2((b+1)/t,(w+1)/r),O=new THREE.Vector2(b/t,(w+1)/r),this.faces.push(new THREE.Face3(x,T,C)),this.faceVertexUvs[0].push([k,L,O]),this.faces.push(new THREE.Face3(T,N,C)),this.faceVertexUvs[0].push([L.clone(),A,O.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry,THREE.TubeGeometry.NoTaper=function(e){return 1},THREE.TubeGeometry.SinusoidalTaper=function(e){return Math.sin(Math.PI*e)},THREE.TubeGeometry.FrenetFrames=function(e,t,n){function y(){s[0]=new THREE.Vector3,o[0]=new THREE.Vector3,h=Number.MAX_VALUE,p=Math.abs(i[0].x),d=Math.abs(i[0].y),v=Math.abs(i[0].z),p<=h&&(h=p,r.set(1,0,0)),d<=h&&(h=d,r.set(0,1,0)),v<=h&&r.set(0,0,1),u.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],u),o[0].crossVectors(i[0],s[0])}var r=new THREE.Vector3,i=[],s=[],o=[],u=new THREE.Vector3,a=new THREE.Matrix4,f=t+1,l,c=1e-4,h,p,d,v,m,g;this.tangents=i,this.normals=s,this.binormals=o;for(m=0;m<f;m++)g=m/(f-1),i[m]=e.getTangentAt(g),i[m].normalize();y();for(m=1;m<f;m++)s[m]=s[m-1].clone(),o[m]=o[m-1].clone(),u.crossVectors(i[m-1],i[m]),u.length()>c&&(u.normalize(),l=Math.acos(THREE.Math.clamp(i[m-1].dot(i[m]),-1,1)),s[m].applyMatrix4(a.makeRotationAxis(u,l))),o[m].crossVectors(i[m],s[m]);if(n){l=Math.acos(THREE.Math.clamp(s[0].dot(s[f-1]),-1,1)),l/=f-1,i[0].dot(u.crossVectors(s[0],s[f-1]))>0&&(l=-l);for(m=1;m<f;m++)s[m].applyMatrix4(a.makeRotationAxis(i[m],l*m)),o[m].crossVectors(i[m],s[m])}},THREE.PolyhedronGeometry=function(e,t,n,r){function w(e){var t=e.normalize().clone();t.index=i.vertices.push(t)-1;var n=x(e)/2/Math.PI+.5,r=T(e)/Math.PI+.5;return t.uv=new THREE.Vector2(n,1-r),t}function E(e,t,n,r){var s=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()],undefined,r);i.faces.push(s),p.copy(e).add(t).add(n).divideScalar(3);var o=x(p);i.faceVertexUvs[0].push([N(e.uv,e,o),N(t.uv,t,o),N(n.uv,n,o)])}function S(e,t){var n=Math.pow(2,t),r=w(i.vertices[e.a]),s=w(i.vertices[e.b]),o=w(i.vertices[e.c]),u=[],a=e.materialIndex;for(var f=0;f<=n;f++){u[f]=[];var l=w(r.clone().lerp(o,f/n)),c=w(s.clone().lerp(o,f/n)),h=n-f;for(var p=0;p<=h;p++)p===0&&f===n?u[f][p]=l:u[f][p]=w(l.clone().lerp(c,p/h))}for(var f=0;f<n;f++)for(var p=0;p<2*(n-f)-1;p++){var d=Math.floor(p/2);p%2===0?E(u[f][d+1],u[f+1][d],u[f][d],a):E(u[f][d+1],u[f+1][d+1],u[f+1][d],a)}}function x(e){return Math.atan2(e.z,-e.x)}function T(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function N(e,t,n){return n<0&&e.x===1&&(e=new THREE.Vector2(e.x-1,e.y)),t.x===0&&t.z===0&&(e=new THREE.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1,r=r||0;var i=this;for(var s=0,o=e.length;s<o;s+=3)w(new THREE.Vector3(e[s],e[s+1],e[s+2]));var u=this.vertices,a=[];for(var s=0,f=0,o=t.length;s<o;s+=3,f++){var l=u[t[s]],c=u[t[s+1]],h=u[t[s+2]];a[f]=new THREE.Face3(l.index,c.index,h.index,[l.clone(),c.clone(),h.clone()],undefined,f)}var p=new THREE.Vector3;for(var s=0,o=a.length;s<o;s++)S(a[s],r);for(var s=0,o=this.faceVertexUvs[0].length;s<o;s++){var d=this.faceVertexUvs[0][s],v=d[0].x,m=d[1].x,g=d[2].x,y=Math.max(v,Math.max(m,g)),b=Math.min(v,Math.min(m,g));y>.9&&b<.1&&(v<.2&&(d[0].x+=1),m<.2&&(d[1].x+=1),g<.2&&(d[2].x+=1))}for(var s=0,o=this.vertices.length;s<o;s++)this.vertices[s].multiplyScalar(n);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry,THREE.PolyhedronGeometry.prototype.clone=function(){var e=new THREE.PolyhedronGeometry(this.parameters.vertices,this.parameters.indices,this.parameters.radius,this.parameters.detail);return e.copy(this)},THREE.PolyhedronGeometry.prototype.copy=function(e){return THREE.Geometry.prototype.copy.call(this,e),this},THREE.DodecahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,i,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}},THREE.DodecahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry,THREE.DodecahedronGeometry.prototype.clone=function(){var e=new THREE.DodecahedronGeometry(this.parameters.radius,this.parameters.detail);return e.copy(this),e},THREE.IcosahedronGeometry=function(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,r,i,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}},THREE.IcosahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry,THREE.IcosahedronGeometry.prototype.clone=function(){var e=new THREE.IcosahedronGeometry(this.parameters.radius,this.parameters.detail);return e.copy(this),e},THREE.OctahedronGeometry=function(e,t){var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,n,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},THREE.OctahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry,THREE.OctahedronGeometry.prototype.clone=function(){var e=new THREE.OctahedronGeometry(this.parameters.radius,this.parameters.detail);return e.copy(this),e},THREE.TetrahedronGeometry=function(e,t){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,n,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}},THREE.TetrahedronGeometry.prototype=Object.create(THREE.PolyhedronGeometry.prototype),THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry,THREE.TetrahedronGeometry.prototype.clone=function(){var e=new THREE.TetrahedronGeometry(this.parameters.radius,this.parameters.detail);return e.copy(this),e},THREE.ParametricGeometry=function(e,t,n){THREE.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};var r=this.vertices,i=this.faces,s=this.faceVertexUvs[0],o,u,a,f,l,c=t+1;for(o=0;o<=n;o++){l=o/n;for(u=0;u<=t;u++)f=u/t,a=e(f,l),r.push(a)}var h,p,d,v,m,g,y,b;for(o=0;o<n;o++)for(u=0;u<t;u++)h=o*c+u,p=o*c+u+1,d=(o+1)*c+u+1,v=(o+1)*c+u,m=new THREE.Vector2(u/t,o/n),g=new THREE.Vector2((u+1)/t,o/n),y=new THREE.Vector2((u+1)/t,(o+1)/n),b=new THREE.Vector2(u/t,(o+1)/n),i.push(new THREE.Face3(h,p,v)),s.push([m,g,b]),i.push(new THREE.Face3(p,d,v)),s.push([g.clone(),y,b.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry,THREE.WireframeGeometry=function(e){THREE.BufferGeometry.call(this);var t=[0,0],n={},r=function(e,t){return e-t},i=["a","b","c"];if(e instanceof THREE.Geometry){var s=e.vertices,o=e.faces,u=0,a=new Uint32Array(6*o.length);for(var f=0,l=o.length;f<l;f++){var c=o[f];for(var h=0;h<3;h++){t[0]=c[i[h]],t[1]=c[i[(h+1)%3]],t.sort(r);var p=t.toString();n[p]===undefined&&(a[2*u]=t[0],a[2*u+1]=t[1],n[p]=!0,u++)}}var d=new Float32Array(u*2*3);for(var f=0,l=u;f<l;f++)for(var h=0;h<2;h++){var v=s[a[2*f+h]],m=6*f+3*h;d[m+0]=v.x,d[m+1]=v.y,d[m+2]=v.z}this.addAttribute("position",new THREE.BufferAttribute(d,3))}else if(e instanceof THREE.BufferGeometry)if(e.index!==null){var g=e.index.array,s=e.attributes.position,y=e.drawcalls,u=0;y.length===0&&e.addGroup(0,g.length);var a=new Uint32Array(2*g.length);for(var b=0,w=y.length;b<w;++b){var E=y[b],S=E.start,x=E.count;for(var f=S,T=S+x;f<T;f+=3)for(var h=0;h<3;h++){t[0]=g[f+h],t[1]=g[f+(h+1)%3],t.sort(r);var p=t.toString();n[p]===undefined&&(a[2*u]=t[0],a[2*u+1]=t[1],n[p]=!0,u++)}}var d=new Float32Array(u*2*3);for(var f=0,l=u;f<l;f++)for(var h=0;h<2;h++){var m=6*f+3*h,N=a[2*f+h];d[m+0]=s.getX(N),d[m+1]=s.getY(N),d[m+2]=s.getZ(N)}this.addAttribute("position",new THREE.BufferAttribute(d,3))}else{var s=e.attributes.position.array,u=s.length/3,C=u/3,d=new Float32Array(u*2*3);for(var f=0,l=C;f<l;f++)for(var h=0;h<3;h++){var m=18*f+6*h,k=9*f+3*h;d[m+0]=s[k],d[m+1]=s[k+1],d[m+2]=s[k+2];var N=9*f+3*((h+1)%3);d[m+3]=s[N],d[m+4]=s[N+1],d[m+5]=s[N+2]}this.addAttribute("position",new THREE.BufferAttribute(d,3))}},THREE.WireframeGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.WireframeGeometry.prototype.constructor=THREE.WireframeGeometry,THREE.AxisHelper=function(e){e=e||1;var t=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.BufferAttribute(t,3)),r.addAttribute("color",new THREE.BufferAttribute(n,3));var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.LineSegments.call(this,r,i)},THREE.AxisHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.AxisHelper.prototype.constructor=THREE.AxisHelper,THREE.ArrowHelper=function(){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var t=new THREE.CylinderGeometry(0,.5,1,5,1);return t.translate(0,-0.5,0),function(r,i,s,o,u,a){THREE.Object3D.call(this),o===undefined&&(o=16776960),s===undefined&&(s=1),u===undefined&&(u=.2*s),a===undefined&&(a=.2*u),this.position.copy(i),u<s&&(this.line=new THREE.Line(e,new THREE.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line)),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(r),this.setLength(s,u,a)}}(),THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper,THREE.ArrowHelper.prototype.setDirection=function(){var e=new THREE.Vector3,t;return function(r){r.y>.99999?this.quaternion.set(0,0,0,1):r.y<-0.99999?this.quaternion.set(1,0,0,0):(e.set(r.z,0,-r.x).normalize(),t=Math.acos(r.y),this.quaternion.setFromAxisAngle(e,t))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,n){t===undefined&&(t=.2*e),n===undefined&&(n=.2*t),t<e&&(this.line.scale.set(1,e-t,1),this.line.updateMatrix()),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){this.line!==undefined&&this.line.material.color.set(e),this.cone.material.color.set(e)},THREE.BoxHelper=function(e){var t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new THREE.BufferGeometry;r.setIndex(new THREE.BufferAttribute(t,1)),r.addAttribute("position",new THREE.BufferAttribute(n,3)),THREE.LineSegments.call(this,r,new THREE.LineBasicMaterial({color:16776960})),e!==undefined&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.BoxHelper.prototype.constructor=THREE.BoxHelper,THREE.BoxHelper.prototype.update=function(){var e=new THREE.Box3;return function(t){e.setFromObject(t);if(e.empty())return;var n=e.min,r=e.max,i=this.geometry.attributes.position,s=i.array;s[0]=r.x,s[1]=r.y,s[2]=r.z,s[3]=n.x,s[4]=r.y,s[5]=r.z,s[6]=n.x,s[7]=n.y,s[8]=r.z,s[9]=r.x,s[10]=n.y,s[11]=r.z,s[12]=r.x,s[13]=r.y,s[14]=n.z,s[15]=n.x,s[16]=r.y,s[17]=n.z,s[18]=n.x,s[19]=n.y,s[20]=n.z,s[21]=r.x,s[22]=n.y,s[23]=n.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}(),THREE.BoundingBoxHelper=function(e,t){var n=t!==undefined?t:8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:n,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper,THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function f(e,t,n){l(e,n),l(t,n)}function l(e,n){t.vertices.push(new THREE.Vector3),t.colors.push(new THREE.Color(n)),r[e]===undefined&&(r[e]=[]),r[e].push(t.vertices.length-1)}var t=new THREE.Geometry,n=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),r={},i=16755200,s=16711680,o=43775,u=16777215,a=3355443;f("n1","n2",i),f("n2","n4",i),f("n4","n3",i),f("n3","n1",i),f("f1","f2",i),f("f2","f4",i),f("f4","f3",i),f("f3","f1",i),f("n1","f1",i),f("n2","f2",i),f("n3","f3",i),f("n4","f4",i),f("p","n1",s),f("p","n2",s),f("p","n3",s),f("p","n4",s),f("u1","u2",o),f("u2","u3",o),f("u3","u1",o),f("c","t",u),f("p","c",a),f("cn1","cn2",a),f("cn3","cn4",a),f("cf1","cf2",a),f("cf3","cf4",a),THREE.LineSegments.call(this,t,n),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.CameraHelper.prototype.constructor=THREE.CameraHelper,THREE.CameraHelper.prototype.update=function(){var e,t,n=new THREE.Vector3,r=new THREE.Camera,i=function(i,s,o,u){n.set(s,o,u).unproject(r);var a=t[i];if(a!==undefined)for(var f=0,l=a.length;f<l;f++)e.vertices[a[f]].copy(n)};return function(){e=this.geometry,t=this.pointMap;var n=1,s=1;r.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-n,-s,-1),i("n2",n,-s,-1),i("n3",-n,s,-1),i("n4",n,s,-1),i("f1",-n,-s,1),i("f2",n,-s,1),i("f3",-n,s,1),i("f4",n,s,1),i("u1",n*.7,s*1.1,-1),i("u2",-n*.7,s*1.1,-1),i("u3",0,s*2,-1),i("cf1",-n,0,1),i("cf2",n,0,1),i("cf3",0,-s,1),i("cf4",0,s,1),i("cn1",-n,0,-1),i("cn2",n,0,-1),i("cn3",0,-s,-1),i("cn4",0,s,-1),e.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(-t,t,0),new THREE.Vector3(t,t,0),new THREE.Vector3(t,-t,0),new THREE.Vector3(-t,-t,0),new THREE.Vector3(-t,t,0));var r=new THREE.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Line(n,r),this.add(this.lightPlane),n=new THREE.Geometry,n.vertices.push(new THREE.Vector3,new THREE.Vector3),r=new THREE.LineBasicMaterial({fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(n,r),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper,THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(e,t,n){var r=t!==undefined?t:16777215;THREE.LineSegments.call(this,new THREE.EdgesGeometry(e.geometry,n),new THREE.LineBasicMaterial({color:r})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.EdgesHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper,THREE.FaceNormalsHelper=function(e,t,n,r){this.object=e,this.size=t!==undefined?t:1;var i=n!==undefined?n:16776960,s=r!==undefined?r:1,o=0,u=this.object.geometry;u instanceof THREE.Geometry?o=u.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var a=new THREE.BufferGeometry,f=new THREE.Float32Attribute(o*2*3,3);a.addAttribute("position",f),THREE.LineSegments.call(this,a,new THREE.LineBasicMaterial({color:i,linewidth:s})),this.matrixAutoUpdate=!1,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper,THREE.FaceNormalsHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Matrix3;return function(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,s=this.geometry.attributes.position,o=this.object.geometry,u=o.vertices,a=o.faces,f=0;for(var l=0,c=a.length;l<c;l++){var h=a[l],p=h.normal;e.copy(u[h.a]).add(u[h.b]).add(u[h.c]).divideScalar(3).applyMatrix4(i),t.copy(p).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),s.setXYZ(f,e.x,e.y,e.z),f+=1,s.setXYZ(f,t.x,t.y,t.z),f+=1}return s.needsUpdate=!0,this}}(),THREE.GridHelper=function(e,t){var n=new THREE.Geometry,r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var i=-e;i<=e;i+=t){n.vertices.push(new THREE.Vector3(-e,0,i),new THREE.Vector3(e,0,i),new THREE.Vector3(i,0,-e),new THREE.Vector3(i,0,e));var s=i===0?this.color1:this.color2;n.colors.push(s,s,s,s)}THREE.LineSegments.call(this,n,r)},THREE.GridHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.GridHelper.prototype.constructor=THREE.GridHelper,THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var n=new THREE.SphereGeometry(t,4,2);n.rotateX(-Math.PI/2);for(var r=0,i=8;r<i;r++)n.faces[r].color=this.colors[r<4?0:1];var s=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(n,s),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper,THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var n=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,n,r),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper,THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(e){this.bones=this.getBoneList(e);var t=new THREE.Geometry;for(var n=0;n<this.bones.length;n++){var r=this.bones[n];r.parent instanceof THREE.Bone&&(t.vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3),t.colors.push(new THREE.Color(0,0,1)),t.colors.push(new THREE.Color(0,1,0)))}t.dynamic=!0;var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});THREE.LineSegments.call(this,t,i),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper,THREE.SkeletonHelper.prototype.getBoneList=function(e){var t=[];e instanceof THREE.Bone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,this.getBoneList(e.children[n]));return t},THREE.SkeletonHelper.prototype.update=function(){var e=this.geometry,t=(new THREE.Matrix4).getInverse(this.root.matrixWorld),n=new THREE.Matrix4,r=0;for(var i=0;i<this.bones.length;i++){var s=this.bones[i];s.parent instanceof THREE.Bone&&(n.multiplyMatrices(t,s.matrixWorld),e.vertices[r].setFromMatrixPosition(n),n.multiplyMatrices(t,s.parent.matrixWorld),e.vertices[r+1].setFromMatrixPosition(n),r+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new THREE.CylinderGeometry(0,1,1,8,1,!0);t.translate(0,-0.5,0),t.rotateX(-Math.PI/2);var n=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(t,n),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper,THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,n,r){this.object=e,this.size=t!==undefined?t:1;var i=n!==undefined?n:16711680,s=r!==undefined?r:1,o=0,u=this.object.geometry;u instanceof THREE.Geometry?o=u.faces.length*3:u instanceof THREE.BufferGeometry&&(o=u.attributes.normal.count);var a=new THREE.BufferGeometry,f=new THREE.Float32Attribute(o*2*3,3);a.addAttribute("position",f),THREE.LineSegments.call(this,a,new THREE.LineBasicMaterial({color:i,linewidth:s})),this.matrixAutoUpdate=!1,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper,THREE.VertexNormalsHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Matrix3;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var s=this.object.matrixWorld,o=this.geometry.attributes.position,u=this.object.geometry;if(u instanceof THREE.Geometry){var a=u.vertices,f=u.faces,l=0;for(var c=0,h=f.length;c<h;c++){var p=f[c];for(var d=0,v=p.vertexNormals.length;d<v;d++){var m=a[p[i[d]]],g=p.vertexNormals[d];e.copy(m).applyMatrix4(s),t.copy(g).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),o.setXYZ(l,e.x,e.y,e.z),l+=1,o.setXYZ(l,t.x,t.y,t.z),l+=1}}}else if(u instanceof THREE.BufferGeometry){var y=u.attributes.position,b=u.attributes.normal,l=0;for(var d=0,v=y.count;d<v;d++)e.set(y.getX(d),y.getY(d),y.getZ(d)).applyMatrix4(s),t.set(b.getX(d),b.getY(d),b.getZ(d)),t.applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),o.setXYZ(l,e.x,e.y,e.z),l+=1,o.setXYZ(l,t.x,t.y,t.z),l+=1}return o.needsUpdate=!0,this}}(),THREE.WireframeHelper=function(e,t){var n=t!==undefined?t:16777215;THREE.LineSegments.call(this,new THREE.WireframeGeometry(e.geometry),new THREE.LineBasicMaterial({color:n})),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},THREE.WireframeHelper.prototype=Object.create(THREE.LineSegments.prototype),THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper,THREE.ImmediateRenderObject=function(e){THREE.Object3D.call(this),this.material=e,this.render=function(e){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject,THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,r="__default",i=0,s=n-1,o=n/1;this.createAnimation(r,i,s,o),this.setAnimationWeight(r,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh,THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){var i={start:t,end:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=i,this.animationsList.push(i)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){var t=/([a-z]+)_?(\d+)/,n,r={},i=this.geometry;for(var s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s],a=u.name.match(t);if(a&&a.length>1){var f=a[1];r[f]||(r[f]={start:Infinity,end:-Infinity});var l=r[f];s<l.start&&(l.start=s),s>l.end&&(l.end=s),n||(n=f)}}for(var f in r){var l=r[f];this.createAnimation(f,l.start,l.end,e)}this.firstAnimation=n},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,n=this.animationsMap[e];return n&&(t=n.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,n=this.animationsMap[e];return n&&(t=n.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(!r.active)continue;var i=r.duration/r.length;r.time+=r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||r.time<0)r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)}else r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration);var s=r.start+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1),o=r.weight;s!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*o,this.morphTargetInfluences[s]=0,r.lastFrame=r.currentFrame,r.currentFrame=s);var u=r.time%i/i;r.directionBackwards&&(u=1-u),r.currentFrame!==r.lastFrame?(this.morphTargetInfluences[r.currentFrame]=u*o,this.morphTargetInfluences[r.lastFrame]=(1-u)*o):this.morphTargetInfluences[r.currentFrame]=o}},define("THREE",function(e){return function(){var t,n;return t||e.THREE}}(this)),define("cnc/maths/slicer",["THREE","clipper","cnc/cam/cam"],function(e,t,n){function r(e,t,n){function s(n,r,i){var s=t.vertices[n],o=t.vertices[r],u=e-s.z,a=e-o.z;if(u*a>=0)return null;var f=u/(u-a);return[n,r,o.clone().sub(s).multiplyScalar(f).add(s),i]}function a(e,t){u[e]===undefined&&(u[e]=[]),u[e].push(t)}function f(e,t,n){function r(e,t){for(var n=0;n<i[e].length;n++)if(i[e][n]==t){i[e].splice(n,1),i[e].length==0&&delete i[e];break}}var i=JSON.parse(JSON.stringify(t)),s=null,u=e,a=[e],l=[o[e]];do{var c=!1;for(var h=0;i[u]!==undefined&&h<i[u].length;h++)if(i[u][h]!=s){s=u,a.push(i[u][h]),l.push(o[i[u][h]]),u=i[u][h],r(s,u),r(u,s),c=!0;break}}while(u!=e&&c);return!c&&!n?f(a[a.length-1],t,!0):{path:a,vertexPath:l,remainingGraph:i}}var r=t.vertices.length,i=[],o=[],u=[];$.each(t.faces,function(e,t){var u=s(t.a,t.b,t.c),f=s(t.b,t.c,t.a);if(u||f){var l=s(t.c,t.a,t.b),c=[];$.each([u,f,l],function(e,t){if(t){var n=Math.min(t[0],t[1]),i=Math.max(t[0],t[1]),s=n+i*r;o[s]=t[2],c.push(s)}}),a(c[0],c[1]),a(c[1],c[0]),n||i.push(t)}});var l=[];do{var c=null;for(var h in u)if(String(h>>>0)==h&&h>>>0!=4294967295&&u[h]){c=h;break}if(c!==null){var p=f(c,u);l.push(p.vertexPath),u=p.remainingGraph}}while(c!==null);return{contours:l,triangles:n?undefined:i}}function i(i,s){var o=new e.Geometry;o.fromBufferGeometry(s),o.mergeVertices();var u=r(i,o,!0).contours,a=n.polygonsToClipper(u);return a=n.polyOp(a,[],t.ClipType.ctUnion,!1,t.PolyFillType.pftEvenOdd),n.clipperToPathDef(a)}return{slice:r,polygonCorrectedSliceAsSvg:i}});